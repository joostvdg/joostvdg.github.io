<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Introduction Into Concurrency With Java"><link href=https://joostvdg.github.io/java/concurrency/ rel=canonical><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.2"><title>Java Concurrency</title><link rel=stylesheet href=../../assets/stylesheets/application.30686662.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#fb8c00><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-145385967-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=orange data-md-color-accent=red> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#java-concurrency tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo"> <i class=md-icon>public</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> J's Software Development Pages </span> <span class=md-header-nav__topic> Java Concurrency </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../blogs/jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../../cloudbees/sso-azure-ad/ class=md-tabs__link> CICD </a> </li> <li class=md-tabs__item> <a href=../../kubernetes/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ class=md-tabs__link> Cloud </a> </li> <li class=md-tabs__item> <a href=../../certificates/lets-encrypt-k8s/ class=md-tabs__link> SWE </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> Java </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo"> <i class=md-icon>public</i> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Blogs </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../blogs/docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../blogs/k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../blogs/sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../blogs/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../blogs/kubernetes-sso-keycloak/ title="Kubernetes SSO Keycloak" class=md-nav__link> Kubernetes SSO Keycloak </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8> <label class=md-nav__link for=nav-2-8> Jenkins Monitoring Kubernetes </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-8> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/metrics/ title=Metrics class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../blogs/k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../blogs/dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> CICD </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> CICD </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> CloudBees </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-1> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloudbees/sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../../cloudbees/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-team-namespace/ title="Team Master Namespace" class=md-nav__link> Team Master Namespace </a> </li> <li class=md-nav__item> <a href=../../cloudbees/multi-cluster/ title=Multi-Cluster class=md-nav__link> Multi-Cluster </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Jenkins X </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/build-packs/ title="Build Packs" class=md-nav__link> Build Packs </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jx-pipelines/ title="Jenkins X Pipelines" class=md-nav__link> Jenkins X Pipelines </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot/ title="JX Boot GKE" class=md-nav__link> JX Boot GKE </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot-aks/ title="JX Boot AKS" class=md-nav__link> JX Boot AKS </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/aks-boot-core/ title="JX Boot & CloudBees Core" class=md-nav__link> JX Boot & CloudBees Core </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/kubernetes-days/ title="Example For Console Reel" class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-3> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-4> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/kaniko-pipelines/ title="Build Docker Image Kaniko" class=md-nav__link> Build Docker Image Kaniko </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/podtemplate-dind/ title="PodTemplate With Docker-In-Docker" class=md-nav__link> PodTemplate With Docker-In-Docker </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ title="Parallel Pipelines" class=md-nav__link> Parallel Pipelines </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-5 type=checkbox id=nav-3-5> <label class=md-nav__link for=nav-3-5> Jenkins Pipeline Examples </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-5> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Containers </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1> <label class=md-nav__link for=nav-4-1> Kubernetes (K8S) </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> K8S Public Services </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-2> K8S Public Services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/gke-terraform/ title="GKE Terraform" class=md-nav__link> GKE Terraform </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> K8S Hard Way - GCE </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-3> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4> <label class=md-nav__link for=nav-4-4> Docker </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-4> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-5> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Cloud </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Cloud </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ title="Automation - Pulumi" class=md-nav__link> Automation - Pulumi </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> SWE </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> SWE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../certificates/lets-encrypt-k8s/ title="Let's Encrypt K8S" class=md-nav__link> Let's Encrypt K8S </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-3> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7 checked> <label class=md-nav__link for=nav-7> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Java Concurrency </label> <a href=./ title="Java Concurrency" class="md-nav__link md-nav__link--active"> Java Concurrency </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#terminology class=md-nav__link> Terminology </a> </li> <li class=md-nav__item> <a href=#patterns class=md-nav__link> Patterns </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#queue-deque class=md-nav__link> Queue &amp; Deque </a> </li> <li class=md-nav__item> <a href=#monitor-pattern class=md-nav__link> Monitor pattern </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#confinement class=md-nav__link> Confinement </a> </li> <li class=md-nav__item> <a href=#http-call-counter class=md-nav__link> HTTP Call Counter </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#unsafe-counter class=md-nav__link> Unsafe Counter </a> </li> <li class=md-nav__item> <a href=#safe-counter class=md-nav__link> Safe Counter </a> </li> <li class=md-nav__item> <a href=#caller class=md-nav__link> Caller </a> </li> <li class=md-nav__item> <a href=#outcome class=md-nav__link> Outcome </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#terminology class=md-nav__link> Terminology </a> </li> <li class=md-nav__item> <a href=#patterns class=md-nav__link> Patterns </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#queue-deque class=md-nav__link> Queue &amp; Deque </a> </li> <li class=md-nav__item> <a href=#monitor-pattern class=md-nav__link> Monitor pattern </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#confinement class=md-nav__link> Confinement </a> </li> <li class=md-nav__item> <a href=#http-call-counter class=md-nav__link> HTTP Call Counter </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#unsafe-counter class=md-nav__link> Unsafe Counter </a> </li> <li class=md-nav__item> <a href=#safe-counter class=md-nav__link> Safe Counter </a> </li> <li class=md-nav__item> <a href=#caller class=md-nav__link> Caller </a> </li> <li class=md-nav__item> <a href=#outcome class=md-nav__link> Outcome </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/java/concurrency.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=java-concurrency>Java Concurrency<a class=headerlink href=#java-concurrency title="Permanent link">&para;</a></h1> <h2 id=terminology>Terminology<a class=headerlink href=#terminology title="Permanent link">&para;</a></h2> <details class=note><summary>Correctness</summary><p>Correctness means that a class <em>conforms to its specification</em>. A good specification defines <em>invariants</em> constraining an object’s state and <em>postconditions</em> describing the effects of its operations. <sup id=fnref10:6><a class=footnote-ref href=#fn:6>6</a></sup></p> </details> <details class=note><summary>Thread Safe Class</summary><p>a class is thread-safe when it continues to behave correctly when accessed from multiple threads</p> <p>No set of operations performed sequentially or concurrently on instances of a thread-safe class can cause an instance to be in an invalid state. <sup id=fnref9:6><a class=footnote-ref href=#fn:6>6</a></sup></p> </details> <details class=note><summary>Mutex</summary><p>Every Java object can implicitly act as a lock for purposes of synchronization; these built-in locks are called <strong>intrinsic locks</strong> or <strong>monitor locks</strong>. The lock is auto-matically acquired by the executing thread before entering a synchronized block and automatically released when control exits the synchronized block, whether by the normal control path or by throwing an exception out of the block.</p> <p>Intrinsic locks in Java act as <strong>mutexes</strong> (or <strong>mutual exclusion locks</strong>), which means that at most one thread may own the lock. When thread A attempts to acquire a lock held by thread B, A must wait, or block, until B releases it. If B never releases the lock, A waits forever. <sup id=fnref8:6><a class=footnote-ref href=#fn:6>6</a></sup></p> </details> <details class=note><summary>Reentrant locks</summary><p>When a thread requests a lock that is already held by another thread, the requesting thread blocks. But because intrinsic locks are <strong>reentrant</strong>, if a thread tries to acquire a lock that it already holds, the request succeeds. </p> <p><strong>Reentrancy</strong> means that locks are acquired on a per-thread rather than per-invocation basis. </p> <p><strong>Reentrancy</strong> is implemented by associating with each lock an <strong>acquisition count</strong> and an owning <strong>thread</strong>. When the count is zero, the lock is considered unheld. </p> <p>When a thread acquires a previously unheld lock, the JVM records the owner and sets the acquisition count to one. </p> <p>If that same thread acquires the lock again, the count is incremented, and when the owning thread exits the <strong>synchronized block</strong>, the count is decremented. When the count reaches zero, the lock is released. <sup id=fnref7:6><a class=footnote-ref href=#fn:6>6</a></sup></p> </details> <details class=note><summary>Liveness</summary><p>In concurrent computing, liveness refers to a set of properties of concurrent systems, that require a system to make progress despite the fact that its concurrently executing components ("processes") may have to "take turns" in critical sections, parts of the program that cannot be simultaneously run by multiple processes.<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup> </p> <p>Liveness guarantees are important properties in operating systems and distributed systems.<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup></p> <p>A liveness property cannot be violated in a finite execution of a distributed system because the "good" event might only theoretically occur at some time after execution ends. Eventual consistency is an example of a liveness property.<sup id=fnref:3><a class=footnote-ref href=#fn:3>3</a></sup> </p> <p>All properties can be expressed as the intersection of safety and liveness properties.<sup id=fnref:4><a class=footnote-ref href=#fn:4>4</a></sup></p> </details> <details class=note><summary>Volatile fields</summary><p>When a field is declared <strong>volatile</strong>, the <strong>compiler</strong> and <strong>runtime</strong> are put on notice that this variable is shared and that operations on it should not be reordered with other memory operations. </p> <p>Volatile variables are not cached in registers or in caches where they are hidden from other processors, so a read of a volatile variable always returns the <strong>most recent write</strong> by <strong>any</strong> thread. <sup id=fnref6:6><a class=footnote-ref href=#fn:6>6</a></sup></p> <p>You can use volatile variables only when all the following criteria are met:</p> <ul> <li>Writes to the variable do not depend on its current value, or you can ensure that only a single thread ever updates the value;</li> <li>The variable does not participate in invariants with other state variables;</li> <li>Locking is not required for any other reason while the variable is being accessed</li> </ul> </details> <details class=note><summary>Confinement</summary><p>Confined objects must not escape their intended scope. An object may be confined to a class instance (such as a private class member), a lexical scope (such as a local variable), or a thread (such as an object that is passed from method to method within a thread, but not supposed to be shared across threads). </p> <p>Objects don’t escape on their own, of course—they need help from the developer, who assists by publishing the object beyond its intended scope. <sup id=fnref5:6><a class=footnote-ref href=#fn:6>6</a></sup></p> </details> <details class=note><summary>Latch</summary><p>Simply put, a CountDownLatch has a counter field, which you can decrement as we require. We can then use it to block a calling thread until it’s been counted down to zero.</p> <p>If we were doing some parallel processing, we could instantiate the CountDownLatch with the same value for the counter as a number of threads we want to work across. </p> <p>Then, we could just call countdown() after each thread finishes, guaranteeing that a dependent thread calling await() will block until the worker threads are finished. <sup id=fnref2:7><a class=footnote-ref href=#fn:7>7</a></sup></p> </details> <details class=note><summary>Semaphore</summary><p>In computer science, a semaphore is a variable or abstract data type used to control access to a common resource by multiple processes in a concurrent system such as a multiprogramming operating system.</p> <p>A trivial semaphore is a plain variable that is changed (for example, incremented or decremented, or toggled) depending on programmer-defined conditions. The variable is then used as a condition to control access to some system resource.</p> <p>A useful way to think of a semaphore as used in the real-world systems is as a record of how many units of a particular resource are available, coupled with operations to adjust that record safely (i.e. to avoid race conditions) as units are required or become free, and, if necessary, wait until a unit of the resource becomes available. <sup id=fnref:7><a class=footnote-ref href=#fn:7>7</a></sup></p> </details> <details class=note><summary>Java Thread pools</summary><p>There are several different types of Thread pools available.</p> <ul> <li> <p><strong>FixedThreadPool</strong>: A fixed-size thread pool creates threads as tasks are submitted, up to the maximum pool size, and then attempts to keep the pool size constant (adding new threads if a thread dies due to an unexpected Exception ).</p> </li> <li> <p><strong>CachedThreadPool</strong>: A cached thread pool has more flexibility to reap idle threads when the current size of the pool exceeds the demand for processing, and to add new threads when demand increases, but places no bounds on the size of the pool.</p> </li> <li> <p><strong>SingleThreadExecutor</strong>: A single-threaded executor creates a single worker thread to process tasks, replacing it if it dies unexpectedly. Tasks are guaranteed to be processed sequentially according to the order imposed by the task queue (FIFO, LIFO, priority order). 4</p> </li> <li> <p><strong>ScheduledThreadPool</strong>: A fixed-size thread pool that supports delayed and periodic task execution, similar to Timer. <sup id=fnref4:6><a class=footnote-ref href=#fn:6>6</a></sup></p> </li> </ul> </details> <details class=note><summary>Interrupt</summary><p>Thread provides the <strong>interrupt</strong> method for interrupting a thread and for querying whether a thread has been interrupted. Each thread has a boolean property that represents its interrupted status; interrupting a thread sets this status. Interruption is a <strong>cooperative</strong> mechanism. </p> <p>One thread cannot force another to stop what it is doing and do something else; when thread A interrupts thread B, A is merely requesting that B stop what it is doing when it gets to a convenient stopping point—if it feels like it.</p> <p>When your code calls a method that throws InterruptedException , then your method is a blocking method too, and must have a plan for responding to inter- ruption. </p> <p>For library code, there are basically two choices:</p> <ul> <li> <p><strong>Propagate the InterruptedException</strong>: This is often the most sensible policy if you can get away with it: just propagate the InterruptedException to your caller. This could involve not catching InterruptedException , or catching it and throwing it again after performing some brief activity-specific cleanup.</p> </li> <li> <p><strong>Restore the interrupt</strong>: Sometimes you cannot throw InterruptedException , for instance when your code is part of a Runnable . In these situations, you must catch InterruptedException and restore the interrupted status by calling interrupt on the current thread, so that code higher up the call stack can see that an interrupt was issued. <sup id=fnref3:6><a class=footnote-ref href=#fn:6>6</a></sup></p> </li> </ul> </details> <h2 id=patterns>Patterns<a class=headerlink href=#patterns title="Permanent link">&para;</a></h2> <h3 id=queue-deque>Queue &amp; Deque<a class=headerlink href=#queue-deque title="Permanent link">&para;</a></h3> <div class="admonition note"> <p class=admonition-title>Queue &amp; Deque</p> <p>A Deque is a double-ended queue that allows efficient insertion and removal from both the head and the tail. Implementations include ArrayDeque and LinkedBlockingDeque .</p> <p>Just as blocking queues lend themselves to the producer-consumer pattern, deques lend themselves to a related pattern called work stealing. </p> <p>A producer-consumer design has one shared work queue for all consumers; in a work stealing design, every consumer has its own deque. </p> <p>If a consumer exhausts the work in its own deque, it can steal work from the tail of someone else’s deque. </p> <p>Work stealing can be more scalable than a traditional producer-consumer design because workers don’t contend for a shared work queue; most of the time they access only their own deque, reducing contention. </p> <p>When a worker has to access another’s queue, it does so from the tail rather than the head, further reducing contention. <sup id=fnref2:6><a class=footnote-ref href=#fn:6>6</a></sup></p> </div> <h3 id=monitor-pattern>Monitor pattern<a class=headerlink href=#monitor-pattern title="Permanent link">&para;</a></h3> <h4 id=resources>Resources<a class=headerlink href=#resources title="Permanent link">&para;</a></h4> <ul> <li><a href=http://www.tomaszezula.com/2014/08/30/concurrency-patterns-monitor-object/ >concurrency-patterns-monitor-object</a></li> <li><a href=https://en.wikipedia.org/wiki/Monitor_(synchronization)>Wikipedia article on monitor pattern</a></li> <li><a href=http://blog.e-zest.com/java-monitor-pattern/ >e-zest blog on monitor pattern java</a></li> </ul> <h2 id=examples>Examples<a class=headerlink href=#examples title="Permanent link">&para;</a></h2> <h3 id=confinement>Confinement<a class=headerlink href=#confinement title="Permanent link">&para;</a></h3> <blockquote> <p>PersonSet (below) illustrates how confinement and locking can work together to make a class thread-safe even when its component state variables are not. The state of PersonSet is managed by a HashSet , which is not thread-safe.</p> </blockquote> <p>But because mySet is private and not allowed to escape, the HashSet is confined to the PersonSet. </p> <p>The only code paths that can access mySet are addPerson and containsPerson , and each of these acquires the lock on the PersonSet. </p> <p>All its state is guarded by its intrinsic lock, making PersonSet thread-safe. <sup id=fnref:6><a class=footnote-ref href=#fn:6>6</a></sup></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PersonSet</span> <span class=o>{</span>
    <span class=nd>@GuardedBy</span><span class=o>(</span><span class=s>&quot;this&quot;</span><span class=o>)</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>mySet</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;();</span>

    <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>void</span> <span class=nf>addPerson</span><span class=o>(</span><span class=n>Person</span> <span class=n>p</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>mySet</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>p</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>boolean</span> <span class=nf>containsPerson</span><span class=o>(</span><span class=n>Person</span> <span class=n>p</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>mySet</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>p</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div> </td></tr></table> <h3 id=http-call-counter>HTTP Call Counter<a class=headerlink href=#http-call-counter title="Permanent link">&para;</a></h3> <h4 id=unsafe-counter>Unsafe Counter<a class=headerlink href=#unsafe-counter title="Permanent link">&para;</a></h4> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UnsafeCounter</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=kt>long</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>

    <span class=kd>public</span> <span class=kt>long</span> <span class=nf>getCount</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>count</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>()</span> <span class=o>{</span>
        <span class=c1>// do some work</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=kt>int</span> <span class=n>pseudoRandom</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>nextInt</span><span class=o>(</span><span class=mi>20</span><span class=o>);</span>
            <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>pseudoRandom</span> <span class=o>*</span> <span class=mi>100</span><span class=o>);</span>
            <span class=o>++</span><span class=n>count</span><span class=o>;</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div> </td></tr></table> <h4 id=safe-counter>Safe Counter<a class=headerlink href=#safe-counter title="Permanent link">&para;</a></h4> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SafeCounter</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>final</span> <span class=n>AtomicLong</span> <span class=n>count</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AtomicLong</span><span class=o>(</span><span class=mi>0</span><span class=o>);</span>

    <span class=kd>public</span> <span class=kt>long</span> <span class=nf>getCount</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>count</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>service</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=kt>int</span> <span class=n>pseudoRandom</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>().</span><span class=na>nextInt</span><span class=o>(</span><span class=mi>20</span><span class=o>);</span>
            <span class=n>Thread</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=n>pseudoRandom</span> <span class=o>*</span> <span class=mi>100</span><span class=o>);</span>
            <span class=n>count</span><span class=o>.</span><span class=na>incrementAndGet</span><span class=o>();</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div> </td></tr></table> <h4 id=caller>Caller<a class=headerlink href=#caller title="Permanent link">&para;</a></h4> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Server</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>start</span><span class=o>(</span><span class=kt>int</span> <span class=n>port</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>HttpServer</span> <span class=n>server</span> <span class=o>=</span> <span class=n>HttpServer</span><span class=o>.</span><span class=na>create</span><span class=o>(</span><span class=k>new</span> <span class=n>InetSocketAddress</span><span class=o>(</span><span class=n>port</span><span class=o>),</span> <span class=mi>0</span><span class=o>);</span>
        <span class=n>UnsafeCounter</span> <span class=n>unsafeCounter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>UnsafeCounter</span><span class=o>();</span>
        <span class=n>SafeCounter</span> <span class=n>safeCounter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SafeCounter</span><span class=o>();</span>
        <span class=n>server</span><span class=o>.</span><span class=na>createContext</span><span class=o>(</span><span class=s>&quot;/test&quot;</span><span class=o>,</span> <span class=k>new</span> <span class=n>MyTestHandler</span><span class=o>(</span><span class=n>unsafeCounter</span><span class=o>,</span> <span class=n>safeCounter</span><span class=o>));</span>
        <span class=n>server</span><span class=o>.</span><span class=na>createContext</span><span class=o>(</span><span class=s>&quot;/&quot;</span><span class=o>,</span> <span class=k>new</span> <span class=n>MyHandler</span><span class=o>(</span><span class=n>unsafeCounter</span><span class=o>,</span> <span class=n>safeCounter</span><span class=o>));</span>
        <span class=n>Executor</span> <span class=n>executor</span> <span class=o>=</span> <span class=n>Executors</span><span class=o>.</span><span class=na>newFixedThreadPool</span><span class=o>(</span><span class=mi>5</span><span class=o>);</span>
        <span class=n>server</span><span class=o>.</span><span class=na>setExecutor</span><span class=o>(</span><span class=n>executor</span><span class=o>);</span> <span class=c1>// creates a default executor</span>
        <span class=n>server</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=kd>static</span> <span class=kd>class</span> <span class=nc>MyTestHandler</span> <span class=kd>implements</span> <span class=n>HttpHandler</span> <span class=o>{</span>
        <span class=kd>private</span> <span class=n>UnsafeCounter</span> <span class=n>unsafeCounter</span><span class=o>;</span>
        <span class=kd>private</span> <span class=n>SafeCounter</span> <span class=n>safeCounter</span><span class=o>;</span>

        <span class=kd>public</span> <span class=nf>MyTestHandler</span><span class=o>(</span><span class=n>UnsafeCounter</span> <span class=n>unsafeCounter</span><span class=o>,</span> <span class=n>SafeCounter</span> <span class=n>safeCounter</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>this</span><span class=o>.</span><span class=na>unsafeCounter</span> <span class=o>=</span> <span class=n>unsafeCounter</span><span class=o>;</span>
            <span class=k>this</span><span class=o>.</span><span class=na>safeCounter</span> <span class=o>=</span> <span class=n>safeCounter</span><span class=o>;</span>
        <span class=o>}</span>

        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>handle</span><span class=o>(</span><span class=n>HttpExchange</span> <span class=n>t</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
            <span class=n>safeCounter</span><span class=o>.</span><span class=na>service</span><span class=o>();</span>
            <span class=n>unsafeCounter</span><span class=o>.</span><span class=na>service</span><span class=o>();</span>
            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&quot;Got a request on /test, counts so far:&quot;</span><span class=o>+</span> <span class=n>unsafeCounter</span><span class=o>.</span><span class=na>getCount</span><span class=o>()</span> <span class=o>+</span> <span class=s>&quot;::&quot;</span> <span class=o>+</span> <span class=n>safeCounter</span><span class=o>.</span><span class=na>getCount</span><span class=o>());</span>
            <span class=n>String</span> <span class=n>response</span> <span class=o>=</span> <span class=s>&quot;This is the response&quot;</span><span class=o>;</span>
            <span class=n>t</span><span class=o>.</span><span class=na>sendResponseHeaders</span><span class=o>(</span><span class=mi>200</span><span class=o>,</span> <span class=n>response</span><span class=o>.</span><span class=na>length</span><span class=o>());</span>
            <span class=k>try</span> <span class=o>(</span><span class=n>OutputStream</span> <span class=n>os</span> <span class=o>=</span> <span class=n>t</span><span class=o>.</span><span class=na>getResponseBody</span><span class=o>())</span> <span class=o>{</span>
                <span class=n>os</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>getBytes</span><span class=o>());</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div> </td></tr></table> <h4 id=outcome>Outcome<a class=headerlink href=#outcome title="Permanent link">&para;</a></h4> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span>Starting server on port <span class=m>8080</span>
Server started
Got a request on /, counts so far:2::1
Got a request on /, counts so far:6::2
Got a request on /, counts so far:6::3
Got a request on /, counts so far:6::4
Got a request on /, counts so far:6::5
Got a request on /, counts so far:6::6
</pre></div> </td></tr></table> <div class=footnote> <hr> <ol> <li id=fn:1> <p>Lamport, L. (1977). "Proving the Correctness of Multiprocess Programs". IEEE Transactions on Software Engineering (2): 125–143. doi:<a href=https://doi.org/10.1109%2FTSE.1977.229904>10.1109/TSE.1977.229904</a>.&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:2> <p>Luís Rodrigues, Christian Cachin; Rachid Guerraoui (2010). Introduction to reliable and secure distributed programming (2. ed.). Berlin: Springer Berlin. pp. 22–24. <a href=https://en.wikipedia.org/wiki/International_Standard_Book_Number>ISBN</a> <a href=https://en.wikipedia.org/wiki/Special:BookSources/978-3-642-15259-7>978-3-642-15259-7</a>.&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> <li id=fn:3> <p>Bailis, P.; Ghodsi, A. (2013). "Eventual Consistency Today: Limitations, Extensions, and Beyond". Queue. 11 (3): 20. doi:<a href=https://doi.org/10.1145%2F2460276.2462076>10.1145/2460276.2462076</a>.&#160;<a class=footnote-backref href=#fnref:3 title="Jump back to footnote 3 in the text">&#8617;</a></p> </li> <li id=fn:4> <p>Alpern, B.; Schneider, F. B. (1987). "Recognizing safety and liveness". Distributed Computing. 2 (3): 117. doi:<a href=https://doi.org/10.1007%2FBF01782772>10.1007/BF01782772</a>.&#160;<a class=footnote-backref href=#fnref:4 title="Jump back to footnote 4 in the text">&#8617;</a></p> </li> <li id=fn:5> <p><a href=https://en.wikipedia.org/wiki/Liveness>Liveness article Wikipedia</a>&#160;<a class=footnote-backref href=#fnref:5 title="Jump back to footnote 5 in the text">&#8617;</a></p> </li> <li id=fn:6> <p>Java Concurrency in Practice / Brian Goetz, with Tim Peierls. . . [et al.] <a href=https://www.amazon.com/Java-Concurrency-Practice-Brian-Goetz/dp/0321349601>Concurrency in Practice</a>&#160;<a class=footnote-backref href=#fnref:6 title="Jump back to footnote 6 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:6 title="Jump back to footnote 6 in the text">&#8617;</a><a class=footnote-backref href=#fnref3:6 title="Jump back to footnote 6 in the text">&#8617;</a><a class=footnote-backref href=#fnref4:6 title="Jump back to footnote 6 in the text">&#8617;</a><a class=footnote-backref href=#fnref5:6 title="Jump back to footnote 6 in the text">&#8617;</a><a class=footnote-backref href=#fnref6:6 title="Jump back to footnote 6 in the text">&#8617;</a><a class=footnote-backref href=#fnref7:6 title="Jump back to footnote 6 in the text">&#8617;</a><a class=footnote-backref href=#fnref8:6 title="Jump back to footnote 6 in the text">&#8617;</a><a class=footnote-backref href=#fnref9:6 title="Jump back to footnote 6 in the text">&#8617;</a><a class=footnote-backref href=#fnref10:6 title="Jump back to footnote 6 in the text">&#8617;</a></p> </li> <li id=fn:7> <p><a href=http://www.baeldung.com/java-countdown-latch>Baeldung tutorial on CountDownLatch</a>&#160;<a class=footnote-backref href=#fnref:7 title="Jump back to footnote 7 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:7 title="Jump back to footnote 7 in the text">&#8617;</a></p> </li> <li id=fn:8> <p><a href=https://en.wikipedia.org/wiki/Semaphore_(programming)>Wikipedia article on Semaphore</a>&#160;<a class=footnote-backref href=#fnref:8 title="Jump back to footnote 8 in the text">&#8617;</a></p> </li> </ol> </div> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://joostvdg.github.io/java/concurrency/";
      this.page.identifier =
        "/java/concurrency/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//joostvdg-github-io.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../networking/ title="Java Networking" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Java Networking </span> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 Joost van der Griendt </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/joostvdg class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/joost_vdg class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/joostvdg class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c648116f.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> </body> </html>