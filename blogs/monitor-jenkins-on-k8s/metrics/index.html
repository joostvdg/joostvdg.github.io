<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link href=https://joostvdg.github.io/blogs/monitor-jenkins-on-k8s/metrics/ rel=canonical><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.2"><title>Metrics - J's Software Development Pages</title><link rel=stylesheet href=../../../assets/stylesheets/application.30686662.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#fb8c00><script src=../../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-145385967-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=orange data-md-color-accent=red> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#metrics tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo"> <i class=md-icon>public</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> J's Software Development Pages </span> <span class=md-header-nav__topic> Metrics </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../jenkins-pipeline-support-tool/ class="md-tabs__link md-tabs__link--active"> Blogs </a> </li> <li class=md-tabs__item> <a href=../../../cloudbees/sso-azure-ad/ class=md-tabs__link> CICD </a> </li> <li class=md-tabs__item> <a href=../../../kubernetes/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../../cloud/automation-pulumi/ class=md-tabs__link> Cloud </a> </li> <li class=md-tabs__item> <a href=../../../certificates/lets-encrypt-k8s/ class=md-tabs__link> SWE </a> </li> <li class=md-tabs__item> <a href=../../../java/ class=md-tabs__link> Java </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo"> <i class=md-icon>public</i> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Blogs </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../../graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../kubernetes-sso-keycloak/ title="Kubernetes SSO Keycloak" class=md-nav__link> Kubernetes SSO Keycloak </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8 checked> <label class=md-nav__link for=nav-2-8> Jenkins Monitoring Kubernetes </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-8> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Metrics </label> <a href=./ title=Metrics class="md-nav__link md-nav__link--active"> Metrics </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#types-of-metrics-to-evaluate class=md-nav__link> Types of Metrics to evaluate </a> </li> <li class=md-nav__item> <a href=#jvm-metrics class=md-nav__link> JVM Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#garbage-collection class=md-nav__link> Garbage Collection </a> </li> <li class=md-nav__item> <a href=#check-for-too-many-open-files class=md-nav__link> Check for too many open files </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#jenkins-config-metrics class=md-nav__link> Jenkins Config Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#plugins class=md-nav__link> Plugins </a> </li> <li class=md-nav__item> <a href=#jenkins-build-nodes class=md-nav__link> Jenkins Build Nodes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#jenkins-usage-metrics class=md-nav__link> Jenkins Usage Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#builds-per-day class=md-nav__link> Builds Per Day </a> </li> <li class=md-nav__item> <a href=#job-duration class=md-nav__link> Job duration </a> </li> <li class=md-nav__item> <a href=#job-count class=md-nav__link> Job Count </a> </li> <li class=md-nav__item> <a href=#jobs-in-queue class=md-nav__link> Jobs in Queue </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#web-metrics class=md-nav__link> Web Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#http-requests class=md-nav__link> HTTP Requests </a> </li> <li class=md-nav__item> <a href=#health-check-duration class=md-nav__link> Health Check Duration </a> </li> <li class=md-nav__item> <a href=#ingress-performance class=md-nav__link> Ingress Performance </a> </li> <li class=md-nav__item> <a href=#number-of-good-request-vs-request class=md-nav__link> Number of Good Request vs. Request </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pod-metrics class=md-nav__link> Pod Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cpu-usage class=md-nav__link> CPU Usage </a> </li> <li class=md-nav__item> <a href=#oversubscription-of-pod-memory class=md-nav__link> Oversubscription of Pod memory </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#devoptics-metrics class=md-nav__link> DevOptics Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#active-runs class=md-nav__link> Active Runs </a> </li> <li class=md-nav__item> <a href=#idle-executors class=md-nav__link> Idle Executors </a> </li> <li class=md-nav__item> <a href=#average-time-waiting-to-start class=md-nav__link> Average Time Waiting to Start </a> </li> <li class=md-nav__item> <a href=#completed-runs-per-day class=md-nav__link> Completed Runs Per Day </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#average-time-to-complete class=md-nav__link> Average Time to complete </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> CICD </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> CICD </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> CloudBees </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-1> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloudbees/sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Jenkins X </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkinsx/hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../../../jenkinsx/buildpack/ title=BuildPack class=md-nav__link> BuildPack </a> </li> <li class=md-nav__item> <a href=../../../jenkinsx/maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../../../jenkinsx/hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../../../jenkinsx/kubernetes-days/ title="Example For Console Reel" class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-3> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-4> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/jenkins-parallel-pipeline/ title=Parallel class=md-nav__link> Parallel </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-5 type=checkbox id=nav-3-5> <label class=md-nav__link for=nav-3-5> Jenkins Pipeline Examples </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-5> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Containers </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1> <label class=md-nav__link for=nav-4-1> Kubernetes (K8S) </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> K8S Public Services </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-2> K8S Public Services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> K8S Hard Way - GCE </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-3> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4> <label class=md-nav__link for=nav-4-4> Docker </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-4> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-5> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Cloud </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Cloud </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud/automation-pulumi/ title="Automation - Pulumi" class=md-nav__link> Automation - Pulumi </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> SWE </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> SWE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../certificates/lets-encrypt-k8s/ title="Let's Encrypt K8S" class=md-nav__link> Let's Encrypt K8S </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-3> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../../java/networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../../java/concurrency/ title="Java Concurrency" class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#types-of-metrics-to-evaluate class=md-nav__link> Types of Metrics to evaluate </a> </li> <li class=md-nav__item> <a href=#jvm-metrics class=md-nav__link> JVM Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#garbage-collection class=md-nav__link> Garbage Collection </a> </li> <li class=md-nav__item> <a href=#check-for-too-many-open-files class=md-nav__link> Check for too many open files </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#jenkins-config-metrics class=md-nav__link> Jenkins Config Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#plugins class=md-nav__link> Plugins </a> </li> <li class=md-nav__item> <a href=#jenkins-build-nodes class=md-nav__link> Jenkins Build Nodes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#jenkins-usage-metrics class=md-nav__link> Jenkins Usage Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#builds-per-day class=md-nav__link> Builds Per Day </a> </li> <li class=md-nav__item> <a href=#job-duration class=md-nav__link> Job duration </a> </li> <li class=md-nav__item> <a href=#job-count class=md-nav__link> Job Count </a> </li> <li class=md-nav__item> <a href=#jobs-in-queue class=md-nav__link> Jobs in Queue </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#web-metrics class=md-nav__link> Web Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#http-requests class=md-nav__link> HTTP Requests </a> </li> <li class=md-nav__item> <a href=#health-check-duration class=md-nav__link> Health Check Duration </a> </li> <li class=md-nav__item> <a href=#ingress-performance class=md-nav__link> Ingress Performance </a> </li> <li class=md-nav__item> <a href=#number-of-good-request-vs-request class=md-nav__link> Number of Good Request vs. Request </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pod-metrics class=md-nav__link> Pod Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cpu-usage class=md-nav__link> CPU Usage </a> </li> <li class=md-nav__item> <a href=#oversubscription-of-pod-memory class=md-nav__link> Oversubscription of Pod memory </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#devoptics-metrics class=md-nav__link> DevOptics Metrics </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#active-runs class=md-nav__link> Active Runs </a> </li> <li class=md-nav__item> <a href=#idle-executors class=md-nav__link> Idle Executors </a> </li> <li class=md-nav__item> <a href=#average-time-waiting-to-start class=md-nav__link> Average Time Waiting to Start </a> </li> <li class=md-nav__item> <a href=#completed-runs-per-day class=md-nav__link> Completed Runs Per Day </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#average-time-to-complete class=md-nav__link> Average Time to complete </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/blogs/monitor-jenkins-on-k8s/metrics.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=metrics>Metrics<a class=headerlink href=#metrics title="Permanent link">&para;</a></h1> <p>Jenkins is a Java Web application, in this case running in Kubernetes. Let's categorize the metrics we want to look at and deal with each group individually.</p> <ul> <li><code class=codehilite><span class=n>JVM</span></code>: the JVM metrics are exposed, we should leverage this for particular queries and alerts</li> <li><code class=codehilite><span class=n>Jenkins</span> <span class=n>Configuration</span></code>: the default configuration exposes some configuration elements, a few of these have strong recommended values, such as <code class=codehilite><span class=n>Master</span> <span class=n>Executor</span> <span class=n>Slots</span></code> (should always be <strong>0</strong>)</li> <li><code class=codehilite><span class=n>Jenkins</span> <span class=k>Usage</span></code>: jobs running in Jenkins, or Jobs <em>not</em> running in Jenkins can also tell us about (potential) problems</li> <li><code class=codehilite><span class=n>Web</span></code>: although it is not the primary function of Jenkins, web access gives hints about performance trends</li> <li><code class=codehilite><span class=n>Pod</span> <span class=n>Metrics</span></code>: any generic metric from a Kubernetes Pod perspective can be helpful to look at</li> </ul> <div class="admonition caution"> <p class=admonition-title>Kubernetes Labels</p> <p>This guide assumes you install Jenkins via the Helm chart as explained elsewhere in the guide. This means it assumes the Jenkins instances all have the label <code class=codehilite><span class=n>app</span><span class=p>.</span><span class=n>kubernetes</span><span class=p>.</span><span class=n>io</span><span class=o>/</span><span class=n>instance</span></code>. In Prometheus, this becomes <code class=codehilite><span class=n>app_kubernetes_io_instance</span></code>. </p> <p>If you install your applications (such as Jenkins) in other ways, either change the queries presented here accordingly or add the label.</p> </div> <h2 id=types-of-metrics-to-evaluate>Types of Metrics to evaluate<a class=headerlink href=#types-of-metrics-to-evaluate title="Permanent link">&para;</a></h2> <p>We are in the age where SRE, DevOps Engineer, and Platform Engineer are hyped terms. Hyped they may be, there is a good reason people are making noise about monitoring. A lot is written about which kinds of metrics to observe and which to ignore. There's enough written about this - including Viktor Farcic's excellent DevOps Toolkit 2.5 - so we skip diving into these. In case you haven't read anything about it, let's briefly look at the types of metrics.</p> <ul> <li><code class=codehilite><span class=n>Latency</span></code>: response times of your application, in our case, both external access via Ingress and internal access. We can measure latency on internal access via Jenkins' own metrics, which also has percentile information (for example, p99)</li> <li><code class=codehilite><span class=n>Errors</span></code>: we can take a look at network errors such as HTTP 500, which we get straight from Jenkins' webserver (Netty) and at failed jobs</li> <li><code class=codehilite><span class=n>Traffic</span></code>: the number of connections to our service, in our case we have web traffic and jobs running, both we get from Jenkins</li> <li><code class=codehilite><span class=n>Saturation</span></code>: how much the system is used compared to the available resources, core resources such as CPU and Memory primarily depend on your Kubernetes Nodes. However, we can take a look at the Pod's limits vs. requests and Jenkins' job wait time - which roughly translates to saturation</li> </ul> <h2 id=jvm-metrics>JVM Metrics<a class=headerlink href=#jvm-metrics title="Permanent link">&para;</a></h2> <p>We have some basic JVM metrics, such as CPU and Memory usage, and uptime. </p> <div class="admonition note"> <p class=admonition-title>Uptime</p> <p>In the age of containers, <code class=codehilite><span class=k>uptime</span></code> is not a very useful or <em>sexy</em> metric to observe. I include it because we can use <code class=codehilite><span class=k>uptime</span></code> as a proxy metric. For example, if a service never goes beyond a particular value - Prometheus records Max values - it can signify a problem elsewhere.</p> </div> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>vm_cpu_load</span>
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=p>(</span><span class=n>vm_memory_total_max</span> <span class=o>-</span> <span class=n>vm_memory_total_used</span><span class=p>)</span> <span class=o>/</span> <span class=n>vm_memory_total_max</span> <span class=o>*</span> <span class=mi>100</span><span class=p>.</span><span class=mi>0</span>
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>vm_uptime_milliseconds</span>
</pre></div> </td></tr></table> <h3 id=garbage-collection>Garbage Collection<a class=headerlink href=#garbage-collection title="Permanent link">&para;</a></h3> <p>For fine-tuning the JVM's garbage collection for Jenkins, there are two central guides from CloudBees. Which also explain the <code class=codehilite><span class=n>JVM_OPTIONS</span></code> in the <code class=codehilite><span class=n>jenkins</span><span class=o>-</span><span class=k>values</span><span class=p>.</span><span class=n>yaml</span></code> we used for the Helm installation.</p> <ul> <li><a href=https://support.cloudbees.com/hc/en-us/articles/222446987-Prepare-Jenkins-for-Support>Guide On Preparing Jenkins For Support</a></li> <li><a href=https://go.cloudbees.com/docs/solutions/jvm-troubleshooting/ >JVM Troubleshooting Guide</a> </li> </ul> <p>The second article contains much information on how to analyze the Garbage Collection logs and metrics. To process the data thoroughly requires experts with specially designed tools. I am not such an expert, nor is this the document to guide you through this. Summarizing the two guides: measure core metrics and Garbage Collection Throughput. If you need more, consult experts.</p> <div class="admonition example"> <p class=admonition-title>Garbage Collection Throughput</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=mi>1</span> <span class=o>-</span><span class=k>sum</span><span class=p>(</span>
    <span class=n>rate</span><span class=p>(</span>
        <span class=n>vm_gc_G1_Young_Generation_time</span><span class=p>[</span><span class=mi>5</span><span class=n>m</span><span class=p>]</span>
    <span class=p>)</span>
<span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span> 
<span class=o>/</span> 
<span class=k>sum</span> <span class=p>(</span>
    <span class=n>vm_uptime_milliseconds</span>
<span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span>
</pre></div> </td></tr></table> </div> <h3 id=check-for-too-many-open-files>Check for too many open files<a class=headerlink href=#check-for-too-many-open-files title="Permanent link">&para;</a></h3> <p>When looking at the CloudBees guide on <a href=https://support.cloudbees.com/hc/en-us/articles/115000486312-CloudBees-Core-Performance-Best-Practices-for-Linux>tuning performance on Linux</a>, one of the main things to look are core metrics (Memory and CPU) and Open Files. There's even an explicit guide <a href=https://support.cloudbees.com/hc/en-us/articles/204246140-Too-many-open-files>on monitoring the number of open files</a>.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>vm_file_descriptor_ratio</span>
</pre></div> </td></tr></table> <h2 id=jenkins-config-metrics>Jenkins Config Metrics<a class=headerlink href=#jenkins-config-metrics title="Permanent link">&para;</a></h2> <p>Some of the metrics are derived from the configuration of a Jenkins Master.</p> <h3 id=plugins>Plugins<a class=headerlink href=#plugins title="Permanent link">&para;</a></h3> <p>While Jenkins' extensive community is often praised for the number of plugins created and maintained, the plugins are also a big source of risk. You probably want to set a baseline and determine a value for when to send an alert.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>jenkins_plugins_active</span>
</pre></div> </td></tr></table> <h3 id=jenkins-build-nodes>Jenkins Build Nodes<a class=headerlink href=#jenkins-build-nodes title="Permanent link">&para;</a></h3> <p>Jenkins should never build on a master, always on a node or agent.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>jenkins_executor_count_value</span>
</pre></div> </td></tr></table> <p>You might use static agents or, while we're in Kubernetes, only have dynamic agents. Either way, having nodes offline for a while signifies a problem. Maybe the Node configuration is wrong, or the PodTemplate has a mistake, or maybe your ServiceAccount doesn't have the correct permissions.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>jenkins_node_offline_value</span>
</pre></div> </td></tr></table> <h2 id=jenkins-usage-metrics>Jenkins Usage Metrics<a class=headerlink href=#jenkins-usage-metrics title="Permanent link">&para;</a></h2> <p>Most of Jenkins' metrics relate to its usage, though. Think about metrics regarding HTTP request duration, number server errors (HTTP 500), and all the metrics related to builds.</p> <h3 id=builds-per-day>Builds Per Day<a class=headerlink href=#builds-per-day title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>increase</span><span class=p>(</span><span class=n>jenkins_runs_total_total</span><span class=p>[</span><span class=mi>24</span><span class=n>h</span><span class=p>]))</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span>
</pre></div> </td></tr></table> <h3 id=job-duration>Job duration<a class=headerlink href=#job-duration title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>default_jenkins_builds_last_build_duration_milliseconds</span>
</pre></div> </td></tr></table> <h3 id=job-count>Job Count<a class=headerlink href=#job-count title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>jenkins_job_count_value</span>
</pre></div> </td></tr></table> <h3 id=jobs-in-queue>Jobs in Queue<a class=headerlink href=#jobs-in-queue title="Permanent link">&para;</a></h3> <p>If a Jenkins master is overloaded, it is likely to fall behind building jobs that are scheduled. Jenkins observes the duration a job spends in the queue (<code class=codehilite><span class=n>jenkins_job_queuing_duration</span></code>) and the current queue size (<code class=codehilite><span class=n>jenkins_queue_size_value</span></code>).</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>jenkins_job_queuing_duration</span>
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>jenkins_queue_size_value</span><span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span>
</pre></div> </td></tr></table> <h2 id=web-metrics>Web Metrics<a class=headerlink href=#web-metrics title="Permanent link">&para;</a></h2> <p>As Jenkins is also a web application, it makes to look at its HTTP related metrics as well. </p> <div class="admonition important"> <p class=admonition-title>Route Of External Traffic</p> <p>It is important to note that the HTTP traffic of user interaction with Jenkins when running in Kubernetes can contain quite a lot of layers. Problems can arise in any of these layers, so it is crucial to monitor traffic to a service on multiple layers to speed debug time. Tracing is a great solution but out of scope for this guide.</p> </div> <h3 id=http-requests>HTTP Requests<a class=headerlink href=#http-requests title="Permanent link">&para;</a></h3> <p>The 99<sup>th</sup> percentile of HTTP Requests handled by Jenkins masters. </p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>http_requests</span><span class=err>{</span><span class=n>quantile</span><span class=o>=</span><span class=ss>&quot;0.99&quot;</span><span class=err>}</span> <span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span>
</pre></div> </td></tr></table> <div class="admonition note"> <p class=admonition-title>99<sup>th</sup> percentile</p> <p>We look at percentiles because average times are not very helpful. For more information on why this is so, please <a href=https://landing.google.com/sre/sre-book/chapters/monitoring-distributed-systems/ >consult the Google SRE book</a> which is free online.</p> </div> <h3 id=health-check-duration>Health Check Duration<a class=headerlink href=#health-check-duration title="Permanent link">&para;</a></h3> <p>How long the health check takes to complete at the 99<sup>th</sup> percentile. Higher numbers signify problems.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nb>sum</span><span class=p>(</span><span class=n>rate</span><span class=p>(</span><span class=n>jenkins_health_check_duration</span><span class=p>{</span> <span class=n>quantile</span><span class=o>=</span><span class=s2>&quot;0.99&quot;</span><span class=p>}[</span><span class=mi>5</span><span class=n>m</span><span class=p>]))</span> 
 <span class=n>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span>
</pre></div> </td></tr></table> <h3 id=ingress-performance>Ingress Performance<a class=headerlink href=#ingress-performance title="Permanent link">&para;</a></h3> <p>In this case, we look at the metrics of the Nginx Ingress Controller. If you use a different controller, rewrite the query to a sensible alternative.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>rate</span><span class=p>(</span>
 <span class=n>nginx_ingress_controller_request_duration_seconds_bucket</span><span class=err>{</span>
 <span class=n>le</span><span class=o>=</span><span class=ss>&quot;0.25&quot;</span>
 <span class=err>}</span><span class=p>[</span><span class=mi>5</span><span class=n>m</span><span class=p>]</span>
<span class=p>))</span> 
<span class=k>by</span> <span class=p>(</span><span class=n>ingress</span><span class=p>)</span> <span class=o>/</span>
<span class=k>sum</span><span class=p>(</span><span class=n>rate</span><span class=p>(</span>
 <span class=n>nginx_ingress_controller_request_duration_seconds_count</span><span class=p>[</span><span class=mi>5</span><span class=n>m</span><span class=p>]</span>
<span class=p>))</span> 
<span class=k>by</span> <span class=p>(</span><span class=n>ingress</span><span class=p>)</span>
</pre></div> </td></tr></table> <h3 id=number-of-good-request-vs-request>Number of Good Request vs. Request<a class=headerlink href=#number-of-good-request-vs-request title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>http_responseCodes_ok_total</span><span class=p>)</span> 
 <span class=k>by</span> <span class=p>(</span><span class=n>kubernetes_pod_name</span><span class=p>)</span> <span class=o>/</span> 
<span class=k>sum</span><span class=p>(</span><span class=n>http_requests_count</span><span class=p>)</span> 
 <span class=k>by</span> <span class=p>(</span><span class=n>kubernetes_pod_name</span><span class=p>)</span>
</pre></div> </td></tr></table> <h2 id=pod-metrics>Pod Metrics<a class=headerlink href=#pod-metrics title="Permanent link">&para;</a></h2> <p>These metrics are purely related to the Kubernetes Pods. They are as such, applicable to more applications than just Jenkins.</p> <h3 id=cpu-usage>CPU Usage<a class=headerlink href=#cpu-usage title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>rate</span><span class=p>(</span>
 <span class=n>container_cpu_usage_seconds_total</span><span class=err>{</span>
 <span class=n>container_name</span><span class=o>=</span><span class=ss>&quot;jenkins*&quot;</span>
 <span class=err>}</span><span class=p>[</span><span class=mi>5</span><span class=n>m</span><span class=p>]</span>
<span class=p>))</span> 
<span class=k>by</span> <span class=p>(</span><span class=n>pod_name</span><span class=p>)</span>
</pre></div> </td></tr></table> <div class="admonition note"> <p class=admonition-title>Query Filters</p> <p>In this case, we filter on those containers with name <code class=codehilite><span class=n>jenkins</span><span class=o>*</span></code>, which means any container whose name has <em>jenkins</em> as the prefix. If you want to have more than one prefix or suffix, you can use <code class=codehilite><span class=o>||</span></code>. </p> <p>So, if you would want to combine Jenkins with, let's say, <code class=codehilite><span class=n>prometheus</span></code>, you will get the following.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>container_name</span><span class=o>=</span><span class=ss>&quot;jenkins*||prometheus*&quot;</span>
</pre></div> </td></tr></table> </div> <h3 id=oversubscription-of-pod-memory>Oversubscription of Pod memory<a class=headerlink href=#oversubscription-of-pod-memory title="Permanent link">&para;</a></h3> <p>While <code class=codehilite><span class=n>requests</span></code> are not meant to be binding, if you think your application requests around 1GB and it is using well over 3GB, something is off. Either you are too naive and should update the <code class=codehilite><span class=n>requests</span></code>, or something is wrong, and you need to take action.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span> <span class=p>(</span><span class=n>label_join</span><span class=p>(</span><span class=n>container_memory_usage_bytes</span><span class=err>{</span>
 <span class=n>container_name</span><span class=o>=</span><span class=ss>&quot;jenkins&quot;</span>
 <span class=err>}</span><span class=p>,</span> 
 <span class=ss>&quot;pod&quot;</span><span class=p>,</span> 
 <span class=ss>&quot;,&quot;</span><span class=p>,</span> 
 <span class=ss>&quot;pod_name&quot;</span>
<span class=p>))</span> <span class=k>by</span> <span class=p>(</span><span class=n>pod</span><span class=p>)</span> <span class=o>/</span> 
<span class=k>sum</span> <span class=p>(</span><span class=n>kube_pod_container_resource_requests_memory_bytes</span> <span class=err>{</span> 
 <span class=n>container</span><span class=o>=</span><span class=ss>&quot;jenkins&quot;</span>
 <span class=err>}</span>
<span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>pod</span><span class=p>)</span>
</pre></div> </td></tr></table> <h2 id=devoptics-metrics>DevOptics Metrics<a class=headerlink href=#devoptics-metrics title="Permanent link">&para;</a></h2> <p>CloudBees made parts of its DevOptics product free. This product contains - amongst other things - a feature set called <a href=https://go.cloudbees.com/docs/cloudbees-documentation/devoptics-user-guide/run_insights/ >Run Insights</a>. This is a monitoring solution where your Jenkins Master uploads its metrics to the CloudBees service, and you get a dashboard with many of the same things already discussed.</p> <p>You might not want to leverage this free service but like some of its dashboard features. I've tried to recreate some of these - in a minimal fashion.</p> <h3 id=active-runs>Active Runs<a class=headerlink href=#active-runs title="Permanent link">&para;</a></h3> <p>To know how many current builds there are, we can watch the executors that are in use.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>jenkins_executor_in_use_history</span><span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span>
</pre></div> </td></tr></table> <h3 id=idle-executors>Idle Executors<a class=headerlink href=#idle-executors title="Permanent link">&para;</a></h3> <p>When using Kubernetes' Pods as an agent, the only <em>idle</em> executors we'll have are Pods that are done with their build and in the process of being terminated. Not very useful, but in case you want to know how:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>jenkins_executor_free_history</span><span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span>
</pre></div> </td></tr></table> <h3 id=average-time-waiting-to-start>Average Time Waiting to Start<a class=headerlink href=#average-time-waiting-to-start title="Permanent link">&para;</a></h3> <p>With Kubernetes PodTemplates we cannot calculate this. The only wait time we get is the one that is between queue'ing a job and requesting the Pod, which isn't very meaningful.</p> <h3 id=completed-runs-per-day>Completed Runs Per Day<a class=headerlink href=#completed-runs-per-day title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>increase</span><span class=p>(</span><span class=n>jenkins_runs_total_total</span><span class=p>[</span><span class=mi>24</span><span class=n>h</span><span class=p>]))</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span>
</pre></div> </td></tr></table> <h4 id=average-time-to-complete>Average Time to complete<a class=headerlink href=#average-time-to-complete title="Permanent link">&para;</a></h4> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=k>sum</span><span class=p>(</span><span class=n>jenkins_job_building_duration</span><span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span> <span class=o>/</span>
 <span class=k>sum</span><span class=p>(</span><span class=n>jenkins_job_building_duration_count</span><span class=p>)</span> <span class=k>by</span> <span class=p>(</span><span class=n>app_kubernetes_io_instance</span><span class=p>)</span>
</pre></div> </td></tr></table> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://joostvdg.github.io/blogs/monitor-jenkins-on-k8s/metrics/";
      this.page.identifier =
        "/blogs/monitor-jenkins-on-k8s/metrics/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//joostvdg-github-io.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../install/ title="Install Tools" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Install Tools </span> </div> </a> <a href=../alerts/ title=Alerts class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Alerts </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 Joost van der Griendt </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/joostvdg class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/joost_vdg class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/joostvdg class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.c648116f.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> </body> </html>