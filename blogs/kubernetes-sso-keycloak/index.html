<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Setup Single Sign-On for Jenkins with Apache Keycloak"><link href=https://joostvdg.github.io/blogs/kubernetes-sso-keycloak/ rel=canonical><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.2"><title>SSO Jenkins With Keycloak On Kubernetes</title><link rel=stylesheet href=../../assets/stylesheets/main.a2408e81.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.a46bcfb3.min.css><meta name=theme-color content=#ffa726><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7CCutive+Mono&display=fallback"><style>body,input{font-family:"Lato",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Cutive Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-145385967-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=orange data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#single-sign-on-on-kubernetes-with-keycloak class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> J's Software Development Pages </span> <span class="md-header-nav__topic md-ellipsis"> SSO Jenkins With Keycloak On Kubernetes </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../jenkins-pipeline-support-tool/ class="md-tabs__link md-tabs__link--active"> Blogs </a> </li> <li class=md-tabs__item> <a href=../../cloudbees/sso-azure-ad/ class=md-tabs__link> Jenkins & CloudBees </a> </li> <li class=md-tabs__item> <a href=../../jenkinsx/build-packs/ class=md-tabs__link> Jenkins X </a> </li> <li class=md-tabs__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ class=md-tabs__link> Software Eng. </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Blogs <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Blogs data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Kubernetes SSO Keycloak <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Kubernetes SSO Keycloak" class="md-nav__link md-nav__link--active"> Kubernetes SSO Keycloak </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#goal class=md-nav__link> Goal </a> </li> <li class=md-nav__item> <a href=#audience class=md-nav__link> Audience </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> Steps </a> </li> <li class=md-nav__item> <a href=#ldap class=md-nav__link> LDAP </a> <nav class=md-nav aria-label=LDAP> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-data-set class=md-nav__link> Test Data Set </a> <nav class=md-nav aria-label="Test Data Set"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#basics class=md-nav__link> Basics </a> </li> <li class=md-nav__item> <a href=#user-entries class=md-nav__link> User Entries </a> </li> <li class=md-nav__item> <a href=#group class=md-nav__link> Group </a> </li> <li class=md-nav__item> <a href=#administrator class=md-nav__link> Administrator </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-opendj class=md-nav__link> Configure OpenDJ </a> </li> <li class=md-nav__item> <a href=#dockerfile class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=#kubernetes-deployment class=md-nav__link> Kubernetes Deployment </a> </li> <li class=md-nav__item> <a href=#kubernetes-service class=md-nav__link> Kubernetes Service </a> </li> <li class=md-nav__item> <a href=#homegrown-helm-chart-with-github class=md-nav__link> Homegrown Helm chart with GitHub </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#keycloak class=md-nav__link> Keycloak </a> <nav class=md-nav aria-label=Keycloak> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-requisites </a> </li> <li class=md-nav__item> <a href=#install-via-helm class=md-nav__link> Install Via Helm </a> </li> <li class=md-nav__item> <a href=#ldap-as-user-federation class=md-nav__link> LDAP As User Federation </a> <nav class=md-nav aria-label="LDAP As User Federation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-ldap class=md-nav__link> Create LDAP </a> </li> <li class=md-nav__item> <a href=#add-group-mapping class=md-nav__link> Add Group Mapping </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mix-ldap-users-with-other-sources class=md-nav__link> Mix LDAP Users With Other Sources </a> <nav class=md-nav aria-label="Mix LDAP Users With Other Sources"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#rest-api class=md-nav__link> REST API </a> <nav class=md-nav aria-label="REST API"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-token class=md-nav__link> Get Token </a> </li> <li class=md-nav__item> <a href=#get-users class=md-nav__link> Get Users </a> </li> <li class=md-nav__item> <a href=#create-user class=md-nav__link> Create User </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#verify class=md-nav__link> Verify </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sso-with-jenkins class=md-nav__link> SSO with Jenkins </a> <nav class=md-nav aria-label="SSO with Jenkins"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#keycloak-client class=md-nav__link> Keycloak Client </a> <nav class=md-nav aria-label="Keycloak Client"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#main-settings class=md-nav__link> Main Settings </a> </li> <li class=md-nav__item> <a href=#group-mappings class=md-nav__link> Group Mappings </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-via-ui class=md-nav__link> Configure Via UI </a> </li> <li class=md-nav__item> <a href=#configure-via-configuration-as-code class=md-nav__link> Configure Via Configuration-as-Code </a> </li> <li class=md-nav__item> <a href=#use-keycloak-groups-in-jenkins class=md-nav__link> Use Keycloak Groups In Jenkins </a> </li> <li class=md-nav__item> <a href=#verify_1 class=md-nav__link> Verify </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8> <label class=md-nav__link for=nav-2-8> Jenkins X Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ title="Database Connection And Secrets" class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ title="Previews & Integration Tests" class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-9 type=checkbox id=nav-2-9> <label class=md-nav__link for=nav-2-9> Jenkins Monitoring Kubernetes <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Monitoring Kubernetes" data-md-level=2> <label class=md-nav__title for=nav-2-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/metrics/ title=Metrics class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Jenkins & CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins & CloudBees" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins & CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=CloudBees data-md-level=2> <label class=md-nav__title for=nav-3-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloudbees/sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../../cloudbees/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-team-namespace/ title="Team Master Namespace" class=md-nav__link> Team Master Namespace </a> </li> <li class=md-nav__item> <a href=../../cloudbees/multi-cluster/ title=Multi-Cluster class=md-nav__link> Multi-Cluster </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Jenkins <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Jenkins data-md-level=2> <label class=md-nav__title for=nav-3-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins Pipelines <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipelines" data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/kaniko-pipelines/ title="Build Docker Image Kaniko" class=md-nav__link> Build Docker Image Kaniko </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/podtemplate-dind/ title="PodTemplate With Docker-In-Docker" class=md-nav__link> PodTemplate With Docker-In-Docker </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ title="Parallel Pipelines" class=md-nav__link> Parallel Pipelines </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipeline Examples <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipeline Examples" data-md-level=2> <label class=md-nav__title for=nav-3-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Jenkins X <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/build-packs/ title="Build Packs" class=md-nav__link> Build Packs </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jx-pipelines/ title="Jenkins X Pipelines" class=md-nav__link> Jenkins X Pipelines </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-4-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ title="Database Connection And Secrets" class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ title="Previews & Integration Tests" class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../jenkinsx/builder-image/ title="Create Builder Image" class=md-nav__link> Create Builder Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot/ title="JX Boot GKE" class=md-nav__link> JX Boot GKE </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot-aks/ title="JX Boot AKS" class=md-nav__link> JX Boot AKS </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/aks-boot-core/ title="JX Boot & CloudBees Core" class=md-nav__link> JX Boot & CloudBees Core </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-minimal/ title="OpenShift 3.11" class=md-nav__link> OpenShift 3.11 </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-restricted/ title="OpenShift 3.11 - Restricted" class=md-nav__link> OpenShift 3.11 - Restricted </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/lighthouse-bitbucket/ title="Lighthouse & Bitbucket" class=md-nav__link> Lighthouse & Bitbucket </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/kubernetes-days/ title="Example For Console Reel" class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Containers <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Containers data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> OpenShift <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=OpenShift data-md-level=2> <label class=md-nav__title for=nav-5-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-minimal/ title="OpenShift 3.11 GCP(minimal)" class=md-nav__link> OpenShift 3.11 GCP(minimal) </a> </li> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-medium/ title="OpenShift 3.11 GCP(medium)" class=md-nav__link> OpenShift 3.11 GCP(medium) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Kubernetes (K8S) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Kubernetes (K8S)" data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Managed Kubernetes (cloud) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Managed Kubernetes (cloud)" data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Managed Kubernetes (cloud) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/gke-terraform/ title="GKE Terraform" class=md-nav__link> GKE Terraform </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> K8S Hard Way - GCE <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="K8S Hard Way - GCE" data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Docker <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Docker data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> Linux <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Software Eng. <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Eng." data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Eng. </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Automation <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Automation data-md-level=2> <label class=md-nav__title for=nav-6-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ title=Pulumi class=md-nav__link> Pulumi </a> </li> <li class=md-nav__item> <a href=../../certificates/lets-encrypt-k8s/ title="Let's Encrypt K8S" class=md-nav__link> Let's Encrypt K8S </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Engineering" data-md-level=2> <label class=md-nav__title for=nav-6-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Productivity data-md-level=2> <label class=md-nav__title for=nav-6-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-4 type=checkbox id=nav-6-4> <label class=md-nav__link for=nav-6-4> Java <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Java data-md-level=2> <label class=md-nav__title for=nav-6-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../java/networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../java/concurrency/ title="Java Concurrency" class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#goal class=md-nav__link> Goal </a> </li> <li class=md-nav__item> <a href=#audience class=md-nav__link> Audience </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> Steps </a> </li> <li class=md-nav__item> <a href=#ldap class=md-nav__link> LDAP </a> <nav class=md-nav aria-label=LDAP> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-data-set class=md-nav__link> Test Data Set </a> <nav class=md-nav aria-label="Test Data Set"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#basics class=md-nav__link> Basics </a> </li> <li class=md-nav__item> <a href=#user-entries class=md-nav__link> User Entries </a> </li> <li class=md-nav__item> <a href=#group class=md-nav__link> Group </a> </li> <li class=md-nav__item> <a href=#administrator class=md-nav__link> Administrator </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-opendj class=md-nav__link> Configure OpenDJ </a> </li> <li class=md-nav__item> <a href=#dockerfile class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=#kubernetes-deployment class=md-nav__link> Kubernetes Deployment </a> </li> <li class=md-nav__item> <a href=#kubernetes-service class=md-nav__link> Kubernetes Service </a> </li> <li class=md-nav__item> <a href=#homegrown-helm-chart-with-github class=md-nav__link> Homegrown Helm chart with GitHub </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#keycloak class=md-nav__link> Keycloak </a> <nav class=md-nav aria-label=Keycloak> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-requisites </a> </li> <li class=md-nav__item> <a href=#install-via-helm class=md-nav__link> Install Via Helm </a> </li> <li class=md-nav__item> <a href=#ldap-as-user-federation class=md-nav__link> LDAP As User Federation </a> <nav class=md-nav aria-label="LDAP As User Federation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-ldap class=md-nav__link> Create LDAP </a> </li> <li class=md-nav__item> <a href=#add-group-mapping class=md-nav__link> Add Group Mapping </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#mix-ldap-users-with-other-sources class=md-nav__link> Mix LDAP Users With Other Sources </a> <nav class=md-nav aria-label="Mix LDAP Users With Other Sources"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#rest-api class=md-nav__link> REST API </a> <nav class=md-nav aria-label="REST API"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-token class=md-nav__link> Get Token </a> </li> <li class=md-nav__item> <a href=#get-users class=md-nav__link> Get Users </a> </li> <li class=md-nav__item> <a href=#create-user class=md-nav__link> Create User </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#verify class=md-nav__link> Verify </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sso-with-jenkins class=md-nav__link> SSO with Jenkins </a> <nav class=md-nav aria-label="SSO with Jenkins"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#keycloak-client class=md-nav__link> Keycloak Client </a> <nav class=md-nav aria-label="Keycloak Client"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#main-settings class=md-nav__link> Main Settings </a> </li> <li class=md-nav__item> <a href=#group-mappings class=md-nav__link> Group Mappings </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-via-ui class=md-nav__link> Configure Via UI </a> </li> <li class=md-nav__item> <a href=#configure-via-configuration-as-code class=md-nav__link> Configure Via Configuration-as-Code </a> </li> <li class=md-nav__item> <a href=#use-keycloak-groups-in-jenkins class=md-nav__link> Use Keycloak Groups In Jenkins </a> </li> <li class=md-nav__item> <a href=#verify_1 class=md-nav__link> Verify </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/blogs/kubernetes-sso-keycloak.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=single-sign-on-on-kubernetes-with-keycloak>Single Sign On on Kubernetes with Keycloak<a class=headerlink href=#single-sign-on-on-kubernetes-with-keycloak title="Permanent link">&para;</a></h1> <p>This article is about setting up an Apache Keycloak<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup> instance for Single Sign-On<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup> (SSO) on Kubernetes.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>This guide is created to help you show how you can do this from a technical point of view. If you are in an enterprise, please consult your in-house - if available - or external security professionals before running tools such as Keycloak in production.</p> </div> <h2 id=goal>Goal<a class=headerlink href=#goal title="Permanent link">&para;</a></h2> <p>The goal is to show why using Keycloak as SSO can be valuable and guide on how to do so.</p> <p>For what's in the <code>How</code>, look at the next paragraph: <code>Steps</code>.</p> <p>At the outset, this article is not about comparing SSO solutions or about claiming Keycloak is the best. Its a solution, and if you're interested in using this, it helps you with the how.</p> <p>Below are some links to alternatives as reference, but are not discussed.</p> <h2 id=audience>Audience<a class=headerlink href=#audience title="Permanent link">&para;</a></h2> <p>The expected audience are those who are using Kubernetes<sup id=fnref:3><a class=footnote-ref href=#fn:3>3</a></sup> and are:</p> <ul> <li>looking to host a SSO solution themselves</li> <li>want to use LDAP<sup id=fnref:4><a class=footnote-ref href=#fn:4>4</a></sup> as <code>User Federation</code> for Keycloak</li> <li>want to setup a SSO with Jenkins<sup id=fnref:5><a class=footnote-ref href=#fn:5>5</a></sup> and/or SonarQube<sup id=fnref:6><a class=footnote-ref href=#fn:6>6</a></sup></li> </ul> <h2 id=steps>Steps<a class=headerlink href=#steps title="Permanent link">&para;</a></h2> <p>These are the steps we will execute.</p> <ul> <li>configure an LDAP server with a test data set</li> <li>package LDAP server in a Docker container and run it as an kubernetes <code>Deployment</code><ul> <li>you might think, why not a <code>StatefulSet</code>, but our LDAP will have static data</li> <li>and the idea of this setup, is that we do not control LDAP, meaning, we should expect LDAP's data to be immutable</li> </ul> </li> <li>install Keycloak with Helm<sup id=fnref:8><a class=footnote-ref href=#fn:8>8</a></sup><ul> <li>we use Helm 2, as Helm 3<sup id=fnref:9><a class=footnote-ref href=#fn:9>9</a></sup> is still in beta at the time of writing (September 2019)</li> </ul> </li> <li>configure Keycloak to use LDAP for <code>User Federation</code></li> <li>install Jenkins and SonarQube with Helm<sup id=fnref2:8><a class=footnote-ref href=#fn:8>8</a></sup></li> <li>configure SSO with Keycloak in Jenkins</li> <li>configure SSO with Keycloak in SonarQube</li> </ul> <h2 id=ldap>LDAP<a class=headerlink href=#ldap title="Permanent link">&para;</a></h2> <p>We will use OpenDJ<sup id=fnref:7><a class=footnote-ref href=#fn:7>7</a></sup> as LDAP implementation. There are many alternatives out there, feel free to use those. But for this guide, we will use OpenDJ's community edition, it works well and is easy to configure.</p> <p>We need the following:</p> <ul> <li>configured with a test data set including users and groups</li> <li>Docker container image definition</li> <li>Kubernetes <code>Deployment</code> definition to run</li> <li>Kubernetes <code>Service</code> definition to access a stable address</li> </ul> <h3 id=test-data-set>Test Data Set<a class=headerlink href=#test-data-set title="Permanent link">&para;</a></h3> <details class=example><summary>example.ldiff</summary><p>This a full example.</p> <p>The different parts will be explained below.</p> <div class=highlight><pre><span></span><code>dn: dc=example,dc=com
objectclass: top
objectclass: domain
dc: example

dn: ou=People, dc=example,dc=com
objectclass: top
objectclass: organizationalunit
ou: People
aci: (targetattr=&quot;*||+&quot;)(version 3.0; acl &quot;IDM Access&quot;; allow (all)
userdn=&quot;ldap:///uid=idm,ou=Administrators,dc=example,dc=com&quot;;)

dn: uid=cptjack, ou=People, dc=example,dc=com
cn: cpt. Jack Sparrow
sn: Sparrow
givenname: Jack
objectclass: top
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
ou: Operations
ou: People
l: Caribbean
uid: cptjack
mail: jack@example.com
telephonenumber: +421 910 123456
facsimiletelephonenumber: +1 408 555 1111
roomnumber: 666
userpassword: MyAwesomePassword

dn: uid=djones, ou=People, dc=example,dc=com
cn: Davy Jones
sn: Jones
givenname: Davy
objectclass: top
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
ou: Operations
ou: People
l: Caribbean
uid: djones
mail: d.jones@example.com
telephonenumber: +421 910 382735
facsimiletelephonenumber: +1 408 555 1112
roomnumber: 112
userpassword: MyAwesomePassword

dn: ou=Groups, dc=example,dc=com
objectclass: top
objectclass: organizationalunit
ou: Groups
aci: (targetattr=&quot;*||+&quot;)(version 3.0; acl &quot;IDM Access&quot;; allow (all)
userdn=&quot;ldap:///uid=idm,ou=Administrators,dc=example,dc=com&quot;;)

dn: cn=Pirates,ou=Groups,dc=example,dc=com
objectclass: top
objectclass: groupOfUniqueNames
cn: Pirates
ou: Groups
uniquemember: uid=cptjack, ou=People, dc=example,dc=com
uniquemember: uid=djones, ou=People, dc=example,dc=com
description: Arrrrr!

dn: cn=Catmins,ou=Groups,dc=example,dc=com
objectclass: top
objectclass: groupOfUniqueNames
cn: Catmins
ou: Groups
uniquemember: uid=djones, ou=People, dc=example,dc=com
description: Purrrr!

dn: ou=Administrators, dc=example,dc=com
objectclass: top
objectclass: organizationalunit
ou: Administrators

dn: uid=idm, ou=Administrators,dc=example,dc=com
objectclass: top
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
uid: idm
cn: IDM Administrator
sn: IDM Administrator
description: Special LDAP acccount used by the IDM
to access the LDAP data.
ou: Administrators
userPassword: MySecretAdminPassword
ds-privilege-name: unindexed-search
ds-privilege-name: password-reset
</code></pre></div> </details> <h4 id=basics>Basics<a class=headerlink href=#basics title="Permanent link">&para;</a></h4> <p>We need some basic meta data for our server. The two most important elements being:</p> <ul> <li>the base <code>dn</code> (<em>Distinguished Name</em>), where all of our data lives<ul> <li>build up out of <code>dc</code> (<em>domainComponent</em>) elements, representing a domain name, usually <em>companyName.com</em></li> </ul> </li> <li>the <code>dn</code> where our user data will live and which user owns it (the <code>userdn</code> assigned in the <code>aci</code>)</li> </ul> <div class=highlight><pre><span></span><code>dn: dc=example,dc=com
objectclass: top
objectclass: domain
dc: example

dn: ou=People, dc=example,dc=com
objectclass: top
objectclass: organizationalunit
ou: People
aci: (targetattr=&quot;*||+&quot;)(version 3.0; acl &quot;IDM Access&quot;; allow (all)
  userdn=&quot;ldap:///uid=idm,ou=Administrators,dc=example,dc=com&quot;;)
</code></pre></div> <h4 id=user-entries>User Entries<a class=headerlink href=#user-entries title="Permanent link">&para;</a></h4> <p>After these two main metadata <code>dn</code> elements, we have all the user entries.</p> <p>We start with the identifier of the entry, designated by the <code>dn</code>, followed by attributes and classifications. While LDAP stands for <em>Lightweight</em>, it has a lot of attributes which are not easily understood because they are commonly used by their two-letter acronym only. Below we explain a few of the attributes, but there are more complete lists available<sup id=fnref:10><a class=footnote-ref href=#fn:10>10</a></sup>.</p> <ul> <li><strong>dn</strong>: the full identifier of the data entry, in reverse tree</li> <li><strong>uid</strong>: the unique id of the user within the organizational structure</li> <li><strong>cn</strong>: <em>Common Name</em>, generally how humans would identify this resource</li> <li><strong>l</strong>: <em>Location</em></li> <li><strong>ou</strong>: <em>Organizational Unit</em>, these commonly represent departments</li> <li><strong>objectclass</strong>: defines a object hierarchy, derived from Object Oriented Programming<ul> <li><strong>top</strong>: is commonly the root object class, every other object inheriting from there</li> <li>object classes are used to create typed objects which have their own schema</li> <li>this allows you to define what values are required and which are optional</li> <li>object classes are also used in search filters, so you can distinguish different value types (users, groups)</li> </ul> </li> </ul> <div class="admonition note"> <p class=admonition-title>Organizational Tree</p> <div class=highlight><pre><span></span><code>.
├── com
│   └── example
│       ├── Operations
│       └── People
│           └── jwick
</code></pre></div> </div> <div class=highlight><pre><span></span><code>dn: uid=jwick, ou=People, dc=example,dc=com
cn: John Wick
sn: Wick
givenname: John
objectclass: top
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
ou: Operations
ou: People
l: New York
uid: jwick
mail: jwick@example.com
telephonenumber: +1 408 555 1236
facsimiletelephonenumber: +1 408 555 4323
roomnumber: 233
userpassword: myawesomepassword
</code></pre></div> <h4 id=group>Group<a class=headerlink href=#group title="Permanent link">&para;</a></h4> <p>We first create the <code>OU</code> housing our Groups, including which object classes it represents.</p> <p>Then we can attach groups to this <code>OU</code> by creating <code>dn</code>'s under it. There are two flavors of groups, we have <code>groupOfNames</code> and <code>groupOfUniqueNames</code>, I'm sure you understand what the difference is.</p> <p>We explain wich kind of group we are by the <code>objectclass: groupOfUniqueNames</code>, and include a list of members. In the case of <code>groupOfNames</code> we use <code>member: &lt;member dn&gt;</code>, in our case we user <code>uniquemember: uid=cptjack, ou=People, dc=example,dc=com</code>. To make it a list, add more than one entry, each with a unique value.</p> <div class=highlight><pre><span></span><code>dn: ou=Groups, dc=example,dc=com
objectclass: top
objectclass: organizationalunit
ou: Groups
aci: (targetattr=&quot;*||+&quot;)(version 3.0; acl &quot;IDM Access&quot;; allow (all)
  userdn=&quot;ldap:///uid=idm,ou=Administrators,dc=example,dc=com&quot;;)

dn: cn=Pirates,ou=Groups,dc=example,dc=com
objectclass: top
objectclass: groupOfUniqueNames
cn: Pirates
ou: Groups
uniquemember: uid=cptjack, ou=People, dc=example,dc=com
uniquemember: uid=will, ou=People, dc=example,dc=com
uniquemember: uid=djones, ou=People, dc=example,dc=com
description: Arrrrr!
</code></pre></div> <h4 id=administrator>Administrator<a class=headerlink href=#administrator title="Permanent link">&para;</a></h4> <p>We have to configure our main administrator, as we've already given it a lot of privileges to manage the other resources (via the <code>aci</code> rules). As usual, we start with defining a <code>ou</code> that houses our <code>Administrators</code>.</p> <p>In this case, we give it two more special permissions via <code>ds-privilege-name</code>. So this user can also reset passwords, just in case.</p> <div class=highlight><pre><span></span><code>dn: ou=Administrators, dc=example,dc=com
objectclass: top
objectclass: organizationalunit
ou: Administrators

dn: uid=idm, ou=Administrators,dc=example,dc=com
objectclass: top
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
uid: idm
cn: IDM Administrator
sn: IDM Administrator
description: Special LDAP acccount used by the IDM
  to access the LDAP data.
ou: Administrators
userPassword: MySecretAdminPassword
ds-privilege-name: unindexed-search
ds-privilege-name: password-reset
</code></pre></div> <h3 id=configure-opendj>Configure OpenDJ<a class=headerlink href=#configure-opendj title="Permanent link">&para;</a></h3> <p>One of the reasons I like OpenDJ is because it is very easy to operate. It has many tools to help you manage the server. Some are separate tools that interact with a running server, others interact with the configure while the server is offline.</p> <p>We have to do two configuration actions, 1) we intialize it with our root <code>dn</code>, which port to use and so on, 2) we add our test data set, so we have our groups and users to work with.</p> <div class=highlight><pre><span></span><code>/opt/opendj/setup --cli <span class=se>\</span>
    -p <span class=m>1389</span> <span class=se>\</span>
    --ldapsPort <span class=m>1636</span> <span class=se>\</span>
    --enableStartTLS <span class=se>\</span>
    --generateSelfSignedCertificate <span class=se>\</span>
    --baseDN <span class=nv>dc</span><span class=o>=</span>example,dc<span class=o>=</span>com <span class=se>\</span>
    -h localhost <span class=se>\</span>
    --rootUserDN <span class=s2>&quot;</span><span class=nv>$ROOT_USER_DN</span><span class=s2>&quot;</span> <span class=se>\</span>
    --rootUserPassword <span class=s2>&quot;</span><span class=nv>$ROOT_PASSWORD</span><span class=s2>&quot;</span> <span class=se>\</span>
    --acceptLicense <span class=se>\</span>
    --no-prompt <span class=se>\</span>
    --doNotStart
</code></pre></div> <div class=highlight><pre><span></span><code>/opt/opendj/bin/import-ldif <span class=se>\</span>
    --includeBranch <span class=nv>dc</span><span class=o>=</span>example,dc<span class=o>=</span>com <span class=se>\</span>
    --backendID userRoot <span class=se>\</span>
    --offline <span class=se>\</span>
    --ldifFile example.ldiff
</code></pre></div> <h3 id=dockerfile>Dockerfile<a class=headerlink href=#dockerfile title="Permanent link">&para;</a></h3> <p>For completeness I will also include my Docker image.</p> <p>We use Tini<sup id=fnref:11><a class=footnote-ref href=#fn:11>11</a></sup> order to manage the process of OpenDJ nicely, even in the face of being shutdown. For more information, read <a href=/blogs/graceful-shutdown/ >my article on Docker Graceful Shutdown</a>.</p> <p>We use a <code>jre</code> as we only need to run Java, so no need for a JDK. We use the OpenJDK distribution from <code>Azul</code><sup id=fnref:15><a class=footnote-ref href=#fn:15>15</a></sup> in order to avoid possible violations of Oracle's License<sup id=fnref:12><a class=footnote-ref href=#fn:12>12</a></sup>. We use Azul's Alpine<sup id=fnref:13><a class=footnote-ref href=#fn:13>13</a></sup> based image as it is much smaller than those based of full-fledged OS's. This makes the image smaller in size on disk and in memory and reduces the attack vector and recommended by the likes of Docker and Snyk<sup id=fnref:14><a class=footnote-ref href=#fn:14>14</a></sup>.</p> <p>We download the latest version available which, as of this writing in September 2019, is <code>4.4.3</code> which you can retrieve from the OpenDJ Community's <code>releases</code> page on GitHub<sup id=fnref2:13><a class=footnote-ref href=#fn:13>13</a></sup>.</p> <div class=highlight><pre><span></span><code><span class=k>FROM</span> <span class=s>azul/zulu-openjdk-alpine:8u222-jre</span>

<span class=k>LABEL</span> <span class=nv>authors</span><span class=o>=</span><span class=s2>&quot;Joost van der Griendt &lt;joostvdg@gmail.com&gt;&quot;</span>
<span class=k>LABEL</span> <span class=nv>version</span><span class=o>=</span><span class=s2>&quot;0.2.0&quot;</span>
<span class=k>LABEL</span> <span class=nv>description</span><span class=o>=</span><span class=s2>&quot;OpenDJ container&quot;</span>

<span class=k>WORKDIR</span><span class=s> /opt</span>
<span class=k>EXPOSE</span><span class=s> 1389 1636 4444</span>

<span class=k>ENV</span> <span class=nv>CHANGE_DATE</span><span class=o>=</span><span class=s1>&#39;20190916-2100&#39;</span>
<span class=k>ENV</span> JAVA_HOME /usr/lib/jvm/zulu-8
<span class=k>ENV</span> OPENDJ_JAVA_HOME /usr/lib/jvm/zulu-8
<span class=k>ENV</span> <span class=nv>VERSION</span><span class=o>=</span><span class=m>4</span>.4.3
<span class=k>ENV</span> <span class=nv>ROOT_USER_DN</span><span class=o>=</span><span class=s1>&#39;cn=admin&#39;</span>
<span class=k>ENV</span> <span class=nv>ROOT_PASSWORD</span><span class=o>=</span><span class=s1>&#39;changeme&#39;</span>
<span class=k>RUN</span> apk add --no-cache tini

<span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&quot;/sbin/tini&quot;</span><span class=p>,</span> <span class=s2>&quot;-vv&quot;</span><span class=p>,</span><span class=s2>&quot;-g&quot;</span><span class=p>,</span><span class=s2>&quot;-s&quot;</span><span class=p>,</span> <span class=s2>&quot;--&quot;</span><span class=p>]</span>
<span class=k>CMD</span> <span class=p>[</span><span class=s2>&quot;/opt/opendj/bin/start-ds&quot;</span><span class=p>,</span> <span class=s2>&quot;--nodetach&quot;</span><span class=p>]</span>

<span class=k>RUN</span> wget --quiet <span class=se>\</span>
    https://github.com/OpenIdentityPlatform/OpenDJ/releases/download/<span class=nv>$VERSION</span>/opendj-<span class=nv>$VERSION</span>.zip <span class=o>&amp;&amp;</span> <span class=se>\</span>
    unzip opendj-<span class=nv>$VERSION</span>.zip <span class=o>&amp;&amp;</span> <span class=se>\</span>
    rm -r opendj-<span class=nv>$VERSION</span>.zip

<span class=k>RUN</span> /opt/opendj/setup --cli <span class=se>\</span>
    -p <span class=m>1389</span> <span class=se>\</span>
    --ldapsPort <span class=m>1636</span> <span class=se>\</span>
    --enableStartTLS <span class=se>\</span>
    --generateSelfSignedCertificate <span class=se>\</span>
    --baseDN <span class=nv>dc</span><span class=o>=</span>example,dc<span class=o>=</span>com <span class=se>\</span>
    -h localhost <span class=se>\</span>
    --rootUserDN <span class=s2>&quot;</span><span class=nv>$ROOT_USER_DN</span><span class=s2>&quot;</span> <span class=se>\</span>
    --rootUserPassword <span class=s2>&quot;</span><span class=nv>$ROOT_PASSWORD</span><span class=s2>&quot;</span> <span class=se>\</span>
    --acceptLicense <span class=se>\</span>
    --no-prompt <span class=se>\</span>
    --doNotStart

<span class=k>ADD</span> Example.ldif /var/tmp/example.ldiff
<span class=c># RUN /opt/opendj/bin/import-ldif --help</span>
<span class=k>RUN</span> /opt/opendj/bin/import-ldif --includeBranch <span class=nv>dc</span><span class=o>=</span>example,dc<span class=o>=</span>com --backendID userRoot --offline --ldifFile /var/tmp/example.ldiff
</code></pre></div> <h3 id=kubernetes-deployment>Kubernetes Deployment<a class=headerlink href=#kubernetes-deployment title="Permanent link">&para;</a></h3> <p>In production you might want to run LDAP in a <code>StatefulSet</code> and give it some permanent storage. But in this guide the goal of LDAP is to show how to use it with Keycloak and we stick to a <code>Deployment</code> as it is easier.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">opendj4</span>
  <span class=nt>labels</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">opendj4</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>replicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>matchLabels</span><span class=p>:</span>
      <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">opendj4</span>
  <span class=nt>template</span><span class=p>:</span>
    <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">opendj4</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">opendj4</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">caladreas/opendj:4.4.3-1</span>
        <span class=nt>ports</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1389</span>
          <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ldap</span>
        <span class=nt>resources</span><span class=p>:</span>
          <span class=nt>requests</span><span class=p>:</span>
            <span class=nt>memory</span><span class=p>:</span> <span class=s>&quot;250Mi&quot;</span>
            <span class=nt>cpu</span><span class=p>:</span> <span class=s>&quot;50m&quot;</span>
          <span class=nt>limits</span><span class=p>:</span>
            <span class=nt>memory</span><span class=p>:</span> <span class=s>&quot;500Mi&quot;</span>
            <span class=nt>cpu</span><span class=p>:</span> <span class=s>&quot;250m&quot;</span>
</code></pre></div> <h3 id=kubernetes-service>Kubernetes Service<a class=headerlink href=#kubernetes-service title="Permanent link">&para;</a></h3> <p>When we use a <code>Deployment</code> our container instance will have a generated name and a new ip address on every (re-)start. So we use a <code>Service</code> to create a stable endpoint, which means that we will now access our LDAP server via our service: <code>ldap://opendj4:389</code>.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>labels</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">opendj4</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">opendj4</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>ports</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
      <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">389</span>
      <span class=nt>targetPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1389</span>
      <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">opendj4</span>
</code></pre></div> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>If you deploy the <code>Service</code> and <code>Deployment</code> in a different namespace than where you want to access them from, you will have to add the namespace to the access url.</p> <p>If you've configured them in namespace <code>ldap</code>, the access url becomes <code>ldap://opendj4.ldap:389</code>.</p> </div> <h3 id=homegrown-helm-chart-with-github>Homegrown Helm chart with GitHub<a class=headerlink href=#homegrown-helm-chart-with-github title="Permanent link">&para;</a></h3> <p>You can also package the above explained Docker Image + Kubernetes Yaml definition as a Helm package in a GitHub repository<sup id=fnref:16><a class=footnote-ref href=#fn:16>16</a></sup>.</p> <p>So if you do not want to use any of the above, feel free to use my personal Helm Repository<sup id=fnref:17><a class=footnote-ref href=#fn:17>17</a></sup>.</p> <div class=highlight><pre><span></span><code>helm repo add joostvdg https://raw.githubusercontent.com/joostvdg/helm-repo/master/
helm repo update
</code></pre></div> <div class=highlight><pre><span></span><code>helm install joostvdg/opendj4 --name ldap --namespace ldap
</code></pre></div> <p>The service, retrieved by <code>kubectl get service</code> now has a different name.</p> <div class=highlight><pre><span></span><code>NAME           TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE
ldap-opendj4   ClusterIP   <span class=m>10</span>.100.19.29     &lt;none&gt;        <span class=m>389</span>/TCP   105s
</code></pre></div> <p>So now we access the LDAP server via <code>ldap://ldap-opendj4:389</code>.</p> <h2 id=keycloak>Keycloak<a class=headerlink href=#keycloak title="Permanent link">&para;</a></h2> <h3 id=pre-requisites>Pre-requisites<a class=headerlink href=#pre-requisites title="Permanent link">&para;</a></h3> <ul> <li>Helm installed</li> <li>TLS certificate</li> </ul> <p>Using a tool as Keycloak to do SSO well, feels wrong without using TLS certificates. So I wholeheartedly recommend configuring Keycloak with a Domain name and TLS Certificate.</p> <p>For the TLS certificate, you use Let's Encrypt<sup id=fnref:20><a class=footnote-ref href=#fn:20>20</a></sup> with Cert Manager<sup id=fnref:19><a class=footnote-ref href=#fn:19>19</a></sup>, if you unsure how to proceed in Kubernetes <a href=/blogs/k8s-lets-encrypt/ >read my guide on Let's Encrypt on Kubernetes</a>.</p> <h3 id=install-via-helm>Install Via Helm<a class=headerlink href=#install-via-helm title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>helm repo add codecentric https://codecentric.github.io/helm-charts
helm repo update
</code></pre></div> <div class=highlight><pre><span></span><code>kubectl apply -f keycloak-certificate.yaml
</code></pre></div> <div class=highlight><pre><span></span><code>helm install --name keycloak codecentric/keycloak -f keycloak-values.yaml
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Make sure you replace the dns name <code>keycloak.my.domain.com</code> with your own domain. If you do not have a domain, you can use `nip.io<sup id=fnref:18><a class=footnote-ref href=#fn:18>18</a></sup>.</p> </div> <div class="admonition example"> <p class=admonition-title>keycloak-certificate.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">certmanager.k8s.io/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Certificate</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">tls-keycloak</span>
<span class=nt>dnsNames</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
<span class=nt>acme</span><span class=p>:</span>
    <span class=nt>config</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>http01</span><span class=p>:</span>
        <span class=nt>ingressClass</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class=nt>domains</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
<span class=nt>issuerRef</span><span class=p>:</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
    <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
</code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>keycloak-values.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>keycloak</span><span class=p>:</span>
  <span class=nt>password</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">notsosecret</span>
  <span class=nt>ingress</span><span class=p>:</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
    <span class=nt>annotations</span><span class=p>:</span> 
    <span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class=nt>kubernetes.io/tls-acme</span><span class=p>:</span> <span class=s>&quot;true&quot;</span>
    <span class=nt>ingress.kubernetes.io/affinity</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cookie</span>
    <span class=nt>hosts</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
    <span class=nt>tls</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>hosts</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
    <span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">tls-keycloak</span>
</code></pre></div> </div> <h3 id=ldap-as-user-federation>LDAP As User Federation<a class=headerlink href=#ldap-as-user-federation title="Permanent link">&para;</a></h3> <p>Assuming you have Keycloak running now, login with the admin user, <code>keycloak</code>, and the password you set in the <code>keycloak-values.yaml</code>.</p> <p>In the left hand menu, you can select <code>User Federation</code>, this is where we can add <code>ldap</code> and <code>kerberos</code> providers. As Keycloak supports multiple sources, these will be listed by their priority (the smaller the number, the higher). The federations are consulted in the order according to their priority.</p> <h4 id=create-ldap>Create LDAP<a class=headerlink href=#create-ldap title="Permanent link">&para;</a></h4> <p>Let's create the new LDAP provider, select the <code>Add provider</code> dropdown - top right - and choose <code>ldap</code>.</p> <p>You will now see a whole list of values to fill in, don't worry, many can be kept as default. And to be sure, I will list them all here. For more information, each field has a little question mark, hover over it.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>When you've filled in the <code>Connection URL</code>, you should test the configuration with the <code>Test connection</code> button. The same is true for when you've configured the fields <code>Users DN</code>, <code>Bind Type</code>, <code>Bind DN</code>, <code>Bind Credential</code> with the button <code>Test authentication</code>.</p> </div> <ul> <li><strong>Console Display Name</strong>: display name, should be a name that tells you what this provider is</li> <li><strong>Priority</strong>: the priority of this provider, will be used for the order that the federation is accessed</li> <li><strong>Import Users</strong>: wether or not to import the users, I just leave this to <code>On</code> as to cache the users</li> <li><strong>Import Users</strong>: <code>READ_ONLY</code>, in this guide we assume the LDAP server is not under your control, so read only</li> <li><strong>Vendor</strong>: <code>Other</code></li> <li><strong>Username LDAP attribute</strong>: <code>uid</code></li> <li><strong>RDN LDAP attribute</strong>: <code>uid</code></li> <li><strong>UUID LDAP attribute</strong>: <code>entryUUID</code></li> <li><strong>User Object Classes</strong>: <code>inetOrgPerson, organizationalPerson</code></li> <li><strong>Connection URL</strong>: <code>ldap://opendj4:389</code></li> <li><strong>Users DN</strong>: <code>dc=example,dc=com</code></li> <li><strong>Bind Type</strong>: <code>simple</code></li> <li><strong>Bind DN</strong>: <code>uid=idm, ou=Administrators,dc=example,dc=com</code></li> <li><strong>Bind Credential</strong>: <code>secret</code> -&gt; or what ever you've set it in the <code>example.diff</code></li> <li><strong>Custom User LDAP Filter</strong>: ``</li> <li><strong>Search Scope</strong>: <code>Subtree</code></li> <li><strong>Validate Password Policy</strong>: <code>OFF</code></li> <li><strong>Use Truststore SPI</strong>: <code>Only for ldap</code></li> <li><strong>Connection Pooling</strong>: <code>ON</code></li> <li><strong>Connection Timeout</strong>: ``</li> <li><strong>Read Timeout</strong>: ``</li> <li><strong>Pagination</strong>: <code>ON</code></li> </ul> <p>Sync Settings:</p> <ul> <li><strong>Cache Policy</strong>: 1000</li> <li><strong>Periodic Full Sync</strong>: <code>On</code></li> <li><strong>Full Sync Period</strong>: <code>604800</code></li> <li><strong>Periodic Changed Users Sync</strong>: <code>On</code></li> <li><strong>Changed Users Sync Period</strong>: <code>86400</code></li> </ul> <p>Cache Settings:</p> <ul> <li><strong>Cache Policy</strong>: <code>DEFAULT</code></li> </ul> <p><img alt="Keycloak - Add LDAP" src=../../images/keycloak-ldap-01.png></p> <h4 id=add-group-mapping>Add Group Mapping<a class=headerlink href=#add-group-mapping title="Permanent link">&para;</a></h4> <p>If the value is not mentioned, the default value should be fine.</p> <p>Some values listed here are default, but listed all the same.</p> <ul> <li><strong>Name</strong>: <code>groups</code></li> <li><strong>Mapper Type</strong>: <code>group-ldap-mapper</code></li> <li><strong>LDAP Groups DN</strong>: <code>ou=Groups, dc=example,dc=com</code></li> <li><strong>Group Name LDAP Attribute</strong>: <code>cn</code></li> <li><strong>Group Object Classes</strong>: <code>groupOfUniqueNames</code></li> <li><strong>Membership LDAP Attribute</strong>: <code>uniquemember</code></li> <li><strong>User Groups Retrieve Strategy</strong>: <code>LOAD_GROUPS_BY_MEMBER_ATTRIBUTE</code></li> </ul> <p>When you hit <code>Save</code>, you can synchronize the groups to Keycloak - if you don't need to, it will confirm the configuration works. Hit the <code>Sync LDAP Groups To Keycloak</code> button, and on top there should be a temporary banner stating how many groups were synchronized (if all categories are <code>0</code>, something is wrong).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Everytime you change a value, you first have to save the page before you can synchronize again.</p> </div> <p><img alt="Keycloak - Add LDAP" src=../../images/keycloak-ldap-02.png></p> <h3 id=mix-ldap-users-with-other-sources>Mix LDAP Users With Other Sources<a class=headerlink href=#mix-ldap-users-with-other-sources title="Permanent link">&para;</a></h3> <p>One of the reasons for this guide to exist, is to be able to encapsulate an LDAP over which you have no control and add additional accounts and groups. There's multiple ways forward here, you can use <code>Identity Providers</code> and <code>User Federation</code> to create more sources of user accounts.</p> <p>Perhaps the simplest way is to manage these extra accounts in Keycloak itself. It has its own User database and Groups database. In addition to that, it allows you to assign users created in Keycloak to be a member of a group derived from LDAP - if you've synched them.</p> <h4 id=ui>UI<a class=headerlink href=#ui title="Permanent link">&para;</a></h4> <p>We can use the UI in Keycloak to manage Users and Groups.</p> <p>We initiate this by going to the <code>Users</code> view and hit <code>Add user</code>.</p> <p><img alt="Keycloak - Create User" src=../../images/keycloak-create-user-01.png></p> <p>We can then fill in all the details of the User.</p> <p><img alt="Keycloak - Create User" src=../../images/keycloak-create-user-02.png></p> <h4 id=rest-api>REST API<a class=headerlink href=#rest-api title="Permanent link">&para;</a></h4> <p>Keycloak has a rich REST API with good decent documentation<sup id=fnref:21><a class=footnote-ref href=#fn:21>21</a></sup>. The thing missing is some examples for how to use them correctly.</p> <p>I recommend using HTTPie<sup id=fnref:28><a class=footnote-ref href=#fn:28>28</a></sup> rather than cUrl, as it is easier to use for these more complex calls.</p> <h5 id=get-token>Get Token<a class=headerlink href=#get-token title="Permanent link">&para;</a></h5> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The Bearer Token is only valid for a short period of time. If you wait too long, you will get <code>401 unauthorized</code>.</p> </div> <p>The default REALM is <code>master</code>.</p> <div class=tabbed-set data-tabs=1:2> <input name=__tabbed_1 type=radio id=__tabbed_1_1 checked=checked><label for=__tabbed_1_1>httpie</label><div class=tabbed-content><div class=highlight><pre><span></span><code>http --form POST <span class=s2>&quot;</span><span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span><span class=s2>/auth/realms/</span><span class=si>${</span><span class=nv>REALM</span><span class=si>}</span><span class=s2>/protocol/openid-connect/token&quot;</span> <span class=nv>username</span><span class=o>=</span><span class=s2>&quot;keycloak&quot;</span> <span class=nv>password</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>PASS</span><span class=si>}</span><span class=s2>&quot;</span> <span class=nv>client_id</span><span class=o>=</span><span class=s2>&quot;admin-cli&quot;</span> <span class=nv>grant_type</span><span class=o>=</span><span class=s2>&quot;password&quot;</span>
</code></pre></div></div> <input name=__tabbed_1 type=radio id=__tabbed_1_2><label for=__tabbed_1_2>curl</label><div class=tabbed-content><div class=highlight><pre><span></span><code>curl <span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span>/auth/realms/<span class=si>${</span><span class=nv>REALM</span><span class=si>}</span>/protocol/openid-connect/token -u keycloak:<span class=si>${</span><span class=nv>PASS</span><span class=si>}</span>
</code></pre></div></div> </div> <h5 id=get-users>Get Users<a class=headerlink href=#get-users title="Permanent link">&para;</a></h5> <div class=tabbed-set data-tabs=2:3> <input name=__tabbed_2 type=radio id=__tabbed_2_1 checked=checked><label for=__tabbed_2_1>httpie</label><div class=tabbed-content><div class=highlight><pre><span></span><code>http <span class=s2>&quot;</span><span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span><span class=s2>/auth/admin/realms/</span><span class=si>${</span><span class=nv>REALM</span><span class=si>}</span><span class=s2>/users&quot;</span> <span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span>
</code></pre></div></div> <input name=__tabbed_2 type=radio id=__tabbed_2_2><label for=__tabbed_2_2>httpie - get user</label><div class=tabbed-content><div class=highlight><pre><span></span><code>http <span class=s2>&quot;</span><span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span><span class=s2>/auth/admin/realms/</span><span class=si>${</span><span class=nv>REALM</span><span class=si>}</span><span class=s2>/users/</span><span class=si>${</span><span class=nv>userId</span><span class=si>}</span><span class=s2>&quot;</span> <span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span>
</code></pre></div></div> <input name=__tabbed_2 type=radio id=__tabbed_2_3><label for=__tabbed_2_3>curl</label><div class=tabbed-content><div class=highlight><pre><span></span><code>curl -v <span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span>/auth/admin/realms/<span class=si>${</span><span class=nv>REALM</span><span class=si>}</span>/users -H <span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span> <span class=p>|</span> jq
</code></pre></div></div> </div> <h5 id=create-user>Create User<a class=headerlink href=#create-user title="Permanent link">&para;</a></h5> <div class=tabbed-set data-tabs=3:2> <input name=__tabbed_3 type=radio id=__tabbed_3_1 checked=checked><label for=__tabbed_3_1>httpie</label><div class=tabbed-content><div class=highlight><pre><span></span><code>http POST <span class=s2>&quot;</span><span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span><span class=s2>/auth/admin/realms/</span><span class=si>${</span><span class=nv>REALM</span><span class=si>}</span><span class=s2>/users&quot;</span> <span class=se>\</span>
    <span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span> <span class=se>\</span>
    credentials:<span class=o>=</span><span class=s2>&quot;[{\&quot;value\&quot; : \&quot;mypass\&quot;, \&quot;type\&quot;: \&quot;password\&quot; }]&quot;</span> <span class=se>\</span>
    <span class=nv>email</span><span class=o>=</span><span class=s2>&quot;user@example.com&quot;</span> <span class=se>\</span>
    <span class=nv>firstName</span><span class=o>=</span><span class=s2>&quot;hannibal&quot;</span> <span class=se>\</span>
    <span class=nv>lastName</span><span class=o>=</span><span class=s2>&quot;lecter&quot;</span> <span class=se>\</span>
    <span class=nv>username</span><span class=o>=</span><span class=s2>&quot;hlecter&quot;</span> <span class=se>\</span>
    groups:<span class=o>=</span><span class=s1>&#39;[&quot;Robots&quot;]&#39;</span> <span class=se>\</span>
    emailVerified:<span class=o>=</span><span class=nb>true</span> <span class=se>\</span>
    enabled:<span class=o>=</span><span class=nb>true</span>
</code></pre></div></div> <input name=__tabbed_3 type=radio id=__tabbed_3_2><label for=__tabbed_3_2>curl</label><div class=tabbed-content><div class=highlight><pre><span></span><code>curl -v <span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span>/auth/admin/realms/<span class=si>${</span><span class=nv>REALM</span><span class=si>}</span>/users -H <span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span> <span class=p>|</span> jq
</code></pre></div></div> </div> <h3 id=verify>Verify<a class=headerlink href=#verify title="Permanent link">&para;</a></h3> <p>To verify everything is working as it should, you can go to the <code>Groups</code> and <code>Users</code> pages within the <code>Manage</code> menu (left hand side).</p> <p>With Groups you have <code>View all groups</code>, which should have the groups from LDAP and any group you have created within Keycloak - if not yet, you can do so here as well.</p> <p>To view details of a Group, double click the name - it's not obvious you can do so - and you will go to the details page. Here you can also see the members of the Group.</p> <p>You can do the same with the Users menu item. By default the page is empty, if your list of users is not too large, click on <code>View all users</code>. You can view the details page of a user by clicking the link of the User ID. Within the Groups tab you can add the user to more groups, this should contain all the groups known to Keycloak - both Keycloak internal and from LDAP.</p> <h2 id=sso-with-jenkins>SSO with Jenkins<a class=headerlink href=#sso-with-jenkins title="Permanent link">&para;</a></h2> <p>To configure Jenkins to use Keycloak we have two plugins at our disposal, OpenId Connect(<code>oic-auth</code>)<sup id=fnref:22><a class=footnote-ref href=#fn:22>22</a></sup> and Keycloak<sup id=fnref:23><a class=footnote-ref href=#fn:23>23</a></sup>. While the Keycloak plugin is easier to configure for authentication, I found it difficult to configure groups. As I feel the group management is mandatory we're going with the OpenId Connect plugin.</p> <p>You can install plugins in Jenkins via the UI<sup id=fnref:24><a class=footnote-ref href=#fn:24>24</a></sup>, via the new Jenkins CLI<sup id=fnref:25><a class=footnote-ref href=#fn:25>25</a></sup>, or via the <code>values.yaml</code> when installing via the Helm Chart<sup id=fnref:27><a class=footnote-ref href=#fn:27>27</a></sup>.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Install the OpenId Connect plugin before configuring the next parts, and restart your Jenkins instance for best results.</p> </div> <p>In order to configure OpenId Connect with Jenkins, it is the easiest to use the <code>well-known</code> endpoint url. This endpoint contains all the configuration information the plugin needs to configure itself.</p> <p>Usually, this is <code>${KEYCLOAK_URL}/auth/realms/${REALM}/.well-known/openid-configuration</code>.</p> <p>From Keycloak's perspective we have to register Jenkins as a Client.</p> <h3 id=keycloak-client>Keycloak Client<a class=headerlink href=#keycloak-client title="Permanent link">&para;</a></h3> <p>We go to the <code>Clients</code> screen in Keycloak and hit the <code>Create</code> button.</p> <p>In the next screen, we need to supply three values:</p> <ul> <li><strong>Client ID</strong>: the name of your client, <code>jenkins</code> would be good example</li> <li><strong>Client Protocol</strong>: <code>openid-connect</code> is recommended</li> <li><strong>Root URL</strong>: the main url of your installation, for example <code>https://jenkins.my.domain.com</code></li> </ul> <h4 id=main-settings>Main Settings<a class=headerlink href=#main-settings title="Permanent link">&para;</a></h4> <p>Once we hit save, we get a details view.</p> <p>We have to change some values here.</p> <ul> <li><strong>Access Type</strong>: we need a Client ID and Client Secret, we only get this when we select <code>confidential</code></li> <li><strong>Valid Redirect URIs</strong>: confirm this is <code>${yourJenkinsURL}/*</code></li> </ul> <p><img alt="Keycloak - Configure Jenkins via UI" src=../../images/keycloak-client-01.png></p> <p>Once you hit save, you get a new Tab in the Details screen of this Client. It is called <code>Credentials</code>, and here you can see the Client <code>Secret</code> which we will need to enter in Jenkins.</p> <p><img alt="Keycloak - Configure Jenkins via UI" src=../../images/keycloak-client-03.png></p> <h4 id=group-mappings>Group Mappings<a class=headerlink href=#group-mappings title="Permanent link">&para;</a></h4> <p>Just as we had to add the Group mapping to the LDAP configuration, we will need to configure the Group mapping in the Client.</p> <p>If we go into the Client details, we see there's a Tab called <code>Mappers</code>. We create a new Mapping here by hitting the <code>Create</code> button.</p> <p>Give the mapping a name and then select the <strong><em>Mapper Type</em></strong> <code>Group Membership</code>.</p> <p>The <strong><em>Token Claim Name</em></strong> is important as well, we use this in our Jenkins configuration, give it a descriptive name such as <code>group-membership</code>.</p> <p><img alt="Keycloak - Configure Jenkins via UI" src=../../images/keycloak-client-02.png></p> <h3 id=configure-via-ui>Configure Via UI<a class=headerlink href=#configure-via-ui title="Permanent link">&para;</a></h3> <p>In Jenkins we go to <code>Manage Jenkins</code> -&gt; <code>Configure Global Security</code> and here we select <code>Login with Openid Connect</code> in the <code>Security Realm</code> block.</p> <ul> <li><strong>Client id</strong>: the client we've configured in Keycloak, if you've followed this guide, it should be <code>jenkins</code></li> <li><strong>Client secret</strong>: the secret of the client configured in Keycloak, if you've lost it, go back to <code>Keycloak</code> -&gt; <code>Clients</code> -&gt; <code>jenkins</code> -&gt; <code>Credentials</code> and copy the value in the field <code>Secret</code>.</li> </ul> <p>We now get a <code>Configuration mode</code> block where we can select either <code>Automatic configuration</code> on <code>Manual configuration</code>. We select <code>Automatic</code> and enter our <code>Well-known</code> configuration endpoint URL from Keycloak we've written down earlier. If you don't remember, the format is usually this: <code>${KEYCLOAK_URL}/auth/realms/${REALM}/.well-known/openid-configuration</code>.</p> <ul> <li><strong>User name field name</strong>: <code>preferred_username</code></li> <li><strong>Full name field name</strong>: <code>name</code></li> <li><strong>Email field name</strong>: <code>email</code></li> <li><strong>Groups field name</strong>: <code>group-membership</code></li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The field <strong>Groups field name</strong> refers back to the <strong><em>Token Claim Name</em></strong> we configured in Keycloak within our Client's Mapping for Group Membership.</p> </div> <p><img alt="Keycloak - Configure Jenkins via UI" src=../../images/keycloak-jenkins-01.png></p> <h3 id=configure-via-configuration-as-code>Configure Via Configuration-as-Code<a class=headerlink href=#configure-via-configuration-as-code title="Permanent link">&para;</a></h3> <p>We can use the amazing Jenkins Configuration-as-Code<sup id=fnref:26><a class=footnote-ref href=#fn:26>26</a></sup> to make sure our SSO configuration is configured out-of-the-box!</p> <p>In order to avoid the having to store the Client ID and Client Secret, we're going to create these as Kubernetes Secrets first.</p> <p>There's more ways to create these, but this is to keep it simple.</p> <div class=highlight><pre><span></span><code>kubectl create secret generic oic-auth <span class=se>\</span>
  --from-literal<span class=o>=</span><span class=nv>clientID</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CLIENT_ID</span><span class=si>}</span><span class=s2>&quot;</span> <span class=se>\</span>
  --from-literal<span class=o>=</span><span class=nv>clientSecret</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CLIENT_SECRET</span><span class=si>}</span><span class=s2>&quot;</span> <span class=se>\</span>
  --from-literal<span class=o>=</span><span class=nv>keycloakUrl</span><span class=o>=</span><span class=si>${</span><span class=nv>keycloakUrl</span><span class=si>}</span> <span class=se>\</span>
  --namespace jenkins
</code></pre></div> <div class="admonition example"> <p class=admonition-title>JCASC-config.yaml</p> <div class=highlight><pre><span></span><code>  <span class=nt>jenkins</span><span class=p>:</span>
    <span class=nt>securityRealm</span><span class=p>:</span>
    <span class=nt>oic</span><span class=p>:</span>
      <span class=nt>clientId</span><span class=p>:</span> <span class=s>&quot;${clientID}&quot;</span>
      <span class=nt>clientSecret</span><span class=p>:</span> <span class=s>&quot;${clientSecret}&quot;</span>
      <span class=nt>wellKnownOpenIDConfigurationUrl</span><span class=p>:</span> <span class=s>&quot;${keycloakUrl}/auth/realms/master/.well-known/openid-configuration&quot;</span>
      <span class=nt>tokenServerUrl</span><span class=p>:</span> <span class=s>&quot;${keycloakUrl}auth/realms/master/protocol/openid-connect/token&quot;</span>
      <span class=nt>authorizationServerUrl</span><span class=p>:</span> <span class=s>&quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/auth&quot;</span>
      <span class=nt>userInfoServerUrl</span><span class=p>:</span> <span class=s>&quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/userinfo&quot;</span>
      <span class=nt>userNameField</span><span class=p>:</span> <span class=s>&quot;preferred_username&quot;</span>
      <span class=nt>fullNameFieldName</span><span class=p>:</span> <span class=s>&quot;name&quot;</span>
      <span class=nt>emailFieldName</span><span class=p>:</span> <span class=s>&quot;email&quot;</span>
      <span class=nt>groupsFieldName</span><span class=p>:</span> <span class=s>&quot;group-membership&quot;</span>
      <span class=nt>scopes</span><span class=p>:</span> <span class=s>&quot;web-origins</span><span class=nv> </span><span class=s>address</span><span class=nv> </span><span class=s>phone</span><span class=nv> </span><span class=s>openid</span><span class=nv> </span><span class=s>offline_access</span><span class=nv> </span><span class=s>profile</span><span class=nv> </span><span class=s>roles</span><span class=nv> </span><span class=s>microprofile-jwt</span><span class=nv> </span><span class=s>email&quot;</span>
      <span class=nt>disableSslVerification</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class=nt>logoutFromOpenidProvider</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class=nt>endSessionUrl</span><span class=p>:</span> <span class=s>&quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/logout&quot;</span>
      <span class=nt>postLogoutRedirectUrl</span><span class=p>:</span> <span class=s>&quot;&quot;</span>
      <span class=nt>escapeHatchEnabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class=nt>escapeHatchSecret</span><span class=p>:</span> <span class=s>&quot;&quot;</span>
</code></pre></div> </div> <details class=example><summary>complete-jenkins-helm-values.yaml</summary><div class=highlight><pre><span></span><code><span class=nt>master</span><span class=p>:</span>
  <span class=nt>ingress</span><span class=p>:</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>hostName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins.my.doamain.com</span>
  <span class=nt>csrf</span><span class=p>:</span>
    <span class=nt>defaultCrumbIssuer</span><span class=p>:</span>
      <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class=nt>proxyCompatability</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class=nt>cli</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class=nt>installPlugins</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-credentials:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">workflow-aggregator:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">workflow-job:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">credentials-binding:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">git:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">blueocean:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">prometheus:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">matrix-auth:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">keycloak:latest</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth:latest</span>
  <span class=nt>JCasC</span><span class=p>:</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>pluginVersion</span><span class=p>:</span> <span class=s>&quot;1.30&quot;</span>
    <span class=nt>configScripts</span><span class=p>:</span>
      <span class=nt>welcome-message</span><span class=p>:</span> <span class="p p-Indicator">|</span>
        <span class=no>jenkins:</span>
          <span class=no>systemMessage: Welcome, this Jenkins is configured and managed as code.</span>
      <span class=nt>ldap-settings</span><span class=p>:</span> <span class="p p-Indicator">|</span>
        <span class=no>jenkins:</span>
          <span class=no>securityRealm:</span>
            <span class=no>oic:</span>
              <span class=no>clientId: &quot;${clientID}&quot;</span>
              <span class=no>clientSecret: &quot;${clientSecret}&quot;</span>
              <span class=no>wellKnownOpenIDConfigurationUrl: &quot;${keycloakUrl}/auth/realms/master/.well-known/openid-configuration&quot;</span>
              <span class=no>tokenServerUrl: &quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/token&quot;</span>
              <span class=no>authorizationServerUrl: &quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/auth&quot;</span>
              <span class=no>userInfoServerUrl: &quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/userinfo&quot;</span>
              <span class=no>userNameField: &quot;preferred_username&quot;</span>
              <span class=no>fullNameFieldName: &quot;name&quot;</span>
              <span class=no>emailFieldName: &quot;email&quot;</span>
              <span class=no>groupsFieldName: &quot;group-membership&quot;</span>
              <span class=no>scopes: &quot;web-origins address phone openid offline_access profile roles microprofile-jwt email&quot;</span>
              <span class=no>disableSslVerification: false</span>
              <span class=no>logoutFromOpenidProvider: true</span>
              <span class=no>endSessionUrl: &quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/logout&quot;</span>
              <span class=no>postLogoutRedirectUrl: &quot;&quot;</span>
              <span class=no>escapeHatchEnabled: false</span>
              <span class=no>escapeHatchSecret: &quot;&quot;</span>
      <span class=nt>matrix-auth</span><span class=p>:</span> <span class="p p-Indicator">|</span>
        <span class=no>jenkins:</span>
          <span class=no>authorizationStrategy:</span>
            <span class=no>globalMatrix:</span>
              <span class=no>permissions:</span>
                <span class=no>- &quot;Overall/Read:authenticated&quot;</span>
                <span class=no>- &quot;Overall/Administer:barbossa&quot;</span>
                <span class=no>- &quot;Overall/Administer:Catmins&quot;</span>
                <span class=no>- &quot;Overall/Administer:Robots&quot;</span>
                <span class=no>- &quot;Overall/Administer:/Catmins&quot;</span>
                <span class=no>- &quot;Overall/Administer:/Robots&quot;</span>
<span class=nt>persistence</span><span class=p>:</span>
  <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class=nt>volumes</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth-clientid</span>
    <span class=nt>secret</span><span class=p>:</span>
      <span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth</span>
      <span class=nt>items</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">clientID</span>
          <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">clientID</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth-clientsecret</span>
    <span class=nt>secret</span><span class=p>:</span>
      <span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth</span>
      <span class=nt>items</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">clientSecret</span>
          <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">clientSecret</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth-keycloakurl</span>
    <span class=nt>secret</span><span class=p>:</span>
      <span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth</span>
      <span class=nt>items</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">keycloakUrl</span>
          <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">keycloakUrl</span>
  <span class=nt>mounts</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth-clientid</span>
      <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/run/secrets/clientID</span>
      <span class=nt>subPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">clientID</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth-clientsecret</span>
      <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/run/secrets/clientSecret</span>
      <span class=nt>subPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">clientSecret</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">oic-auth-keycloakurl</span>
      <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/run/secrets/keycloakUrl</span>
      <span class=nt>subPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">keycloakUrl</span>
</code></pre></div> </details> <h3 id=use-keycloak-groups-in-jenkins>Use Keycloak Groups In Jenkins<a class=headerlink href=#use-keycloak-groups-in-jenkins title="Permanent link">&para;</a></h3> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Unfortuantely, there is one caveat about using Keycloak as intermediary between LDAP and Jenkins.</p> <p>Groups do not come across the same as before, they're now prefixed with <code>/</code>. I'm sure it is down to a misconfiguration on my end, so please let me know how to resolve that if you figure it out. </p> <p>This means, that a LDAP group called <strong><em>Catmins</em></strong> will have to be used in Jenkins via <code>/Catmins</code> in <code>Matrix</code>, <code>Project Matrix</code> or other authorization schemes.</p> </div> <h3 id=verify_1>Verify<a class=headerlink href=#verify_1 title="Permanent link">&para;</a></h3> <p>To verify, take the leap of faith to save the configuration, logout (top right) and then log back in. If everything goes well, you will be redirected to Keycloak, once successfully logged in, redirected back to Jenkins!</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>One thing to remark, that if you're logged into Jenkins and you want to see the Groups, you can select your User (top right, click on your name). </p> <p>Alternatively, you can go to <code>${JENKINS_URL}/whoAmI</code> (notice the capital casing of the 'A' and 'I', it is required).</p> </div> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">&para;</a></h2> <div class=footnote> <hr> <ol> <li id=fn:1> <p><a href=https://www.keycloak.org/ >Apache Keycloak Home</a>&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:2> <p><a href=https://en.wikipedia.org/wiki/Single_sign-on>Wikipedia Definition on Single sign-on</a>&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> <li id=fn:3> <p><a href=https://kubernetes.io/ >Kubernetes Home</a>&#160;<a class=footnote-backref href=#fnref:3 title="Jump back to footnote 3 in the text">&#8617;</a></p> </li> <li id=fn:4> <p><a href=https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol>Lightweight Directory Access Protocol (LDAP)</a>&#160;<a class=footnote-backref href=#fnref:4 title="Jump back to footnote 4 in the text">&#8617;</a></p> </li> <li id=fn:5> <p><a href=http://jenkins.io>Jenkins Home</a>&#160;<a class=footnote-backref href=#fnref:5 title="Jump back to footnote 5 in the text">&#8617;</a></p> </li> <li id=fn:6> <p><a href=https://www.sonarqube.org/ >SonarQube Home</a>&#160;<a class=footnote-backref href=#fnref:6 title="Jump back to footnote 6 in the text">&#8617;</a></p> </li> <li id=fn:7> <p><a href=https://github.com/OpenIdentityPlatform/OpenDJ>OpenDJ Community Edition</a>&#160;<a class=footnote-backref href=#fnref:7 title="Jump back to footnote 7 in the text">&#8617;</a></p> </li> <li id=fn:8> <p><a href=https://helm.sh/ >Helm - Package Manager for Kubernetes</a>&#160;<a class=footnote-backref href=#fnref:8 title="Jump back to footnote 8 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:8 title="Jump back to footnote 8 in the text">&#8617;</a></p> </li> <li id=fn:9> <p><a href=https://medium.com/better-programming/helm-3-fun-with-the-new-beta-8f91c70891ff>Helm 3 Beta</a>&#160;<a class=footnote-backref href=#fnref:9 title="Jump back to footnote 9 in the text">&#8617;</a></p> </li> <li id=fn:10> <p><a href=http://www.zytrax.com/books/ldap/ape/#attributes>Common Used LDAP Attributes Explained</a>&#160;<a class=footnote-backref href=#fnref:10 title="Jump back to footnote 10 in the text">&#8617;</a></p> </li> <li id=fn:11> <p><a href=https://github.com/krallin/tini>tini - process manager</a>&#160;<a class=footnote-backref href=#fnref:11 title="Jump back to footnote 11 in the text">&#8617;</a></p> </li> <li id=fn:12> <p><a href=https://blog.overops.com/running-java-on-docker-youre-breaking-the-law/ >Overops Article on Java License in Docker images</a>&#160;<a class=footnote-backref href=#fnref:12 title="Jump back to footnote 12 in the text">&#8617;</a></p> </li> <li id=fn:13> <p><a href=https://hub.docker.com/_/alpine>Alpine Docker Image</a>&#160;<a class=footnote-backref href=#fnref:13 title="Jump back to footnote 13 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:13 title="Jump back to footnote 13 in the text">&#8617;</a></p> </li> <li id=fn:14> <p><a href=https://snyk.io/blog/10-docker-image-security-best-practices/ >Snyk - 10 docker image security best practices</a>&#160;<a class=footnote-backref href=#fnref:14 title="Jump back to footnote 14 in the text">&#8617;</a></p> </li> <li id=fn:15> <p><a href=https://hub.docker.com/r/azul/zulu-openjdk-alpine>Azul OpenJDK Alpine Image</a>&#160;<a class=footnote-backref href=#fnref:15 title="Jump back to footnote 15 in the text">&#8617;</a></p> </li> <li id=fn:16> <p><a href=https://blog.softwaremill.com/hosting-helm-private-repository-from-github-ff3fa940d0b7>Hosting Helm Private Repository from GitHub</a>&#160;<a class=footnote-backref href=#fnref:16 title="Jump back to footnote 16 in the text">&#8617;</a></p> </li> <li id=fn:17> <p><a href=https://github.com/joostvdg/helm-repo>Joost van der Griendt's Helm Repository</a>&#160;<a class=footnote-backref href=#fnref:17 title="Jump back to footnote 17 in the text">&#8617;</a></p> </li> <li id=fn:18> <p><a href=https://nip.io/ >Nip Io - Dead simple wildcard DNS for any IP Address</a>&#160;<a class=footnote-backref href=#fnref:18 title="Jump back to footnote 18 in the text">&#8617;</a></p> </li> <li id=fn:19> <p><a href=https://github.com/jetstack/cert-manager>Cert Manager</a>&#160;<a class=footnote-backref href=#fnref:19 title="Jump back to footnote 19 in the text">&#8617;</a></p> </li> <li id=fn:20> <p><a href=https://letsencrypt.org/ >Let's Encrypt - Let's Encrypt the world!</a>&#160;<a class=footnote-backref href=#fnref:20 title="Jump back to footnote 20 in the text">&#8617;</a></p> </li> <li id=fn:21> <p><a href=https://www.keycloak.org/docs-api/6.0/rest-api/index.html#_uri_scheme>Keycloak Admin REST API</a>&#160;<a class=footnote-backref href=#fnref:21 title="Jump back to footnote 21 in the text">&#8617;</a></p> </li> <li id=fn:22> <p><a href=https://github.com/jenkinsci/oic-auth-plugin>Jenkins OpenId Connect Plugin</a>&#160;<a class=footnote-backref href=#fnref:22 title="Jump back to footnote 22 in the text">&#8617;</a></p> </li> <li id=fn:23> <p><a href=https://wiki.jenkins.io/display/JENKINS/keycloak-plugin>Jenkins Keycloak Plugin</a>&#160;<a class=footnote-backref href=#fnref:23 title="Jump back to footnote 23 in the text">&#8617;</a></p> </li> <li id=fn:24> <p><a href=https://jenkins.io/doc/book/managing/plugins/ >Jenkins Plugin Management</a>&#160;<a class=footnote-backref href=#fnref:24 title="Jump back to footnote 24 in the text">&#8617;</a></p> </li> <li id=fn:25> <p><a href=https://jenkins.io/blog/2019/08/30/jenkins-cli/ >Jenkins JCLI</a>&#160;<a class=footnote-backref href=#fnref:25 title="Jump back to footnote 25 in the text">&#8617;</a></p> </li> <li id=fn:26> <p><a href=https://github.com/jenkinsci/configuration-as-code-plugin/blob/master/README.md>Jenkins Configuration As Code</a>&#160;<a class=footnote-backref href=#fnref:26 title="Jump back to footnote 26 in the text">&#8617;</a></p> </li> <li id=fn:27> <p><a href=https://github.com/helm/charts/tree/master/stable/jenkins>Jenkins Helm Chart</a>&#160;<a class=footnote-backref href=#fnref:27 title="Jump back to footnote 27 in the text">&#8617;</a></p> </li> <li id=fn:28> <p><a href=https://httpie.org>HTTPie http commandline interface</a>&#160;<a class=footnote-backref href=#fnref:28 title="Jump back to footnote 28 in the text">&#8617;</a></p> </li> </ol> </div> <hr> <div class=md-source-date> <small> Last update: 2019-09-21 21:58:50 </small> </div> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>var disqus_config=function(){this.page.url="https://joostvdg.github.io/blogs/kubernetes-sso-keycloak/",this.page.identifier="/blogs/kubernetes-sso-keycloak/"};!function(){var e=document,i=e.createElement("script");i.src="//joostvdg-github-io.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)}()</script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../teams-automation/ title="CloudBees Automate Teams" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> CloudBees Automate Teams </div> </div> </a> <a href=../../jenkinsx/java-native-prod/01-intro/ title=Intro class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Intro </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Joost van der Griendt </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/joostvdg target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/joost_vdg target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/joostvdg target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.d710d30a.min.js></script> <script src=../../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../..",
          features: ["tabs", "instant"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>