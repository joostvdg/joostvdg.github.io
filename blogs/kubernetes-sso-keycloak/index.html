<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Setup Single Sign-On for Jenkins with Apache Keycloak"><link href=https://joostvdg.github.io/blogs/kubernetes-sso-keycloak/ rel=canonical><link href=../teams-automation/ rel=prev><link href=../../jenkinsx/java-native-prod/01-intro/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.7"><title>SSO Jenkins With Keycloak On Kubernetes - J's Software Development Pages</title><link rel=stylesheet href=../../assets/stylesheets/main.4b4a2bd9.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.356b1318.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-353607268"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-353607268",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-353607268",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=orange data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#single-sign-on-on-kubernetes-with-keycloak class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="J's Software Development Pages" class="md-header__button md-logo" aria-label="J's Software Development Pages" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48 1.18-1.53 3.08-1.95.63-2.3 2.5-3.72Q9.63 4 12 4q2.93 0 4.96 2.04Q19 8.07 19 11q1.73.2 2.86 1.5 1.14 1.28 1.14 3 0 1.88-1.31 3.19T18.5 20Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> J's Software Development Pages </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> SSO Jenkins With Keycloak On Kubernetes </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=orange data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=deep-orange data-md-color-accent=teal aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/joostvdg/joostvdg.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../../jenkins/jenkins-on-kubernetes/ class=md-tabs__link> Jenkins & CloudBees </a> </li> <li class=md-tabs__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-tabs__link> Kubernetes & Docker </a> </li> <li class=md-tabs__item> <a href=../../tanzu/ class=md-tabs__link> VMware Tanzu </a> </li> <li class=md-tabs__item> <a href=../../jenkinsx/build-packs/ class=md-tabs__link> Jenkins X </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ class=md-tabs__link> Software Eng. </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="J's Software Development Pages" class="md-nav__button md-logo" aria-label="J's Software Development Pages" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48 1.18-1.53 3.08-1.95.63-2.3 2.5-3.72Q9.63 4 12 4q2.93 0 4.96 2.04Q19 8.07 19 11q1.73.2 2.86 1.5 1.14 1.28 1.14 3 0 1.88-1.31 3.19T18.5 20Z"/></svg> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Me </span> </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ class=md-nav__link> <span class=md-ellipsis> MKDocs (This Static Website) </span> </a> </li> <li class=md-nav__item> <a href=../../other/vim/ class=md-nav__link> <span class=md-ellipsis> VIM </span> </a> </li> <li class=md-nav__item> <a href=../../other/shell/ class=md-nav__link> <span class=md-ellipsis> Shell </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Blogs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../jenkins-pipeline-support-tool/ class=md-nav__link> <span class=md-ellipsis> Jenkins Pipeline Support Tools </span> </a> </li> <li class=md-nav__item> <a href=../graceful-shutdown/ class=md-nav__link> <span class=md-ellipsis> Docker Graceful Shutdown </span> </a> </li> <li class=md-nav__item> <a href=../docker-alternatives/ class=md-nav__link> <span class=md-ellipsis> Pipelines with Docker Alternatives </span> </a> </li> <li class=md-nav__item> <a href=../k8s-lets-encrypt/ class=md-nav__link> <span class=md-ellipsis> Let's Encrypt for Kubernetes Apps </span> </a> </li> <li class=md-nav__item> <a href=../sso-azure-ad/ class=md-nav__link> <span class=md-ellipsis> CloudBees SSO Azure AD </span> </a> </li> <li class=md-nav__item> <a href=../teams-automation/ class=md-nav__link> <span class=md-ellipsis> CloudBees Automate Teams </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Kubernetes SSO Keycloak </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Kubernetes SSO Keycloak </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#goal class=md-nav__link> Goal </a> </li> <li class=md-nav__item> <a href=#audience class=md-nav__link> Audience </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> Steps </a> </li> <li class=md-nav__item> <a href=#ldap class=md-nav__link> LDAP </a> <nav class=md-nav aria-label=LDAP> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-data-set class=md-nav__link> Test Data Set </a> </li> <li class=md-nav__item> <a href=#configure-opendj class=md-nav__link> Configure OpenDJ </a> </li> <li class=md-nav__item> <a href=#dockerfile class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=#kubernetes-deployment class=md-nav__link> Kubernetes Deployment </a> </li> <li class=md-nav__item> <a href=#kubernetes-service class=md-nav__link> Kubernetes Service </a> </li> <li class=md-nav__item> <a href=#homegrown-helm-chart-with-github class=md-nav__link> Homegrown Helm chart with GitHub </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#keycloak class=md-nav__link> Keycloak </a> <nav class=md-nav aria-label=Keycloak> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-requisites </a> </li> <li class=md-nav__item> <a href=#install-via-helm class=md-nav__link> Install Via Helm </a> </li> <li class=md-nav__item> <a href=#ldap-as-user-federation class=md-nav__link> LDAP As User Federation </a> </li> <li class=md-nav__item> <a href=#mix-ldap-users-with-other-sources class=md-nav__link> Mix LDAP Users With Other Sources </a> </li> <li class=md-nav__item> <a href=#verify class=md-nav__link> Verify </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sso-with-jenkins class=md-nav__link> SSO with Jenkins </a> <nav class=md-nav aria-label="SSO with Jenkins"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#keycloak-client class=md-nav__link> Keycloak Client </a> </li> <li class=md-nav__item> <a href=#configure-via-ui class=md-nav__link> Configure Via UI </a> </li> <li class=md-nav__item> <a href=#configure-via-configuration-as-code class=md-nav__link> Configure Via Configuration-as-Code </a> </li> <li class=md-nav__item> <a href=#use-keycloak-groups-in-jenkins class=md-nav__link> Use Keycloak Groups In Jenkins </a> </li> <li class=md-nav__item> <a href=#verify_1 class=md-nav__link> Verify </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_8> <label class=md-nav__link for=__nav_2_8 id=__nav_2_8_label tabindex=0> <span class=md-ellipsis> Jenkins X Java Native Image Prod </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_8_label aria-expanded=false> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> Jenkins X Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ class=md-nav__link> <span class=md-ellipsis> Cloud SQL </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ class=md-nav__link> <span class=md-ellipsis> Quarkus </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ class=md-nav__link> <span class=md-ellipsis> Import Into Jenkins X </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ class=md-nav__link> <span class=md-ellipsis> Database Connection And Secrets </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ class=md-nav__link> <span class=md-ellipsis> Native Image </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ class=md-nav__link> <span class=md-ellipsis> Pipeline Improvements </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ class=md-nav__link> <span class=md-ellipsis> Previews & Integration Tests </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ class=md-nav__link> <span class=md-ellipsis> Production Improvements </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ class=md-nav__link> <span class=md-ellipsis> Promote To Production </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_9> <label class=md-nav__link for=__nav_2_9 id=__nav_2_9_label tabindex=0> <span class=md-ellipsis> Jenkins Monitoring Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_9_label aria-expanded=false> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/prepare/ class=md-nav__link> <span class=md-ellipsis> Prepare Environment </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/install/ class=md-nav__link> <span class=md-ellipsis> Install Tools </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/metrics/ class=md-nav__link> <span class=md-ellipsis> Metrics </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/alerts/ class=md-nav__link> <span class=md-ellipsis> Alerts </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/pipeline/ class=md-nav__link> <span class=md-ellipsis> Pipeline </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/dashboard/ class=md-nav__link> <span class=md-ellipsis> Dashboard </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/cloudbees/ class=md-nav__link> <span class=md-ellipsis> CloudBees </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../k8s-crd/ class=md-nav__link> <span class=md-ellipsis> Create your own k8s resource </span> </a> </li> <li class=md-nav__item> <a href=../dockercon-eu-2018/ class=md-nav__link> <span class=md-ellipsis> DockerCon EU 2018 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Jenkins & CloudBees </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Jenkins & CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/jenkins-on-kubernetes/ class=md-nav__link> <span class=md-ellipsis> Jenkins On Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/jenkins-tap/ class=md-nav__link> <span class=md-ellipsis> TAP & Jenkins </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> CloudBees </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloudbees/cbci-casc/ class=md-nav__link> <span class=md-ellipsis> CloudBees CasC </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/sso-azure-ad/ class=md-nav__link> <span class=md-ellipsis> Single Sign On - AzureAD </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/teams-automation/ class=md-nav__link> <span class=md-ellipsis> CloudBees Automate Teams </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-gke-helm/ class=md-nav__link> <span class=md-ellipsis> CloudBees CI on GKE </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-eks/ class=md-nav__link> <span class=md-ellipsis> CloudBees CI on EKS </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-team-namespace/ class=md-nav__link> <span class=md-ellipsis> Team Master Namespace </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/multi-cluster-gke/ class=md-nav__link> <span class=md-ellipsis> Multi-Cluster GKE </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/multi-cluster-eks/ class=md-nav__link> <span class=md-ellipsis> Multi-Cluster EKS </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/multi-cluster/ class=md-nav__link> <span class=md-ellipsis> Multi-Cluster (OLD/AKS) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> Jenkins </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ class=md-nav__link> <span class=md-ellipsis> JobDSL </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ class=md-nav__link> <span class=md-ellipsis> JenkinsJobsBuilder </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class=md-ellipsis> Jenkins Pipelines </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ class=md-nav__link> <span class=md-ellipsis> Job Types </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/kaniko-pipelines/ class=md-nav__link> <span class=md-ellipsis> Build Docker Image Kaniko </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/podtemplate-dind/ class=md-nav__link> <span class=md-ellipsis> PodTemplate With Docker-In-Docker </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ class=md-nav__link> <span class=md-ellipsis> Parallel Pipelines </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ class=md-nav__link> <span class=md-ellipsis> Core Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ class=md-nav__link> <span class=md-ellipsis> Artifactory Integration </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ class=md-nav__link> <span class=md-ellipsis> Pipeline (declarative) </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ class=md-nav__link> <span class=md-ellipsis> Groovy DSL Pipeline </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ class=md-nav__link> <span class=md-ellipsis> Pipeline Libraries </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ class=md-nav__link> <span class=md-ellipsis> DSL IDE Integration </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ class=md-nav__link> <span class=md-ellipsis> Input </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class=md-ellipsis> Jenkins Pipeline Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ class=md-nav__link> <span class=md-ellipsis> Docker Alternatives </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ class=md-nav__link> <span class=md-ellipsis> Maven Declarative </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ class=md-nav__link> <span class=md-ellipsis> Docker Declarative </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Kubernetes & Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Kubernetes & Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> OpenShift </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-nav__link> <span class=md-ellipsis> OpenShift 3.11 GCP(minimal) </span> </a> </li> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-medium/ class=md-nav__link> <span class=md-ellipsis> OpenShift 3.11 GCP(medium) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Kubernetes (K8S) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ class=md-nav__link> <span class=md-ellipsis> CKA Exam prep </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ class=md-nav__link> <span class=md-ellipsis> Tools </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Managed Kubernetes (cloud) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Managed Kubernetes (cloud) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ class=md-nav__link> <span class=md-ellipsis> GKE </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/gke-terraform/ class=md-nav__link> <span class=md-ellipsis> GKE Terraform </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ class=md-nav__link> <span class=md-ellipsis> AWS EKS </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ class=md-nav__link> <span class=md-ellipsis> AKS CLI </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ class=md-nav__link> <span class=md-ellipsis> AKS Terraform </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> K8S Hard Way - GCE </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ class=md-nav__link> <span class=md-ellipsis> Installer Preparation </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ class=md-nav__link> <span class=md-ellipsis> Create GCE resources </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ class=md-nav__link> <span class=md-ellipsis> Prepare Certificates </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ class=md-nav__link> <span class=md-ellipsis> Prepare Kubeconfigs </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ class=md-nav__link> <span class=md-ellipsis> Encryption configuration </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ class=md-nav__link> <span class=md-ellipsis> ETCD configuration </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ class=md-nav__link> <span class=md-ellipsis> Controller Config </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ class=md-nav__link> <span class=md-ellipsis> Worker Config </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ class=md-nav__link> <span class=md-ellipsis> Remote access </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ class=md-nav__link> <span class=md-ellipsis> Network config </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ class=md-nav__link> <span class=md-ellipsis> Debug </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ class=md-nav__link> <span class=md-ellipsis> Graceful Shutdown </span> </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ class=md-nav__link> <span class=md-ellipsis> BuildKit </span> </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ class=md-nav__link> <span class=md-ellipsis> Multi-Stage Builds(TBD) </span> </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ class=md-nav__link> <span class=md-ellipsis> Swarm (mode) (TBD) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ class=md-nav__link> <span class=md-ellipsis> SystemD </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> VMware Tanzu </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> VMware Tanzu </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/ class=md-nav__link> <span class=md-ellipsis> Tanzu </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> TAP GitOps </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> TAP GitOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/services/ class=md-nav__link> <span class=md-ellipsis> Services </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/tap-gitops-prep/ class=md-nav__link> <span class=md-ellipsis> TAP GitOps Prep </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/tap-build/ class=md-nav__link> <span class=md-ellipsis> TAP Build </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/tap-run/ class=md-nav__link> <span class=md-ellipsis> TAP Run </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/tap-view/ class=md-nav__link> <span class=md-ellipsis> TAP View </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/next-steps/ class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/run-with-argocd/ class=md-nav__link> <span class=md-ellipsis> TAP Run With ArgoCD </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_3> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> <span class=md-ellipsis> TAP Supply Chain Customization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> TAP Supply Chain Customization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/supplychain/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/supplychain/gitops-flow/ class=md-nav__link> <span class=md-ellipsis> GitOps Flow </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> TAP GUI/Portal </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> TAP GUI/Portal </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/tap-gui/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gui/gitlab-integration/ class=md-nav__link> <span class=md-ellipsis> GitLab Integration </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gui/techdocs-minio/ class=md-nav__link> <span class=md-ellipsis> TechDocs with MinIO </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gui/tdp-plugins/ class=md-nav__link> <span class=md-ellipsis> Backstage Plugins </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> TAP on TKGs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> TAP on TKGs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5_1> <label class=md-nav__link for=__nav_5_5_1 id=__nav_5_5_1_label tabindex=0> <span class=md-ellipsis> TAP 1.3.x </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_5_5_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5_1> <span class="md-nav__icon md-icon"></span> TAP 1.3.x </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13-overview/ class=md-nav__link> <span class=md-ellipsis> TAP on TKGs </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13/build-basic/ class=md-nav__link> <span class=md-ellipsis> TAP Build Profile - Basic Supply Chain </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13/build-scanning-testing/ class=md-nav__link> <span class=md-ellipsis> TAP Build Profile - Scanning & Testing Supply Chain </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13/run/ class=md-nav__link> <span class=md-ellipsis> TAP Run Profile </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13/view/ class=md-nav__link> <span class=md-ellipsis> TAP View Profile </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex=0> <span class=md-ellipsis> TAP DevSecOps </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> TAP DevSecOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/grype-airgapped/ class=md-nav__link> <span class=md-ellipsis> Use Grype In Restricted Environments </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class=md-ellipsis> TAP Misc </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> TAP Misc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/tap/fluxcd-ssh/ class=md-nav__link> <span class=md-ellipsis> Git access with SSH </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap/gitea/ class=md-nav__link> <span class=md-ellipsis> Setup Gitea </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../tanzu/custom-ca/ class=md-nav__link> <span class=md-ellipsis> Setup Custom CA </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/harbor-ca/ class=md-nav__link> <span class=md-ellipsis> Harbor with custom CA </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/minio-ca/ class=md-nav__link> <span class=md-ellipsis> Minio with custom CA </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkg-grafana/ class=md-nav__link> <span class=md-ellipsis> TKG Grafana with LDAP </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/dependencies/ class=md-nav__link> <span class=md-ellipsis> Dependencies </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Jenkins X </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/build-packs/ class=md-nav__link> <span class=md-ellipsis> Build Packs </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jx-pipelines/ class=md-nav__link> <span class=md-ellipsis> Jenkins X Pipelines </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> Java Native Image Prod </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ class=md-nav__link> <span class=md-ellipsis> Cloud SQL </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ class=md-nav__link> <span class=md-ellipsis> Quarkus </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ class=md-nav__link> <span class=md-ellipsis> Import Into Jenkins X </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ class=md-nav__link> <span class=md-ellipsis> Database Connection And Secrets </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ class=md-nav__link> <span class=md-ellipsis> Native Image </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ class=md-nav__link> <span class=md-ellipsis> Pipeline Improvements </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ class=md-nav__link> <span class=md-ellipsis> Previews & Integration Tests </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ class=md-nav__link> <span class=md-ellipsis> Production Improvements </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ class=md-nav__link> <span class=md-ellipsis> Promote To Production </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../jenkinsx/builder-image/ class=md-nav__link> <span class=md-ellipsis> Create Builder Image </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot/ class=md-nav__link> <span class=md-ellipsis> JX Boot GKE </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot-aks/ class=md-nav__link> <span class=md-ellipsis> JX Boot AKS </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/aks-boot-core/ class=md-nav__link> <span class=md-ellipsis> JX Boot & CloudBees Core </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-minimal/ class=md-nav__link> <span class=md-ellipsis> OpenShift 3.11 </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-restricted/ class=md-nav__link> <span class=md-ellipsis> OpenShift 3.11 - Restricted </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/lighthouse-bitbucket/ class=md-nav__link> <span class=md-ellipsis> Lighthouse & Bitbucket </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hello-world/ class=md-nav__link> <span class=md-ellipsis> HelloWorld </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/maven/ class=md-nav__link> <span class=md-ellipsis> Maven </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hybrid/ class=md-nav__link> <span class=md-ellipsis> Hybrid </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/kubernetes-days/ class=md-nav__link> <span class=md-ellipsis> Example For Console Reel </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Software Eng. </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Software Eng. </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1 id=__nav_7_1_label tabindex=0> <span class=md-ellipsis> Automation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_1_label aria-expanded=false> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ class=md-nav__link> <span class=md-ellipsis> Pulumi </span> </a> </li> <li class=md-nav__item> <a href=../../certificates/lets-encrypt-k8s/ class=md-nav__link> <span class=md-ellipsis> Let's Encrypt K8S </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2 id=__nav_7_2_label tabindex=0> <span class=md-ellipsis> Software Engineering </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_2_label aria-expanded=false> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ class=md-nav__link> <span class=md-ellipsis> Important Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ class=md-nav__link> <span class=md-ellipsis> Naming </span> </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ class=md-nav__link> <span class=md-ellipsis> Distributed Computing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> Productivity </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ class=md-nav__link> <span class=md-ellipsis> General </span> </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ class=md-nav__link> <span class=md-ellipsis> Incidents </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4 id=__nav_7_4_label tabindex=0> <span class=md-ellipsis> Java </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/ class=md-nav__link> <span class=md-ellipsis> General </span> </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ class=md-nav__link> <span class=md-ellipsis> Spring Boot App </span> </a> </li> <li class=md-nav__item> <a href=../../java/networking/ class=md-nav__link> <span class=md-ellipsis> Java Networking </span> </a> </li> <li class=md-nav__item> <a href=../../java/concurrency/ class=md-nav__link> <span class=md-ellipsis> Java Concurrency </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#goal class=md-nav__link> Goal </a> </li> <li class=md-nav__item> <a href=#audience class=md-nav__link> Audience </a> </li> <li class=md-nav__item> <a href=#steps class=md-nav__link> Steps </a> </li> <li class=md-nav__item> <a href=#ldap class=md-nav__link> LDAP </a> <nav class=md-nav aria-label=LDAP> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-data-set class=md-nav__link> Test Data Set </a> </li> <li class=md-nav__item> <a href=#configure-opendj class=md-nav__link> Configure OpenDJ </a> </li> <li class=md-nav__item> <a href=#dockerfile class=md-nav__link> Dockerfile </a> </li> <li class=md-nav__item> <a href=#kubernetes-deployment class=md-nav__link> Kubernetes Deployment </a> </li> <li class=md-nav__item> <a href=#kubernetes-service class=md-nav__link> Kubernetes Service </a> </li> <li class=md-nav__item> <a href=#homegrown-helm-chart-with-github class=md-nav__link> Homegrown Helm chart with GitHub </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#keycloak class=md-nav__link> Keycloak </a> <nav class=md-nav aria-label=Keycloak> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-requisites </a> </li> <li class=md-nav__item> <a href=#install-via-helm class=md-nav__link> Install Via Helm </a> </li> <li class=md-nav__item> <a href=#ldap-as-user-federation class=md-nav__link> LDAP As User Federation </a> </li> <li class=md-nav__item> <a href=#mix-ldap-users-with-other-sources class=md-nav__link> Mix LDAP Users With Other Sources </a> </li> <li class=md-nav__item> <a href=#verify class=md-nav__link> Verify </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sso-with-jenkins class=md-nav__link> SSO with Jenkins </a> <nav class=md-nav aria-label="SSO with Jenkins"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#keycloak-client class=md-nav__link> Keycloak Client </a> </li> <li class=md-nav__item> <a href=#configure-via-ui class=md-nav__link> Configure Via UI </a> </li> <li class=md-nav__item> <a href=#configure-via-configuration-as-code class=md-nav__link> Configure Via Configuration-as-Code </a> </li> <li class=md-nav__item> <a href=#use-keycloak-groups-in-jenkins class=md-nav__link> Use Keycloak Groups In Jenkins </a> </li> <li class=md-nav__item> <a href=#verify_1 class=md-nav__link> Verify </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=single-sign-on-on-kubernetes-with-keycloak>Single Sign On on Kubernetes with Keycloak<a class=headerlink href=#single-sign-on-on-kubernetes-with-keycloak title="Permanent link">&para;</a></h1> <p>This article is about setting up an Apache Keycloak<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup> instance for Single Sign-On<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup> (SSO) on Kubernetes.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>This guide is created to help you show how you can do this from a technical point of view. If you are in an enterprise, please consult your in-house - if available - or external security professionals before running tools such as Keycloak in production.</p> </div> <h2 id=goal>Goal<a class=headerlink href=#goal title="Permanent link">&para;</a></h2> <p>The goal is to show why using Keycloak as SSO can be valuable and guide on how to do so.</p> <p>For what's in the <code>How</code>, look at the next paragraph: <code>Steps</code>.</p> <p>At the outset, this article is not about comparing SSO solutions or about claiming Keycloak is the best. Its a solution, and if you're interested in using this, it helps you with the how.</p> <p>Below are some links to alternatives as reference, but are not discussed.</p> <h2 id=audience>Audience<a class=headerlink href=#audience title="Permanent link">&para;</a></h2> <p>The expected audience are those who are using Kubernetes<sup id=fnref:3><a class=footnote-ref href=#fn:3>3</a></sup> and are:</p> <ul> <li>looking to host a SSO solution themselves</li> <li>want to use LDAP<sup id=fnref:4><a class=footnote-ref href=#fn:4>4</a></sup> as <code>User Federation</code> for Keycloak</li> <li>want to setup a SSO with Jenkins<sup id=fnref:5><a class=footnote-ref href=#fn:5>5</a></sup> and/or SonarQube<sup id=fnref:6><a class=footnote-ref href=#fn:6>6</a></sup></li> </ul> <h2 id=steps>Steps<a class=headerlink href=#steps title="Permanent link">&para;</a></h2> <p>These are the steps we will execute.</p> <ul> <li>configure an LDAP server with a test data set</li> <li>package LDAP server in a Docker container and run it as an kubernetes <code>Deployment</code><ul> <li>you might think, why not a <code>StatefulSet</code>, but our LDAP will have static data</li> <li>and the idea of this setup, is that we do not control LDAP, meaning, we should expect LDAP's data to be immutable</li> </ul> </li> <li>install Keycloak with Helm<sup id=fnref:8><a class=footnote-ref href=#fn:8>8</a></sup><ul> <li>we use Helm 2, as Helm 3<sup id=fnref:9><a class=footnote-ref href=#fn:9>9</a></sup> is still in beta at the time of writing (September 2019)</li> </ul> </li> <li>configure Keycloak to use LDAP for <code>User Federation</code></li> <li>install Jenkins and SonarQube with Helm<sup id=fnref2:8><a class=footnote-ref href=#fn:8>8</a></sup></li> <li>configure SSO with Keycloak in Jenkins</li> <li>configure SSO with Keycloak in SonarQube</li> </ul> <h2 id=ldap>LDAP<a class=headerlink href=#ldap title="Permanent link">&para;</a></h2> <p>We will use OpenDJ<sup id=fnref:7><a class=footnote-ref href=#fn:7>7</a></sup> as LDAP implementation. There are many alternatives out there, feel free to use those. But for this guide, we will use OpenDJ's community edition, it works well and is easy to configure.</p> <p>We need the following:</p> <ul> <li>configured with a test data set including users and groups</li> <li>Docker container image definition</li> <li>Kubernetes <code>Deployment</code> definition to run</li> <li>Kubernetes <code>Service</code> definition to access a stable address</li> </ul> <h3 id=test-data-set>Test Data Set<a class=headerlink href=#test-data-set title="Permanent link">&para;</a></h3> <details class=example> <summary>example.ldiff</summary> <p>This a full example.</p> <p>The different parts will be explained below.</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>dn: dc=example,dc=com
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>objectclass: top
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>objectclass: domain
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>dc: example
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>dn: ou=People, dc=example,dc=com
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>objectclass: top
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>objectclass: organizationalunit
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>ou: People
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>aci: (targetattr=&quot;*||+&quot;)(version 3.0; acl &quot;IDM Access&quot;; allow (all)
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>userdn=&quot;ldap:///uid=idm,ou=Administrators,dc=example,dc=com&quot;;)
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>dn: uid=cptjack, ou=People, dc=example,dc=com
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>cn: cpt. Jack Sparrow
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>sn: Sparrow
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>givenname: Jack
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>objectclass: top
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>objectclass: person
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>objectclass: organizationalPerson
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>objectclass: inetOrgPerson
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>ou: Operations
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>ou: People
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>l: Caribbean
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>uid: cptjack
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>mail: jack@example.com
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>telephonenumber: +421 910 123456
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>facsimiletelephonenumber: +1 408 555 1111
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>roomnumber: 666
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>userpassword: MyAwesomePassword
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a>dn: uid=djones, ou=People, dc=example,dc=com
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>cn: Davy Jones
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a>sn: Jones
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a>givenname: Davy
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>objectclass: top
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a>objectclass: person
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a>objectclass: organizationalPerson
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a>objectclass: inetOrgPerson
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a>ou: Operations
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>ou: People
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a>l: Caribbean
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a>uid: djones
</span><span id=__span-0-43><a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a>mail: d.jones@example.com
</span><span id=__span-0-44><a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a>telephonenumber: +421 910 382735
</span><span id=__span-0-45><a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a>facsimiletelephonenumber: +1 408 555 1112
</span><span id=__span-0-46><a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a>roomnumber: 112
</span><span id=__span-0-47><a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a>userpassword: MyAwesomePassword
</span><span id=__span-0-48><a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a>
</span><span id=__span-0-49><a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a>dn: ou=Groups, dc=example,dc=com
</span><span id=__span-0-50><a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a>objectclass: top
</span><span id=__span-0-51><a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>objectclass: organizationalunit
</span><span id=__span-0-52><a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a>ou: Groups
</span><span id=__span-0-53><a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a>aci: (targetattr=&quot;*||+&quot;)(version 3.0; acl &quot;IDM Access&quot;; allow (all)
</span><span id=__span-0-54><a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a>userdn=&quot;ldap:///uid=idm,ou=Administrators,dc=example,dc=com&quot;;)
</span><span id=__span-0-55><a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a>
</span><span id=__span-0-56><a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a>dn: cn=Pirates,ou=Groups,dc=example,dc=com
</span><span id=__span-0-57><a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a>objectclass: top
</span><span id=__span-0-58><a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a>objectclass: groupOfUniqueNames
</span><span id=__span-0-59><a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a>cn: Pirates
</span><span id=__span-0-60><a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a>ou: Groups
</span><span id=__span-0-61><a id=__codelineno-0-61 name=__codelineno-0-61 href=#__codelineno-0-61></a>uniquemember: uid=cptjack, ou=People, dc=example,dc=com
</span><span id=__span-0-62><a id=__codelineno-0-62 name=__codelineno-0-62 href=#__codelineno-0-62></a>uniquemember: uid=djones, ou=People, dc=example,dc=com
</span><span id=__span-0-63><a id=__codelineno-0-63 name=__codelineno-0-63 href=#__codelineno-0-63></a>description: Arrrrr!
</span><span id=__span-0-64><a id=__codelineno-0-64 name=__codelineno-0-64 href=#__codelineno-0-64></a>
</span><span id=__span-0-65><a id=__codelineno-0-65 name=__codelineno-0-65 href=#__codelineno-0-65></a>dn: cn=Catmins,ou=Groups,dc=example,dc=com
</span><span id=__span-0-66><a id=__codelineno-0-66 name=__codelineno-0-66 href=#__codelineno-0-66></a>objectclass: top
</span><span id=__span-0-67><a id=__codelineno-0-67 name=__codelineno-0-67 href=#__codelineno-0-67></a>objectclass: groupOfUniqueNames
</span><span id=__span-0-68><a id=__codelineno-0-68 name=__codelineno-0-68 href=#__codelineno-0-68></a>cn: Catmins
</span><span id=__span-0-69><a id=__codelineno-0-69 name=__codelineno-0-69 href=#__codelineno-0-69></a>ou: Groups
</span><span id=__span-0-70><a id=__codelineno-0-70 name=__codelineno-0-70 href=#__codelineno-0-70></a>uniquemember: uid=djones, ou=People, dc=example,dc=com
</span><span id=__span-0-71><a id=__codelineno-0-71 name=__codelineno-0-71 href=#__codelineno-0-71></a>description: Purrrr!
</span><span id=__span-0-72><a id=__codelineno-0-72 name=__codelineno-0-72 href=#__codelineno-0-72></a>
</span><span id=__span-0-73><a id=__codelineno-0-73 name=__codelineno-0-73 href=#__codelineno-0-73></a>dn: ou=Administrators, dc=example,dc=com
</span><span id=__span-0-74><a id=__codelineno-0-74 name=__codelineno-0-74 href=#__codelineno-0-74></a>objectclass: top
</span><span id=__span-0-75><a id=__codelineno-0-75 name=__codelineno-0-75 href=#__codelineno-0-75></a>objectclass: organizationalunit
</span><span id=__span-0-76><a id=__codelineno-0-76 name=__codelineno-0-76 href=#__codelineno-0-76></a>ou: Administrators
</span><span id=__span-0-77><a id=__codelineno-0-77 name=__codelineno-0-77 href=#__codelineno-0-77></a>
</span><span id=__span-0-78><a id=__codelineno-0-78 name=__codelineno-0-78 href=#__codelineno-0-78></a>dn: uid=idm, ou=Administrators,dc=example,dc=com
</span><span id=__span-0-79><a id=__codelineno-0-79 name=__codelineno-0-79 href=#__codelineno-0-79></a>objectclass: top
</span><span id=__span-0-80><a id=__codelineno-0-80 name=__codelineno-0-80 href=#__codelineno-0-80></a>objectclass: person
</span><span id=__span-0-81><a id=__codelineno-0-81 name=__codelineno-0-81 href=#__codelineno-0-81></a>objectclass: organizationalPerson
</span><span id=__span-0-82><a id=__codelineno-0-82 name=__codelineno-0-82 href=#__codelineno-0-82></a>objectclass: inetOrgPerson
</span><span id=__span-0-83><a id=__codelineno-0-83 name=__codelineno-0-83 href=#__codelineno-0-83></a>uid: idm
</span><span id=__span-0-84><a id=__codelineno-0-84 name=__codelineno-0-84 href=#__codelineno-0-84></a>cn: IDM Administrator
</span><span id=__span-0-85><a id=__codelineno-0-85 name=__codelineno-0-85 href=#__codelineno-0-85></a>sn: IDM Administrator
</span><span id=__span-0-86><a id=__codelineno-0-86 name=__codelineno-0-86 href=#__codelineno-0-86></a>description: Special LDAP acccount used by the IDM
</span><span id=__span-0-87><a id=__codelineno-0-87 name=__codelineno-0-87 href=#__codelineno-0-87></a>to access the LDAP data.
</span><span id=__span-0-88><a id=__codelineno-0-88 name=__codelineno-0-88 href=#__codelineno-0-88></a>ou: Administrators
</span><span id=__span-0-89><a id=__codelineno-0-89 name=__codelineno-0-89 href=#__codelineno-0-89></a>userPassword: MySecretAdminPassword
</span><span id=__span-0-90><a id=__codelineno-0-90 name=__codelineno-0-90 href=#__codelineno-0-90></a>ds-privilege-name: unindexed-search
</span><span id=__span-0-91><a id=__codelineno-0-91 name=__codelineno-0-91 href=#__codelineno-0-91></a>ds-privilege-name: password-reset
</span></code></pre></div> </details> <h4 id=basics>Basics<a class=headerlink href=#basics title="Permanent link">&para;</a></h4> <p>We need some basic meta data for our server. The two most important elements being:</p> <ul> <li>the base <code>dn</code> (<em>Distinguished Name</em>), where all of our data lives<ul> <li>build up out of <code>dc</code> (<em>domainComponent</em>) elements, representing a domain name, usually <em>companyName.com</em></li> </ul> </li> <li>the <code>dn</code> where our user data will live and which user owns it (the <code>userdn</code> assigned in the <code>aci</code>)</li> </ul> <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>dn: dc=example,dc=com
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>objectclass: top
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>objectclass: domain
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>dc: example
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>dn: ou=People, dc=example,dc=com
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>objectclass: top
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>objectclass: organizationalunit
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>ou: People
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>aci: (targetattr=&quot;*||+&quot;)(version 3.0; acl &quot;IDM Access&quot;; allow (all)
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>  userdn=&quot;ldap:///uid=idm,ou=Administrators,dc=example,dc=com&quot;;)
</span></code></pre></div> <h4 id=user-entries>User Entries<a class=headerlink href=#user-entries title="Permanent link">&para;</a></h4> <p>After these two main metadata <code>dn</code> elements, we have all the user entries.</p> <p>We start with the identifier of the entry, designated by the <code>dn</code>, followed by attributes and classifications. While LDAP stands for <em>Lightweight</em>, it has a lot of attributes which are not easily understood because they are commonly used by their two-letter acronym only. Below we explain a few of the attributes, but there are more complete lists available<sup id=fnref:10><a class=footnote-ref href=#fn:10>10</a></sup>.</p> <ul> <li><strong>dn</strong>: the full identifier of the data entry, in reverse tree</li> <li><strong>uid</strong>: the unique id of the user within the organizational structure</li> <li><strong>cn</strong>: <em>Common Name</em>, generally how humans would identify this resource</li> <li><strong>l</strong>: <em>Location</em></li> <li><strong>ou</strong>: <em>Organizational Unit</em>, these commonly represent departments</li> <li><strong>objectclass</strong>: defines a object hierarchy, derived from Object Oriented Programming<ul> <li><strong>top</strong>: is commonly the root object class, every other object inheriting from there</li> <li>object classes are used to create typed objects which have their own schema</li> <li>this allows you to define what values are required and which are optional</li> <li>object classes are also used in search filters, so you can distinguish different value types (users, groups)</li> </ul> </li> </ul> <div class="admonition note"> <p class=admonition-title>Organizational Tree</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>.
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>├── com
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>│   └── example
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>│       ├── Operations
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>│       └── People
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>│           └── jwick
</span></code></pre></div> </div> <div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>dn: uid=jwick, ou=People, dc=example,dc=com
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>cn: John Wick
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>sn: Wick
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>givenname: John
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>objectclass: top
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>objectclass: person
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>objectclass: organizationalPerson
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>objectclass: inetOrgPerson
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>ou: Operations
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>ou: People
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>l: New York
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>uid: jwick
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>mail: jwick@example.com
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>telephonenumber: +1 408 555 1236
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>facsimiletelephonenumber: +1 408 555 4323
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>roomnumber: 233
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>userpassword: myawesomepassword
</span></code></pre></div> <h4 id=group>Group<a class=headerlink href=#group title="Permanent link">&para;</a></h4> <p>We first create the <code>OU</code> housing our Groups, including which object classes it represents.</p> <p>Then we can attach groups to this <code>OU</code> by creating <code>dn</code>'s under it. There are two flavors of groups, we have <code>groupOfNames</code> and <code>groupOfUniqueNames</code>, I'm sure you understand what the difference is.</p> <p>We explain wich kind of group we are by the <code>objectclass: groupOfUniqueNames</code>, and include a list of members. In the case of <code>groupOfNames</code> we use <code>member: &lt;member dn&gt;</code>, in our case we user <code>uniquemember: uid=cptjack, ou=People, dc=example,dc=com</code>. To make it a list, add more than one entry, each with a unique value.</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>dn: ou=Groups, dc=example,dc=com
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>objectclass: top
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>objectclass: organizationalunit
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>ou: Groups
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>aci: (targetattr=&quot;*||+&quot;)(version 3.0; acl &quot;IDM Access&quot;; allow (all)
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>  userdn=&quot;ldap:///uid=idm,ou=Administrators,dc=example,dc=com&quot;;)
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>dn: cn=Pirates,ou=Groups,dc=example,dc=com
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>objectclass: top
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>objectclass: groupOfUniqueNames
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>cn: Pirates
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>ou: Groups
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>uniquemember: uid=cptjack, ou=People, dc=example,dc=com
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>uniquemember: uid=will, ou=People, dc=example,dc=com
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>uniquemember: uid=djones, ou=People, dc=example,dc=com
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>description: Arrrrr!
</span></code></pre></div> <h4 id=administrator>Administrator<a class=headerlink href=#administrator title="Permanent link">&para;</a></h4> <p>We have to configure our main administrator, as we've already given it a lot of privileges to manage the other resources (via the <code>aci</code> rules). As usual, we start with defining a <code>ou</code> that houses our <code>Administrators</code>.</p> <p>In this case, we give it two more special permissions via <code>ds-privilege-name</code>. So this user can also reset passwords, just in case.</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>dn: ou=Administrators, dc=example,dc=com
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>objectclass: top
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>objectclass: organizationalunit
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>ou: Administrators
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>dn: uid=idm, ou=Administrators,dc=example,dc=com
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>objectclass: top
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>objectclass: person
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>objectclass: organizationalPerson
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>objectclass: inetOrgPerson
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>uid: idm
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>cn: IDM Administrator
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>sn: IDM Administrator
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>description: Special LDAP acccount used by the IDM
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>  to access the LDAP data.
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>ou: Administrators
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>userPassword: MySecretAdminPassword
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>ds-privilege-name: unindexed-search
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>ds-privilege-name: password-reset
</span></code></pre></div> <h3 id=configure-opendj>Configure OpenDJ<a class=headerlink href=#configure-opendj title="Permanent link">&para;</a></h3> <p>One of the reasons I like OpenDJ is because it is very easy to operate. It has many tools to help you manage the server. Some are separate tools that interact with a running server, others interact with the configure while the server is offline.</p> <p>We have to do two configuration actions, 1) we intialize it with our root <code>dn</code>, which port to use and so on, 2) we add our test data set, so we have our groups and users to work with.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>/opt/opendj/setup<span class=w> </span>--cli<span class=w> </span><span class=se>\</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span>-p<span class=w> </span><span class=m>1389</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span>--ldapsPort<span class=w> </span><span class=m>1636</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span>--enableStartTLS<span class=w> </span><span class=se>\</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span>--generateSelfSignedCertificate<span class=w> </span><span class=se>\</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>    </span>--baseDN<span class=w> </span><span class=nv>dc</span><span class=o>=</span>example,dc<span class=o>=</span>com<span class=w> </span><span class=se>\</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>    </span>-h<span class=w> </span>localhost<span class=w> </span><span class=se>\</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>    </span>--rootUserDN<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ROOT_USER_DN</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>    </span>--rootUserPassword<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ROOT_PASSWORD</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span>--acceptLicense<span class=w> </span><span class=se>\</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>    </span>--no-prompt<span class=w> </span><span class=se>\</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>    </span>--doNotStart
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>/opt/opendj/bin/import-ldif<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>    </span>--includeBranch<span class=w> </span><span class=nv>dc</span><span class=o>=</span>example,dc<span class=o>=</span>com<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>    </span>--backendID<span class=w> </span>userRoot<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>    </span>--offline<span class=w> </span><span class=se>\</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>    </span>--ldifFile<span class=w> </span>example.ldiff
</span></code></pre></div> <h3 id=dockerfile>Dockerfile<a class=headerlink href=#dockerfile title="Permanent link">&para;</a></h3> <p>For completeness I will also include my Docker image.</p> <p>We use Tini<sup id=fnref:11><a class=footnote-ref href=#fn:11>11</a></sup> order to manage the process of OpenDJ nicely, even in the face of being shutdown. For more information, read <a href=/blogs/graceful-shutdown/ >my article on Docker Graceful Shutdown</a>.</p> <p>We use a <code>jre</code> as we only need to run Java, so no need for a JDK. We use the OpenJDK distribution from <code>Azul</code><sup id=fnref:15><a class=footnote-ref href=#fn:15>15</a></sup> in order to avoid possible violations of Oracle's License<sup id=fnref:12><a class=footnote-ref href=#fn:12>12</a></sup>. We use Azul's Alpine<sup id=fnref:13><a class=footnote-ref href=#fn:13>13</a></sup> based image as it is much smaller than those based of full-fledged OS's. This makes the image smaller in size on disk and in memory and reduces the attack vector and recommended by the likes of Docker and Snyk<sup id=fnref:14><a class=footnote-ref href=#fn:14>14</a></sup>.</p> <p>We download the latest version available which, as of this writing in September 2019, is <code>4.4.3</code> which you can retrieve from the OpenDJ Community's <code>releases</code> page on GitHub<sup id=fnref2:13><a class=footnote-ref href=#fn:13>13</a></sup>.</p> <div class="language-Dockerfile highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>FROM</span><span class=w> </span><span class=s>azul/zulu-openjdk-alpine:8u222-jre</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>LABEL</span><span class=w> </span><span class=nv>authors</span><span class=o>=</span><span class=s2>&quot;Joost van der Griendt &lt;joostvdg@gmail.com&gt;&quot;</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=k>LABEL</span><span class=w> </span><span class=nv>version</span><span class=o>=</span><span class=s2>&quot;0.2.0&quot;</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=k>LABEL</span><span class=w> </span><span class=nv>description</span><span class=o>=</span><span class=s2>&quot;OpenDJ container&quot;</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/opt</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>1389 1636 4444</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=k>ENV</span><span class=w> </span><span class=nv>CHANGE_DATE</span><span class=o>=</span><span class=s1>&#39;20190916-2100&#39;</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=k>ENV</span><span class=w> </span>JAVA_HOME<span class=w> </span>/usr/lib/jvm/zulu-8
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=k>ENV</span><span class=w> </span>OPENDJ_JAVA_HOME<span class=w> </span>/usr/lib/jvm/zulu-8
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=k>ENV</span><span class=w> </span><span class=nv>VERSION</span><span class=o>=</span><span class=m>4</span>.4.3
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=k>ENV</span><span class=w> </span><span class=nv>ROOT_USER_DN</span><span class=o>=</span><span class=s1>&#39;cn=admin&#39;</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=k>ENV</span><span class=w> </span><span class=nv>ROOT_PASSWORD</span><span class=o>=</span><span class=s1>&#39;changeme&#39;</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=k>RUN</span><span class=w> </span>apk<span class=w> </span>add<span class=w> </span>--no-cache<span class=w> </span>tini
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=k>ENTRYPOINT</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/sbin/tini&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;-vv&quot;</span><span class=p>,</span><span class=s2>&quot;-g&quot;</span><span class=p>,</span><span class=s2>&quot;-s&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--&quot;</span><span class=p>]</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/opt/opendj/bin/start-ds&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--nodetach&quot;</span><span class=p>]</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=k>RUN</span><span class=w> </span>wget<span class=w> </span>--quiet<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=w>    </span>https://github.com/OpenIdentityPlatform/OpenDJ/releases/download/<span class=nv>$VERSION</span>/opendj-<span class=nv>$VERSION</span>.zip<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=w>    </span>unzip<span class=w> </span>opendj-<span class=nv>$VERSION</span>.zip<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=w>    </span>rm<span class=w> </span>-r<span class=w> </span>opendj-<span class=nv>$VERSION</span>.zip
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=k>RUN</span><span class=w> </span>/opt/opendj/setup<span class=w> </span>--cli<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=w>    </span>-p<span class=w> </span><span class=m>1389</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a><span class=w>    </span>--ldapsPort<span class=w> </span><span class=m>1636</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a><span class=w>    </span>--enableStartTLS<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=w>    </span>--generateSelfSignedCertificate<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=w>    </span>--baseDN<span class=w> </span><span class=nv>dc</span><span class=o>=</span>example,dc<span class=o>=</span>com<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=w>    </span>-h<span class=w> </span>localhost<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a><span class=w>    </span>--rootUserDN<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ROOT_USER_DN</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-34><a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=w>    </span>--rootUserPassword<span class=w> </span><span class=s2>&quot;</span><span class=nv>$ROOT_PASSWORD</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-8-35><a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a><span class=w>    </span>--acceptLicense<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-36><a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a><span class=w>    </span>--no-prompt<span class=w> </span><span class=se>\</span>
</span><span id=__span-8-37><a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a><span class=w>    </span>--doNotStart
</span><span id=__span-8-38><a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a>
</span><span id=__span-8-39><a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a><span class=k>ADD</span><span class=w> </span>Example.ldif<span class=w> </span>/var/tmp/example.ldiff
</span><span id=__span-8-40><a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a><span class=c># RUN /opt/opendj/bin/import-ldif --help</span>
</span><span id=__span-8-41><a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a><span class=k>RUN</span><span class=w> </span>/opt/opendj/bin/import-ldif<span class=w> </span>--includeBranch<span class=w> </span><span class=nv>dc</span><span class=o>=</span>example,dc<span class=o>=</span>com<span class=w> </span>--backendID<span class=w> </span>userRoot<span class=w> </span>--offline<span class=w> </span>--ldifFile<span class=w> </span>/var/tmp/example.ldiff
</span></code></pre></div> <h3 id=kubernetes-deployment>Kubernetes Deployment<a class=headerlink href=#kubernetes-deployment title="Permanent link">&para;</a></h3> <p>In production you might want to run LDAP in a <code>StatefulSet</code> and give it some permanent storage. But in this guide the goal of LDAP is to show how to use it with Keycloak and we stick to a <code>Deployment</code> as it is easier.</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opendj4</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opendj4</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opendj4</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opendj4</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opendj4</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">caladreas/opendj:4.4.3-1</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1389</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ldap</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=w>        </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=w>          </span><span class=nt>requests</span><span class=p>:</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;250Mi&quot;</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;50m&quot;</span>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a><span class=w>          </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-9-28><a id=__codelineno-9-28 name=__codelineno-9-28 href=#__codelineno-9-28></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;500Mi&quot;</span>
</span><span id=__span-9-29><a id=__codelineno-9-29 name=__codelineno-9-29 href=#__codelineno-9-29></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;250m&quot;</span>
</span></code></pre></div> <h3 id=kubernetes-service>Kubernetes Service<a class=headerlink href=#kubernetes-service title="Permanent link">&para;</a></h3> <p>When we use a <code>Deployment</code> our container instance will have a generated name and a new ip address on every (re-)start. So we use a <code>Service</code> to create a stable endpoint, which means that we will now access our LDAP server via our service: <code>ldap://opendj4:389</code>.</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opendj4</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opendj4</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">389</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1389</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">opendj4</span>
</span></code></pre></div> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>If you deploy the <code>Service</code> and <code>Deployment</code> in a different namespace than where you want to access them from, you will have to add the namespace to the access url.</p> <p>If you've configured them in namespace <code>ldap</code>, the access url becomes <code>ldap://opendj4.ldap:389</code>.</p> </div> <h3 id=homegrown-helm-chart-with-github>Homegrown Helm chart with GitHub<a class=headerlink href=#homegrown-helm-chart-with-github title="Permanent link">&para;</a></h3> <p>You can also package the above explained Docker Image + Kubernetes Yaml definition as a Helm package in a GitHub repository<sup id=fnref:16><a class=footnote-ref href=#fn:16>16</a></sup>.</p> <p>So if you do not want to use any of the above, feel free to use my personal Helm Repository<sup id=fnref:17><a class=footnote-ref href=#fn:17>17</a></sup>.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>joostvdg<span class=w> </span>https://raw.githubusercontent.com/joostvdg/helm-repo/master/
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>helm<span class=w> </span>repo<span class=w> </span>update
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>helm<span class=w> </span>install<span class=w> </span>joostvdg/opendj4<span class=w> </span>--name<span class=w> </span>ldap<span class=w> </span>--namespace<span class=w> </span>ldap
</span></code></pre></div> <p>The service, retrieved by <code>kubectl get service</code> now has a different name.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>NAME<span class=w>           </span>TYPE<span class=w>        </span>CLUSTER-IP<span class=w>       </span>EXTERNAL-IP<span class=w>   </span>PORT<span class=o>(</span>S<span class=o>)</span><span class=w>   </span>AGE
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>ldap-opendj4<span class=w>   </span>ClusterIP<span class=w>   </span><span class=m>10</span>.100.19.29<span class=w>     </span>&lt;none&gt;<span class=w>        </span><span class=m>389</span>/TCP<span class=w>   </span>105s
</span></code></pre></div> <p>So now we access the LDAP server via <code>ldap://ldap-opendj4:389</code>.</p> <h2 id=keycloak>Keycloak<a class=headerlink href=#keycloak title="Permanent link">&para;</a></h2> <h3 id=pre-requisites>Pre-requisites<a class=headerlink href=#pre-requisites title="Permanent link">&para;</a></h3> <ul> <li>Helm installed</li> <li>TLS certificate</li> </ul> <p>Using a tool as Keycloak to do SSO well, feels wrong without using TLS certificates. So I wholeheartedly recommend configuring Keycloak with a Domain name and TLS Certificate.</p> <p>For the TLS certificate, you use Let's Encrypt<sup id=fnref:20><a class=footnote-ref href=#fn:20>20</a></sup> with Cert Manager<sup id=fnref:19><a class=footnote-ref href=#fn:19>19</a></sup>, if you unsure how to proceed in Kubernetes <a href=/blogs/k8s-lets-encrypt/ >read my guide on Let's Encrypt on Kubernetes</a>.</p> <h3 id=install-via-helm>Install Via Helm<a class=headerlink href=#install-via-helm title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>codecentric<span class=w> </span>https://codecentric.github.io/helm-charts
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>helm<span class=w> </span>repo<span class=w> </span>update
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>keycloak-certificate.yaml
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>helm<span class=w> </span>install<span class=w> </span>--name<span class=w> </span>keycloak<span class=w> </span>codecentric/keycloak<span class=w> </span>-f<span class=w> </span>keycloak-values.yaml
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Make sure you replace the dns name <code>keycloak.my.domain.com</code> with your own domain. If you do not have a domain, you can use `nip.io<sup id=fnref:18><a class=footnote-ref href=#fn:18>18</a></sup>.</p> </div> <div class="admonition example"> <p class=admonition-title>keycloak-certificate.yaml</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">certmanager.k8s.io/v1alpha1</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Certificate</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=nt>metadata</span><span class=p>:</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=nt>spec</span><span class=p>:</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tls-keycloak</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=nt>dnsNames</span><span class=p>:</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=nt>acme</span><span class=p>:</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>    </span><span class=nt>config</span><span class=p>:</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>http01</span><span class=p>:</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>        </span><span class=nt>ingressClass</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>    </span><span class=nt>domains</span><span class=p>:</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=nt>issuerRef</span><span class=p>:</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
</span></code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>keycloak-values.yaml</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=nt>keycloak</span><span class=p>:</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=w>  </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">notsosecret</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=w>  </span><span class=nt>ingress</span><span class=p>:</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span><span class=w> </span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=w>    </span><span class=nt>kubernetes.io/tls-acme</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=w>    </span><span class=nt>ingress.kubernetes.io/affinity</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cookie</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=w>    </span><span class=nt>hosts</span><span class=p>:</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=w>    </span><span class=nt>tls</span><span class=p>:</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak.my.domain.com</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=w>    </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tls-keycloak</span>
</span></code></pre></div> </div> <h3 id=ldap-as-user-federation>LDAP As User Federation<a class=headerlink href=#ldap-as-user-federation title="Permanent link">&para;</a></h3> <p>Assuming you have Keycloak running now, login with the admin user, <code>keycloak</code>, and the password you set in the <code>keycloak-values.yaml</code>.</p> <p>In the left hand menu, you can select <code>User Federation</code>, this is where we can add <code>ldap</code> and <code>kerberos</code> providers. As Keycloak supports multiple sources, these will be listed by their priority (the smaller the number, the higher). The federations are consulted in the order according to their priority.</p> <h4 id=create-ldap>Create LDAP<a class=headerlink href=#create-ldap title="Permanent link">&para;</a></h4> <p>Let's create the new LDAP provider, select the <code>Add provider</code> dropdown - top right - and choose <code>ldap</code>.</p> <p>You will now see a whole list of values to fill in, don't worry, many can be kept as default. And to be sure, I will list them all here. For more information, each field has a little question mark, hover over it.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>When you've filled in the <code>Connection URL</code>, you should test the configuration with the <code>Test connection</code> button. The same is true for when you've configured the fields <code>Users DN</code>, <code>Bind Type</code>, <code>Bind DN</code>, <code>Bind Credential</code> with the button <code>Test authentication</code>.</p> </div> <ul> <li><strong>Console Display Name</strong>: display name, should be a name that tells you what this provider is</li> <li><strong>Priority</strong>: the priority of this provider, will be used for the order that the federation is accessed</li> <li><strong>Import Users</strong>: wether or not to import the users, I just leave this to <code>On</code> as to cache the users</li> <li><strong>Import Users</strong>: <code>READ_ONLY</code>, in this guide we assume the LDAP server is not under your control, so read only</li> <li><strong>Vendor</strong>: <code>Other</code></li> <li><strong>Username LDAP attribute</strong>: <code>uid</code></li> <li><strong>RDN LDAP attribute</strong>: <code>uid</code></li> <li><strong>UUID LDAP attribute</strong>: <code>entryUUID</code></li> <li><strong>User Object Classes</strong>: <code>inetOrgPerson, organizationalPerson</code></li> <li><strong>Connection URL</strong>: <code>ldap://opendj4:389</code></li> <li><strong>Users DN</strong>: <code>dc=example,dc=com</code></li> <li><strong>Bind Type</strong>: <code>simple</code></li> <li><strong>Bind DN</strong>: <code>uid=idm, ou=Administrators,dc=example,dc=com</code></li> <li><strong>Bind Credential</strong>: <code>secret</code> -&gt; or what ever you've set it in the <code>example.diff</code></li> <li><strong>Custom User LDAP Filter</strong>: ``</li> <li><strong>Search Scope</strong>: <code>Subtree</code></li> <li><strong>Validate Password Policy</strong>: <code>OFF</code></li> <li><strong>Use Truststore SPI</strong>: <code>Only for ldap</code></li> <li><strong>Connection Pooling</strong>: <code>ON</code></li> <li><strong>Connection Timeout</strong>: ``</li> <li><strong>Read Timeout</strong>: ``</li> <li><strong>Pagination</strong>: <code>ON</code></li> </ul> <p>Sync Settings:</p> <ul> <li><strong>Cache Policy</strong>: 1000</li> <li><strong>Periodic Full Sync</strong>: <code>On</code></li> <li><strong>Full Sync Period</strong>: <code>604800</code></li> <li><strong>Periodic Changed Users Sync</strong>: <code>On</code></li> <li><strong>Changed Users Sync Period</strong>: <code>86400</code></li> </ul> <p>Cache Settings:</p> <ul> <li><strong>Cache Policy</strong>: <code>DEFAULT</code></li> </ul> <p><img alt="Keycloak - Add LDAP" src=../../images/keycloak-ldap-01.png></p> <h4 id=add-group-mapping>Add Group Mapping<a class=headerlink href=#add-group-mapping title="Permanent link">&para;</a></h4> <p>If the value is not mentioned, the default value should be fine.</p> <p>Some values listed here are default, but listed all the same.</p> <ul> <li><strong>Name</strong>: <code>groups</code></li> <li><strong>Mapper Type</strong>: <code>group-ldap-mapper</code></li> <li><strong>LDAP Groups DN</strong>: <code>ou=Groups, dc=example,dc=com</code></li> <li><strong>Group Name LDAP Attribute</strong>: <code>cn</code></li> <li><strong>Group Object Classes</strong>: <code>groupOfUniqueNames</code></li> <li><strong>Membership LDAP Attribute</strong>: <code>uniquemember</code></li> <li><strong>User Groups Retrieve Strategy</strong>: <code>LOAD_GROUPS_BY_MEMBER_ATTRIBUTE</code></li> </ul> <p>When you hit <code>Save</code>, you can synchronize the groups to Keycloak - if you don't need to, it will confirm the configuration works. Hit the <code>Sync LDAP Groups To Keycloak</code> button, and on top there should be a temporary banner stating how many groups were synchronized (if all categories are <code>0</code>, something is wrong).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Everytime you change a value, you first have to save the page before you can synchronize again.</p> </div> <p><img alt="Keycloak - Add LDAP" src=../../images/keycloak-ldap-02.png></p> <h3 id=mix-ldap-users-with-other-sources>Mix LDAP Users With Other Sources<a class=headerlink href=#mix-ldap-users-with-other-sources title="Permanent link">&para;</a></h3> <p>One of the reasons for this guide to exist, is to be able to encapsulate an LDAP over which you have no control and add additional accounts and groups. There's multiple ways forward here, you can use <code>Identity Providers</code> and <code>User Federation</code> to create more sources of user accounts.</p> <p>Perhaps the simplest way is to manage these extra accounts in Keycloak itself. It has its own User database and Groups database. In addition to that, it allows you to assign users created in Keycloak to be a member of a group derived from LDAP - if you've synched them.</p> <h4 id=ui>UI<a class=headerlink href=#ui title="Permanent link">&para;</a></h4> <p>We can use the UI in Keycloak to manage Users and Groups.</p> <p>We initiate this by going to the <code>Users</code> view and hit <code>Add user</code>.</p> <p><img alt="Keycloak - Create User" src=../../images/keycloak-create-user-01.png></p> <p>We can then fill in all the details of the User.</p> <p><img alt="Keycloak - Create User" src=../../images/keycloak-create-user-02.png></p> <h4 id=rest-api>REST API<a class=headerlink href=#rest-api title="Permanent link">&para;</a></h4> <p>Keycloak has a rich REST API with good decent documentation<sup id=fnref:21><a class=footnote-ref href=#fn:21>21</a></sup>. The thing missing is some examples for how to use them correctly.</p> <p>I recommend using HTTPie<sup id=fnref:28><a class=footnote-ref href=#fn:28>28</a></sup> rather than cUrl, as it is easier to use for these more complex calls.</p> <h5 id=get-token>Get Token<a class=headerlink href=#get-token title="Permanent link">&para;</a></h5> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The Bearer Token is only valid for a short period of time. If you wait too long, you will get <code>401 unauthorized</code>.</p> </div> <p>The default REALM is <code>master</code>, and <code>URL</code> is the base URL of Keycloak.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>httpie</label><label for=__tabbed_1_2>curl</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-bash highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1>#include &lt;stdio.h&gt;</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>http<span class=w> </span>--form<span class=w> </span>POST<span class=w> </span><span class=se>\</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>URL</span><span class=si>}</span><span class=s2>/auth/realms/</span><span class=si>${</span><span class=nv>REALM</span><span class=si>}</span><span class=s2>/protocol/openid-connect/token&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>  </span><span class=nv>username</span><span class=o>=</span><span class=s2>&quot;keycloak&quot;</span><span class=w>  </span><span class=se>\</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>  </span><span class=nv>password</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>PASS</span><span class=si>}</span><span class=s2>&quot;</span><span class=w>   </span><span class=se>\</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>  </span><span class=nv>client_id</span><span class=o>=</span><span class=s2>&quot;admin-cli&quot;</span><span class=se>\</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>  </span><span class=nv>grant_type</span><span class=o>=</span><span class=s2>&quot;password&quot;</span>
</span></code></pre></div> </div> <div class=tabbed-block> <div class="language-bash highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>curl<span class=w> </span><span class=si>${</span><span class=nv>URL</span><span class=si>}</span>/auth/realms/<span class=si>${</span><span class=nv>REALM</span><span class=si>}</span>/protocol/openid-connect/token<span class=w> </span>-u<span class=w> </span>keycloak:<span class=si>${</span><span class=nv>PASS</span><span class=si>}</span>
</span></code></pre></div> </div> </div> </div> <h5 id=get-users>Get Users<a class=headerlink href=#get-users title="Permanent link">&para;</a></h5> <div class="tabbed-set tabbed-alternate" data-tabs=2:3><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><input id=__tabbed_2_3 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>httpie</label><label for=__tabbed_2_2>httpie - get user</label><label for=__tabbed_2_3>curl</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-bash highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>http<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span><span class=s2>/auth/admin/realms/</span><span class=si>${</span><span class=nv>REALM</span><span class=si>}</span><span class=s2>/users&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w>  </span><span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span>
</span></code></pre></div> </div> <div class=tabbed-block> <div class="language-bash highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>http<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span><span class=s2>/auth/admin/realms/</span><span class=si>${</span><span class=nv>REALM</span><span class=si>}</span><span class=s2>/users/</span><span class=si>${</span><span class=nv>userId</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>  </span><span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span>
</span></code></pre></div> </div> <div class=tabbed-block> <div class="language-bash highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>curl<span class=w> </span>-v<span class=w> </span><span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span>/auth/admin/realms/<span class=si>${</span><span class=nv>REALM</span><span class=si>}</span>/users<span class=w> </span><span class=se>\</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq
</span></code></pre></div> </div> </div> </div> <h5 id=create-user>Create User<a class=headerlink href=#create-user title="Permanent link">&para;</a></h5> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>httpie</label><label for=__tabbed_3_2>curl</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-bash highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>http<span class=w> </span>POST<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span><span class=s2>/auth/admin/realms/</span><span class=si>${</span><span class=nv>REALM</span><span class=si>}</span><span class=s2>/users&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=w>    </span><span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>    </span>credentials:<span class=o>=</span><span class=s2>&quot;[{\&quot;value\&quot; : \&quot;mypass\&quot;, \&quot;type\&quot;: \&quot;password\&quot; }]&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class=nv>email</span><span class=o>=</span><span class=s2>&quot;user@example.com&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>    </span><span class=nv>firstName</span><span class=o>=</span><span class=s2>&quot;hannibal&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>    </span><span class=nv>lastName</span><span class=o>=</span><span class=s2>&quot;lecter&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>    </span><span class=nv>username</span><span class=o>=</span><span class=s2>&quot;hlecter&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>    </span>groups:<span class=o>=</span><span class=s1>&#39;[&quot;Robots&quot;]&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>    </span>emailVerified:<span class=o>=</span><span class=nb>true</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>    </span>enabled:<span class=o>=</span><span class=nb>true</span>
</span></code></pre></div> </div> <div class=tabbed-block> <div class="language-bash highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>curl<span class=w> </span>-v<span class=w> </span><span class=si>${</span><span class=nv>KEYCLOAK_URL</span><span class=si>}</span>/auth/admin/realms/<span class=si>${</span><span class=nv>REALM</span><span class=si>}</span>/users<span class=w> </span><span class=se>\</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=w>  </span>-H<span class=w> </span><span class=s2>&quot;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq
</span></code></pre></div> </div> </div> </div> <h3 id=verify>Verify<a class=headerlink href=#verify title="Permanent link">&para;</a></h3> <p>To verify everything is working as it should, you can go to the <code>Groups</code> and <code>Users</code> pages within the <code>Manage</code> menu (left hand side).</p> <p>With Groups you have <code>View all groups</code>, which should have the groups from LDAP and any group you have created within Keycloak - if not yet, you can do so here as well.</p> <p>To view details of a Group, double click the name - it's not obvious you can do so - and you will go to the details page. Here you can also see the members of the Group.</p> <p>You can do the same with the Users menu item. By default the page is empty, if your list of users is not too large, click on <code>View all users</code>. You can view the details page of a user by clicking the link of the User ID. Within the Groups tab you can add the user to more groups, this should contain all the groups known to Keycloak - both Keycloak internal and from LDAP.</p> <h2 id=sso-with-jenkins>SSO with Jenkins<a class=headerlink href=#sso-with-jenkins title="Permanent link">&para;</a></h2> <p>To configure Jenkins to use Keycloak we have two plugins at our disposal, OpenId Connect(<code>oic-auth</code>)<sup id=fnref:22><a class=footnote-ref href=#fn:22>22</a></sup> and Keycloak<sup id=fnref:23><a class=footnote-ref href=#fn:23>23</a></sup>. While the Keycloak plugin is easier to configure for authentication, I found it difficult to configure groups. As I feel the group management is mandatory we're going with the OpenId Connect plugin.</p> <p>You can install plugins in Jenkins via the UI<sup id=fnref:24><a class=footnote-ref href=#fn:24>24</a></sup>, via the new Jenkins CLI<sup id=fnref:25><a class=footnote-ref href=#fn:25>25</a></sup>, or via the <code>values.yaml</code> when installing via the Helm Chart<sup id=fnref:27><a class=footnote-ref href=#fn:27>27</a></sup>.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Install the OpenId Connect plugin before configuring the next parts, and restart your Jenkins instance for best results.</p> </div> <p>In order to configure OpenId Connect with Jenkins, it is the easiest to use the <code>well-known</code> endpoint url. This endpoint contains all the configuration information the plugin needs to configure itself.</p> <p>Usually, this is <code>${KEYCLOAK_URL}/auth/realms/${REALM}/.well-known/openid-configuration</code>.</p> <p>From Keycloak's perspective we have to register Jenkins as a Client.</p> <h3 id=keycloak-client>Keycloak Client<a class=headerlink href=#keycloak-client title="Permanent link">&para;</a></h3> <p>We go to the <code>Clients</code> screen in Keycloak and hit the <code>Create</code> button.</p> <p>In the next screen, we need to supply three values:</p> <ul> <li><strong>Client ID</strong>: the name of your client, <code>jenkins</code> would be good example</li> <li><strong>Client Protocol</strong>: <code>openid-connect</code> is recommended</li> <li><strong>Root URL</strong>: the main url of your installation, for example <code>https://jenkins.my.domain.com</code></li> </ul> <h4 id=main-settings>Main Settings<a class=headerlink href=#main-settings title="Permanent link">&para;</a></h4> <p>Once we hit save, we get a details view.</p> <p>We have to change some values here.</p> <ul> <li><strong>Access Type</strong>: we need a Client ID and Client Secret, we only get this when we select <code>confidential</code></li> <li><strong>Valid Redirect URIs</strong>: confirm this is <code>${yourJenkinsURL}/*</code></li> </ul> <p><img alt="Keycloak - Configure Jenkins via UI" src=../../images/keycloak-client-01.png></p> <p>Once you hit save, you get a new Tab in the Details screen of this Client. It is called <code>Credentials</code>, and here you can see the Client <code>Secret</code> which we will need to enter in Jenkins.</p> <p><img alt="Keycloak - Configure Jenkins via UI" src=../../images/keycloak-client-03.png></p> <h4 id=group-mappings>Group Mappings<a class=headerlink href=#group-mappings title="Permanent link">&para;</a></h4> <p>Just as we had to add the Group mapping to the LDAP configuration, we will need to configure the Group mapping in the Client.</p> <p>If we go into the Client details, we see there's a Tab called <code>Mappers</code>. We create a new Mapping here by hitting the <code>Create</code> button.</p> <p>Give the mapping a name and then select the <strong><em>Mapper Type</em></strong> <code>Group Membership</code>.</p> <p>The <strong><em>Token Claim Name</em></strong> is important as well, we use this in our Jenkins configuration, give it a descriptive name such as <code>group-membership</code>.</p> <p><img alt="Keycloak - Configure Jenkins via UI" src=../../images/keycloak-client-02.png></p> <h3 id=configure-via-ui>Configure Via UI<a class=headerlink href=#configure-via-ui title="Permanent link">&para;</a></h3> <p>In Jenkins we go to <code>Manage Jenkins</code> -&gt; <code>Configure Global Security</code> and here we select <code>Login with Openid Connect</code> in the <code>Security Realm</code> block.</p> <ul> <li><strong>Client id</strong>: the client we've configured in Keycloak, if you've followed this guide, it should be <code>jenkins</code></li> <li><strong>Client secret</strong>: the secret of the client configured in Keycloak, if you've lost it, go back to <code>Keycloak</code> -&gt; <code>Clients</code> -&gt; <code>jenkins</code> -&gt; <code>Credentials</code> and copy the value in the field <code>Secret</code>.</li> </ul> <p>We now get a <code>Configuration mode</code> block where we can select either <code>Automatic configuration</code> on <code>Manual configuration</code>. We select <code>Automatic</code> and enter our <code>Well-known</code> configuration endpoint URL from Keycloak we've written down earlier. If you don't remember, the format is usually this: <code>${KEYCLOAK_URL}/auth/realms/${REALM}/.well-known/openid-configuration</code>.</p> <ul> <li><strong>User name field name</strong>: <code>preferred_username</code></li> <li><strong>Full name field name</strong>: <code>name</code></li> <li><strong>Email field name</strong>: <code>email</code></li> <li><strong>Groups field name</strong>: <code>group-membership</code></li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The field <strong>Groups field name</strong> refers back to the <strong><em>Token Claim Name</em></strong> we configured in Keycloak within our Client's Mapping for Group Membership.</p> </div> <p><img alt="Keycloak - Configure Jenkins via UI" src=../../images/keycloak-jenkins-01.png></p> <h3 id=configure-via-configuration-as-code>Configure Via Configuration-as-Code<a class=headerlink href=#configure-via-configuration-as-code title="Permanent link">&para;</a></h3> <p>We can use the amazing Jenkins Configuration-as-Code<sup id=fnref:26><a class=footnote-ref href=#fn:26>26</a></sup> to make sure our SSO configuration is configured out-of-the-box!</p> <p>In order to avoid the having to store the Client ID and Client Secret, we're going to create these as Kubernetes Secrets first.</p> <p>There's more ways to create these, but this is to keep it simple.</p> <div class="language-bash highlight"><span class=filename>create generic kubernetes secret</span><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>oic-auth<span class=w> </span><span class=se>\</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=w>  </span>--from-literal<span class=o>=</span><span class=nv>clientID</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CLIENT_ID</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>  </span>--from-literal<span class=o>=</span><span class=nv>clientSecret</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>CLIENT_SECRET</span><span class=si>}</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>  </span>--from-literal<span class=o>=</span><span class=nv>keycloakUrl</span><span class=o>=</span><span class=si>${</span><span class=nv>keycloakUrl</span><span class=si>}</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>  </span>--namespace<span class=w> </span>jenkins
</span></code></pre></div> <div class="admonition example"> <p class=admonition-title>JCASC-config.yaml</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=w>  </span><span class=nt>jenkins</span><span class=p>:</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=w>    </span><span class=nt>securityRealm</span><span class=p>:</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=w>    </span><span class=nt>oic</span><span class=p>:</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>      </span><span class=nt>clientId</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${clientID}&quot;</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=w>      </span><span class=nt>clientSecret</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${clientSecret}&quot;</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=w>      </span><span class=nt>wellKnownOpenIDConfigurationUrl</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${keycloakUrl}/auth/realms/master/.well-known/openid-configuration&quot;</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=w>      </span><span class=nt>tokenServerUrl</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${keycloakUrl}auth/realms/master/protocol/openid-connect/token&quot;</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>      </span><span class=nt>authorizationServerUrl</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/auth&quot;</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=w>      </span><span class=nt>userInfoServerUrl</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/userinfo&quot;</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=w>      </span><span class=nt>userNameField</span><span class=p>:</span><span class=w> </span><span class=s>&quot;preferred_username&quot;</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=w>      </span><span class=nt>fullNameFieldName</span><span class=p>:</span><span class=w> </span><span class=s>&quot;name&quot;</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=w>      </span><span class=nt>emailFieldName</span><span class=p>:</span><span class=w> </span><span class=s>&quot;email&quot;</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=w>      </span><span class=nt>groupsFieldName</span><span class=p>:</span><span class=w> </span><span class=s>&quot;group-membership&quot;</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=w>      </span><span class=nt>scopes</span><span class=p>:</span><span class=w> </span><span class=s>&quot;web-origins</span><span class=nv> </span><span class=s>address</span><span class=nv> </span><span class=s>phone</span><span class=nv> </span><span class=s>openid</span><span class=nv> </span><span class=s>offline_access</span><span class=nv> </span><span class=s>profile</span><span class=nv> </span><span class=s>roles</span><span class=nv> </span><span class=s>microprofile-jwt</span><span class=nv> </span><span class=s>email&quot;</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=w>      </span><span class=nt>disableSslVerification</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=w>      </span><span class=nt>logoutFromOpenidProvider</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=w>      </span><span class=nt>endSessionUrl</span><span class=p>:</span><span class=w> </span><span class=s>&quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/logout&quot;</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=w>      </span><span class=nt>postLogoutRedirectUrl</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=w>      </span><span class=nt>escapeHatchEnabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=w>      </span><span class=nt>escapeHatchSecret</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span>
</span></code></pre></div> </div> <details class=example> <summary>complete-jenkins-helm-values.yaml</summary> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=nt>master</span><span class=p>:</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=w>  </span><span class=nt>ingress</span><span class=p>:</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>    </span><span class=nt>hostName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jenkins.my.doamain.com</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>  </span><span class=nt>csrf</span><span class=p>:</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=w>    </span><span class=nt>defaultCrumbIssuer</span><span class=p>:</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=w>      </span><span class=nt>proxyCompatability</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=w>  </span><span class=nt>cli</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=w>  </span><span class=nt>installPlugins</span><span class=p>:</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes:latest</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-credentials:latest</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">workflow-aggregator:latest</span>
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">workflow-job:latest</span>
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">credentials-binding:latest</span>
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">git:latest</span>
</span><span id=__span-28-17><a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">blueocean:latest</span>
</span><span id=__span-28-18><a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prometheus:latest</span>
</span><span id=__span-28-19><a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">matrix-auth:latest</span>
</span><span id=__span-28-20><a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloak:latest</span>
</span><span id=__span-28-21><a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth:latest</span>
</span><span id=__span-28-22><a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a><span class=w>  </span><span class=nt>JCasC</span><span class=p>:</span>
</span><span id=__span-28-23><a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-28-24><a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a><span class=w>    </span><span class=nt>pluginVersion</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1.30&quot;</span>
</span><span id=__span-28-25><a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a><span class=w>    </span><span class=nt>configScripts</span><span class=p>:</span>
</span><span id=__span-28-26><a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a><span class=w>      </span><span class=nt>welcome-message</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-28-27><a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a><span class=w>        </span><span class=no>jenkins:</span>
</span><span id=__span-28-28><a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a><span class=w>          </span><span class=no>systemMessage: Welcome, this Jenkins is configured and managed as code.</span>
</span><span id=__span-28-29><a id=__codelineno-28-29 name=__codelineno-28-29 href=#__codelineno-28-29></a><span class=w>      </span><span class=nt>ldap-settings</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-28-30><a id=__codelineno-28-30 name=__codelineno-28-30 href=#__codelineno-28-30></a><span class=w>        </span><span class=no>jenkins:</span>
</span><span id=__span-28-31><a id=__codelineno-28-31 name=__codelineno-28-31 href=#__codelineno-28-31></a><span class=w>          </span><span class=no>securityRealm:</span>
</span><span id=__span-28-32><a id=__codelineno-28-32 name=__codelineno-28-32 href=#__codelineno-28-32></a><span class=w>            </span><span class=no>oic:</span>
</span><span id=__span-28-33><a id=__codelineno-28-33 name=__codelineno-28-33 href=#__codelineno-28-33></a><span class=w>              </span><span class=no>clientId: &quot;${clientID}&quot;</span>
</span><span id=__span-28-34><a id=__codelineno-28-34 name=__codelineno-28-34 href=#__codelineno-28-34></a><span class=w>              </span><span class=no>clientSecret: &quot;${clientSecret}&quot;</span>
</span><span id=__span-28-35><a id=__codelineno-28-35 name=__codelineno-28-35 href=#__codelineno-28-35></a><span class=w>              </span><span class=no>wellKnownOpenIDConfigurationUrl: &quot;${keycloakUrl}/auth/realms/master/.well-known/openid-configuration&quot;</span>
</span><span id=__span-28-36><a id=__codelineno-28-36 name=__codelineno-28-36 href=#__codelineno-28-36></a><span class=w>              </span><span class=no>tokenServerUrl: &quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/token&quot;</span>
</span><span id=__span-28-37><a id=__codelineno-28-37 name=__codelineno-28-37 href=#__codelineno-28-37></a><span class=w>              </span><span class=no>authorizationServerUrl: &quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/auth&quot;</span>
</span><span id=__span-28-38><a id=__codelineno-28-38 name=__codelineno-28-38 href=#__codelineno-28-38></a><span class=w>              </span><span class=no>userInfoServerUrl: &quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/userinfo&quot;</span>
</span><span id=__span-28-39><a id=__codelineno-28-39 name=__codelineno-28-39 href=#__codelineno-28-39></a><span class=w>              </span><span class=no>userNameField: &quot;preferred_username&quot;</span>
</span><span id=__span-28-40><a id=__codelineno-28-40 name=__codelineno-28-40 href=#__codelineno-28-40></a><span class=w>              </span><span class=no>fullNameFieldName: &quot;name&quot;</span>
</span><span id=__span-28-41><a id=__codelineno-28-41 name=__codelineno-28-41 href=#__codelineno-28-41></a><span class=w>              </span><span class=no>emailFieldName: &quot;email&quot;</span>
</span><span id=__span-28-42><a id=__codelineno-28-42 name=__codelineno-28-42 href=#__codelineno-28-42></a><span class=w>              </span><span class=no>groupsFieldName: &quot;group-membership&quot;</span>
</span><span id=__span-28-43><a id=__codelineno-28-43 name=__codelineno-28-43 href=#__codelineno-28-43></a><span class=w>              </span><span class=no>scopes: &quot;web-origins address phone openid offline_access profile roles microprofile-jwt email&quot;</span>
</span><span id=__span-28-44><a id=__codelineno-28-44 name=__codelineno-28-44 href=#__codelineno-28-44></a><span class=w>              </span><span class=no>disableSslVerification: false</span>
</span><span id=__span-28-45><a id=__codelineno-28-45 name=__codelineno-28-45 href=#__codelineno-28-45></a><span class=w>              </span><span class=no>logoutFromOpenidProvider: true</span>
</span><span id=__span-28-46><a id=__codelineno-28-46 name=__codelineno-28-46 href=#__codelineno-28-46></a><span class=w>              </span><span class=no>endSessionUrl: &quot;${keycloakUrl}/auth/realms/master/protocol/openid-connect/logout&quot;</span>
</span><span id=__span-28-47><a id=__codelineno-28-47 name=__codelineno-28-47 href=#__codelineno-28-47></a><span class=w>              </span><span class=no>postLogoutRedirectUrl: &quot;&quot;</span>
</span><span id=__span-28-48><a id=__codelineno-28-48 name=__codelineno-28-48 href=#__codelineno-28-48></a><span class=w>              </span><span class=no>escapeHatchEnabled: false</span>
</span><span id=__span-28-49><a id=__codelineno-28-49 name=__codelineno-28-49 href=#__codelineno-28-49></a><span class=w>              </span><span class=no>escapeHatchSecret: &quot;&quot;</span>
</span><span id=__span-28-50><a id=__codelineno-28-50 name=__codelineno-28-50 href=#__codelineno-28-50></a><span class=w>      </span><span class=nt>matrix-auth</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-28-51><a id=__codelineno-28-51 name=__codelineno-28-51 href=#__codelineno-28-51></a><span class=w>        </span><span class=no>jenkins:</span>
</span><span id=__span-28-52><a id=__codelineno-28-52 name=__codelineno-28-52 href=#__codelineno-28-52></a><span class=w>          </span><span class=no>authorizationStrategy:</span>
</span><span id=__span-28-53><a id=__codelineno-28-53 name=__codelineno-28-53 href=#__codelineno-28-53></a><span class=w>            </span><span class=no>globalMatrix:</span>
</span><span id=__span-28-54><a id=__codelineno-28-54 name=__codelineno-28-54 href=#__codelineno-28-54></a><span class=w>              </span><span class=no>permissions:</span>
</span><span id=__span-28-55><a id=__codelineno-28-55 name=__codelineno-28-55 href=#__codelineno-28-55></a><span class=w>                </span><span class=no>- &quot;Overall/Read:authenticated&quot;</span>
</span><span id=__span-28-56><a id=__codelineno-28-56 name=__codelineno-28-56 href=#__codelineno-28-56></a><span class=w>                </span><span class=no>- &quot;Overall/Administer:barbossa&quot;</span>
</span><span id=__span-28-57><a id=__codelineno-28-57 name=__codelineno-28-57 href=#__codelineno-28-57></a><span class=w>                </span><span class=no>- &quot;Overall/Administer:Catmins&quot;</span>
</span><span id=__span-28-58><a id=__codelineno-28-58 name=__codelineno-28-58 href=#__codelineno-28-58></a><span class=w>                </span><span class=no>- &quot;Overall/Administer:Robots&quot;</span>
</span><span id=__span-28-59><a id=__codelineno-28-59 name=__codelineno-28-59 href=#__codelineno-28-59></a><span class=w>                </span><span class=no>- &quot;Overall/Administer:/Catmins&quot;</span>
</span><span id=__span-28-60><a id=__codelineno-28-60 name=__codelineno-28-60 href=#__codelineno-28-60></a><span class=w>                </span><span class=no>- &quot;Overall/Administer:/Robots&quot;</span>
</span><span id=__span-28-61><a id=__codelineno-28-61 name=__codelineno-28-61 href=#__codelineno-28-61></a><span class=nt>persistence</span><span class=p>:</span>
</span><span id=__span-28-62><a id=__codelineno-28-62 name=__codelineno-28-62 href=#__codelineno-28-62></a><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-28-63><a id=__codelineno-28-63 name=__codelineno-28-63 href=#__codelineno-28-63></a><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-28-64><a id=__codelineno-28-64 name=__codelineno-28-64 href=#__codelineno-28-64></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth-clientid</span>
</span><span id=__span-28-65><a id=__codelineno-28-65 name=__codelineno-28-65 href=#__codelineno-28-65></a><span class=w>    </span><span class=nt>secret</span><span class=p>:</span>
</span><span id=__span-28-66><a id=__codelineno-28-66 name=__codelineno-28-66 href=#__codelineno-28-66></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth</span>
</span><span id=__span-28-67><a id=__codelineno-28-67 name=__codelineno-28-67 href=#__codelineno-28-67></a><span class=w>      </span><span class=nt>items</span><span class=p>:</span>
</span><span id=__span-28-68><a id=__codelineno-28-68 name=__codelineno-28-68 href=#__codelineno-28-68></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clientID</span>
</span><span id=__span-28-69><a id=__codelineno-28-69 name=__codelineno-28-69 href=#__codelineno-28-69></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clientID</span>
</span><span id=__span-28-70><a id=__codelineno-28-70 name=__codelineno-28-70 href=#__codelineno-28-70></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth-clientsecret</span>
</span><span id=__span-28-71><a id=__codelineno-28-71 name=__codelineno-28-71 href=#__codelineno-28-71></a><span class=w>    </span><span class=nt>secret</span><span class=p>:</span>
</span><span id=__span-28-72><a id=__codelineno-28-72 name=__codelineno-28-72 href=#__codelineno-28-72></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth</span>
</span><span id=__span-28-73><a id=__codelineno-28-73 name=__codelineno-28-73 href=#__codelineno-28-73></a><span class=w>      </span><span class=nt>items</span><span class=p>:</span>
</span><span id=__span-28-74><a id=__codelineno-28-74 name=__codelineno-28-74 href=#__codelineno-28-74></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clientSecret</span>
</span><span id=__span-28-75><a id=__codelineno-28-75 name=__codelineno-28-75 href=#__codelineno-28-75></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clientSecret</span>
</span><span id=__span-28-76><a id=__codelineno-28-76 name=__codelineno-28-76 href=#__codelineno-28-76></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth-keycloakurl</span>
</span><span id=__span-28-77><a id=__codelineno-28-77 name=__codelineno-28-77 href=#__codelineno-28-77></a><span class=w>    </span><span class=nt>secret</span><span class=p>:</span>
</span><span id=__span-28-78><a id=__codelineno-28-78 name=__codelineno-28-78 href=#__codelineno-28-78></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth</span>
</span><span id=__span-28-79><a id=__codelineno-28-79 name=__codelineno-28-79 href=#__codelineno-28-79></a><span class=w>      </span><span class=nt>items</span><span class=p>:</span>
</span><span id=__span-28-80><a id=__codelineno-28-80 name=__codelineno-28-80 href=#__codelineno-28-80></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloakUrl</span>
</span><span id=__span-28-81><a id=__codelineno-28-81 name=__codelineno-28-81 href=#__codelineno-28-81></a><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloakUrl</span>
</span><span id=__span-28-82><a id=__codelineno-28-82 name=__codelineno-28-82 href=#__codelineno-28-82></a><span class=w>  </span><span class=nt>mounts</span><span class=p>:</span>
</span><span id=__span-28-83><a id=__codelineno-28-83 name=__codelineno-28-83 href=#__codelineno-28-83></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth-clientid</span>
</span><span id=__span-28-84><a id=__codelineno-28-84 name=__codelineno-28-84 href=#__codelineno-28-84></a><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/run/secrets/clientID</span>
</span><span id=__span-28-85><a id=__codelineno-28-85 name=__codelineno-28-85 href=#__codelineno-28-85></a><span class=w>      </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clientID</span>
</span><span id=__span-28-86><a id=__codelineno-28-86 name=__codelineno-28-86 href=#__codelineno-28-86></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth-clientsecret</span>
</span><span id=__span-28-87><a id=__codelineno-28-87 name=__codelineno-28-87 href=#__codelineno-28-87></a><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/run/secrets/clientSecret</span>
</span><span id=__span-28-88><a id=__codelineno-28-88 name=__codelineno-28-88 href=#__codelineno-28-88></a><span class=w>      </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">clientSecret</span>
</span><span id=__span-28-89><a id=__codelineno-28-89 name=__codelineno-28-89 href=#__codelineno-28-89></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">oic-auth-keycloakurl</span>
</span><span id=__span-28-90><a id=__codelineno-28-90 name=__codelineno-28-90 href=#__codelineno-28-90></a><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/run/secrets/keycloakUrl</span>
</span><span id=__span-28-91><a id=__codelineno-28-91 name=__codelineno-28-91 href=#__codelineno-28-91></a><span class=w>      </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">keycloakUrl</span>
</span></code></pre></div> </details> <h3 id=use-keycloak-groups-in-jenkins>Use Keycloak Groups In Jenkins<a class=headerlink href=#use-keycloak-groups-in-jenkins title="Permanent link">&para;</a></h3> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Unfortuantely, there is one caveat about using Keycloak as intermediary between LDAP and Jenkins.</p> <p>Groups do not come across the same as before, they're now prefixed with <code>/</code>. I'm sure it is down to a misconfiguration on my end, so please let me know how to resolve that if you figure it out. </p> <p>This means, that a LDAP group called <strong><em>Catmins</em></strong> will have to be used in Jenkins via <code>/Catmins</code> in <code>Matrix</code>, <code>Project Matrix</code> or other authorization schemes.</p> </div> <h3 id=verify_1>Verify<a class=headerlink href=#verify_1 title="Permanent link">&para;</a></h3> <p>To verify, take the leap of faith to save the configuration, logout (top right) and then log back in. If everything goes well, you will be redirected to Keycloak, once successfully logged in, redirected back to Jenkins!</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>One thing to remark, that if you're logged into Jenkins and you want to see the Groups, you can select your User (top right, click on your name). </p> <p>Alternatively, you can go to <code>${JENKINS_URL}/whoAmI</code> (notice the capital casing of the 'A' and 'I', it is required).</p> </div> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">&para;</a></h2> <div class=footnote> <hr> <ol> <li id=fn:1> <p><a href=https://www.keycloak.org/ >Apache Keycloak Home</a>&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:2> <p><a href=https://en.wikipedia.org/wiki/Single_sign-on>Wikipedia Definition on Single sign-on</a>&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> <li id=fn:3> <p><a href=https://kubernetes.io/ >Kubernetes Home</a>&#160;<a class=footnote-backref href=#fnref:3 title="Jump back to footnote 3 in the text">&#8617;</a></p> </li> <li id=fn:4> <p><a href=https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol>Lightweight Directory Access Protocol (LDAP)</a>&#160;<a class=footnote-backref href=#fnref:4 title="Jump back to footnote 4 in the text">&#8617;</a></p> </li> <li id=fn:5> <p><a href=http://jenkins.io>Jenkins Home</a>&#160;<a class=footnote-backref href=#fnref:5 title="Jump back to footnote 5 in the text">&#8617;</a></p> </li> <li id=fn:6> <p><a href=https://www.sonarqube.org/ >SonarQube Home</a>&#160;<a class=footnote-backref href=#fnref:6 title="Jump back to footnote 6 in the text">&#8617;</a></p> </li> <li id=fn:7> <p><a href=https://github.com/OpenIdentityPlatform/OpenDJ>OpenDJ Community Edition</a>&#160;<a class=footnote-backref href=#fnref:7 title="Jump back to footnote 7 in the text">&#8617;</a></p> </li> <li id=fn:8> <p><a href=https://helm.sh/ >Helm - Package Manager for Kubernetes</a>&#160;<a class=footnote-backref href=#fnref:8 title="Jump back to footnote 8 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:8 title="Jump back to footnote 8 in the text">&#8617;</a></p> </li> <li id=fn:9> <p><a href=https://medium.com/better-programming/helm-3-fun-with-the-new-beta-8f91c70891ff>Helm 3 Beta</a>&#160;<a class=footnote-backref href=#fnref:9 title="Jump back to footnote 9 in the text">&#8617;</a></p> </li> <li id=fn:10> <p><a href=http://www.zytrax.com/books/ldap/ape/#attributes>Common Used LDAP Attributes Explained</a>&#160;<a class=footnote-backref href=#fnref:10 title="Jump back to footnote 10 in the text">&#8617;</a></p> </li> <li id=fn:11> <p><a href=https://github.com/krallin/tini>tini - process manager</a>&#160;<a class=footnote-backref href=#fnref:11 title="Jump back to footnote 11 in the text">&#8617;</a></p> </li> <li id=fn:12> <p><a href=https://blog.overops.com/running-java-on-docker-youre-breaking-the-law/ >Overops Article on Java License in Docker images</a>&#160;<a class=footnote-backref href=#fnref:12 title="Jump back to footnote 12 in the text">&#8617;</a></p> </li> <li id=fn:13> <p><a href=https://hub.docker.com/_/alpine>Alpine Docker Image</a>&#160;<a class=footnote-backref href=#fnref:13 title="Jump back to footnote 13 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:13 title="Jump back to footnote 13 in the text">&#8617;</a></p> </li> <li id=fn:14> <p><a href=https://snyk.io/blog/10-docker-image-security-best-practices/ >Snyk - 10 docker image security best practices</a>&#160;<a class=footnote-backref href=#fnref:14 title="Jump back to footnote 14 in the text">&#8617;</a></p> </li> <li id=fn:15> <p><a href=https://hub.docker.com/r/azul/zulu-openjdk-alpine>Azul OpenJDK Alpine Image</a>&#160;<a class=footnote-backref href=#fnref:15 title="Jump back to footnote 15 in the text">&#8617;</a></p> </li> <li id=fn:16> <p><a href=https://blog.softwaremill.com/hosting-helm-private-repository-from-github-ff3fa940d0b7>Hosting Helm Private Repository from GitHub</a>&#160;<a class=footnote-backref href=#fnref:16 title="Jump back to footnote 16 in the text">&#8617;</a></p> </li> <li id=fn:17> <p><a href=https://github.com/joostvdg/helm-repo>Joost van der Griendt's Helm Repository</a>&#160;<a class=footnote-backref href=#fnref:17 title="Jump back to footnote 17 in the text">&#8617;</a></p> </li> <li id=fn:18> <p><a href=https://nip.io/ >Nip Io - Dead simple wildcard DNS for any IP Address</a>&#160;<a class=footnote-backref href=#fnref:18 title="Jump back to footnote 18 in the text">&#8617;</a></p> </li> <li id=fn:19> <p><a href=https://github.com/jetstack/cert-manager>Cert Manager</a>&#160;<a class=footnote-backref href=#fnref:19 title="Jump back to footnote 19 in the text">&#8617;</a></p> </li> <li id=fn:20> <p><a href=https://letsencrypt.org/ >Let's Encrypt - Let's Encrypt the world!</a>&#160;<a class=footnote-backref href=#fnref:20 title="Jump back to footnote 20 in the text">&#8617;</a></p> </li> <li id=fn:21> <p><a href=https://www.keycloak.org/docs-api/6.0/rest-api/index.html#_uri_scheme>Keycloak Admin REST API</a>&#160;<a class=footnote-backref href=#fnref:21 title="Jump back to footnote 21 in the text">&#8617;</a></p> </li> <li id=fn:22> <p><a href=https://github.com/jenkinsci/oic-auth-plugin>Jenkins OpenId Connect Plugin</a>&#160;<a class=footnote-backref href=#fnref:22 title="Jump back to footnote 22 in the text">&#8617;</a></p> </li> <li id=fn:23> <p><a href=https://wiki.jenkins.io/display/JENKINS/keycloak-plugin>Jenkins Keycloak Plugin</a>&#160;<a class=footnote-backref href=#fnref:23 title="Jump back to footnote 23 in the text">&#8617;</a></p> </li> <li id=fn:24> <p><a href=https://jenkins.io/doc/book/managing/plugins/ >Jenkins Plugin Management</a>&#160;<a class=footnote-backref href=#fnref:24 title="Jump back to footnote 24 in the text">&#8617;</a></p> </li> <li id=fn:25> <p><a href=https://jenkins.io/blog/2019/08/30/jenkins-cli/ >Jenkins JCLI</a>&#160;<a class=footnote-backref href=#fnref:25 title="Jump back to footnote 25 in the text">&#8617;</a></p> </li> <li id=fn:26> <p><a href=https://github.com/jenkinsci/configuration-as-code-plugin/blob/master/README.md>Jenkins Configuration As Code</a>&#160;<a class=footnote-backref href=#fnref:26 title="Jump back to footnote 26 in the text">&#8617;</a></p> </li> <li id=fn:27> <p><a href=https://github.com/helm/charts/tree/master/stable/jenkins>Jenkins Helm Chart</a>&#160;<a class=footnote-backref href=#fnref:27 title="Jump back to footnote 27 in the text">&#8617;</a></p> </li> <li id=fn:28> <p><a href=https://httpie.org>HTTPie http commandline interface</a>&#160;<a class=footnote-backref href=#fnref:28 title="Jump back to footnote 28 in the text">&#8617;</a></p> </li> </ol> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2022-07-05 15:36:54</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 Joost van der Griendt </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/joostvdg target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/joost_vdg target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/joostvdg target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tabs.sticky", "content.code.annotate", "content.code.copy", "toc.follow"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.aecac24b.min.js></script> </body> </html>