<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A Recap Of DockerCon EU 2018 at Barcelona"><link href=https://joostvdg.github.io/blogs/dockercon-eu-2018/ rel=canonical><link href=../k8s-crd/ rel=prev><link href=../../jenkins/jenkins-on-kubernetes/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.9"><title>DockerCon EU 2018 - J's Software Development Pages</title><link rel=stylesheet href=../../assets/stylesheets/main.78cf6014.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.356b1318.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-353607268"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-353607268",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-353607268",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=orange data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#dockercon-eu-2018-recap class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="J's Software Development Pages" class="md-header__button md-logo" aria-label="J's Software Development Pages" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48 1.18-1.53 3.08-1.95.63-2.3 2.5-3.72Q9.63 4 12 4q2.93 0 4.96 2.04Q19 8.07 19 11q1.73.2 2.86 1.5 1.14 1.28 1.14 3 0 1.88-1.31 3.19T18.5 20Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> J's Software Development Pages </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> DockerCon EU 2018 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=orange data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=deep-orange data-md-color-accent=teal aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/joostvdg/joostvdg.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../../jenkins/jenkins-on-kubernetes/ class=md-tabs__link> Jenkins & CloudBees </a> </li> <li class=md-tabs__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-tabs__link> Kubernetes & Docker </a> </li> <li class=md-tabs__item> <a href=../../tanzu/ class=md-tabs__link> VMware Tanzu </a> </li> <li class=md-tabs__item> <a href=../../platform-sre/backstage/plugin/ class=md-tabs__link> Platform Engineering/SRE </a> </li> <li class=md-tabs__item> <a href=../../jenkinsx/build-packs/ class=md-tabs__link> Jenkins X </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ class=md-tabs__link> Software Eng. </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="J's Software Development Pages" class="md-nav__button md-logo" aria-label="J's Software Development Pages" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48 1.18-1.53 3.08-1.95.63-2.3 2.5-3.72Q9.63 4 12 4q2.93 0 4.96 2.04Q19 8.07 19 11q1.73.2 2.86 1.5 1.14 1.28 1.14 3 0 1.88-1.31 3.19T18.5 20Z"/></svg> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Me </span> </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ class=md-nav__link> <span class=md-ellipsis> MKDocs (This Static Website) </span> </a> </li> <li class=md-nav__item> <a href=../../other/vim/ class=md-nav__link> <span class=md-ellipsis> VIM </span> </a> </li> <li class=md-nav__item> <a href=../../other/shell/ class=md-nav__link> <span class=md-ellipsis> Shell </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Blogs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../jenkins-pipeline-support-tool/ class=md-nav__link> <span class=md-ellipsis> Jenkins Pipeline Support Tools </span> </a> </li> <li class=md-nav__item> <a href=../graceful-shutdown/ class=md-nav__link> <span class=md-ellipsis> Docker Graceful Shutdown </span> </a> </li> <li class=md-nav__item> <a href=../docker-alternatives/ class=md-nav__link> <span class=md-ellipsis> Pipelines with Docker Alternatives </span> </a> </li> <li class=md-nav__item> <a href=../k8s-lets-encrypt/ class=md-nav__link> <span class=md-ellipsis> Let's Encrypt for Kubernetes Apps </span> </a> </li> <li class=md-nav__item> <a href=../sso-azure-ad/ class=md-nav__link> <span class=md-ellipsis> CloudBees SSO Azure AD </span> </a> </li> <li class=md-nav__item> <a href=../teams-automation/ class=md-nav__link> <span class=md-ellipsis> CloudBees Automate Teams </span> </a> </li> <li class=md-nav__item> <a href=../kubernetes-sso-keycloak/ class=md-nav__link> <span class=md-ellipsis> Kubernetes SSO Keycloak </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_8> <label class=md-nav__link for=__nav_2_8 id=__nav_2_8_label tabindex=0> <span class=md-ellipsis> Jenkins X Java Native Image Prod </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_8_label aria-expanded=false> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> Jenkins X Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ class=md-nav__link> <span class=md-ellipsis> Cloud SQL </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ class=md-nav__link> <span class=md-ellipsis> Quarkus </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ class=md-nav__link> <span class=md-ellipsis> Import Into Jenkins X </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ class=md-nav__link> <span class=md-ellipsis> Database Connection And Secrets </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ class=md-nav__link> <span class=md-ellipsis> Native Image </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ class=md-nav__link> <span class=md-ellipsis> Pipeline Improvements </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ class=md-nav__link> <span class=md-ellipsis> Previews & Integration Tests </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ class=md-nav__link> <span class=md-ellipsis> Production Improvements </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ class=md-nav__link> <span class=md-ellipsis> Promote To Production </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_9> <label class=md-nav__link for=__nav_2_9 id=__nav_2_9_label tabindex=0> <span class=md-ellipsis> Jenkins Monitoring Kubernetes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_9_label aria-expanded=false> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/prepare/ class=md-nav__link> <span class=md-ellipsis> Prepare Environment </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/install/ class=md-nav__link> <span class=md-ellipsis> Install Tools </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/metrics/ class=md-nav__link> <span class=md-ellipsis> Metrics </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/alerts/ class=md-nav__link> <span class=md-ellipsis> Alerts </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/pipeline/ class=md-nav__link> <span class=md-ellipsis> Pipeline </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/dashboard/ class=md-nav__link> <span class=md-ellipsis> Dashboard </span> </a> </li> <li class=md-nav__item> <a href=../monitor-jenkins-on-k8s/cloudbees/ class=md-nav__link> <span class=md-ellipsis> CloudBees </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../k8s-crd/ class=md-nav__link> <span class=md-ellipsis> Create your own k8s resource </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> DockerCon EU 2018 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> DockerCon EU 2018 </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#generally-outline class=md-nav__link> <span class=md-ellipsis> Generally outline </span> </a> <nav class=md-nav aria-label="Generally outline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#security-begins-at-the-developer class=md-nav__link> <span class=md-ellipsis> Security begins at the Developer </span> </a> </li> <li class=md-nav__item> <a href=#broader-automation class=md-nav__link> <span class=md-ellipsis> Broader Automation </span> </a> </li> <li class=md-nav__item> <a href=#containerization-influences-everything class=md-nav__link> <span class=md-ellipsis> Containerization Influences Everything </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#docker-build-with-build-kit class=md-nav__link> <span class=md-ellipsis> Docker Build with Build-Kit </span> </a> </li> <li class=md-nav__item> <a href=#secure-your-kubernetes class=md-nav__link> <span class=md-ellipsis> Secure your Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=#broader-cloud-automation class=md-nav__link> <span class=md-ellipsis> Broader Cloud Automation </span> </a> <nav class=md-nav aria-label="Broader Cloud Automation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cnab-cloud-native-application-bundle class=md-nav__link> <span class=md-ellipsis> CNAB: cloud native application bundle </span> </a> </li> <li class=md-nav__item> <a href=#pulumi class=md-nav__link> <span class=md-ellipsis> Pulumi </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#jfrog-jenkins-challenge class=md-nav__link> <span class=md-ellipsis> JFrog Jenkins Challenge </span> </a> <nav class=md-nav aria-label="JFrog Jenkins Challenge"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#jenkins-challenge class=md-nav__link> <span class=md-ellipsis> Jenkins Challenge </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#docker-security-standards class=md-nav__link> <span class=md-ellipsis> Docker security &amp; standards </span> </a> </li> <li class=md-nav__item> <a href=#docker-java-cicd class=md-nav__link> <span class=md-ellipsis> Docker &amp; Java &amp; CICD </span> </a> </li> <li class=md-nav__item> <a href=#docker-windows class=md-nav__link> <span class=md-ellipsis> Docker &amp; Windows </span> </a> </li> <li class=md-nav__item> <a href=#other class=md-nav__link> <span class=md-ellipsis> Other </span> </a> <nav class=md-nav aria-label=Other> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-pipeline class=md-nav__link> <span class=md-ellipsis> Docker pipeline </span> </a> </li> <li class=md-nav__item> <a href=#idea-build-a-dynamic-cicd-platform-with-kubernetes class=md-nav__link> <span class=md-ellipsis> Idea: build a dynamic ci/cd platform with kubernetes </span> </a> </li> <li class=md-nav__item> <a href=#apply-diplomacy-to-code-review class=md-nav__link> <span class=md-ellipsis> Apply Diplomacy to Code Review </span> </a> </li> <li class=md-nav__item> <a href=#citizens-bank-journey class=md-nav__link> <span class=md-ellipsis> Citizens Bank journey </span> </a> </li> <li class=md-nav__item> <a href=#docker-ee-assemble class=md-nav__link> <span class=md-ellipsis> Docker EE - Assemble </span> </a> </li> <li class=md-nav__item> <a href=#other_1 class=md-nav__link> <span class=md-ellipsis> Other </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Jenkins & CloudBees </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Jenkins & CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/jenkins-on-kubernetes/ class=md-nav__link> <span class=md-ellipsis> Jenkins On Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/jenkins-tap/ class=md-nav__link> <span class=md-ellipsis> TAP & Jenkins </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> CloudBees </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloudbees/cbci-casc/ class=md-nav__link> <span class=md-ellipsis> CloudBees CasC </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/sso-azure-ad/ class=md-nav__link> <span class=md-ellipsis> Single Sign On - AzureAD </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/teams-automation/ class=md-nav__link> <span class=md-ellipsis> CloudBees Automate Teams </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-gke-helm/ class=md-nav__link> <span class=md-ellipsis> CloudBees CI on GKE </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-eks/ class=md-nav__link> <span class=md-ellipsis> CloudBees CI on EKS </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-team-namespace/ class=md-nav__link> <span class=md-ellipsis> Team Master Namespace </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/multi-cluster-gke/ class=md-nav__link> <span class=md-ellipsis> Multi-Cluster GKE </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/multi-cluster-eks/ class=md-nav__link> <span class=md-ellipsis> Multi-Cluster EKS </span> </a> </li> <li class=md-nav__item> <a href=../../cloudbees/multi-cluster/ class=md-nav__link> <span class=md-ellipsis> Multi-Cluster (OLD/AKS) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> Jenkins </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ class=md-nav__link> <span class=md-ellipsis> JobDSL </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ class=md-nav__link> <span class=md-ellipsis> JenkinsJobsBuilder </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class=md-ellipsis> Jenkins Pipelines </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ class=md-nav__link> <span class=md-ellipsis> Job Types </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/kaniko-pipelines/ class=md-nav__link> <span class=md-ellipsis> Build Docker Image Kaniko </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/podtemplate-dind/ class=md-nav__link> <span class=md-ellipsis> PodTemplate With Docker-In-Docker </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ class=md-nav__link> <span class=md-ellipsis> Parallel Pipelines </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ class=md-nav__link> <span class=md-ellipsis> Core Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ class=md-nav__link> <span class=md-ellipsis> Artifactory Integration </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ class=md-nav__link> <span class=md-ellipsis> Pipeline (declarative) </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ class=md-nav__link> <span class=md-ellipsis> Groovy DSL Pipeline </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ class=md-nav__link> <span class=md-ellipsis> Pipeline Libraries </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ class=md-nav__link> <span class=md-ellipsis> DSL IDE Integration </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ class=md-nav__link> <span class=md-ellipsis> Input </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class=md-ellipsis> Jenkins Pipeline Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ class=md-nav__link> <span class=md-ellipsis> Docker Alternatives </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ class=md-nav__link> <span class=md-ellipsis> Maven Declarative </span> </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ class=md-nav__link> <span class=md-ellipsis> Docker Declarative </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Kubernetes & Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Kubernetes & Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> OpenShift </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-nav__link> <span class=md-ellipsis> OpenShift 3.11 GCP(minimal) </span> </a> </li> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-medium/ class=md-nav__link> <span class=md-ellipsis> OpenShift 3.11 GCP(medium) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Kubernetes (K8S) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ class=md-nav__link> <span class=md-ellipsis> CKA Exam prep </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ class=md-nav__link> <span class=md-ellipsis> Tools </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Managed Kubernetes (cloud) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Managed Kubernetes (cloud) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ class=md-nav__link> <span class=md-ellipsis> GKE </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/gke-terraform/ class=md-nav__link> <span class=md-ellipsis> GKE Terraform </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ class=md-nav__link> <span class=md-ellipsis> AWS EKS </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ class=md-nav__link> <span class=md-ellipsis> AKS CLI </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ class=md-nav__link> <span class=md-ellipsis> AKS Terraform </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> K8S Hard Way - GCE </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ class=md-nav__link> <span class=md-ellipsis> Installer Preparation </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ class=md-nav__link> <span class=md-ellipsis> Create GCE resources </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ class=md-nav__link> <span class=md-ellipsis> Prepare Certificates </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ class=md-nav__link> <span class=md-ellipsis> Prepare Kubeconfigs </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ class=md-nav__link> <span class=md-ellipsis> Encryption configuration </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ class=md-nav__link> <span class=md-ellipsis> ETCD configuration </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ class=md-nav__link> <span class=md-ellipsis> Controller Config </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ class=md-nav__link> <span class=md-ellipsis> Worker Config </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ class=md-nav__link> <span class=md-ellipsis> Remote access </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ class=md-nav__link> <span class=md-ellipsis> Network config </span> </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ class=md-nav__link> <span class=md-ellipsis> Debug </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ class=md-nav__link> <span class=md-ellipsis> Graceful Shutdown </span> </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ class=md-nav__link> <span class=md-ellipsis> BuildKit </span> </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ class=md-nav__link> <span class=md-ellipsis> Multi-Stage Builds(TBD) </span> </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ class=md-nav__link> <span class=md-ellipsis> Swarm (mode) (TBD) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> Linux </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ class=md-nav__link> <span class=md-ellipsis> SystemD </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> VMware Tanzu </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> VMware Tanzu </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/ class=md-nav__link> <span class=md-ellipsis> Tanzu </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_2> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> <span class=md-ellipsis> TAP GitOps </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> TAP GitOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/services/ class=md-nav__link> <span class=md-ellipsis> Services </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/tap-gitops-prep/ class=md-nav__link> <span class=md-ellipsis> TAP GitOps Prep </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/tap-build/ class=md-nav__link> <span class=md-ellipsis> TAP Build </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/tap-run/ class=md-nav__link> <span class=md-ellipsis> TAP Run </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/tap-view/ class=md-nav__link> <span class=md-ellipsis> TAP View </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/next-steps/ class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gitops/run-with-argocd/ class=md-nav__link> <span class=md-ellipsis> TAP Run With ArgoCD </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../tanzu/tap/multi-env-promo/ class=md-nav__link> <span class=md-ellipsis> TAP Multi-Env Promotion </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> <span class=md-ellipsis> TAP Supply Chain Customization </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> TAP Supply Chain Customization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/supplychain/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/supplychain/gitops-flow/ class=md-nav__link> <span class=md-ellipsis> GitOps Flow </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> <span class=md-ellipsis> TAP GUI/Portal </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> TAP GUI/Portal </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/tap-gui/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gui/gitlab-integration/ class=md-nav__link> <span class=md-ellipsis> GitLab Integration </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gui/techdocs-minio/ class=md-nav__link> <span class=md-ellipsis> TechDocs with MinIO </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-gui/tdp-plugins/ class=md-nav__link> <span class=md-ellipsis> Backstage Plugins </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 id=__nav_5_6_label tabindex=0> <span class=md-ellipsis> TAP on TKGs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_6_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> TAP on TKGs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_6_1> <label class=md-nav__link for=__nav_5_6_1 id=__nav_5_6_1_label tabindex=0> <span class=md-ellipsis> TAP 1.3.x </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_5_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_5_6_1> <span class="md-nav__icon md-icon"></span> TAP 1.3.x </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13-overview/ class=md-nav__link> <span class=md-ellipsis> TAP on TKGs </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13/build-basic/ class=md-nav__link> <span class=md-ellipsis> TAP Build Profile - Basic Supply Chain </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13/build-scanning-testing/ class=md-nav__link> <span class=md-ellipsis> TAP Build Profile - Scanning & Testing Supply Chain </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13/run/ class=md-nav__link> <span class=md-ellipsis> TAP Run Profile </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkgs/tap13/view/ class=md-nav__link> <span class=md-ellipsis> TAP View Profile </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex=0> <span class=md-ellipsis> TAP DevSecOps </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> TAP DevSecOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/grype-airgapped/ class=md-nav__link> <span class=md-ellipsis> Use Grype In Restricted Environments </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex=0> <span class=md-ellipsis> TAP Misc </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> TAP Misc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/tap/fluxcd-ssh/ class=md-nav__link> <span class=md-ellipsis> Git access with SSH </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap/gitea/ class=md-nav__link> <span class=md-ellipsis> Setup Gitea </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../tanzu/custom-ca/ class=md-nav__link> <span class=md-ellipsis> Setup Custom CA </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/harbor-ca/ class=md-nav__link> <span class=md-ellipsis> Harbor with custom CA </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/minio-ca/ class=md-nav__link> <span class=md-ellipsis> Minio with custom CA </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/tkg-grafana/ class=md-nav__link> <span class=md-ellipsis> TKG Grafana with LDAP </span> </a> </li> <li class=md-nav__item> <a href=../../tanzu/dependencies/ class=md-nav__link> <span class=md-ellipsis> Dependencies </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex> <span class=md-ellipsis> Platform Engineering/SRE </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Platform Engineering/SRE </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> Backstage Plugin </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> Backstage Plugin </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../platform-sre/backstage/plugin/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../platform-sre/backstage/plugin/backend/ class=md-nav__link> <span class=md-ellipsis> Backend Plugin </span> </a> </li> <li class=md-nav__item> <a href=../../platform-sre/backstage/plugin/frontend/ class=md-nav__link> <span class=md-ellipsis> Frontend Plugin </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> Backstage & Tanzu </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> Backstage & Tanzu </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../platform-sre/backstage/tap/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../platform-sre/backstage/tap/wrap-plugins/ class=md-nav__link> <span class=md-ellipsis> Wrap Plugins </span> </a> </li> <li class=md-nav__item> <a href=../../platform-sre/backstage/tap/add-wrap-plugin/ class=md-nav__link> <span class=md-ellipsis> Add Wrapped Plugins </span> </a> </li> <li class=md-nav__item> <a href=../../platform-sre/backstage/tap/tekton/ class=md-nav__link> <span class=md-ellipsis> Tekton Plugin </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> Jenkins X </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/build-packs/ class=md-nav__link> <span class=md-ellipsis> Build Packs </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jx-pipelines/ class=md-nav__link> <span class=md-ellipsis> Jenkins X Pipelines </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3 id=__nav_7_3_label tabindex=0> <span class=md-ellipsis> Java Native Image Prod </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_7_3_label aria-expanded=false> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ class=md-nav__link> <span class=md-ellipsis> Intro </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ class=md-nav__link> <span class=md-ellipsis> Cloud SQL </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ class=md-nav__link> <span class=md-ellipsis> Quarkus </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ class=md-nav__link> <span class=md-ellipsis> Import Into Jenkins X </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ class=md-nav__link> <span class=md-ellipsis> Database Connection And Secrets </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ class=md-nav__link> <span class=md-ellipsis> Native Image </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ class=md-nav__link> <span class=md-ellipsis> Pipeline Improvements </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ class=md-nav__link> <span class=md-ellipsis> Previews & Integration Tests </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ class=md-nav__link> <span class=md-ellipsis> Production Improvements </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ class=md-nav__link> <span class=md-ellipsis> Promote To Production </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../jenkinsx/builder-image/ class=md-nav__link> <span class=md-ellipsis> Create Builder Image </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot/ class=md-nav__link> <span class=md-ellipsis> JX Boot GKE </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot-aks/ class=md-nav__link> <span class=md-ellipsis> JX Boot AKS </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/aks-boot-core/ class=md-nav__link> <span class=md-ellipsis> JX Boot & CloudBees Core </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-minimal/ class=md-nav__link> <span class=md-ellipsis> OpenShift 3.11 </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-restricted/ class=md-nav__link> <span class=md-ellipsis> OpenShift 3.11 - Restricted </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/lighthouse-bitbucket/ class=md-nav__link> <span class=md-ellipsis> Lighthouse & Bitbucket </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hello-world/ class=md-nav__link> <span class=md-ellipsis> HelloWorld </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/maven/ class=md-nav__link> <span class=md-ellipsis> Maven </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hybrid/ class=md-nav__link> <span class=md-ellipsis> Hybrid </span> </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/kubernetes-days/ class=md-nav__link> <span class=md-ellipsis> Example For Console Reel </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex> <span class=md-ellipsis> Software Eng. </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Software Eng. </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_1> <label class=md-nav__link for=__nav_8_1 id=__nav_8_1_label tabindex=0> <span class=md-ellipsis> Automation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_1_label aria-expanded=false> <label class=md-nav__title for=__nav_8_1> <span class="md-nav__icon md-icon"></span> Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ class=md-nav__link> <span class=md-ellipsis> Pulumi </span> </a> </li> <li class=md-nav__item> <a href=../../certificates/lets-encrypt-k8s/ class=md-nav__link> <span class=md-ellipsis> Let's Encrypt K8S </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2 id=__nav_8_2_label tabindex=0> <span class=md-ellipsis> Software Engineering </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_2_label aria-expanded=false> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ class=md-nav__link> <span class=md-ellipsis> Important Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ class=md-nav__link> <span class=md-ellipsis> Naming </span> </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ class=md-nav__link> <span class=md-ellipsis> Distributed Computing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_3> <label class=md-nav__link for=__nav_8_3 id=__nav_8_3_label tabindex=0> <span class=md-ellipsis> Productivity </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_3_label aria-expanded=false> <label class=md-nav__title for=__nav_8_3> <span class="md-nav__icon md-icon"></span> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ class=md-nav__link> <span class=md-ellipsis> General </span> </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ class=md-nav__link> <span class=md-ellipsis> Incidents </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_4> <label class=md-nav__link for=__nav_8_4 id=__nav_8_4_label tabindex=0> <span class=md-ellipsis> Java </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_4_label aria-expanded=false> <label class=md-nav__title for=__nav_8_4> <span class="md-nav__icon md-icon"></span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/ class=md-nav__link> <span class=md-ellipsis> General </span> </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ class=md-nav__link> <span class=md-ellipsis> Spring Boot App </span> </a> </li> <li class=md-nav__item> <a href=../../java/networking/ class=md-nav__link> <span class=md-ellipsis> Java Networking </span> </a> </li> <li class=md-nav__item> <a href=../../java/concurrency/ class=md-nav__link> <span class=md-ellipsis> Java Concurrency </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#generally-outline class=md-nav__link> <span class=md-ellipsis> Generally outline </span> </a> <nav class=md-nav aria-label="Generally outline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#security-begins-at-the-developer class=md-nav__link> <span class=md-ellipsis> Security begins at the Developer </span> </a> </li> <li class=md-nav__item> <a href=#broader-automation class=md-nav__link> <span class=md-ellipsis> Broader Automation </span> </a> </li> <li class=md-nav__item> <a href=#containerization-influences-everything class=md-nav__link> <span class=md-ellipsis> Containerization Influences Everything </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#docker-build-with-build-kit class=md-nav__link> <span class=md-ellipsis> Docker Build with Build-Kit </span> </a> </li> <li class=md-nav__item> <a href=#secure-your-kubernetes class=md-nav__link> <span class=md-ellipsis> Secure your Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=#broader-cloud-automation class=md-nav__link> <span class=md-ellipsis> Broader Cloud Automation </span> </a> <nav class=md-nav aria-label="Broader Cloud Automation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cnab-cloud-native-application-bundle class=md-nav__link> <span class=md-ellipsis> CNAB: cloud native application bundle </span> </a> </li> <li class=md-nav__item> <a href=#pulumi class=md-nav__link> <span class=md-ellipsis> Pulumi </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#jfrog-jenkins-challenge class=md-nav__link> <span class=md-ellipsis> JFrog Jenkins Challenge </span> </a> <nav class=md-nav aria-label="JFrog Jenkins Challenge"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#jenkins-challenge class=md-nav__link> <span class=md-ellipsis> Jenkins Challenge </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#docker-security-standards class=md-nav__link> <span class=md-ellipsis> Docker security &amp; standards </span> </a> </li> <li class=md-nav__item> <a href=#docker-java-cicd class=md-nav__link> <span class=md-ellipsis> Docker &amp; Java &amp; CICD </span> </a> </li> <li class=md-nav__item> <a href=#docker-windows class=md-nav__link> <span class=md-ellipsis> Docker &amp; Windows </span> </a> </li> <li class=md-nav__item> <a href=#other class=md-nav__link> <span class=md-ellipsis> Other </span> </a> <nav class=md-nav aria-label=Other> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-pipeline class=md-nav__link> <span class=md-ellipsis> Docker pipeline </span> </a> </li> <li class=md-nav__item> <a href=#idea-build-a-dynamic-cicd-platform-with-kubernetes class=md-nav__link> <span class=md-ellipsis> Idea: build a dynamic ci/cd platform with kubernetes </span> </a> </li> <li class=md-nav__item> <a href=#apply-diplomacy-to-code-review class=md-nav__link> <span class=md-ellipsis> Apply Diplomacy to Code Review </span> </a> </li> <li class=md-nav__item> <a href=#citizens-bank-journey class=md-nav__link> <span class=md-ellipsis> Citizens Bank journey </span> </a> </li> <li class=md-nav__item> <a href=#docker-ee-assemble class=md-nav__link> <span class=md-ellipsis> Docker EE - Assemble </span> </a> </li> <li class=md-nav__item> <a href=#other_1 class=md-nav__link> <span class=md-ellipsis> Other </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=dockercon-eu-2018-recap>DockerCon EU 2018 - Recap<a class=headerlink href=#dockercon-eu-2018-recap title="Permanent link">&para;</a></h1> <h2 id=generally-outline>Generally outline<a class=headerlink href=#generally-outline title="Permanent link">&para;</a></h2> <p>From my perspective, there were a few red threads throughout the conference.</p> <h3 id=security-begins-at-the-developer>Security begins at the Developer<a class=headerlink href=#security-begins-at-the-developer title="Permanent link">&para;</a></h3> <p>A shift left of security, bringing the responsibility of knowing your dependencies and their quality firmly to the developer. Most of this tooling is still aimed at enterprises though, being part of paid solutions mostly. At least that which was shown at the conference.</p> <ul> <li>docker-assemble, that can build in an image from a Maven pom.xml and will include meta-data of all your dependencies (transitive included)</li> <li>JFrog X-Ray</li> <li>Docker EE tooling such as Docker Trusted Registry (DTR)</li> </ul> <h3 id=broader-automation>Broader Automation<a class=headerlink href=#broader-automation title="Permanent link">&para;</a></h3> <p>More focus on the entire lifecycle of a system and not just an application. It seems people are starting to understand that doing CI/CD and Infrastructure As Code is not a single event for a single application. There is likely to be a few applications belonging together making a whole system which will land on more than one type of infrastructure and possibly more types of clusters.</p> <p>What we see is tools looking at either a broader scope, a higher level abstraction or more developer focussed (more love for the Dev in DevOps) to allow for easier integration with multiple platforms. For example, Pulumi will enable you to create any type of infrastructure - like Hashicorp's Terraform - but then in programming languages, you're used to (TypeScript, Python, Go).</p> <ul> <li>Pulumi</li> <li>Docker App</li> <li>CNAB</li> <li>Build-Kit</li> </ul> <h3 id=containerization-influences-everything>Containerization Influences Everything<a class=headerlink href=#containerization-influences-everything title="Permanent link">&para;</a></h3> <p>Containerization has left deep and easy to spot imprints in our industry from startups building entirely on top of containers to programming languages changing their ways to stay relevant.</p> <p>There are new monitoring kings in the world, DataDog, Sysdig, Honeycomb.io and so on. They live and breathe containers and are not afraid of being thrown around different public clouds, networks and what not. In contrast to traditional monitoring tools, which are often bolting on container support and struggle with the dynamic nature of containerized clusters.</p> <p>Another extraordinary influence is that on the Java language. Declared dead a million times over and deemed obsolete in the container era due to its massive footprint in image size and runtime size. Both are being addressed, and we see a lot of work done on reducing footprint and static linking (JLink, Graal).</p> <p>The most significant influence might be on the software behemoth that has rejuvenated itself. Microsoft has sworn allegiance to open source, Linux and containers. Windows 2019 server can run container workloads natively and work as nodes alongside a Docker EE cluster - which can include Kubernetes workloads. The next step would be support for Kubernetes integration, and as in the case of Java, smaller container footprint.</p> <ul> <li>Java &amp; Docker</li> <li>Windows Container &amp; Windows Server Support</li> <li>Observability tools</li> <li>Kubernetes offerings everywhere...</li> </ul> <h2 id=docker-build-with-build-kit>Docker Build with Build-Kit<a class=headerlink href=#docker-build-with-build-kit title="Permanent link">&para;</a></h2> <p>Instead of investing in improving docker image building via the Docker Client, Docker created a new API and client library.</p> <p>This library called BuildKit, is completely independent. With Docker 18.09, it is included in the Docker Client allowing anyone to use it as easily as the traditional <code>docker image build</code>.</p> <p>BuildKit is already used by some other tools, such as Buildah and IMG, and allows you to create custom DSL "Frontends". As long as the API of BuikdKit is adhered to, the resulting image will be OCI compliant.</p> <p>So further remarks below and how to use it.</p> <ul> <li><a href=https://github.com/moby/buildkit>BuildKit</a></li> <li>In-Depth session <a href=https://europe-2018.dockercon.com/videos-hub>Supercharged Docker Build with BuildKit</a></li> <li>Usable from Docker <code>18.09</code></li> <li>HighLights:<ul> <li>allows custom DSL for specifying image (BuildKit) to still be used with Docker client/daemon</li> <li>build cache for your own files during build, think Go, Maven, Gradle...</li> <li>much more optimized, builds less, quicker, with more cache in less time</li> <li>support mounts (cache) such as secrets, during build phase</li> </ul> </li> </ul> <div class="language-bash highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># Set env variable to enable</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=c1># Or configure docker&#39;s json config</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=nb>export</span><span class=w> </span><span class=nv>DOCKER_BUILDKIT</span><span class=o>=</span><span class=m>1</span>
</span></code></pre></div> <div class="language-dockerfile highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c># syntax=docker/dockerfile:experimental</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=c>#######################################</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c>## 1. BUILD JAR WITH MAVEN</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=k>FROM</span><span class=w> </span><span class=s>maven:3.6-jdk-8</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s>BUILD</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/usr/src</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>/usr/src
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>!<span class=w> </span>RUN<span class=w> </span>--mount<span class=o>=</span><span class=nv>type</span><span class=o>=</span>cache,target<span class=o>=</span>/root/.m2/<span class=w>  </span>mvn<span class=w> </span>clean<span class=w> </span>package<span class=w> </span>-e
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=c>#######################################</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c>## 2. BUILD NATIVE IMAGE WITH GRAAL</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=k>FROM</span><span class=w> </span><span class=s>oracle/graalvm-ce:1.0.0-rc9</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s>NATIVE_BUILD</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/usr/src</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>BUILD<span class=w> </span>/usr/src/<span class=w> </span>/usr/src
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=k>RUN</span><span class=w> </span>ls<span class=w> </span>-lath<span class=w> </span>/usr/src/target/
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=k>COPY</span><span class=w> </span>/docker-graal-build.sh<span class=w> </span>/usr/src
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=k>RUN</span><span class=w> </span>./docker-graal-build.sh
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=k>RUN</span><span class=w> </span>ls<span class=w> </span>-lath
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=c>#######################################</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=c>## 3. BUILD DOCKER RUNTIME IMAGE</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=k>FROM</span><span class=w> </span><span class=s>alpine:3.8</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;jpc-graal&quot;</span><span class=p>]</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>NATIVE_BUILD<span class=w> </span>/usr/src/jpc-graal<span class=w> </span>/usr/local/bin/
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=k>RUN</span><span class=w> </span>chmod<span class=w> </span>+x<span class=w> </span>/usr/local/bin/jpc-graal
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=c>#######################################</span>
</span></code></pre></div> <p><img alt="BuildKit Slide" src=../../images/dockerconeu2018/buildkit-1.jpg></p> <h2 id=secure-your-kubernetes>Secure your Kubernetes<a class=headerlink href=#secure-your-kubernetes title="Permanent link">&para;</a></h2> <ul> <li><a href=https://www.openpolicyagent.org>https://www.openpolicyagent.org</a> + admission controller</li> <li>Network Policies</li> <li>Service Accounts</li> </ul> <h2 id=broader-cloud-automation>Broader Cloud Automation<a class=headerlink href=#broader-cloud-automation title="Permanent link">&para;</a></h2> <p>Two of the <code>broader cloud automation</code> initiatives that impressed me at DockerCon were Pulumi and CNAB.</p> <p>Where Pulumi is an attempt to provide a more developer-friendly alternative to Terraform, CNAB is an attempt to create an environment agnostic installer specification.</p> <p>Meaning, you could create a CNAB installer which uses Pulumi to install all required infrastructure, applications and other resources.</p> <h3 id=cnab-cloud-native-application-bundle>CNAB: cloud native application bundle<a class=headerlink href=#cnab-cloud-native-application-bundle title="Permanent link">&para;</a></h3> <ul> <li>Bundle.json</li> <li>invocation image (oci) = installer</li> <li><a href=https://cnab.io>https://cnab.io</a></li> <li>docker app implements it</li> <li>helm support</li> <li><a href=https://github.com/deislabs>https://github.com/deislabs</a></li> </ul> <p><img alt=CNAB src=../../images/dockerconeu2018/cnab-1.jpg></p> <h4 id=install-an-implementation>Install an implementation<a class=headerlink href=#install-an-implementation title="Permanent link">&para;</a></h4> <p>There are currently two implementations - that I found. Duffle from DeisLabs - open source from Azure - and Docker App - From Docker Inc..</p> <h4 id=duffle>Duffle<a class=headerlink href=#duffle title="Permanent link">&para;</a></h4> <ul> <li>create a new repo</li> <li>clone the repo</li> <li>init a duffle bundle</li> <li>copy duffle bundle data to our repo folder</li> </ul> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>git<span class=w> </span>clone<span class=w> </span>git@github.com:demomon/cnab-duffle-demo-1.git
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>duffle<span class=w> </span>create<span class=w> </span>cnab-duffle-demo-2
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>mv<span class=w> </span>cnab-duffle-demo-2/cnab<span class=w> </span>cnab-duffle-demo-1/
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>mv<span class=w> </span>cnab-duffle-demo-2/duffle.json<span class=w> </span>cnab-duffle-demo-1/
</span></code></pre></div> <ul> <li>edit our install file (<code>cnab/run</code>)</li> <li>build our duffle bundle (<code>duffle build .</code>)</li> </ul> <p>We can now inspect our bundle with duffle.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>duffle<span class=w> </span>show<span class=w> </span>cnab-duffle-demo-1:0.1.0<span class=w> </span>-r
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>-----BEGIN<span class=w> </span>PGP<span class=w> </span>SIGNED<span class=w> </span>MESSAGE-----
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>Hash:<span class=w> </span>SHA256
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=o>{</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>  </span><span class=s2>&quot;name&quot;</span>:<span class=w> </span><span class=s2>&quot;cnab-duffle-demo-1&quot;</span>,
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>  </span><span class=s2>&quot;version&quot;</span>:<span class=w> </span><span class=s2>&quot;0.1.0&quot;</span>,
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=w>  </span><span class=s2>&quot;description&quot;</span>:<span class=w> </span><span class=s2>&quot;A short description of your bundle&quot;</span>,
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>  </span><span class=s2>&quot;keywords&quot;</span>:<span class=w> </span><span class=o>[</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>    </span><span class=s2>&quot;cnab-duffle-demo-1&quot;</span>,
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>    </span><span class=s2>&quot;cnab&quot;</span>,
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>    </span><span class=s2>&quot;demo&quot;</span>,
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>    </span><span class=s2>&quot;joostvdg&quot;</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=w>  </span><span class=o>]</span>,
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=w>  </span><span class=s2>&quot;maintainers&quot;</span>:<span class=w> </span><span class=o>[</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=w>    </span><span class=o>{</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=w>      </span><span class=s2>&quot;name&quot;</span>:<span class=w> </span><span class=s2>&quot;Joost van der Griendt&quot;</span>,
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=w>      </span><span class=s2>&quot;email&quot;</span>:<span class=w> </span><span class=s2>&quot;joostvdg@gmail.com&quot;</span>,
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a><span class=w>      </span><span class=s2>&quot;url&quot;</span>:<span class=w> </span><span class=s2>&quot;https://joostvdg.github.io&quot;</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=w>  </span><span class=o>]</span>,
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=w>  </span><span class=s2>&quot;invocationImages&quot;</span>:<span class=w> </span><span class=o>[</span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a><span class=w>    </span><span class=o>{</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=w>      </span><span class=s2>&quot;imageType&quot;</span>:<span class=w> </span><span class=s2>&quot;docker&quot;</span>,
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a><span class=w>      </span><span class=s2>&quot;image&quot;</span>:<span class=w> </span><span class=s2>&quot;deislabs/cnab-duffle-demo-1-cnab:2965aad7406e1b651a98fffe1194fcaaec5e623c&quot;</span>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a><span class=w>  </span><span class=o>]</span>,
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a><span class=w>  </span><span class=s2>&quot;images&quot;</span>:<span class=w> </span>null,
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a><span class=w>  </span><span class=s2>&quot;parameters&quot;</span>:<span class=w> </span>null,
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a><span class=w>  </span><span class=s2>&quot;credentials&quot;</span>:<span class=w> </span>null
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a><span class=o>}</span>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a>-----BEGIN<span class=w> </span>PGP<span class=w> </span>SIGNATURE-----
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a>wsDcBAEBCAAQBQJcL3L8CRDgq4YEOipZ/QAAjDYMAJI5o66SteUP2o4HsbVk+Viw
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a>3Fd874vSVmpPKcmN3tRCEDWGdMdvqQiirDpa//ghx4y5oFTahK2ihQ35GbJLlq8S
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a>v9/CK6CKGJtp5g38s2LZrKIvESzEF2lTXwHB03PG8PJ37iWiYkHkxvMpyzded3Rs
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a>4d+VgUnip0Cre7DemaUaz5+fTQjs88WNTIhqPg47YvgqFXV0s1y7yN3RTLr3ohQ1
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a>9mkw87nWfOD+ULpbCUaq9FhNZ+v4dK5IZcWlkyv+yrtguyBBiA3MC54ueVBAdFCl
</span><span id=__span-3-40><a id=__codelineno-3-40 name=__codelineno-3-40 href=#__codelineno-3-40></a>2OhxXgZjbBHPfQPV1mPqCQudOsWjK/+gqyNb6KTzKrAnyrumVQli/C/8BVk/SRC/
</span><span id=__span-3-41><a id=__codelineno-3-41 name=__codelineno-3-41 href=#__codelineno-3-41></a>GS2o4EdTS2lfREc2Gl0/VTmMkqzFZZhWd7pwt/iMjl0bICFehSU0N6OqN1d+v6Sq
</span><span id=__span-3-42><a id=__codelineno-3-42 name=__codelineno-3-42 href=#__codelineno-3-42></a>vWIZ5ppxt1NnCzp05Y+NRfVZOxBc2xjYTquFwIa/+qGPrmXBKamw/irjmCOndvx+
</span><span id=__span-3-43><a id=__codelineno-3-43 name=__codelineno-3-43 href=#__codelineno-3-43></a>l1tf/g0UVSQI2R2/19svl7dlMkYpDdlth1YGgZi/Hg<span class=o>==</span>
</span><span id=__span-3-44><a id=__codelineno-3-44 name=__codelineno-3-44 href=#__codelineno-3-44></a><span class=o>=</span>8Xwi
</span><span id=__span-3-45><a id=__codelineno-3-45 name=__codelineno-3-45 href=#__codelineno-3-45></a>-----END<span class=w> </span>PGP<span class=w> </span>SIGNATURE-----
</span></code></pre></div> <h4 id=demo>Demo<a class=headerlink href=#demo title="Permanent link">&para;</a></h4> <p>I've created a demo on GitHub: <a href=https://github.com/demomon/cnab-duffle-demo-1>github.com/demomon/cnab-duffle-demo-1</a></p> <p>Its goal is to install <a href=https://www.cloudbees.com/products/cloudbees-core>CloudBees Core</a> and its prerequisites in a (GKE) Kubernetes cluster.</p> <p>It wraps a Go (lang) binary that will execute the commands, for which you can find the source code <a href=https://github.com/joostvdg/k8s-gitops-installer>on GitHub</a>.</p> <h5 id=components>Components<a class=headerlink href=#components title="Permanent link">&para;</a></h5> <p>A CNAB bundle has some components by default, for this demo we needed the following:</p> <ul> <li><strong>duffle.json</strong>: Duffle configuration file</li> <li><strong>Dockerfile</strong>: the CNAB installer runtime</li> <li><strong>run</strong>(script): the installer script</li> <li><strong>kgi</strong>(binary): the binary executable from my k8s-gitops-installer code, that we will leverage for the installation</li> </ul> <h5 id=dockerfile>Dockerfile<a class=headerlink href=#dockerfile title="Permanent link">&para;</a></h5> <p>The installer tool (<code>kgi</code>) requires <code>Helm</code> and <code>Kubectl</code>, so we a Docker image that has those. As we might end up packaging the entire image as part of the full CNAB package, it should also be based on Alpine (or similar minimal Linux).</p> <p>There seems to be one very well maintained and widely used (according to GitHub and Dockerhub stats): <code>dtzar/helm-kubect</code>. So no need to roll our own.</p> <div class="language-Dockerfile highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>FROM</span><span class=w> </span><span class=s>dtzar/helm-kubectl:2.12.1</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>COPY</span><span class=w> </span>Dockerfile<span class=w> </span>/cnab/Dockerfile
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=k>COPY</span><span class=w> </span>app<span class=w> </span>/cnab/app
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=k>COPY</span><span class=w> </span>kgi<span class=w> </span>/usr/bin
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=k>RUN</span><span class=w> </span>ls<span class=w> </span>-lath<span class=w> </span>/cnab/app/
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=k>RUN</span><span class=w> </span>kgi<span class=w> </span>--help
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;/cnab/app/run&quot;</span><span class=p>]</span>
</span></code></pre></div> <h5 id=dufflejson>duffle.json<a class=headerlink href=#dufflejson title="Permanent link">&para;</a></h5> <p>The only thing we need to add beyond the auto-generated file, is the credentials section.</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nt>&quot;credentials&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>    </span><span class=nt>&quot;kubeconfig&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>        </span><span class=nt>&quot;path&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/cnab/app/kube-config&quot;</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=p>}</span>
</span></code></pre></div> <h5 id=kgi>kgi<a class=headerlink href=#kgi title="Permanent link">&para;</a></h5> <p>I pre-build a binary suitable for Linux that works in Alpine and included it in the CNAB folder.</p> <h5 id=run-script>run script<a class=headerlink href=#run-script title="Permanent link">&para;</a></h5> <p>First thing we need to make sure, is to configure the Kubeconfig location.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=nb>export</span><span class=w> </span><span class=nv>KUBECONFIG</span><span class=o>=</span><span class=s2>&quot;/cnab/app/kube-config&quot;</span>
</span></code></pre></div> <p>This should match what we defined in the <code>duffle.json</code> configuration - as you might expect - to make sure it gets bound in the right location. The <code>kubectl</code> command now knows which file to use.</p> <p>For the rest, we can do what we want, but convention tells us we need at least support <code>status</code>, <code>install</code> and <code>uninstall</code>. I'm lazy and only implemented <code>install</code> at the moment.</p> <p>In the install action, we will use the <code>kgi</code> executable to install CloudBees Core and it's pre-requisites.</p> <p><div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=nv>action</span><span class=o>=</span><span class=nv>$CNAB_ACTION</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=k>case</span><span class=w> </span><span class=nv>$action</span><span class=w> </span><span class=k>in</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>    </span>install<span class=o>)</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>        </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;[Install]&quot;</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>        </span>kgi<span class=w> </span>validate<span class=w> </span>kubectl
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=p>;;</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=k>esac</span>
</span></code></pre></div> For the rest, I recommend you look at the sources.</p> <h5 id=run-the-demo>Run the demo<a class=headerlink href=#run-the-demo title="Permanent link">&para;</a></h5> <p>First, we have to build the bundle.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>duffle<span class=w> </span>build<span class=w> </span>.
</span></code></pre></div> <p>Once the build succeeded, we can create a credentials configuration. This will be a separate configuration file managed by Duffle. This configuration config must then be used with any installation that requires it - which makes it reusable as well.</p> <p>We have to populate it with the credential. In this case a path to a kube-config file. If you do not have one that you can export - e.g. based on GCloud - you can create a new user/certificate with a script.</p> <p>This is taken from <a href=https://gravitational.com/blog/kubectl-gke/ >gravitational</a>, which were nice enough to create a script for doing so.</p> <p>You can find the script on <a href=https://github.com/gravitational/teleport/blob/master/examples/gke-auth/get-kubeconfig.sh>GitHub (get-kubeconfig.sh)</a>.</p> <p>Once you have that, store the end result at a decent place and configure it as your credential.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>duffle<span class=w> </span>creds<span class=w> </span>generate<span class=w> </span>demo1<span class=w> </span>cnab-duffle-demo-1
</span></code></pre></div> <p>With the above command we can create a credential config object based on the build bundle <code>cnab-duffle-demo-1</code>. The credential object will be <code>demo-1</code>, which we can now use for installing.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>duffle<span class=w> </span>install<span class=w> </span>demo1<span class=w> </span>cnab-duffle-demo-1:1.0.0<span class=w> </span>-c<span class=w> </span>demo1
</span></code></pre></div> <h4 id=further-reading>Further reading<a class=headerlink href=#further-reading title="Permanent link">&para;</a></h4> <ul> <li><a href=https://github.com/deislabs/duffle/blob/master/docs/guides/bundle-guide.md>Howto guide on creating a Duffle Bundle</a></li> <li><a href=https://github.com/deislabs/cnab-spec/blob/master/802-credential-sets.md>Howto on handling credentials</a></li> <li><a href=https://github.com/bitnami/cnab-bundles/tree/master/wordpress-k8s-rds>Wordpress with Kubernetes and AWS demo by Bitnami</a></li> <li><a href=https://github.com/deislabs/bundles>Example bundles</a></li> </ul> <h3 id=pulumi>Pulumi<a class=headerlink href=#pulumi title="Permanent link">&para;</a></h3> <p>Just pointing to the documentation and GitHub repository is a bit boring and most of all, lazy. So I've gone through the trouble to create a demo project that shows what Pulumi can do.</p> <p>One of the things to keep in mind is that Pulumi keeps its state in a remote location by default - Pulumi's SaaS service. Much like using an S3 bucket to store your Terraform state.</p> <p>The goal of the demo is to show what you can do with Pulumi. My personal opinion is that Pulumi is excellent for managing entire systems as code. From public cloud infrastructure to public open source resources right down to your applications and their configurations.</p> <p>The system that I've written with Pulumi is a CI/CD system running in a GKE cluster. The system contains Jenkins, Artifactory and a custom LDAP server.</p> <p>To make it interesting, we'll use different aspects of Pulumi to create the system. We will create the GKE cluster via Pulumi's wrapper for the <code>gcloud</code> cli - in a similar way as JenkinsX does -, install Jenkins and Artifactory via Helm and install the LDAP server via Pulumi's Kubernetes resource classes.</p> <h4 id=steps-taken>Steps taken<a class=headerlink href=#steps-taken title="Permanent link">&para;</a></h4> <ul> <li>For more info <a href=pulumi.io>Pulumi.io</a></li> <li>install: <code>brew install pulumi</code></li> <li>clone demo: <code>git clone https://github.com/demomon/pulumi-demo-1</code></li> <li>init stack: <code>pulumi stack init demomon-pulumi-demo-1</code><ul> <li>connect to GitHub</li> </ul> </li> <li>set kubernetes config <code>pulumi config set kubernetes:context gke_ps-dev-201405_europe-west4_joostvdg-reg-dec18-1</code></li> <li><code>pulumi config set isMinikube false</code></li> <li>install npm resources: <code>npm install</code> (I've used the TypeScript demo's)</li> <li><code>pulumi config set username administrator</code></li> <li><code>pulumi config set password 3OvlgaockdnTsYRU5JAcgM1o --secret</code></li> <li><code>pulumi preview</code></li> <li>incase pulumi loses your stack: <code>pulumi stack select demomon-pulumi-demo-1</code></li> <li><code>pulumi destroy</code></li> </ul> <p>Based on the following demo's:</p> <ul> <li><a href=https://pulumi.io/quickstart/kubernetes/tutorial-exposed-deployment.html>https://pulumi.io/quickstart/kubernetes/tutorial-exposed-deployment.html</a></li> <li><a href=https://github.com/pulumi/examples/tree/master/kubernetes-ts-jenkins>https://github.com/pulumi/examples/tree/master/kubernetes-ts-jenkins</a></li> </ul> <h4 id=artifactory-via-helm>Artifactory via Helm<a class=headerlink href=#artifactory-via-helm title="Permanent link">&para;</a></h4> <p>To install the helm charts of Artifactory using Helm, we will first need to add JFrog's repository.</p> <ul> <li><code>helm repo add jfrog https://charts.jfrog.io</code></li> <li><code>helm repo update</code></li> </ul> <h4 id=gke-cluster>GKE Cluster<a class=headerlink href=#gke-cluster title="Permanent link">&para;</a></h4> <p>Below is the code for the cluster.</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>import</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>gcp</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;@pulumi/gcp&quot;</span><span class=p>;</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=k>import</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>k8s</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;@pulumi/kubernetes&quot;</span><span class=p>;</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=k>import</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>pulumi</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;@pulumi/pulumi&quot;</span><span class=p>;</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>nodeCount</span><span class=p>,</span><span class=w> </span><span class=nx>nodeMachineType</span><span class=p>,</span><span class=w> </span><span class=nx>password</span><span class=p>,</span><span class=w> </span><span class=nx>username</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./gke-config&quot;</span><span class=p>;</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>k8sCluster</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>gcp</span><span class=p>.</span><span class=nx>container</span><span class=p>.</span><span class=nx>Cluster</span><span class=p>(</span><span class=s2>&quot;gke-cluster&quot;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;joostvdg-dec-2018-pulumi&quot;</span><span class=p>,</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>    </span><span class=nx>initialNodeCount</span><span class=o>:</span><span class=w> </span><span class=kt>nodeCount</span><span class=p>,</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>    </span><span class=nx>nodeVersion</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>    </span><span class=nx>minMasterVersion</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>    </span><span class=nx>nodeConfig</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>        </span><span class=nx>machineType</span><span class=o>:</span><span class=w> </span><span class=kt>nodeMachineType</span><span class=p>,</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>        </span><span class=nx>oauthScopes</span><span class=o>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>            </span><span class=s2>&quot;https://www.googleapis.com/auth/compute&quot;</span><span class=p>,</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>            </span><span class=s2>&quot;https://www.googleapis.com/auth/devstorage.read_only&quot;</span><span class=p>,</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>            </span><span class=s2>&quot;https://www.googleapis.com/auth/logging.write&quot;</span><span class=p>,</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>            </span><span class=s2>&quot;https://www.googleapis.com/auth/monitoring&quot;</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>        </span><span class=p>],</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=p>});</span>
</span></code></pre></div> <h5 id=gke-config>GKE Config<a class=headerlink href=#gke-config title="Permanent link">&para;</a></h5> <p>As you could see, we import variables from a configuration file <code>gke-config</code>.</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>Config</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;@pulumi/pulumi&quot;</span><span class=p>;</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=kd>const</span><span class=w> </span><span class=nx>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Config</span><span class=p>();</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>nodeCount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>getNumber</span><span class=p>(</span><span class=s2>&quot;nodeCount&quot;</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=mf>3</span><span class=p>;</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>nodeMachineType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&quot;nodeMachineType&quot;</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s2>&quot;n1-standard-2&quot;</span><span class=p>;</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=c1>// username is the admin username for the cluster.</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>username</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&quot;username&quot;</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s2>&quot;admin&quot;</span><span class=p>;</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=c1>// password is the password for the admin user in the cluster.</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>password</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>require</span><span class=p>(</span><span class=s2>&quot;password&quot;</span><span class=p>);</span>
</span></code></pre></div> <h5 id=kubeconfig>Kubeconfig<a class=headerlink href=#kubeconfig title="Permanent link">&para;</a></h5> <p>As you probably will want to install other things (Helm charts, services) inside this cluster, we need to make sure we get the <code>kubeconfig</code> file of our cluster - which is yet to be created. Below is the code - courtesy of <a href=https://github.com/pulumi/examples/tree/master/gcp-ts-gke>Pulumi's GKE Example</a> - that generates and exports the Kubernetes Client Configuration.</p> <p>This client configuration can then be used by Helm charts or other Kubernetes services. Pulumi will then also understand it depends on the cluster and create/update it first before moving on to the others.</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1>// Manufacture a GKE-style Kubeconfig. Note that this is slightly &quot;different&quot; because of the way GKE requires</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=c1>// gcloud to be in the picture for cluster authentication (rather than using the client cert/key directly).</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>k8sConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>pulumi</span><span class=p>.</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>    </span><span class=nx>all</span><span class=p>([</span><span class=w> </span><span class=nx>k8sCluster</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=nx>k8sCluster</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>,</span><span class=w> </span><span class=nx>k8sCluster</span><span class=p>.</span><span class=nx>masterAuth</span><span class=w> </span><span class=p>]).</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>    </span><span class=nx>apply</span><span class=p>(([</span><span class=w> </span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=nx>endpoint</span><span class=p>,</span><span class=w> </span><span class=nx>auth</span><span class=w> </span><span class=p>])</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>context</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=sb>`</span><span class=si>${</span><span class=nx>gcp</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>project</span><span class=si>}</span><span class=sb>_</span><span class=si>${</span><span class=nx>gcp</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>zone</span><span class=si>}</span><span class=sb>_</span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=sb>`apiVersion: v1</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=sb>clusters:</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=sb>- cluster:</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=sb>    certificate-authority-data: </span><span class=si>${</span><span class=nx>auth</span><span class=p>.</span><span class=nx>clusterCaCertificate</span><span class=si>}</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=sb>    server: https://</span><span class=si>${</span><span class=nx>endpoint</span><span class=si>}</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=sb>  name: </span><span class=si>${</span><span class=nx>context</span><span class=si>}</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=sb>contexts:</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=sb>- context:</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=sb>    cluster: </span><span class=si>${</span><span class=nx>context</span><span class=si>}</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=sb>    user: </span><span class=si>${</span><span class=nx>context</span><span class=si>}</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=sb>  name: </span><span class=si>${</span><span class=nx>context</span><span class=si>}</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=sb>current-context: </span><span class=si>${</span><span class=nx>context</span><span class=si>}</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=sb>kind: Config</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=sb>preferences: {}</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=sb>users:</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=sb>- name: </span><span class=si>${</span><span class=nx>context</span><span class=si>}</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=sb>  user:</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=sb>    auth-provider:</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=sb>      config:</span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=sb>        cmd-args: config config-helper --format=json</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a><span class=sb>        cmd-path: gcloud</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=sb>        expiry-key: &#39;{.credential.token_expiry}&#39;</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a><span class=sb>        token-key: &#39;{.credential.access_token}&#39;</span>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a><span class=sb>      name: gcp</span>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a><span class=sb>`</span><span class=p>;</span>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a>
</span><span id=__span-13-34><a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a><span class=c1>// Export a Kubernetes provider instance that uses our cluster from above.</span>
</span><span id=__span-13-35><a id=__codelineno-13-35 name=__codelineno-13-35 href=#__codelineno-13-35></a><span class=k>export</span><span class=w> </span><span class=kd>const</span><span class=w> </span><span class=nx>k8sProvider</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>k8s</span><span class=p>.</span><span class=nx>Provider</span><span class=p>(</span><span class=s2>&quot;gkeK8s&quot;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-36><a id=__codelineno-13-36 name=__codelineno-13-36 href=#__codelineno-13-36></a><span class=w>    </span><span class=nx>kubeconfig</span><span class=o>:</span><span class=w> </span><span class=kt>k8sConfig</span><span class=p>,</span>
</span><span id=__span-13-37><a id=__codelineno-13-37 name=__codelineno-13-37 href=#__codelineno-13-37></a><span class=p>});</span>
</span></code></pre></div> <h4 id=pulumi-gcp-config>Pulumi GCP Config<a class=headerlink href=#pulumi-gcp-config title="Permanent link">&para;</a></h4> <ul> <li><a href=https://github.com/pulumi/examples/blob/master/gcp-ts-gke/README.md>https://github.com/pulumi/examples/blob/master/gcp-ts-gke/README.md</a></li> </ul> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nb>export</span><span class=w> </span><span class=nv>GCP_PROJECT</span><span class=o>=</span>...
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=nb>export</span><span class=w> </span><span class=nv>GCP_ZONE</span><span class=o>=</span>europe-west4-a
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=nb>export</span><span class=w> </span><span class=nv>CLUSTER_PASSWORD</span><span class=o>=</span>...
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=nb>export</span><span class=w> </span><span class=nv>GCP_SA_NAME</span><span class=o>=</span>...
</span></code></pre></div> <p>Make sure you have a Google SA (Service Account) by that name first, as you can <a href=https://pulumi.io/quickstart/gcp/index.html>read here</a>. For me it worked best to NOT set any environment variables mentioned. They invairably caused authentication or authorization issues. Just make sure the SA account and it's credential file (see below) are authorized and the <code>gcloud</code> cli works.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>gcloud<span class=w> </span>iam<span class=w> </span>service-accounts<span class=w> </span>keys<span class=w> </span>create<span class=w> </span>gcp-credentials.json<span class=w> </span><span class=se>\</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>    </span>--iam-account<span class=w> </span><span class=si>${</span><span class=nv>GCP_SA_NAME</span><span class=si>}</span>@<span class=si>${</span><span class=nv>GCP_PROJECT</span><span class=si>}</span>.iam.gserviceaccount.com
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>gcloud<span class=w> </span>auth<span class=w> </span>activate-service-account<span class=w> </span>--key-file<span class=w> </span>gcp-credentials.json
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>gcloud<span class=w> </span>auth<span class=w> </span>application-default<span class=w> </span>login
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>pulumi<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>gcp:project<span class=w> </span><span class=si>${</span><span class=nv>GCP_PROJECT</span><span class=si>}</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>pulumi<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>gcp:zone<span class=w> </span><span class=si>${</span><span class=nv>GCP_ZONE</span><span class=si>}</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>pulumi<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>password<span class=w> </span>--secret<span class=w> </span><span class=si>${</span><span class=nv>CLUSTER_PASSWORD</span><span class=si>}</span>
</span></code></pre></div> <h5 id=post-cluster-creation>Post Cluster Creation<a class=headerlink href=#post-cluster-creation title="Permanent link">&para;</a></h5> <div class="language-bash highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>gcloud<span class=w> </span>container<span class=w> </span>clusters<span class=w> </span>get-credentials<span class=w> </span>joostvdg-dec-2018-pulumi
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>kubectl<span class=w> </span>create<span class=w> </span>clusterrolebinding<span class=w> </span>cluster-admin-binding<span class=w>  </span>--clusterrole<span class=w> </span>cluster-admin<span class=w>  </span>--user<span class=w> </span><span class=k>$(</span>gcloud<span class=w> </span>config<span class=w> </span>get-value<span class=w> </span>account<span class=k>)</span>
</span></code></pre></div> <h5 id=install-failed>Install failed<a class=headerlink href=#install-failed title="Permanent link">&para;</a></h5> <p>Failed to install <code>kubernetes:rbac.authorization.k8s.io:Role artifactory-artifactory</code>.</p> <p>Probably due to missing rights, so probably have to execute the admin binding before the helm charts.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>error:<span class=w> </span>Plan<span class=w> </span>apply<span class=w> </span>failed:<span class=w> </span>roles.rbac.authorization.k8s.io<span class=w> </span><span class=s2>&quot;artifactory-artifactory&quot;</span><span class=w> </span>is<span class=w> </span>forbidden:<span class=w> </span>attempt<span class=w> </span>to<span class=w> </span>grant<span class=w> </span>extra<span class=w> </span>privileges:<span class=w> </span>...
</span></code></pre></div> <h4 id=helm-charts>Helm Charts<a class=headerlink href=#helm-charts title="Permanent link">&para;</a></h4> <p>Using Pulumi to install a Helm Chart feels a bit like adding layers of wrapping upon wrapping. The power of Pulumi becomes visible when using more than one related service on the same cluster - for example a SDLC Tool Chain.</p> <p>This example application installs two helm charts, Jenkins and Artifactory, on a GKE cluster that is also created and managed by Pulumi.</p> <p>Below is an example of installing a Helm chart of Jenkins, where we provide the Kubernetes config from the GKE cluster as Provider. This way, Pulumi knows it must install the helm chart in that GKE cluster and not in the current Kubeconfig.</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>k8sProvider</span><span class=p>,</span><span class=w> </span><span class=nx>k8sConfig</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./gke-cluster&quot;</span><span class=p>;</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=kd>const</span><span class=w> </span><span class=nx>jenkins</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>k8s</span><span class=p>.</span><span class=nx>helm</span><span class=p>.</span><span class=nx>v2</span><span class=p>.</span><span class=nx>Chart</span><span class=p>(</span><span class=s2>&quot;jenkins&quot;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>    </span><span class=nx>repo</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;stable&quot;</span><span class=p>,</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>    </span><span class=nx>version</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;0.25.1&quot;</span><span class=p>,</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>    </span><span class=nx>chart</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;jenkins&quot;</span><span class=p>,</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>{</span><span class=w> </span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>        </span><span class=nx>providers</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>kubernetes</span><span class=o>:</span><span class=w> </span><span class=kt>k8sProvider</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=p>);</span>
</span></code></pre></div> <h4 id=deployment-service>Deployment &amp; Service<a class=headerlink href=#deployment-service title="Permanent link">&para;</a></h4> <p>First, make sure you have an interface for the configuration arguments.</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=k>export</span><span class=w> </span><span class=kd>interface</span><span class=w> </span><span class=nx>LdapArgs</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=w>    </span><span class=k>readonly</span><span class=w> </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>,</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>    </span><span class=k>readonly</span><span class=w> </span><span class=nx>imageName</span><span class=o>:</span><span class=w> </span><span class=kt>string</span><span class=p>,</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>    </span><span class=k>readonly</span><span class=w> </span><span class=nx>imageTag</span><span class=o>:</span><span class=w> </span><span class=kt>string</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=p>}</span>
</span></code></pre></div> <p>Then, create a exportable Pulumi resource class that can be reused.</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=k>export</span><span class=w> </span><span class=kd>class</span><span class=w> </span><span class=nx>LdapInstallation</span><span class=w> </span><span class=k>extends</span><span class=w> </span><span class=nx>pulumi</span><span class=p>.</span><span class=nx>ComponentResource</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w>    </span><span class=k>public</span><span class=w> </span><span class=k>readonly</span><span class=w> </span><span class=nx>deployment</span><span class=o>:</span><span class=w> </span><span class=kt>k8s.apps.v1.Deployment</span><span class=p>;</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>    </span><span class=k>public</span><span class=w> </span><span class=k>readonly</span><span class=w> </span><span class=nx>service</span><span class=o>:</span><span class=w> </span><span class=kt>k8s.core.v1.Service</span><span class=p>;</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>    </span><span class=c1>// constructor</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=p>}</span>
</span></code></pre></div> <p>Inside the constructor placehold we will create a constructor method. It will do all the configuration we need to do for this resource, in this case a Kubernetes Service and Deployment.</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=kr>constructor</span><span class=p>(</span><span class=nx>args</span><span class=o>:</span><span class=w> </span><span class=kt>LdapArgs</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>    </span><span class=k>super</span><span class=p>(</span><span class=s2>&quot;k8stypes:service:LdapInstallation&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>args</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=p>{});</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>labels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>app</span><span class=o>:</span><span class=w> </span><span class=kt>args.name</span><span class=w> </span><span class=p>};</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>args</span><span class=p>.</span><span class=nx>name</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=p>}</span>
</span></code></pre></div> <p>First Kubernetes resource to create is a container specification for the Deployment.</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=kd>const</span><span class=w> </span><span class=nx>container</span><span class=o>:</span><span class=w> </span><span class=kt>k8stypes.core.v1.Container</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=w>    </span><span class=nx>name</span><span class=p>,</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>    </span><span class=nx>image</span><span class=o>:</span><span class=w> </span><span class=kt>args.imageName</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;:&quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>args</span><span class=p>.</span><span class=nx>imageTag</span><span class=p>,</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>    </span><span class=nx>resources</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>        </span><span class=nx>requests</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>cpu</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;100m&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>memory</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;200Mi&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=w>        </span><span class=nx>limits</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>cpu</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;100m&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>memory</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;200Mi&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>    </span><span class=nx>ports</span><span class=o>:</span><span class=w> </span><span class=p>[{</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>            </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;ldap&quot;</span><span class=p>,</span><span class=nx>containerPort</span><span class=o>:</span><span class=w> </span><span class=kt>1389</span><span class=p>,</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>    </span><span class=p>]</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=p>};</span>
</span></code></pre></div> <p>As the configuration arguments can be any TypeScript type, you can allow people to override entire segments (such as Resources). Which you would do as follows:</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=w>    </span><span class=nx>resources</span><span class=o>:</span><span class=w> </span><span class=kt>args.resources</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=w>        </span><span class=nx>requests</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>cpu</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;100m&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>memory</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;200Mi&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>        </span><span class=nx>limits</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>cpu</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;100m&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>memory</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;200Mi&quot;</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class=p>},</span>
</span></code></pre></div> <p>The Deployment and Service construction are quite similar.</p> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=k>this</span><span class=p>.</span><span class=nx>deployment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>k8s</span><span class=p>.</span><span class=nx>apps</span><span class=p>.</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Deployment</span><span class=p>(</span><span class=nx>args</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=w>    </span><span class=nx>spec</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>        </span><span class=nx>selector</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>matchLabels</span><span class=o>:</span><span class=w> </span><span class=kt>labels</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>        </span><span class=nx>replicas</span><span class=o>:</span><span class=w> </span><span class=kt>1</span><span class=p>,</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>        </span><span class=nx>template</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=w>            </span><span class=nx>metadata</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>labels</span><span class=o>:</span><span class=w> </span><span class=kt>labels</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=w>            </span><span class=nx>spec</span><span class=o>:</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>containers</span><span class=o>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=nx>container</span><span class=w> </span><span class=p>]</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>        </span><span class=p>},</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=p>},{</span><span class=w> </span><span class=nx>provider</span><span class=o>:</span><span class=w> </span><span class=kt>cluster.k8sProvider</span><span class=w> </span><span class=p>});</span>
</span></code></pre></div> <div class="language-typescript highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=k>this</span><span class=p>.</span><span class=nx>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>k8s</span><span class=p>.</span><span class=nx>core</span><span class=p>.</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Service</span><span class=p>(</span><span class=nx>args</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=w>    </span><span class=nx>metadata</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>        </span><span class=nx>labels</span><span class=o>:</span><span class=w> </span><span class=kt>this.deployment.metadata.apply</span><span class=p>(</span><span class=nx>meta</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>meta</span><span class=p>.</span><span class=nx>labels</span><span class=p>),</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>    </span><span class=nx>spec</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>        </span><span class=nx>ports</span><span class=o>:</span><span class=w> </span><span class=p>[{</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>                </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;ldap&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>port</span><span class=o>:</span><span class=w> </span><span class=kt>389</span><span class=p>,</span><span class=w> </span><span class=nx>targetPort</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;ldap&quot;</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=nx>protocol</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;TCP&quot;</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=w>            </span><span class=p>},</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=w>        </span><span class=p>],</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=w>        </span><span class=nx>selector</span><span class=o>:</span><span class=w> </span><span class=kt>this.deployment.spec.apply</span><span class=p>(</span><span class=nx>spec</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>spec</span><span class=p>.</span><span class=nx>template</span><span class=p>.</span><span class=nx>metadata</span><span class=p>.</span><span class=nx>labels</span><span class=p>),</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=w>        </span><span class=kr>type</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;ClusterIP&quot;</span><span class=p>,</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=p>},</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>provider</span><span class=o>:</span><span class=w> </span><span class=kt>cluster.k8sProvider</span><span class=w> </span><span class=p>});</span>
</span></code></pre></div> <h2 id=jfrog-jenkins-challenge>JFrog Jenkins Challenge<a class=headerlink href=#jfrog-jenkins-challenge title="Permanent link">&para;</a></h2> <p>Visited the stand of JFrog where they had stories about two main products: Artifactory and X-Ray.</p> <p>For both there is a Challenge, <a href=https://jfrog.com/content/xray-challenge/ >an X-Ray Challenge</a> and <a href=https://jfrog.com/content/jenkins-challenge>a Jenkins &amp; Artifactory Challenge</a>.</p> <h3 id=jenkins-challenge>Jenkins Challenge<a class=headerlink href=#jenkins-challenge title="Permanent link">&para;</a></h3> <p>The instructions for the Challenge were simply, follow what is stated <a href=https://github.com/jbaruch/jenkins-challenge>in their GitHub repository</a> and email a screenshot of the result.</p> <p>The instruction were as follows:</p> <ol> <li>Get an Artifactory instance (you can start a free trial on prem or in the cloud)</li> <li>Install Jenkins</li> <li>Install Artifactory Jenkins Plugin</li> <li>Add Artifactory credentials to Jenkins Credentials</li> <li>Create a new pipeline job</li> <li>Use the Artifactory Plugin DSL documentation to complete the following script:</li> </ol> <p>With a Scripted Pipeline as starting point:</p> <div class="language-groovy highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=n>node</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=w>    </span><span class=kt>def</span><span class=w> </span><span class=n>rtServer</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=w>    </span><span class=kt>def</span><span class=w> </span><span class=n>rtGradle</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>    </span><span class=kt>def</span><span class=w> </span><span class=n>buildInfo</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=w>    </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Preparation&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=w>        </span><span class=n>git</span><span class=w> </span><span class=s1>&#39;https://github.com/jbaruch/gradle-example.git&#39;</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=w>        </span><span class=c1>// create a new Artifactory server using the credentials defined in Jenkins </span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>        </span><span class=c1>// create a new Gradle build</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=w>        </span><span class=c1>// set the resolver to the Gradle build to resolve from Artifactory</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=w>        </span><span class=c1>// set the deployer to the Gradle build to deploy to Artifactory</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=w>        </span><span class=c1>// declare that your gradle script does not use Artifactory plugin</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=w>        </span><span class=c1>// declare that your gradle script uses Gradle wrapper</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=w>    </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Build&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=w>        </span><span class=c1>//run the artifactoryPublish gradle task and collect the build info</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=w>    </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Publish Build Info&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=w>        </span><span class=c1>//collect the environment variables to build info</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=w>        </span><span class=c1>//publish the build info</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=o>}</span>
</span></code></pre></div> <p>I don't like scripted, so I opted for Declarative with Jenkins in Kubernetes with the Jenkins Kubernetes plugin.</p> <p>Steps I took:</p> <ul> <li>get a trial license from the <a href=https://www.jfrog.com/artifactory/free-trial/ >JFrog website</a></li> <li>install Artifactory<ul> <li>and copy in the license when prompted</li> <li>change admin password</li> <li>create local maven repo 'libs-snapshot-local'</li> <li>create remote maven repo 'jcenter' (default remote value is jcenter, so only have to set the name)</li> </ul> </li> <li>install Jenkins<ul> <li>Artifactory plugin</li> <li>Kubernetes plugin</li> </ul> </li> <li>add Artifactory username/password as credential in Jenkins</li> <li>create a gradle application (Spring boot via start.spring.io) which <a href=https://github.com/demomon/gradle-jenkins-challenge>you can find here</a></li> <li>create a Jenkinsfile</li> </ul> <h4 id=installing-artifactory>Installing Artifactory<a class=headerlink href=#installing-artifactory title="Permanent link">&para;</a></h4> <p>I installed Artifactory via Helm. JFrog has their own Helm repository - of course, would weird otherwise tbh - and you have to add that first.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>jfrog<span class=w> </span>https://charts.jfrog.io
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>helm<span class=w> </span>install<span class=w> </span>--name<span class=w> </span>artifactory<span class=w> </span>stable/artifactory
</span></code></pre></div> <h4 id=jenkinsfile>Jenkinsfile<a class=headerlink href=#jenkinsfile title="Permanent link">&para;</a></h4> <p>This uses the Gradle wrapper - as per instructions in the challenge.</p> <p>So we can use the standard JNLP container, which is default, so <code>agent any</code> will do.</p> <div class="language-groovy highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=n>pipeline</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=w>    </span><span class=n>agent</span><span class=w> </span><span class=n>any</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>    </span><span class=n>environment</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>        </span><span class=n>rtServer</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w>        </span><span class=n>rtGradle</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=w>        </span><span class=n>buildInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>        </span><span class=n>artifactoryServerAddress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;http://..../artifactory&#39;</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=w>    </span><span class=n>stages</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Test Container&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=w>                </span><span class=n>container</span><span class=o>(</span><span class=s1>&#39;gradle&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=w>                    </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;which gradle&#39;</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=w>                    </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;uname -a&#39;</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=w>                    </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;gradle -version&#39;</span>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-29-17><a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-29-18><a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-29-19><a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Checkout&#39;</span><span class=o>){</span>
</span><span id=__span-29-20><a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-21><a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a><span class=w>                </span><span class=n>git</span><span class=w> </span><span class=s1>&#39;https://github.com/demomon/gradle-jenkins-challenge.git&#39;</span>
</span><span id=__span-29-22><a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-29-23><a id=__codelineno-29-23 name=__codelineno-29-23 href=#__codelineno-29-23></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-29-24><a id=__codelineno-29-24 name=__codelineno-29-24 href=#__codelineno-29-24></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Preparation&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-25><a id=__codelineno-29-25 name=__codelineno-29-25 href=#__codelineno-29-25></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-26><a id=__codelineno-29-26 name=__codelineno-29-26 href=#__codelineno-29-26></a><span class=w>                </span><span class=n>script</span><span class=o>{</span>
</span><span id=__span-29-27><a id=__codelineno-29-27 name=__codelineno-29-27 href=#__codelineno-29-27></a><span class=w>                    </span><span class=c1>// create a new Artifactory server using the credentials defined in Jenkins </span>
</span><span id=__span-29-28><a id=__codelineno-29-28 name=__codelineno-29-28 href=#__codelineno-29-28></a><span class=w>                    </span><span class=n>rtServer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Artifactory</span><span class=o>.</span><span class=na>newServer</span><span class=w> </span><span class=nl>url:</span><span class=w> </span><span class=n>artifactoryServerAddress</span><span class=o>,</span><span class=w> </span><span class=nl>credentialsId:</span><span class=w> </span><span class=s1>&#39;art-admin&#39;</span>
</span><span id=__span-29-29><a id=__codelineno-29-29 name=__codelineno-29-29 href=#__codelineno-29-29></a>
</span><span id=__span-29-30><a id=__codelineno-29-30 name=__codelineno-29-30 href=#__codelineno-29-30></a><span class=w>                    </span><span class=c1>// create a new Gradle build</span>
</span><span id=__span-29-31><a id=__codelineno-29-31 name=__codelineno-29-31 href=#__codelineno-29-31></a><span class=w>                    </span><span class=n>rtGradle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Artifactory</span><span class=o>.</span><span class=na>newGradleBuild</span><span class=o>()</span>
</span><span id=__span-29-32><a id=__codelineno-29-32 name=__codelineno-29-32 href=#__codelineno-29-32></a>
</span><span id=__span-29-33><a id=__codelineno-29-33 name=__codelineno-29-33 href=#__codelineno-29-33></a><span class=w>                    </span><span class=c1>// set the resolver to the Gradle build to resolve from Artifactory</span>
</span><span id=__span-29-34><a id=__codelineno-29-34 name=__codelineno-29-34 href=#__codelineno-29-34></a><span class=w>                    </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>resolver</span><span class=w> </span><span class=nl>repo:</span><span class=s1>&#39;jcenter&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>server:</span><span class=w> </span><span class=n>rtServer</span>
</span><span id=__span-29-35><a id=__codelineno-29-35 name=__codelineno-29-35 href=#__codelineno-29-35></a>
</span><span id=__span-29-36><a id=__codelineno-29-36 name=__codelineno-29-36 href=#__codelineno-29-36></a><span class=w>                    </span><span class=c1>// set the deployer to the Gradle build to deploy to Artifactory</span>
</span><span id=__span-29-37><a id=__codelineno-29-37 name=__codelineno-29-37 href=#__codelineno-29-37></a><span class=w>                    </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>deployer</span><span class=w> </span><span class=nl>repo:</span><span class=s1>&#39;libs-snapshot-local&#39;</span><span class=o>,</span><span class=w>  </span><span class=nl>server:</span><span class=w> </span><span class=n>rtServer</span>
</span><span id=__span-29-38><a id=__codelineno-29-38 name=__codelineno-29-38 href=#__codelineno-29-38></a>
</span><span id=__span-29-39><a id=__codelineno-29-39 name=__codelineno-29-39 href=#__codelineno-29-39></a><span class=w>                    </span><span class=c1>// declare that your gradle script does not use Artifactory plugin</span>
</span><span id=__span-29-40><a id=__codelineno-29-40 name=__codelineno-29-40 href=#__codelineno-29-40></a><span class=w>                    </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>usesPlugin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span>
</span><span id=__span-29-41><a id=__codelineno-29-41 name=__codelineno-29-41 href=#__codelineno-29-41></a>
</span><span id=__span-29-42><a id=__codelineno-29-42 name=__codelineno-29-42 href=#__codelineno-29-42></a><span class=w>                    </span><span class=c1>// declare that your gradle script uses Gradle wrapper</span>
</span><span id=__span-29-43><a id=__codelineno-29-43 name=__codelineno-29-43 href=#__codelineno-29-43></a><span class=w>                    </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>useWrapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-29-44><a id=__codelineno-29-44 name=__codelineno-29-44 href=#__codelineno-29-44></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-29-45><a id=__codelineno-29-45 name=__codelineno-29-45 href=#__codelineno-29-45></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-29-46><a id=__codelineno-29-46 name=__codelineno-29-46 href=#__codelineno-29-46></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-29-47><a id=__codelineno-29-47 name=__codelineno-29-47 href=#__codelineno-29-47></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Build&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-48><a id=__codelineno-29-48 name=__codelineno-29-48 href=#__codelineno-29-48></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-49><a id=__codelineno-29-49 name=__codelineno-29-49 href=#__codelineno-29-49></a><span class=w>                </span><span class=n>script</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-50><a id=__codelineno-29-50 name=__codelineno-29-50 href=#__codelineno-29-50></a><span class=w>                    </span><span class=c1>//run the artifactoryPublish gradle task and collect the build info</span>
</span><span id=__span-29-51><a id=__codelineno-29-51 name=__codelineno-29-51 href=#__codelineno-29-51></a><span class=w>                    </span><span class=n>buildInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>run</span><span class=w> </span><span class=nl>buildFile:</span><span class=w> </span><span class=s1>&#39;build.gradle&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>tasks:</span><span class=w> </span><span class=s1>&#39;clean build artifactoryPublish&#39;</span>
</span><span id=__span-29-52><a id=__codelineno-29-52 name=__codelineno-29-52 href=#__codelineno-29-52></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-29-53><a id=__codelineno-29-53 name=__codelineno-29-53 href=#__codelineno-29-53></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-29-54><a id=__codelineno-29-54 name=__codelineno-29-54 href=#__codelineno-29-54></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-29-55><a id=__codelineno-29-55 name=__codelineno-29-55 href=#__codelineno-29-55></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Publish Build Info&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-56><a id=__codelineno-29-56 name=__codelineno-29-56 href=#__codelineno-29-56></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-57><a id=__codelineno-29-57 name=__codelineno-29-57 href=#__codelineno-29-57></a><span class=w>                </span><span class=n>script</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-29-58><a id=__codelineno-29-58 name=__codelineno-29-58 href=#__codelineno-29-58></a><span class=w>                    </span><span class=c1>//collect the environment variables to build info</span>
</span><span id=__span-29-59><a id=__codelineno-29-59 name=__codelineno-29-59 href=#__codelineno-29-59></a><span class=w>                    </span><span class=n>buildInfo</span><span class=o>.</span><span class=na>env</span><span class=o>.</span><span class=na>capture</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-29-60><a id=__codelineno-29-60 name=__codelineno-29-60 href=#__codelineno-29-60></a><span class=w>                    </span><span class=c1>//publish the build info</span>
</span><span id=__span-29-61><a id=__codelineno-29-61 name=__codelineno-29-61 href=#__codelineno-29-61></a><span class=w>                    </span><span class=n>rtServer</span><span class=o>.</span><span class=na>publishBuildInfo</span><span class=w> </span><span class=n>buildInfo</span>
</span><span id=__span-29-62><a id=__codelineno-29-62 name=__codelineno-29-62 href=#__codelineno-29-62></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-29-63><a id=__codelineno-29-63 name=__codelineno-29-63 href=#__codelineno-29-63></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-29-64><a id=__codelineno-29-64 name=__codelineno-29-64 href=#__codelineno-29-64></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-29-65><a id=__codelineno-29-65 name=__codelineno-29-65 href=#__codelineno-29-65></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-29-66><a id=__codelineno-29-66 name=__codelineno-29-66 href=#__codelineno-29-66></a><span class=o>}</span>
</span></code></pre></div> <h4 id=jenkinsfile-without-gradle-wrapper>Jenkinsfile without Gradle Wrapper<a class=headerlink href=#jenkinsfile-without-gradle-wrapper title="Permanent link">&para;</a></h4> <p>I'd rather not install the Gradle tool if I can just use a pre-build container with it.</p> <p>Unfortunately, to use it correctly with the Artifactory plugin and a Jenkins Kubernetes plugin, we need to do two things.</p> <ol> <li>create a <code>Gradle</code> Tool in the Jenkins master<ul> <li>because the Artifactory plugin expects a <code>Jenkins Tool</code> object, not a location</li> <li>Manage Jenkins -&gt; Global Tool Configuration -&gt; Gradle -&gt; Add</li> <li>As value supply <code>/usr</code>, the Artifactory build will add <code>/gradle/bin</code> to it automatically</li> </ul> </li> <li>set the user of build Pod to id <code>1000</code> explicitly<ul> <li>else the build will not be allowed to touch files in <code>/home/jenkins/workspace</code></li> </ul> </li> </ol> <div class="language-groovy highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=n>pipeline</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=w>    </span><span class=n>agent</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=w>        </span><span class=n>kubernetes</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=w>        </span><span class=n>label</span><span class=w> </span><span class=s1>&#39;mypod&#39;</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=w>        </span><span class=n>yaml</span><span class=w> </span><span class=s2>&quot;&quot;&quot;apiVersion: v1</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=s2>kind: Pod</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=s2>spec:</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=s2>  securityContext:</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=s2>    runAsUser: 1000</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=s2>    fsGroup: 1000</span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=s2>  containers:</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=s2>  - name: gradle</span>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=s2>    image: gradle:4.10-jdk-alpine</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=s2>    command: [&#39;cat&#39;]</span>
</span><span id=__span-30-15><a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=s2>    tty: true</span>
</span><span id=__span-30-16><a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-30-17><a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-18><a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-30-19><a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=w>    </span><span class=n>environment</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-20><a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a><span class=w>        </span><span class=n>rtServer</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span>
</span><span id=__span-30-21><a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a><span class=w>        </span><span class=n>rtGradle</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span>
</span><span id=__span-30-22><a id=__codelineno-30-22 name=__codelineno-30-22 href=#__codelineno-30-22></a><span class=w>        </span><span class=n>buildInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;&#39;</span>
</span><span id=__span-30-23><a id=__codelineno-30-23 name=__codelineno-30-23 href=#__codelineno-30-23></a><span class=w>        </span><span class=n>CONTAINER_GRADLE_TOOL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;/usr/bin/gradle&#39;</span>
</span><span id=__span-30-24><a id=__codelineno-30-24 name=__codelineno-30-24 href=#__codelineno-30-24></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-30-25><a id=__codelineno-30-25 name=__codelineno-30-25 href=#__codelineno-30-25></a><span class=w>    </span><span class=n>stages</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-26><a id=__codelineno-30-26 name=__codelineno-30-26 href=#__codelineno-30-26></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Test Container&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-27><a id=__codelineno-30-27 name=__codelineno-30-27 href=#__codelineno-30-27></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-28><a id=__codelineno-30-28 name=__codelineno-30-28 href=#__codelineno-30-28></a><span class=w>                </span><span class=n>container</span><span class=o>(</span><span class=s1>&#39;gradle&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-29><a id=__codelineno-30-29 name=__codelineno-30-29 href=#__codelineno-30-29></a><span class=w>                    </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;which gradle&#39;</span>
</span><span id=__span-30-30><a id=__codelineno-30-30 name=__codelineno-30-30 href=#__codelineno-30-30></a><span class=w>                    </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;uname -a&#39;</span>
</span><span id=__span-30-31><a id=__codelineno-30-31 name=__codelineno-30-31 href=#__codelineno-30-31></a><span class=w>                    </span><span class=n>sh</span><span class=w> </span><span class=s1>&#39;gradle -version&#39;</span>
</span><span id=__span-30-32><a id=__codelineno-30-32 name=__codelineno-30-32 href=#__codelineno-30-32></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-30-33><a id=__codelineno-30-33 name=__codelineno-30-33 href=#__codelineno-30-33></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-34><a id=__codelineno-30-34 name=__codelineno-30-34 href=#__codelineno-30-34></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-35><a id=__codelineno-30-35 name=__codelineno-30-35 href=#__codelineno-30-35></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Checkout&#39;</span><span class=o>){</span>
</span><span id=__span-30-36><a id=__codelineno-30-36 name=__codelineno-30-36 href=#__codelineno-30-36></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-37><a id=__codelineno-30-37 name=__codelineno-30-37 href=#__codelineno-30-37></a><span class=w>                </span><span class=c1>// git &#39;https://github.com/demomon/gradle-jenkins-challenge.git&#39;</span>
</span><span id=__span-30-38><a id=__codelineno-30-38 name=__codelineno-30-38 href=#__codelineno-30-38></a><span class=w>        </span><span class=n>checkout</span><span class=w> </span><span class=n>scm</span>
</span><span id=__span-30-39><a id=__codelineno-30-39 name=__codelineno-30-39 href=#__codelineno-30-39></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-40><a id=__codelineno-30-40 name=__codelineno-30-40 href=#__codelineno-30-40></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-41><a id=__codelineno-30-41 name=__codelineno-30-41 href=#__codelineno-30-41></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Preparation&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-42><a id=__codelineno-30-42 name=__codelineno-30-42 href=#__codelineno-30-42></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-43><a id=__codelineno-30-43 name=__codelineno-30-43 href=#__codelineno-30-43></a><span class=w>                </span><span class=n>script</span><span class=o>{</span>
</span><span id=__span-30-44><a id=__codelineno-30-44 name=__codelineno-30-44 href=#__codelineno-30-44></a><span class=w>                    </span><span class=c1>// create a new Artifactory server using the credentials defined in Jenkins </span>
</span><span id=__span-30-45><a id=__codelineno-30-45 name=__codelineno-30-45 href=#__codelineno-30-45></a><span class=w>                    </span><span class=n>rtServer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Artifactory</span><span class=o>.</span><span class=na>newServer</span><span class=w> </span><span class=nl>url:</span><span class=w> </span><span class=s1>&#39;http://35.204.238.14/artifactory&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>credentialsId:</span><span class=w> </span><span class=s1>&#39;art-admin&#39;</span>
</span><span id=__span-30-46><a id=__codelineno-30-46 name=__codelineno-30-46 href=#__codelineno-30-46></a>
</span><span id=__span-30-47><a id=__codelineno-30-47 name=__codelineno-30-47 href=#__codelineno-30-47></a><span class=w>                    </span><span class=c1>// create a new Gradle build</span>
</span><span id=__span-30-48><a id=__codelineno-30-48 name=__codelineno-30-48 href=#__codelineno-30-48></a><span class=w>                    </span><span class=n>rtGradle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Artifactory</span><span class=o>.</span><span class=na>newGradleBuild</span><span class=o>()</span>
</span><span id=__span-30-49><a id=__codelineno-30-49 name=__codelineno-30-49 href=#__codelineno-30-49></a>
</span><span id=__span-30-50><a id=__codelineno-30-50 name=__codelineno-30-50 href=#__codelineno-30-50></a><span class=w>                    </span><span class=c1>// set the resolver to the Gradle build to resolve from Artifactory</span>
</span><span id=__span-30-51><a id=__codelineno-30-51 name=__codelineno-30-51 href=#__codelineno-30-51></a><span class=w>                    </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>resolver</span><span class=w> </span><span class=nl>repo:</span><span class=s1>&#39;jcenter&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>server:</span><span class=w> </span><span class=n>rtServer</span>
</span><span id=__span-30-52><a id=__codelineno-30-52 name=__codelineno-30-52 href=#__codelineno-30-52></a>
</span><span id=__span-30-53><a id=__codelineno-30-53 name=__codelineno-30-53 href=#__codelineno-30-53></a><span class=w>                    </span><span class=c1>// set the deployer to the Gradle build to deploy to Artifactory</span>
</span><span id=__span-30-54><a id=__codelineno-30-54 name=__codelineno-30-54 href=#__codelineno-30-54></a><span class=w>                    </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>deployer</span><span class=w> </span><span class=nl>repo:</span><span class=s1>&#39;libs-snapshot-local&#39;</span><span class=o>,</span><span class=w>  </span><span class=nl>server:</span><span class=w> </span><span class=n>rtServer</span>
</span><span id=__span-30-55><a id=__codelineno-30-55 name=__codelineno-30-55 href=#__codelineno-30-55></a>
</span><span id=__span-30-56><a id=__codelineno-30-56 name=__codelineno-30-56 href=#__codelineno-30-56></a><span class=w>                    </span><span class=c1>// declare that your gradle script does not use Artifactory plugin</span>
</span><span id=__span-30-57><a id=__codelineno-30-57 name=__codelineno-30-57 href=#__codelineno-30-57></a><span class=w>                    </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>usesPlugin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span>
</span><span id=__span-30-58><a id=__codelineno-30-58 name=__codelineno-30-58 href=#__codelineno-30-58></a>
</span><span id=__span-30-59><a id=__codelineno-30-59 name=__codelineno-30-59 href=#__codelineno-30-59></a><span class=w>                    </span><span class=c1>// declare that your gradle script uses Gradle wrapper</span>
</span><span id=__span-30-60><a id=__codelineno-30-60 name=__codelineno-30-60 href=#__codelineno-30-60></a><span class=w>                    </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>useWrapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-30-61><a id=__codelineno-30-61 name=__codelineno-30-61 href=#__codelineno-30-61></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-30-62><a id=__codelineno-30-62 name=__codelineno-30-62 href=#__codelineno-30-62></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-63><a id=__codelineno-30-63 name=__codelineno-30-63 href=#__codelineno-30-63></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-64><a id=__codelineno-30-64 name=__codelineno-30-64 href=#__codelineno-30-64></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Build&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-65><a id=__codelineno-30-65 name=__codelineno-30-65 href=#__codelineno-30-65></a><span class=w>            </span><span class=c1>//run the artifactoryPublish gradle task and collect the build info</span>
</span><span id=__span-30-66><a id=__codelineno-30-66 name=__codelineno-30-66 href=#__codelineno-30-66></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-67><a id=__codelineno-30-67 name=__codelineno-30-67 href=#__codelineno-30-67></a><span class=w>                </span><span class=n>script</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-68><a id=__codelineno-30-68 name=__codelineno-30-68 href=#__codelineno-30-68></a><span class=w>                    </span><span class=n>buildInfo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rtGradle</span><span class=o>.</span><span class=na>run</span><span class=w> </span><span class=nl>buildFile:</span><span class=w> </span><span class=s1>&#39;build.gradle&#39;</span><span class=o>,</span><span class=w> </span><span class=nl>tasks:</span><span class=w> </span><span class=s1>&#39;clean build artifactoryPublish&#39;</span>
</span><span id=__span-30-69><a id=__codelineno-30-69 name=__codelineno-30-69 href=#__codelineno-30-69></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-30-70><a id=__codelineno-30-70 name=__codelineno-30-70 href=#__codelineno-30-70></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-71><a id=__codelineno-30-71 name=__codelineno-30-71 href=#__codelineno-30-71></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-72><a id=__codelineno-30-72 name=__codelineno-30-72 href=#__codelineno-30-72></a><span class=w>        </span><span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Publish Build Info&#39;</span><span class=o>)</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-73><a id=__codelineno-30-73 name=__codelineno-30-73 href=#__codelineno-30-73></a><span class=w>            </span><span class=c1>//collect the environment variables to build info</span>
</span><span id=__span-30-74><a id=__codelineno-30-74 name=__codelineno-30-74 href=#__codelineno-30-74></a><span class=w>            </span><span class=c1>//publish the build info</span>
</span><span id=__span-30-75><a id=__codelineno-30-75 name=__codelineno-30-75 href=#__codelineno-30-75></a><span class=w>            </span><span class=n>steps</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-76><a id=__codelineno-30-76 name=__codelineno-30-76 href=#__codelineno-30-76></a><span class=w>                </span><span class=n>script</span><span class=w> </span><span class=o>{</span>
</span><span id=__span-30-77><a id=__codelineno-30-77 name=__codelineno-30-77 href=#__codelineno-30-77></a><span class=w>                    </span><span class=n>buildInfo</span><span class=o>.</span><span class=na>env</span><span class=o>.</span><span class=na>capture</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-30-78><a id=__codelineno-30-78 name=__codelineno-30-78 href=#__codelineno-30-78></a><span class=w>                    </span><span class=n>rtServer</span><span class=o>.</span><span class=na>publishBuildInfo</span><span class=w> </span><span class=n>buildInfo</span>
</span><span id=__span-30-79><a id=__codelineno-30-79 name=__codelineno-30-79 href=#__codelineno-30-79></a><span class=w>                </span><span class=o>}</span>
</span><span id=__span-30-80><a id=__codelineno-30-80 name=__codelineno-30-80 href=#__codelineno-30-80></a><span class=w>            </span><span class=o>}</span>
</span><span id=__span-30-81><a id=__codelineno-30-81 name=__codelineno-30-81 href=#__codelineno-30-81></a><span class=w>        </span><span class=o>}</span>
</span><span id=__span-30-82><a id=__codelineno-30-82 name=__codelineno-30-82 href=#__codelineno-30-82></a><span class=w>    </span><span class=o>}</span>
</span><span id=__span-30-83><a id=__codelineno-30-83 name=__codelineno-30-83 href=#__codelineno-30-83></a><span class=o>}</span>
</span></code></pre></div> <h2 id=docker-security-standards>Docker security &amp; standards<a class=headerlink href=#docker-security-standards title="Permanent link">&para;</a></h2> <ul> <li>security takes place in every layer/lifecycle phase</li> <li>for scaling, security needs to be part of developer's day-to-day</li> <li>as everything is code, anything part of the sdlc should be secure and auditable</li> <li>use an admission controller</li> <li>network policies</li> <li>automate your security processes</li> <li>expand your security automation by adding learnings</li> </ul> <p><img alt="Secure 1" src=../../images/dockerconeu2018/secure-1.jpg></p> <p><img alt="Secure 2" src=../../images/dockerconeu2018/secure-2.jpg></p> <h2 id=docker-java-cicd>Docker &amp; Java &amp; CICD<a class=headerlink href=#docker-java-cicd title="Permanent link">&para;</a></h2> <ul> <li>telepresence</li> <li>Distroless (google mini os)</li> <li>OpenJ9</li> <li>Portala (for jdk 12)</li> <li>wagoodman/dive</li> <li>use jre for the runtime instead of jdk</li> <li>buildkit can use mounttarget for local caches</li> <li>add labels with Metadata (depency trees)</li> <li>grafeas &amp; kritis</li> <li>FindSecBugs</li> <li>org.owasp:dependency-check-maven</li> <li>arminc/clair-scanner</li> <li>jlink = in limbo</li> </ul> <h2 id=docker-windows>Docker &amp; Windows<a class=headerlink href=#docker-windows title="Permanent link">&para;</a></h2> <ul> <li>specific base images for different use cases</li> <li>Docker capabilities heavily depend on Windows Server version</li> </ul> <p><img alt="Windows 1" src=../../images/dockerconeu2018/windows-1.jpg></p> <p><img alt="Windows 2" src=../../images/dockerconeu2018/windows-2.jpg></p> <p><img alt="Windows 3" src=../../images/dockerconeu2018/windows-3.jpg></p> <p><img alt="Windows 4" src=../../images/dockerconeu2018/windows-4.jpg></p> <h2 id=other>Other<a class=headerlink href=#other title="Permanent link">&para;</a></h2> <h3 id=docker-pipeline>Docker pipeline<a class=headerlink href=#docker-pipeline title="Permanent link">&para;</a></h3> <ul> <li>Dind + privileged</li> <li>mount socket</li> <li>windows &amp; linux</li> <li>Windows build agent provisioning with docker EE &amp; Jenkins</li> <li>Docker swarm update_config</li> </ul> <h3 id=idea-build-a-dynamic-cicd-platform-with-kubernetes>Idea: build a dynamic ci/cd platform with kubernetes<a class=headerlink href=#idea-build-a-dynamic-cicd-platform-with-kubernetes title="Permanent link">&para;</a></h3> <ul> <li>jenkins evergreen + jcasc</li> <li>kubernetes plugin</li> <li>gitops pipeline</li> <li>AKS + virtual kubelet + ACI</li> <li>Jenkins + EC2 Pluging + ECS/Fargate</li> <li>jenkins agent as ecs task (fargate agent)</li> <li>docker on windows, only on ECS</li> </ul> <h3 id=apply-diplomacy-to-code-review>Apply Diplomacy to Code Review<a class=headerlink href=#apply-diplomacy-to-code-review title="Permanent link">&para;</a></h3> <ul> <li>apply diplomacy to code review</li> <li>always positive</li> <li>remove human resistantance with inclusive language</li> <li>improvement focused</li> <li>persist, kindly</li> </ul> <p><img alt="Diplomacy Language" src=../../images/dockerconeu2018/diplomacy-1.jpg></p> <h3 id=citizens-bank-journey>Citizens Bank journey<a class=headerlink href=#citizens-bank-journey title="Permanent link">&para;</a></h3> <ul> <li>started with swarm, grew towards kubernetes (ucp)</li> <li>elk stack, centralised operations cluster</li> </ul> <p><img alt="Citizens 1" src=../../images/dockerconeu2018/citizens-1.jpg></p> <p><img alt="Citizens 2" src=../../images/dockerconeu2018/citizens-2.jpg></p> <h3 id=docker-ee-assemble>Docker EE - Assemble<a class=headerlink href=#docker-ee-assemble title="Permanent link">&para;</a></h3> <p>Docker EE now has a binary called <code>docker-assemble</code>. This allows you to build a Docker image directly from something like a pom.xml, much like JIB.</p> <p><img alt="DockerAssemble MetaData" src=../../images/dockerconeu2018/metadata-1.jpg></p> <h3 id=other_1>Other<a class=headerlink href=#other_1 title="Permanent link">&para;</a></h3> <p><img alt=Random src=../../images/dockerconeu2018/random-1.jpg></p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2019-08-31 13:12:00</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Joost van der Griendt </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/joostvdg target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/joost_vdg target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/joostvdg target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tabs.sticky", "content.code.annotate", "content.code.copy", "toc.follow"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.6c14ae12.min.js></script> </body> </html>