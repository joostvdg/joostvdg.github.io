



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://joostvdg.github.io/kubernetes/khw-gce/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Installer Preparation - Joostvdg's Software Engineering Page</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#fb8c00">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="orange" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#kubernetes-the-hard-way-gce" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://joostvdg.github.io" title="Joostvdg's Software Engineering Page" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Joostvdg's Software Engineering Page
              </span>
              <span class="md-header-nav__topic">
                Installer Preparation
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/joostvdg/joostvdg.github.io/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      joostvdg/joostvdg.github.io
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://joostvdg.github.io" title="Joostvdg's Software Engineering Page" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Joostvdg's Software Engineering Page
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/joostvdg/joostvdg.github.io/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      joostvdg/joostvdg.github.io
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Java
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/spring/boot/" title="Spring Boot" class="md-nav__link">
      Spring Boot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/java9/" title="Java 9" class="md-nav__link">
      Java 9
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/ecosystem/" title="Java Ecosystem" class="md-nav__link">
      Java Ecosystem
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/networking/" title="Java Networking" class="md-nav__link">
      Java Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/streams/" title="Java Streams" class="md-nav__link">
      Java Streams
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/concurrency/" title="Java Concurrency" class="md-nav__link">
      Java Concurrency
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Docker
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Docker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../docker/multi-stage-builds/" title="Multi-Stage Builds" class="md-nav__link">
      Multi-Stage Builds
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../docker/graceful-shutdown/" title="Graceful shutdown" class="md-nav__link">
      Graceful shutdown
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../docker/swarm/" title="Swarm (mode)" class="md-nav__link">
      Swarm (mode)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../docker/kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux/systemd/" title="SystemD" class="md-nav__link">
      SystemD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux/networking/" title="Networking" class="md-nav__link">
      Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux/iptables/" title="iptables" class="md-nav__link">
      iptables
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Blogs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Blogs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../blogs/docker-graceful-shutdown/" title="Docker Graceful Shutdown" class="md-nav__link">
      Docker Graceful Shutdown
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Kubernetes (K8S)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Kubernetes (K8S)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cka-exam/" title="CKA Exam details" class="md-nav__link">
      CKA Exam details
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cka-exam-prep/" title="CKA Exam prep" class="md-nav__link">
      CKA Exam prep
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      K8S CICD
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        K8S CICD
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cicd/cdp-jenkins-helm/" title="CD Pipeline Jenkins & Helm" class="md-nav__link">
      CD Pipeline Jenkins & Helm
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      K8S Distribution
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        K8S Distribution
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../distributions/install-gke/" title="GKE" class="md-nav__link">
      GKE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../distributions/aws-eks/" title="AWS EKS" class="md-nav__link">
      AWS EKS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" checked>
    
    <label class="md-nav__link" for="nav-9">
      K8S Hard Way - GCE
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        K8S Hard Way - GCE
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Installer Preparation
      </label>
    
    <a href="./" title="Installer Preparation" class="md-nav__link md-nav__link--active">
      Installer Preparation
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" title="Goal" class="md-nav__link">
    Goal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" title="Setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resources-in-gce" title="Resources in GCE" class="md-nav__link">
    Resources in GCE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-resources" title="Kubernetes Resources" class="md-nav__link">
    Kubernetes Resources
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-plane" title="Control Plane" class="md-nav__link">
    Control Plane
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker-nodes" title="Worker nodes" class="md-nav__link">
    Worker nodes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network" title="Network" class="md-nav__link">
    Network
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kelseys-khw" title="Kelsey's KHW" class="md-nav__link">
    Kelsey's KHW
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csnets" title="CSNETs" class="md-nav__link">
    CSNETs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-tools" title="Install tools" class="md-nav__link">
    Install tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-versions" title="Check versions" class="md-nav__link">
    Check versions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-remote-storage" title="Terraform remote storage" class="md-nav__link">
    Terraform remote storage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gke-service-account" title="GKE Service Account" class="md-nav__link">
    GKE Service Account
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="terraform-compute/" title="Create GCE resources" class="md-nav__link">
      Create GCE resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="certificates/" title="Prepare Certificates" class="md-nav__link">
      Prepare Certificates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="kubeconfigs/" title="Prepare Kubeconfigs" class="md-nav__link">
      Prepare Kubeconfigs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="encryption/" title="Encryption configuration" class="md-nav__link">
      Encryption configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="etcd/" title="ETCD configuration" class="md-nav__link">
      ETCD configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="controller/" title="Controller Config" class="md-nav__link">
      Controller Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="worker/" title="Worker Config" class="md-nav__link">
      Worker Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="remote-access/" title="Remote access" class="md-nav__link">
      Remote access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="network/" title="Network config" class="md-nav__link">
      Network config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="debug/" title="Debug" class="md-nav__link">
      Debug
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Software Engineering
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Software Engineering
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../swe/naming/" title="Naming" class="md-nav__link">
      Naming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../swe/ddd/" title="Domain Driven Design" class="md-nav__link">
      Domain Driven Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../swe/microservices/" title="Microservices" class="md-nav__link">
      Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../swe/algorithms/" title="Algorithms" class="md-nav__link">
      Algorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../swe/observability/" title="Observability" class="md-nav__link">
      Observability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../swe/others/" title="Others" class="md-nav__link">
      Others
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Productivity
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Productivity
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../productivity/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../productivity/tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../productivity/intellij/" title="Intelli J" class="md-nav__link">
      Intelli J
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../productivity/paradigms/" title="Paradigms" class="md-nav__link">
      Paradigms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../productivity/studies/" title="Studies" class="md-nav__link">
      Studies
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Certificates
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Certificates
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../certificates/lets-encrypt-k8s/" title="Let's Encrypt K8S" class="md-nav__link">
      Let's Encrypt K8S
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Other
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        Other
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../other/mkdocs/" title="MKDocs (Static Website Generator)" class="md-nav__link">
      MKDocs (Static Website Generator)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../other/vim/" title="VIM" class="md-nav__link">
      VIM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      CloudBees
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        CloudBees
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloudbees/cbc-eks/" title="CloudBees Core on EKS" class="md-nav__link">
      CloudBees Core on EKS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloudbees/cbc-post-install-tips/" title="CloudBees Core Post Install" class="md-nav__link">
      CloudBees Core Post Install
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../jenkins/" title="Jenkins" class="md-nav__link">
      Jenkins
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      Jenkins Job Management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        Jenkins Job Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-jobs/jobdsl/" title="JobDSL" class="md-nav__link">
      JobDSL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-jobs/jenkins-jobs-builder/" title="JenkinsJobsBuilder" class="md-nav__link">
      JenkinsJobsBuilder
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      Jenkins Pipelines
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        Jenkins Pipelines
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline/core-concepts/" title="Core Concepts" class="md-nav__link">
      Core Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline/declarative-pipeline/" title="Pipeline (declarative)" class="md-nav__link">
      Pipeline (declarative)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline/groovy-pipeline/" title="Groovy DSL Pipeline" class="md-nav__link">
      Groovy DSL Pipeline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline/global-shared-library/" title="Pipeline Libraries" class="md-nav__link">
      Pipeline Libraries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline/ide-integration-pipeline-dsl/" title="DSL IDE Integration" class="md-nav__link">
      DSL IDE Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline/jenkins-parallel-pipeline/" title="Parallel" class="md-nav__link">
      Parallel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline/input/" title="Input" class="md-nav__link">
      Input
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-18" type="checkbox" id="nav-18">
    
    <label class="md-nav__link" for="nav-18">
      Jenkins Pipeline Examples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-18">
        Jenkins Pipeline Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline-examples/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline-examples/docker-alternatives/" title="Docker Alternatives" class="md-nav__link">
      Docker Alternatives
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-18-3" type="checkbox" id="nav-18-3">
    
    <label class="md-nav__link" for="nav-18-3">
      Maven
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-18-3">
        Maven
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline-examples/maven-groovy-dsl/" title="Maven Groovy DSL" class="md-nav__link">
      Maven Groovy DSL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline-examples/maven-declarative/" title="Maven Declarative" class="md-nav__link">
      Maven Declarative
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline-examples/maven-shared-library/" title="Maven Shared Library" class="md-nav__link">
      Maven Shared Library
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-18-4" type="checkbox" id="nav-18-4">
    
    <label class="md-nav__link" for="nav-18-4">
      Other
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-18-4">
        Other
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../jenkins-pipeline-examples/docker-declarative/" title="Docker Declarative" class="md-nav__link">
      Docker Declarative
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goal" title="Goal" class="md-nav__link">
    Goal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" title="Setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resources-in-gce" title="Resources in GCE" class="md-nav__link">
    Resources in GCE
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-resources" title="Kubernetes Resources" class="md-nav__link">
    Kubernetes Resources
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-plane" title="Control Plane" class="md-nav__link">
    Control Plane
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#worker-nodes" title="Worker nodes" class="md-nav__link">
    Worker nodes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network" title="Network" class="md-nav__link">
    Network
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kelseys-khw" title="Kelsey's KHW" class="md-nav__link">
    Kelsey's KHW
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csnets" title="CSNETs" class="md-nav__link">
    CSNETs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-tools" title="Install tools" class="md-nav__link">
    Install tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#check-versions" title="Check versions" class="md-nav__link">
    Check versions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-remote-storage" title="Terraform remote storage" class="md-nav__link">
    Terraform remote storage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gke-service-account" title="GKE Service Account" class="md-nav__link">
    GKE Service Account
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/kubernetes/khw-gce/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="kubernetes-the-hard-way-gce">Kubernetes the Hard Way - GCE<a class="headerlink" href="#kubernetes-the-hard-way-gce" title="Permanent link">&para;</a></h1>
<p>This assumes OSX and GCE.</p>
<h2 id="goal">Goal<a class="headerlink" href="#goal" title="Permanent link">&para;</a></h2>
<p>The goal is to setup up HA Kubernetes cluster on GCE from it's most basic parts.
That means we will install and configure the basic components ourselves, such as the API server and Kubelets.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<p>As to limit the scope to doing the setup of the Kubernetes cluster ourselves, we will make it static.
That means we will create and configure the network and compute resources to be fit for 3 Control Plane VM's and 3 worker VM's.
We will not be able to recover a failing node or accomidate additional resources.</p>
<h3 id="resources-in-gce">Resources in GCE<a class="headerlink" href="#resources-in-gce" title="Permanent link">&para;</a></h3>
<ul>
<li>Public IP address, as front-end for the three API servers</li>
<li>3 VM's for the Control Plance</li>
<li>3 VM's as workers</li>
<li>VPC</li>
<li>Network Routes: from POD CIDR blocks to the host VM (for workers)</li>
<li>Firewall configuration: allow health checks, dns, internal communication and connection to API server</li>
</ul>
<h3 id="kubernetes-resources">Kubernetes Resources<a class="headerlink" href="#kubernetes-resources" title="Permanent link">&para;</a></h3>
<h4 id="control-plane">Control Plane<a class="headerlink" href="#control-plane" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>etcd</strong>: stores cluster state</li>
<li><strong>kube-api server</strong>: entry point for interacting with the cluster by exposing the api</li>
<li><strong>kube-scheduler</strong>: makes sure pods get scheduled</li>
<li><strong>kube-controller-manager</strong>: aggregate of required controllers</li>
<li><strong>Node Controller</strong>: &gt; Responsible for noticing and responding when nodes go down.</li>
<li><strong>Replication Controller</strong>:  &gt; Responsible for maintaining the correct number of pods for every replication controller object in the system.</li>
<li><strong>Endpoints Controller</strong>: &gt; Populates the Endpoints object (that is, joins Services &amp; Pods).</li>
<li><strong>Service Account &amp; Token Controller</strong>: &gt; Create default accounts and API access tokens for new namespaces.</li>
</ul>
<h4 id="worker-nodes">Worker nodes<a class="headerlink" href="#worker-nodes" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>kubelet</strong>: &gt; An agent that runs on each node in the cluster. It makes sure that containers are running in a pod.</li>
<li><strong>kube-proxy</strong>: &gt; kube-proxy enables the Kubernetes service abstraction by maintaining network rules on the host and performing connection forwarding</li>
<li>A container runtime: this can be <code>Docker</code>, <code>rkt</code> or as in our case <code>containerd</code></li>
</ul>
<h2 id="network">Network<a class="headerlink" href="#network" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://blog.csnet.me/k8s-thw/part1/">https://blog.csnet.me/k8s-thw/part1/</a></li>
<li><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way">https://github.com/kelseyhightower/kubernetes-the-hard-way</a></li>
</ul>
<p>We will be using the network components - with Weave-Net and CoreDNS - as described in the csnet blog.
But we will use the CIDR blocks as stated in the Kelsey Hightower's Kubernetes the Hard Way (<code>KHW</code>).</p>
<h3 id="kelseys-khw">Kelsey's KHW<a class="headerlink" href="#kelseys-khw" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Range</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.240.0.10/24</td>
<td>LAN (GCE VMS)</td>
</tr>
<tr>
<td>10.200.0.0/16</td>
<td>k8s Pod network</td>
</tr>
<tr>
<td>10.32.0.0/24</td>
<td>k8s Service network</td>
</tr>
<tr>
<td>10.32.0.1</td>
<td>k8s API server</td>
</tr>
<tr>
<td>10.32.0.10</td>
<td>k8s dns</td>
</tr>
</tbody>
</table>
<ul>
<li>API Server: <a href="https://127.0.0.1:6443">https://127.0.0.1:6443</a></li>
<li>service-cluster-ip-range=10.32.0.0/24</li>
<li>cluster-cidr=10.200.0.0/1</li>
</ul>
<h3 id="csnets">CSNETs<a class="headerlink" href="#csnets" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Range</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.32.2.0/24</td>
<td>LAN (csnet.me)</td>
</tr>
<tr>
<td>10.16.0.0/16</td>
<td>k8s Pod network</td>
</tr>
<tr>
<td>10.10.0.0/22</td>
<td>k8s Service network</td>
</tr>
<tr>
<td>10.10.0.1</td>
<td>k8s API server</td>
</tr>
<tr>
<td>10.10.0.10</td>
<td>k8s dns</td>
</tr>
</tbody>
</table>
<ul>
<li>API Server: <a href="https://10.32.2.97:6443">https://10.32.2.97:6443</a></li>
<li>service-cluster-ip-range=10.10.0.0/22</li>
<li>cluster-cidr=10.16.0.0/16</li>
</ul>
<h2 id="install-tools">Install tools<a class="headerlink" href="#install-tools" title="Permanent link">&para;</a></h2>
<p>On the machine doing the installation, we will need some tools installed.
We will use the following tools:</p>
<ul>
<li><strong>kubectl</strong>: for communicating with the API server</li>
<li><strong>cfssl</strong>: for creating the certificates and sign them</li>
<li><strong>helm</strong>: for installing additional tools later</li>
<li><strong>stern</strong>: for viewing logs of multiple pods at once (for example, all kube-dns pods)</li>
<li><strong>terraform</strong>: for managing our resources in GCE</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>brew install kubernetes-cli
brew install cfssl
brew install kubernetes-helm
brew install stern
brew install terraform
</pre></div>
</td></tr></table>

<h3 id="check-versions">Check versions<a class="headerlink" href="#check-versions" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl version -c -o yaml
cfssl version
helm version -c --short
stern --version
terraform version
</pre></div>
</td></tr></table>

<h3 id="terraform-remote-storage">Terraform remote storage<a class="headerlink" href="#terraform-remote-storage" title="Permanent link">&para;</a></h3>
<p>The help with problems of local storage and potential loss of data when local OS problems occur, 
we will use an S3 bucket as Terraform state storage.</p>
<ul>
<li>create s3 bucket</li>
<li>configure Terraform to use this as remote state storage</li>
<li>see how to this <a href="https://medium.com/@jessgreb01/how-to-terraform-locking-state-in-s3-2dc9a5665cb6">here</a></li>
<li>read more about this, in <a href="https://www.terraform.io/docs/backends/types/s3.html">Terraform's docs</a></li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s2">&quot;anaccesskey&quot;</span>
<span class="nb">export</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s2">&quot;asecretkey&quot;</span>
<span class="nb">export</span> <span class="nv">AWS_DEFAULT_REGION</span><span class="o">=</span><span class="s2">&quot;eu-central-1&quot;</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="err">terraform</span> <span class=" -Punctuation">{</span>
  <span class="err">backend</span> <span class="s2">&quot;s3&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    bucket</span>  <span class="o">=</span> <span class="s2">&quot;euros-terraform-state&quot;</span>
<span class="na">    key</span>     <span class="o">=</span> <span class="s2">&quot;terraform.tfstate&quot;</span>
<span class="na">    region</span>  <span class="o">=</span> <span class="s2">&quot;eu-central-1&quot;</span>
<span class="na">    encrypt</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
  <span class=" -Punctuation">}</span>
<span class=" -Punctuation">}</span>
</pre></div>
</td></tr></table>

<h2 id="gke-service-account">GKE Service Account<a class="headerlink" href="#gke-service-account" title="Permanent link">&para;</a></h2>
<p>Create a new GKE service account, and export it's json credentials file for use with Terraform.</p>
<p>See <a href="https://cloud.google.com/docs/authentication/production">GKE Tutorial page</a> for how you can do this.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../distributions/aws-eks/" title="AWS EKS" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                AWS EKS
              </span>
            </div>
          </a>
        
        
          <a href="terraform-compute/" title="Create GCE resources" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Create GCE resources
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Joost van der Griendt
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/joostvdg" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/joost_vdg" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/joostvdg" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>