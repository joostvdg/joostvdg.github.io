<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="How To Use Let's Encrypt On Kubernetes"><link href=https://joostvdg.github.io/certificates/lets-encrypt-k8s/ rel=canonical><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>Let's Encrypt Kubernetes</title><link rel=stylesheet href=../../assets/stylesheets/application.0284f74d.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.01803549.css><meta name=theme-color content=#fb8c00><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-145385967-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=orange data-md-color-accent=red> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#lets-encrypt-for-kubernetes tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo"> <i class=md-icon>public</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> J's Software Development Pages </span> <span class=md-header-nav__topic> Let's Encrypt Kubernetes </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. title=Home class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../docker/graceful-shutdown/ title=Blogs class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../../cloudbees/sso-azure-ad/ title=CICD class=md-tabs__link> CICD </a> </li> <li class=md-tabs__item> <a href=../../kubernetes/ title=Containers class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ title=Cloud class=md-tabs__link> Cloud </a> </li> <li class=md-tabs__item> <a href=./ title=SWE class="md-tabs__link md-tabs__link--active"> SWE </a> </li> <li class=md-tabs__item> <a href=../../java/ title=Java class=md-tabs__link> Java </a> </li> </ul> </div> </nav> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo"> <i class=md-icon>public</i> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Blogs </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../blogs/k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../cloudbees/sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../cloudbees/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../blogs/jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-7 type=checkbox id=nav-2-7> <label class=md-nav__link for=nav-2-7> Jenkins Monitoring Kubernetes </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-7> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/metrics/ title=Metrics class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../blogs/k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../blogs/dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> CICD </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> CICD </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> CloudBees </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-1> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloudbees/sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../../cloudbees/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Jenkins X </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/buildpack/ title=BuildPack class=md-nav__link> BuildPack </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-3> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-4> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ title=Parallel class=md-nav__link> Parallel </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-5 type=checkbox id=nav-3-5> <label class=md-nav__link for=nav-3-5> Jenkins Pipeline Examples </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-5> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Containers </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1> <label class=md-nav__link for=nav-4-1> Kubernetes (K8S) </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> K8S Public Services </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-2> K8S Public Services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> K8S Hard Way - GCE </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-3> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4> <label class=md-nav__link for=nav-4-4> Docker </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-4> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-5> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Cloud </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Cloud </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ title="Automation - Pulumi" class=md-nav__link> Automation - Pulumi </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6 checked> <label class=md-nav__link for=nav-6> SWE </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> SWE </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Let's Encrypt K8S </label> <a href=./ title="Let's Encrypt K8S" class="md-nav__link md-nav__link--active"> Let's Encrypt K8S </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites title=Prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#steps title=Steps class=md-nav__link> Steps </a> </li> <li class=md-nav__item> <a href=#install-cert-manager title="Install Cert Manager" class=md-nav__link> Install Cert Manager </a> </li> <li class=md-nav__item> <a href=#deploy-issuer title="Deploy Issuer" class=md-nav__link> Deploy Issuer </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#clusterissuer title=ClusterIssuer class=md-nav__link> ClusterIssuer </a> </li> <li class=md-nav__item> <a href=#issuer title=Issuer class=md-nav__link> Issuer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-certificate-resource title="Deploy Certificate Resource" class=md-nav__link> Deploy Certificate Resource </a> </li> <li class=md-nav__item> <a href=#confirm-resources title="Confirm Resources" class=md-nav__link> Confirm Resources </a> </li> <li class=md-nav__item> <a href=#use-certificate-to-enable-https title="Use certificate to enable https" class=md-nav__link> Use certificate to enable https </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deployment title=Deployment class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=#service title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=#ingress title=Ingress class=md-nav__link> Ingress </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#further-resources title="Further resources" class=md-nav__link> Further resources </a> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-3> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../java/networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../java/concurrency/ title="Java Concurrency" class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites title=Prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#steps title=Steps class=md-nav__link> Steps </a> </li> <li class=md-nav__item> <a href=#install-cert-manager title="Install Cert Manager" class=md-nav__link> Install Cert Manager </a> </li> <li class=md-nav__item> <a href=#deploy-issuer title="Deploy Issuer" class=md-nav__link> Deploy Issuer </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#clusterissuer title=ClusterIssuer class=md-nav__link> ClusterIssuer </a> </li> <li class=md-nav__item> <a href=#issuer title=Issuer class=md-nav__link> Issuer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-certificate-resource title="Deploy Certificate Resource" class=md-nav__link> Deploy Certificate Resource </a> </li> <li class=md-nav__item> <a href=#confirm-resources title="Confirm Resources" class=md-nav__link> Confirm Resources </a> </li> <li class=md-nav__item> <a href=#use-certificate-to-enable-https title="Use certificate to enable https" class=md-nav__link> Use certificate to enable https </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deployment title=Deployment class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=#service title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=#ingress title=Ingress class=md-nav__link> Ingress </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#further-resources title="Further resources" class=md-nav__link> Further resources </a> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/certificates/lets-encrypt-k8s.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=lets-encrypt-for-kubernetes>Let's Encrypt for Kubernetes<a class=headerlink href=#lets-encrypt-for-kubernetes title="Permanent link">&para;</a></h1> <p><a href=https://letsencrypt.org/ >Let's Encrypt</a> is a free, automated and open Certificate Authority. The kind of service you need if you want to have a secure website with https - yes I know that requires more than that - and it's now more straightforward to use than ever.</p> <p>This about using Let's Encrypt for generating a certificate for your service on Kubernetes. There are several ways to do this, with more or less automation, cluster-wide or namespace bound or with a DNS or HTTP validation check.</p> <p>I'll choose the route that was the easiest for me, and then I'll briefly look at the other options.</p> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <p>There are some prerequisites required, that are best discussed on their own. So we will continue with the assumption that you have these in order.</p> <ul> <li>valid Class A or CNAME domain name</li> <li>kubernetes cluster<ul> <li>with ingress controller (such as nginx)</li> <li>with helm and tiller installed in the cluster</li> </ul> </li> <li>web application</li> </ul> <h2 id=steps>Steps<a class=headerlink href=#steps title="Permanent link">&para;</a></h2> <p>The steps to take to get a web application to get a certificate from Let's Encrypt are the following.</p> <ul> <li>install cert-manager from the <a href=https://github.com/kubernetes/charts/tree/master/stable/cert-manager>official helm chart</a></li> <li>deploy a <code class=codehilite><span class=n>Issuer</span></code> resource</li> <li>deploy a certificate resource</li> <li>confirm certificate and secret are created/filled</li> <li>use in web app</li> </ul> <h2 id=install-cert-manager>Install Cert Manager<a class=headerlink href=#install-cert-manager title="Permanent link">&para;</a></h2> <p>For more details on Cert Manager, I recommend <a href=https://cert-manager.readthedocs.io/en/latest/index.html>reading their introduction</a>.</p> <p>In essence, it's a tool that helps you initiate a certificate request with a service such as Let's Encrypt.</p> <p>You can install it via Helm, and it's meant to be installed only once per cluster. The once per cluster restriction is due to the usage of Custom Resource Definitions (CRD's) which will block any (re-)installation.</p> <p>To confirm if there are any CRD's from cert-manager, you can issue the following command.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>kubectl get customresourcedefinitions.apiextensions.k8s.io
</pre></div> </td></tr></table> <p>The CRD's belonging to cert-manager are the following:</p> <ul> <li>certificates.certmanager.k8s.io</li> <li>clusterissuers.certmanager.k8s.io</li> <li>issuers.certmanager.k8s.io</li> </ul> <p>You will notice later, that we will use these CRD's for getting our certificate, so keep them in mind. To remove them in case of a re-install, you can issue the command below.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4</pre></div></td><td class=code><div class=codehilite><pre><span></span>kubectl delete customresourcedefinitions.apiextensions.k8s.io <span class=se>\</span>
    certificates.certmanager.k8s.io <span class=se>\</span>
    clusterissuers.certmanager.k8s.io <span class=se>\</span>
    issuers.certmanager.k8s.io
</pre></div> </td></tr></table> <p>When you're sure there are no CRD's left, you can install cert-manager via it's helm chart. It has some options in case you need them, you read about them <a href=https://github.com/helm/charts/tree/master/stable/cert-manager>here</a>, but in my case that wasn't needed.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>helm install --name cert-manager --namespace default stable/cert-manager
</pre></div> </td></tr></table> <h2 id=deploy-issuer>Deploy Issuer<a class=headerlink href=#deploy-issuer title="Permanent link">&para;</a></h2> <p>To be able to use a certificate we need to have a Certificate Issuer.</p> <p>If you remember from our <code class=codehilite><span class=n>cert</span><span class=o>-</span><span class=n>manager</span></code>, there are two CRD's that can take this role:</p> <ul> <li><strong>ClusterIssuer</strong>: clusterissuers.certmanager.k8s.io</li> <li><strong>Issuer</strong>: issuers.certmanager.k8s.io</li> </ul> <p>Both issuer type can use two ways of providing the proof of ownership, either by <code class=codehilite><span class=n>dns</span><span class=o>-</span><span class=mi>01</span></code> or <code class=codehilite><span class=n>http</span><span class=o>-</span><span class=mi>01</span></code>.</p> <p>We'll be using the <code class=codehilite><span class=n>http</span><span class=o>-</span><span class=mi>01</span></code> method, for the <code class=codehilite><span class=n>dns</span><span class=o>-</span><span class=mi>01</span></code> method, refer to the <a href=https://cert-manager.readthedocs.io/en/latest/tutorials/acme/dns-validation.html>cert-manager documenation</a>.</p> <h3 id=clusterissuer>ClusterIssuer<a class=headerlink href=#clusterissuer title="Permanent link">&para;</a></h3> <p>As the resource <code class=codehilite><span class=n>Kind</span></code> implies, a <code class=codehilite><span class=n>ClusterIssuer</span></code> is a cluster-wide resource and not bound to a specific namespace.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">certmanager.k8s.io/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">letsencrypt-staging</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>acme</span><span class=p>:</span>
    <span class=c1># The ACME server URL</span>
    <span class=nt>server</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://acme-staging.api.letsencrypt.org/directory</span>
    <span class=c1># Email address used for ACME registration</span>
    <span class=nt>email</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">user@example.com</span>
    <span class=c1># Name of a secret used to store the ACME account private key</span>
    <span class=nt>privateKeySecretRef</span><span class=p>:</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">letsencrypt-staging</span>
    <span class=c1># Enable the HTTP-01 challenge provider</span>
    <span class=nt>http01</span><span class=p>:</span> <span class="p p-Indicator">{}</span>
</pre></div> </td></tr></table> <h3 id=issuer>Issuer<a class=headerlink href=#issuer title="Permanent link">&para;</a></h3> <p>Not everyone wants a cluster-wide resource, and not everyone has the rights to install something elsewhere than their namespace.</p> <p>I prefer having as much as possible tied to a namespace - either a team or an application - I will use this type.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">certmanager.k8s.io/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Issuer</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-letsencrypt-staging</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>acme</span><span class=p>:</span>
    <span class=c1># The ACME server URL</span>
    <span class=nt>server</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://acme-staging-v02.api.letsencrypt.org/directory</span>
    <span class=c1># Email address used for ACME registration</span>
    <span class=nt>email</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myadmin@myapp.com</span>
    <span class=c1># Name of a secret used to store the ACME account private key</span>
    <span class=nt>privateKeySecretRef</span><span class=p>:</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-letsencrypt-staging</span>
    <span class=c1># Enable the HTTP-01 challenge provider</span>
    <span class=nt>http01</span><span class=p>:</span> <span class="p p-Indicator">{}</span>
</pre></div> </td></tr></table> <p>There's a few things to note here:</p> <ul> <li><strong>server</strong>: this refers to the server executing the ACME test, in this case: Let's Encrypt Staging (with the v2 API)</li> <li><strong>email</strong>: this will be the account it will use for registering the certificate</li> <li><strong>privateKeySecretRef</strong>: this is the Kubernetes <code class=codehilite><span class=n>secret</span></code> resource in which the privateKey will be stored, just in case you need or want to remove it</li> </ul> <h2 id=deploy-certificate-resource>Deploy Certificate Resource<a class=headerlink href=#deploy-certificate-resource title="Permanent link">&para;</a></h2> <p>Next up is our <code class=codehilite><span class=n>Certificate</span></code> resource, this is where <code class=codehilite><span class=n>cert</span><span class=o>-</span><span class=n>manager</span></code> will store our certificate details to be used by our application.</p> <p>In case you forgot, this is one of the three CRD's provided by cert-manager.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">certmanager.k8s.io/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Certificate</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-example-com</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-tls</span>
  <span class=nt>dnsNames</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">myapp.example.com</span>
  <span class=nt>acme</span><span class=p>:</span>
    <span class=nt>config</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>http01</span><span class=p>:</span>
        <span class=nt>ingressClass</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
      <span class=nt>domains</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">myapp.example.com</span>
  <span class=nt>issuerRef</span><span class=p>:</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-letsencrypt-staging</span>
    <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Issuer</span>
</pre></div> </td></tr></table> <p>The things to note here:</p> <ul> <li><strong>name</strong>: so far I've found it a naming convention to write the domain name where <code class=codehilite><span class=o>-</span></code> replaces the <code class=codehilite><span class=p>.</span></code>'s.</li> <li><strong>secretName</strong>: the name of the Kubernetes secret that will house the certificate and certificate key</li> <li><strong>dnsNames</strong>: you can specify more than one name, in our case just a single one, should match <code class=codehilite><span class=n>acme</span><span class=p>.</span><span class=n>config</span><span class=p>.</span><span class=n>domains</span></code></li> <li><strong>acme.config</strong>: this defines the configuration for how the ownership proof should be done, this should match the method defined in the <code class=codehilite><span class=n>Issuer</span></code></li> <li><strong>issuerRef</strong>: in good Kubernetes fashion, we reference the <code class=codehilite><span class=n>Issuer</span></code> that should issue our certificate, the name and kind should match our Issue resource</li> </ul> <h2 id=confirm-resources>Confirm Resources<a class=headerlink href=#confirm-resources title="Permanent link">&para;</a></h2> <p>We have defined our set of resources that should create our valid - though not trusted, as it is staging - certificate. Before we use it, we should confirm our secret and our certificate are both valid.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>kubectl describe certificate myapp-example-com --namespace myapp
</pre></div> </td></tr></table> <p>The response includes the latest status, which looks like this:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>Status</span><span class=p>:</span>
  <span class=nt>Acme</span><span class=p>:</span>
    <span class=nt>Order</span><span class=p>:</span>
      <span class=nt>URL</span><span class=p>:</span>  <span class="l l-Scalar l-Scalar-Plain">https://acme-staging-v02.api.letsencrypt.org/acme/order/705.../960...</span>
  <span class=nt>Conditions</span><span class=p>:</span>
    <span class=nt>Last Transition Time</span><span class=p>:</span>  <span class="l l-Scalar l-Scalar-Plain">2018-10-02T21:17:34Z</span>
    <span class=nt>Message</span><span class=p>:</span>               <span class="l l-Scalar l-Scalar-Plain">Certificate issued successfully</span>
    <span class=nt>Reason</span><span class=p>:</span>                <span class="l l-Scalar l-Scalar-Plain">CertIssued</span>
    <span class=nt>Status</span><span class=p>:</span>                <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class=nt>Type</span><span class=p>:</span>                  <span class="l l-Scalar l-Scalar-Plain">Ready</span>
</pre></div> </td></tr></table> <p>Next up is our secret, containing the actual certificate and the certificate key.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>kubectl describe secret myapp-tls --namespace myapp
</pre></div> </td></tr></table> <p>Which results in something like this:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class=code><div class=codehilite><pre><span></span>Name:         myapp-tls
Namespace:    myapp
Labels:       certmanager.k8s.io/certificate-name<span class=o>=</span>myapp-example-com
Annotations:  certmanager.k8s.io/alt-names: myapp.example.com
              certmanager.k8s.io/common-name: myapp.example.com
              certmanager.k8s.io/issuer-kind: Issuer
              certmanager.k8s.io/issuer-name: myapp-letsencrypt-staging

Type:  kubernetes.io/tls

<span class=nv>Data</span>
<span class=o>====</span>
tls.crt:  <span class=m>3797</span> bytes
tls.key:  <span class=m>1679</span> bytes
</pre></div> </td></tr></table> <h2 id=use-certificate-to-enable-https>Use certificate to enable https<a class=headerlink href=#use-certificate-to-enable-https title="Permanent link">&para;</a></h2> <p>Assuming the secret and the certificate are correct, we can use them to enable https on our web app.</p> <p>We put the tls certificate on the ingress of the application, in this case, Nginx, which assumes the following about the app:</p> <ul> <li>it has a deployment or stateful set</li> <li>it has a service which provides and endpoint to one or more instances</li> <li>it has an nginx ingress which points to the service</li> </ul> <h3 id=deployment>Deployment<a class=headerlink href=#deployment title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
  <span class=nt>labels</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>replicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>matchLabels</span><span class=p>:</span>
      <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
  <span class=nt>template</span><span class=p>:</span>
    <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">caladreas/catnip-master</span>
        <span class=nt>imagePullPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>
        <span class=nt>ports</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">8087</span>
</pre></div> </td></tr></table> <p>You should always include livenessprobe, resource limits and so on. But for the sake of brevity, these are omitted!</p> <h3 id=service>Service<a class=headerlink href=#service title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
  <span class=nt>labels</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
  <span class=nt>ports</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
    <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class=nt>targetPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">8087</span>
    <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
</pre></div> </td></tr></table> <h3 id=ingress>Ingress<a class=headerlink href=#ingress title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
  <span class=nt>annotations</span><span class=p>:</span>
    <span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span> <span class=s>&quot;nginx&quot;</span>
    <span class=nt>ingress.kubernetes.io/ssl-redirect</span><span class=p>:</span> <span class=s>&quot;true&quot;</span>
    <span class=nt>certmanager.k8s.io/issuer-kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Issuer</span>
    <span class=nt>certmanager.k8s.io/issuer-name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-letsencrypt-staging</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>rules</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>host</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp.example.com</span>
    <span class=nt>http</span><span class=p>:</span>
      <span class=nt>paths</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>path</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
        <span class=nt>backend</span><span class=p>:</span>
          <span class=nt>serviceName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp</span>
          <span class=nt>servicePort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
  <span class=nt>tls</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>hosts</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">myapp.example.com</span>
    <span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myapp-tls</span>
</pre></div> </td></tr></table> <h2 id=further-resources>Further resources<a class=headerlink href=#further-resources title="Permanent link">&para;</a></h2> <ul> <li><a href=https://letsencrypt.org/how-it-works/ >How Does Let's Encrypt Work</a></li> <li><a href=https://hk.saowen.com/a/c045f2a12e66d94d7addce9101a61887e7f904aaa8efaed07a0e0a1325ab8c55>Tutorial that inspired this page</a></li> <li><a href=https://medium.com/@dmaas/amazon-eks-ingress-guide-8ec2ec940a70>Amazone EKS Ingress Guide</a></li> <li><a href=https://stackoverflow.com/questions/51363674/kubernetes-eks-ingress-and-tls>Kuberetes EKS Ingress and TLS</a></li> <li><a href=https://github.com/kubernetes/contrib/tree/master/ingress/controllers/nginx/examples/tls>How To Configure LTS for Nginx Ingress</a></li> </ul> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://joostvdg.github.io/certificates/lets-encrypt-k8s/";
      this.page.identifier =
        "/certificates/lets-encrypt-k8s/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//joostvdg-github-io.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../../cloud/automation-pulumi/ title="Automation - Pulumi" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Automation - Pulumi </span> </div> </a> <a href=../../swe/important-concepts/ title="Important Concepts" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Important Concepts </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 Joost van der Griendt </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/joostvdg class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/joost_vdg class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/joostvdg class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.245445c6.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> </body> </html>