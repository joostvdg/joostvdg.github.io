<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://joostvdg.github.io/cloudbees/multi-cluster/ rel=canonical><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.2"><title>Multi-Cluster (OLD/AKS) - J's Software Development Pages</title><link rel=stylesheet href=../../assets/stylesheets/main.a2408e81.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.a46bcfb3.min.css><meta name=theme-color content=#ffa726><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7CCutive+Mono&display=fallback"><style>body,input{font-family:"Lato",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Cutive Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-145385967-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=orange data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#prerequisites class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> J's Software Development Pages </span> <span class="md-header-nav__topic md-ellipsis"> Multi-Cluster (OLD/AKS) </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../blogs/jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../sso-azure-ad/ class="md-tabs__link md-tabs__link--active"> Jenkins & CloudBees </a> </li> <li class=md-tabs__item> <a href=../../jenkinsx/build-packs/ class=md-tabs__link> Jenkins X </a> </li> <li class=md-tabs__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ class=md-tabs__link> Software Eng. </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Blogs <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Blogs data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../blogs/docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../blogs/k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../blogs/sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../blogs/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../blogs/kubernetes-sso-keycloak/ title="Kubernetes SSO Keycloak" class=md-nav__link> Kubernetes SSO Keycloak </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8> <label class=md-nav__link for=nav-2-8> Jenkins X Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ title="Database Connection And Secrets" class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ title="Previews & Integration Tests" class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ title="Promote To Production" class=md-nav__link> Promote To Production </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-9 type=checkbox id=nav-2-9> <label class=md-nav__link for=nav-2-9> Jenkins Monitoring Kubernetes <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Monitoring Kubernetes" data-md-level=2> <label class=md-nav__title for=nav-2-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/metrics/ title=Metrics class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../blogs/k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../blogs/dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3 checked> <label class=md-nav__link for=nav-3> Jenkins & CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins & CloudBees" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins & CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1 checked> <label class=md-nav__link for=nav-3-1> CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=CloudBees data-md-level=2> <label class=md-nav__title for=nav-3-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> <li class=md-nav__item> <a href=../cbc-team-namespace/ title="Team Master Namespace" class=md-nav__link> Team Master Namespace </a> </li> <li class=md-nav__item> <a href=../multi-cluster-gke/ title="Multi-Cluster GKE" class=md-nav__link> Multi-Cluster GKE </a> </li> <li class=md-nav__item> <a href=../multi-cluster-eks/ title="Multi-Cluster EKS" class=md-nav__link> Multi-Cluster EKS </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Multi-Cluster (OLD/AKS) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Multi-Cluster (OLD/AKS)" class="md-nav__link md-nav__link--active"> Multi-Cluster (OLD/AKS) </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#steps-to-do class=md-nav__link> Steps to do </a> </li> <li class=md-nav__item> <a href=#tweak-gke-cluster class=md-nav__link> Tweak GKE Cluster </a> <nav class=md-nav aria-label="Tweak GKE Cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tcp-services class=md-nav__link> TCP Services </a> </li> <li class=md-nav__item> <a href=#set-default-tls-certificate class=md-nav__link> Set Default TLS Certificate </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-aks-cluster class=md-nav__link> Configure AKS Cluster </a> <nav class=md-nav aria-label="Configure AKS Cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gather-kubernetes-credential-certificate class=md-nav__link> Gather Kubernetes Credential &amp; Certificate </a> </li> <li class=md-nav__item> <a href=#install-an-ingress-controller class=md-nav__link> Install an Ingress controller </a> </li> <li class=md-nav__item> <a href=#create-configure-namespace class=md-nav__link> Create &amp; Configure Namespace </a> </li> <li class=md-nav__item> <a href=#configure-cloudbees-sidecar-injector class=md-nav__link> Configure CloudBees Sidecar Injector </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-operations-center class=md-nav__link> Configure Operations Center </a> <nav class=md-nav aria-label="Configure Operations Center"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-endpoint class=md-nav__link> Configure Endpoint </a> </li> <li class=md-nav__item> <a href=#master-template class=md-nav__link> Master Template </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-a-managed-master class=md-nav__link> Create a Managed Master </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Jenkins <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Jenkins data-md-level=2> <label class=md-nav__title for=nav-3-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins Pipelines <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipelines" data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/kaniko-pipelines/ title="Build Docker Image Kaniko" class=md-nav__link> Build Docker Image Kaniko </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/podtemplate-dind/ title="PodTemplate With Docker-In-Docker" class=md-nav__link> PodTemplate With Docker-In-Docker </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ title="Parallel Pipelines" class=md-nav__link> Parallel Pipelines </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipeline Examples <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipeline Examples" data-md-level=2> <label class=md-nav__title for=nav-3-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Jenkins X <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/build-packs/ title="Build Packs" class=md-nav__link> Build Packs </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jx-pipelines/ title="Jenkins X Pipelines" class=md-nav__link> Jenkins X Pipelines </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-4-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ title="Database Connection And Secrets" class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ title="Previews & Integration Tests" class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ title="Promote To Production" class=md-nav__link> Promote To Production </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../jenkinsx/builder-image/ title="Create Builder Image" class=md-nav__link> Create Builder Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot/ title="JX Boot GKE" class=md-nav__link> JX Boot GKE </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot-aks/ title="JX Boot AKS" class=md-nav__link> JX Boot AKS </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/aks-boot-core/ title="JX Boot & CloudBees Core" class=md-nav__link> JX Boot & CloudBees Core </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-minimal/ title="OpenShift 3.11" class=md-nav__link> OpenShift 3.11 </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-restricted/ title="OpenShift 3.11 - Restricted" class=md-nav__link> OpenShift 3.11 - Restricted </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/lighthouse-bitbucket/ title="Lighthouse & Bitbucket" class=md-nav__link> Lighthouse & Bitbucket </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/kubernetes-days/ title="Example For Console Reel" class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Containers <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Containers data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> OpenShift <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=OpenShift data-md-level=2> <label class=md-nav__title for=nav-5-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-minimal/ title="OpenShift 3.11 GCP(minimal)" class=md-nav__link> OpenShift 3.11 GCP(minimal) </a> </li> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-medium/ title="OpenShift 3.11 GCP(medium)" class=md-nav__link> OpenShift 3.11 GCP(medium) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Kubernetes (K8S) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Kubernetes (K8S)" data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Managed Kubernetes (cloud) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Managed Kubernetes (cloud)" data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Managed Kubernetes (cloud) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/gke-terraform/ title="GKE Terraform" class=md-nav__link> GKE Terraform </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> K8S Hard Way - GCE <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="K8S Hard Way - GCE" data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Docker <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Docker data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> Linux <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Software Eng. <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Eng." data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Eng. </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Automation <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Automation data-md-level=2> <label class=md-nav__title for=nav-6-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ title=Pulumi class=md-nav__link> Pulumi </a> </li> <li class=md-nav__item> <a href=../../certificates/lets-encrypt-k8s/ title="Let's Encrypt K8S" class=md-nav__link> Let's Encrypt K8S </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Engineering" data-md-level=2> <label class=md-nav__title for=nav-6-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Productivity data-md-level=2> <label class=md-nav__title for=nav-6-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-4 type=checkbox id=nav-6-4> <label class=md-nav__link for=nav-6-4> Java <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Java data-md-level=2> <label class=md-nav__title for=nav-6-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../java/networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../java/concurrency/ title="Java Concurrency" class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#steps-to-do class=md-nav__link> Steps to do </a> </li> <li class=md-nav__item> <a href=#tweak-gke-cluster class=md-nav__link> Tweak GKE Cluster </a> <nav class=md-nav aria-label="Tweak GKE Cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tcp-services class=md-nav__link> TCP Services </a> </li> <li class=md-nav__item> <a href=#set-default-tls-certificate class=md-nav__link> Set Default TLS Certificate </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-aks-cluster class=md-nav__link> Configure AKS Cluster </a> <nav class=md-nav aria-label="Configure AKS Cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gather-kubernetes-credential-certificate class=md-nav__link> Gather Kubernetes Credential &amp; Certificate </a> </li> <li class=md-nav__item> <a href=#install-an-ingress-controller class=md-nav__link> Install an Ingress controller </a> </li> <li class=md-nav__item> <a href=#create-configure-namespace class=md-nav__link> Create &amp; Configure Namespace </a> </li> <li class=md-nav__item> <a href=#configure-cloudbees-sidecar-injector class=md-nav__link> Configure CloudBees Sidecar Injector </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-operations-center class=md-nav__link> Configure Operations Center </a> <nav class=md-nav aria-label="Configure Operations Center"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-endpoint class=md-nav__link> Configure Endpoint </a> </li> <li class=md-nav__item> <a href=#master-template class=md-nav__link> Master Template </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-a-managed-master class=md-nav__link> Create a Managed Master </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/cloudbees/multi-cluster.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Multi-Cluster (OLD/AKS)</h1> <p>Imagine you have a whole range of departments and development teams. Preferably you want to serve them with a standardized SDA(Software Delivery Automation) platform, but at the same time, make sure they pay for their usage.</p> <p>I don't think this is too far fetched or something terrible. I think it makes sense. In this light, CloudBees Core now <a href=https://docs.cloudbees.com/docs/cloudbees-core/latest/cloud-admin-guide/multiple-clusters>supports running on multiple Kubernetes clusters</a>. </p> <p>In this guide, we're going to explore how to run CloudBees Core on a GKE and AKS cluster at the same time. And how to deal with the details of getting the namespace configured, certificates, Kubernetes API tokens and so on and so forth.</p> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <p>First off, we need a [GKE cluster] (/kubernetes/distributions/gke-terraform/) and a <a href=/kubernetes/distributions/aks-terraform/ >AKS cluster</a>.</p> <p>Next, we make the GKE cluster the default one. Here we will install CloudBees Core. You can either install <a href=/cloudbees/cbc-gke-helm/ >CloudBees Core directly</a> or via <a href=/jenkinsx/aks-boot-core/#install-cloudbees-core>Jenkins X</a>.</p> <p>You're also welcome to follow the <a href=https://docs.cloudbees.com/docs/cloudbees-core/latest/gke-install-guide/installing-gke-using-helm>CloudBees documentation</a>.</p> <p>The expected state is that you access Operations Center via a proper DNS name with TLS enabled, served via Nginx Ingress. And the AKS cluster is ready to be used - but empty.</p> <p>Some further assumptions: you have admin rights on both clusters the TLS certificate is from Let's Encrypt via Certmanager the AKS cluster is empty You can break these assumptions, but that means you have to change the examples to reflect your situation.</p> <h2 id=steps-to-do>Steps to do<a class=headerlink href=#steps-to-do title="Permanent link">&para;</a></h2> <p>High over, we have to do the following steps:</p> <ul> <li>tweak the GKE cluster</li> <li>configure the AKS cluster</li> <li>configure Operations Center</li> <li>create a Managed Master</li> </ul> <h2 id=tweak-gke-cluster>Tweak GKE Cluster<a class=headerlink href=#tweak-gke-cluster title="Permanent link">&para;</a></h2> <p>At this time of writing, Jenkins is suffering from an <a href=https://support.cloudbees.com/hc/en-us/articles/360019630132-Issue-connecting-External-Client-Master-with-TLS-setup-at-Ingress>outdated OpenSSL library</a>. This version doesn't support <a href=https://en.wikipedia.org/wiki/Server_Name_Indication>SNI</a>, which is what the <a href=https://github.com/kubernetes/ingress-nginx/issues/4674#issuecomment-569493421>Nginx Ingress Controller</a> relies on.</p> <p>When a Client Master (Managed or not) connects to the Operations Center via the Nginx Controller without SNI, the controller will not route you to the correct path. Because of this, when TLS is enabled, you will get the default controller's TLS certificate. As this certificate, by default, is an invalid one, you get TLS handshake errors.</p> <p>We have to rectify this. There are many ways to do this. For example, you make the TLS certificate for Operations Center the default TLS certificate. While this might not be nice for other applications, it will suit our case.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If there are many other applications in the same cluster, consider having more than one Nginx Ingress Controller.</p> <p>Via the configuration parameters <code>controller.scope.enabled</code> and <code>controller.scope.namespace</code> , you can limit the controller to a single namespace. This way, you can configure the default TLS certificate only for the Ingress Controller that manages the Operations Center's namespace  limiting the effect of the workaround.</p> </div> <p>In addition to the change for the default certificate, we also need to make sure external Masters can connect to the Operations Center. They require two ports to be open, <code>443</code> (or <code>80</code> if no TLS) and <code>50000</code> (if you've kept the default). </p> <p>For this we enable <code>tcp-services</code> and configure the <code>50000</code> port on the <em>deployment</em> and <em>service</em> (Kubernetes resources).</p> <p>How to change the Nginx Ingress configuration depends on how you've installed it. For sake of brevity, I will simply edit the resources via a <code>kubectl edit</code> (hint: don't do this in production).</p> <h3 id=tcp-services>TCP Services<a class=headerlink href=#tcp-services title="Permanent link">&para;</a></h3> <p>To enable the TCP services, we need to do two things: * create a config map with the configuration * enable tcp services in the deployment and point to the configmap</p> <div class=highlight><pre><span></span><code><span class=c1># nginx-config-map.yaml</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
 <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">tcp-services</span>
 <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class=nt>data</span><span class=p>:</span>
 <span class=nt>50000</span><span class=p>:</span> <span class=s>&quot;&lt;CJOC_NAMESPACE&gt;/cjoc:50000&quot;</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Do replace <code>CJOC_NAMESPACE</code> with the actual namespace!</p> </div> <div class=highlight><pre><span></span><code>kubectl apply -f nginx-config-map.yaml
</code></pre></div> <p>Once this is done, we can edit the controller's deployment.</p> <p>We have to make two changes: * add the tcp-services coniguration * add the port <code>50000</code> configuration</p> <p><div class=highlight><pre><span></span><code>kubectl -n <span class=si>${</span><span class=nv>NAMESPACE</span><span class=si>}</span> edit deployment nginx-ingress-controller
</code></pre></div> Among the container args, we add <code>--tcp-services-configmap</code>.</p> <div class=highlight><pre><span></span><code>    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>args</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/nginx-ingress-controller</span>
        <span class="l l-Scalar l-Scalar-Plain">...</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--tcp-services-configmap=kube-system/tcp-services</span>
</code></pre></div> <p>Next, we edit the same deployment, and add the tcp port.</p> <p>We will add the 50000 to the container ports.</p> <div class=highlight><pre><span></span><code>        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">50000</span>
          <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jnlp</span>
          <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
</code></pre></div> <p>It will then look something like this.</p> <div class=highlight><pre><span></span><code>        <span class=nt>ports</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
          <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
          <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
          <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https</span>
          <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">50000</span>
          <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jnlp</span>
          <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
</code></pre></div> <p>Last but not least, we also have to update the Nginx Ingress <em>service</em> resource.</p> <div class=highlight><pre><span></span><code>kubectl -n <span class=nv>$NAMESPACE</span> edit svc nginx-ingress-controller
</code></pre></div> <p>We add a similar port definition.</p> <div class=highlight><pre><span></span><code>  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jnlp</span>
    <span class=nt>nodePort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">31559</span>
    <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">50000</span>
    <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
    <span class=nt>targetPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jnlp</span>
</code></pre></div> <p>Which will then look something like this (clusterIp and nodePort's will be different).</p> <div class=highlight><pre><span></span><code><span class=nt>spec</span><span class=p>:</span>
  <span class=nt>clusterIP</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">.....</span>
  <span class=nt>externalTrafficPolicy</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Cluster</span>
  <span class=nt>ports</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
    <span class=nt>nodePort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">31406</span>
    <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
    <span class=nt>targetPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https</span>
    <span class=nt>nodePort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">30391</span>
    <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
    <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
    <span class=nt>targetPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jnlp</span>
    <span class=nt>nodePort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">31559</span>
    <span class=nt>port</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">50000</span>
    <span class=nt>protocol</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
    <span class=nt>targetPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jnlp</span>
</code></pre></div> <h3 id=set-default-tls-certificate>Set Default TLS Certificate<a class=headerlink href=#set-default-tls-certificate title="Permanent link">&para;</a></h3> <p>The first thing you'll have to do is to find out the name of the secret container the certificate. If you've created it yourself, great, else this is a way.</p> <div class=highlight><pre><span></span><code>kubectl get certificate -A
</code></pre></div> <p>The output should look like this:</p> <div class=highlight><pre><span></span><code>NAMESPACE    NAME                           READY   SECRET                         AGE
jx-staging   tls-staging-gke-kearos-net-p   True    tls-staging-gke-kearos-net-p   4d
jx           tls-dev-gke-kearos-net-p       True    tls-dev-gke-kearos-net-p       15d
</code></pre></div> <p>It should tell you which secret belongs to which certificate and in which namespace it resides. Note down both the secret name and the namespace.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Hint, the <code>-A</code> flag means <code>--all-namespaces</code> but then with less typing.</p> </div> <p><div class=highlight><pre><span></span><code>kubectl -n <span class=si>${</span><span class=nv>NAMESPACE</span><span class=si>}</span> edit deployment nginx-ingress-controller
</code></pre></div> Among the container args, <code>- --default-ssl-certificate=&lt;namespace&gt;/&lt;secretName&gt;</code>.</p> <p>And it should then look something like this:</p> <div class=highlight><pre><span></span><code>    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>args</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/nginx-ingress-controller</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
        <span class="l l-Scalar l-Scalar-Plain">- --default-ssl-certificate=default/tls-fake-kearos-net</span>
</code></pre></div> <h2 id=configure-aks-cluster>Configure AKS Cluster<a class=headerlink href=#configure-aks-cluster title="Permanent link">&para;</a></h2> <p>We need to do the following steps:</p> <ul> <li>retrieve the Kubernetes API endpoint</li> <li>retrieve the Kubernetes API endpoint's certificate</li> <li>retrieve the service account token</li> <li>install an Ingress controller</li> <li>create &amp; configure namespace for Managed Master(s)</li> <li>configure CloudBees Sidecar Injector</li> </ul> <h3 id=gather-kubernetes-credential-certificate>Gather Kubernetes Credential &amp; Certificate<a class=headerlink href=#gather-kubernetes-credential-certificate title="Permanent link">&para;</a></h3> <p>If you haven't already retrieved the Kubernetes credentials for your AKS cluster, you can do so via the <code>az</code> or <em>AzureCLI</em>.</p> <p><div class=highlight><pre><span></span><code>az aks get-credentials --resource-group <span class=si>${</span><span class=nv>AKS_RESOURCE_GROUP</span><span class=si>}</span> --name <span class=si>${</span><span class=nv>AKS_CLUSTER_NAME</span><span class=si>}</span>
</code></pre></div> All three parts that we need, the <em>Kubernetes API endpoint</em>, <em>Kubernetes API endpoint's certificate</em>, <em>Service Account Token</em> will be added to our <code>.kubeconfig</code>. In my case, it is located at <code>~/.kube/config</code>.</p> <ul> <li>Kubernetes API endpoint: <code>cluster.server</code></li> <li>Kubernetes API endpoint's certificate: <code>cluster.certificate-authority-data</code></li> <li>Service Account Token: <code>users.user.token</code></li> </ul> <p>Mind you, the certificate is Base64 encoded. To decode, you can usually use a command line tool. </p> <div class=tabbed-set data-tabs=1:1> <input name=__tabbed_1 type=radio id=__tabbed_1_1 checked=checked><label for=__tabbed_1_1>macOs</label><div class=tabbed-content><div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=s2>&quot;LS0tLS1C....LS0tCg==&quot;</span> <span class=p>|</span> base64 -D
</code></pre></div></div> </div> <p>The decoded thing should look like this:</p> <div class=highlight><pre><span></span><code>-----BEGIN CERTIFICATE-----
MIIEyTCCArGgAwIBAgIQK0sOS0aRjfZPYLM1TaRQMjANBgkqhkiG9w0BAQsFADAN
..........
<span class=nv>kKrPcnzV0gRdWNGNoJtRh9EGtKDP1VZUBiwdH44</span><span class=o>=</span>
-----END CERTIFICATE-----
</code></pre></div> <p>Save this into a <code>.pem</code> file, we're going to need it. Let's call it <code>aks-kubernetes-api-server.pem</code>.</p> <h3 id=install-an-ingress-controller>Install an Ingress controller<a class=headerlink href=#install-an-ingress-controller title="Permanent link">&para;</a></h3> <p>We're going to use Helm to install the Nginx Ingres Controller.</p> <p>Let's start by creating a namespace for your ingress resources</p> <div class=highlight><pre><span></span><code>kubectl create namespace ingress-nginx
</code></pre></div> <p>Add the official stable repository, just to be sure.</p> <div class=highlight><pre><span></span><code>helm repo add stable https://kubernetes-charts.storage.googleapis.com/
</code></pre></div> <p>And update the helm repos.</p> <div class=highlight><pre><span></span><code>helm repo update
</code></pre></div> <p>Create a values file, <code>ingress-values.yaml</code>, we will need to change some values.</p> <div class=highlight><pre><span></span><code><span class=nt>rbac</span><span class=p>:</span>
 <span class=nt>create</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>defaultBackend</span><span class=p>:</span>
 <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=nt>controller</span><span class=p>:</span>
 <span class=nt>ingressClass</span><span class=p>:</span> <span class=s>&quot;nginx&quot;</span>
 <span class=nt>metrics</span><span class=p>:</span>
   <span class=nt>enabled</span><span class=p>:</span> <span class=s>&quot;true&quot;</span>
 <span class=nt>replicaCount</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
 <span class=nt>nodeSelector</span><span class=p>:</span> 
   <span class=nt>beta\.kubernetes.io/os</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">linux</span> 
 <span class=nt>scope</span><span class=p>:</span>
   <span class=nt>enabled</span><span class=p>:</span> <span class=s>&quot;true&quot;</span>
   <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cbmasters</span>
 <span class=nt>service</span><span class=p>:</span>
   <span class=nt>externalTrafficPolicy</span><span class=p>:</span> <span class=s>&quot;Cluster&quot;</span>
</code></pre></div> <div class=tabbed-set data-tabs=2:2> <input name=__tabbed_2 type=radio id=__tabbed_2_1 checked=checked><label for=__tabbed_2_1>Helm V3</label><div class=tabbed-content><div class=highlight><pre><span></span><code>helm install nginx-ingress stable/nginx-ingress <span class=se>\</span>
 --namespace ingress-nginx <span class=se>\</span>
 --values ingress-values.yaml <span class=se>\</span>
 --version <span class=m>1</span>.29.6
</code></pre></div></div> <input name=__tabbed_2 type=radio id=__tabbed_2_2><label for=__tabbed_2_2>Helm V2</label><div class=tabbed-content><div class=highlight><pre><span></span><code>helm install <span class=se>\</span>
 --name nginx-ingress stable/nginx-ingress <span class=se>\</span>
 --namespace ingress-nginx <span class=se>\</span>
 --values ingress-values.yaml <span class=se>\</span>
 --version <span class=m>1</span>.29.6
</code></pre></div></div> </div> <h3 id=create-configure-namespace>Create &amp; Configure Namespace<a class=headerlink href=#create-configure-namespace title="Permanent link">&para;</a></h3> <p>We're going to use a feature from the official CloudBees Core helm chart. We start by creating the namespace that will house our Managed Master(s).</p> <div class=highlight><pre><span></span><code><span class=nv>NAMESPACE</span><span class=o>=</span>
</code></pre></div> <div class=highlight><pre><span></span><code>kubectl create namespace <span class=nv>$NAMESPACE</span>
</code></pre></div> <p>Create a configuration for CloudBees Core Helm chart, called <code>cloudbees-values.yaml</code>. The namespace of the Operations Center doesn't really matter, it is in a different cluster anyway.</p> <div class=highlight><pre><span></span><code><span class=nt>OperationsCenter</span><span class=p>:</span>
 <span class=nt>Enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=nt>Master</span><span class=p>:</span>
 <span class=nt>Enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
 <span class=nt>OperationsCenterNamespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudbees-core</span>
<span class=nt>Agents</span><span class=p>:</span>
 <span class=nt>Enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> <p>To be able to generate the Kubernetes resources files, we first have to use <code>helm fetch</code> to retrieve the chart.</p> <div class=highlight><pre><span></span><code>helm fetch <span class=se>\</span>
 --repo https://charts.cloudbees.com/public/cloudbees <span class=se>\</span>
 --version <span class=m>3</span>.8.0+a0d07461ae1c <span class=se>\</span>
 cloudbees-core
</code></pre></div> <p>Now we can generate the Kubernetes resource definitions and store them as a single yaml file.</p> <div class=highlight><pre><span></span><code>helm template cloudbees-core-namespace <span class=se>\</span>
 cloudbees-core-3.8.0+a0d07461ae1c.tgz <span class=se>\</span>
 -f cloudbees-values.yaml <span class=se>\</span>
 --namespace <span class=si>${</span><span class=nv>NAMESPACE</span><span class=si>}</span> <span class=se>\</span>
 &gt; cloudbees-core-namespace.yml
</code></pre></div> <p>Which we then apply.</p> <div class=highlight><pre><span></span><code>kubectl apply -f cloudbees-core-namespace.yml --namespace <span class=si>${</span><span class=nv>NAMESPACE</span><span class=si>}</span>
</code></pre></div> <h3 id=configure-cloudbees-sidecar-injector>Configure CloudBees Sidecar Injector<a class=headerlink href=#configure-cloudbees-sidecar-injector title="Permanent link">&para;</a></h3> <p>Unfortunately, the Let's Encrypt Root CA certificates are not yet in the trust stores of our images. So we have to ensure they end up in the Masters we run in this (AKS) cluster, so they do not run into SSL errors. You can find the certificates on the <a href=https://letsencrypt.org/certificates/ >certificates</a> page of letsencrypt.org.</p> <p>Make sure to download and save the PEM of <code>ISRGRoot X1 (self-signed)</code>, <code>Let's Encrypt Authority X3 (IdenTrust Cross-signed)</code>, and <code>Let's Encrypt Authority X3 (Signed By ISRG Root X1)</code>.</p> <p>Next, we have to add them to a bundle and a truststore, we can then put into a ConfigMap.</p> <p>We first have retrieve the current bundle and truststore. We can get them from Operations Center via a <code>kubectl cp</code>. The process is described in the <a href=https://docs.cloudbees.com/docs/cloudbees-core/latest/cloud-admin-guide/kubernetes-self-signed-certificates#_create_a_certificate_bundle>CloudBees Cloud Admin Guide</a>. Unfortunately, it seems as of CloudBees Core 2.204.+ the location has changed. The new locations are below. </p> <div class=highlight><pre><span></span><code>kubectl cp cjoc-0:etc/pki/ca-trust/extracted/java/cacerts ca-bundle/cacerts
kubectl cp cjoc-0:etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem ca-bundle/ca-certificates.crt
</code></pre></div> <p>Now that we have the files to start with, we can add our Let's Encrypt Root and Intermediary certificates.</p> <p>This assumes we're in the folder <code>ca-bundle</code>.</p> <div class=highlight><pre><span></span><code>cat valid-isrgrootx1-letsencrypt-org.pem &gt;&gt; ca-certificates.crt
keytool -import -noprompt -keystore cacerts -file valid-isrgrootx1-letsencrypt-org.pem -storepass changeit -alias letsencrypt<span class=p>;</span>
</code></pre></div> <p>We also have to add the <code>aks-kubernetes-api-server.pem</code> to ensure we can talk to the Kubernetes API Endpoint.</p> <div class=highlight><pre><span></span><code>cat aks-kubernetes-api-server.pem &gt;&gt; ca-certificates.crt
keytool -import -noprompt -keystore cacerts -file aks-kubernetes-api-server.pem -storepass changeit -alias kubeapi<span class=p>;</span>
</code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If you use custom or self-signed certificates, the process is the same. Simply substitute the Let's Encrypt certificates mentioned by your own / your provider's.</p> </div> <p>This assumes we're in the folder <code>ca-bundle</code>.</p> <div class=highlight><pre><span></span><code>kubectl create configmap --from-file<span class=o>=</span>ca-certificates.crt,cacerts ca-bundles
</code></pre></div> <p>Now we can focus on installing the <a href=https://docs.cloudbees.com/docs/cloudbees-core/latest/cloud-admin-guide/kubernetes-self-signed-certificates#_set_up_injector>CloudBees Sidecar Injector</a>. It is a tool that creates a <a href=https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/#how-pods-manage-multiple-containers>Sidecar</a> to inject the certificate bundle and truststore from the Configmap into containers.</p> <p>As before, we first fetch chart. Unfortunately, the value we need to change is not parameterized, so we have to un tar the config. We can let the Helm fetch do that via the <code>--untar</code> flag, followed by the <code>--untardir &lt;folderName&gt;</code> flag.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>If you haven't done so already, configure the CloudBees Helm repo by the following commands.</p> <div class=highlight><pre><span></span><code>helm repo add cloudbees https://charts.cloudbees.com/public/cloudbees
helm repo update
</code></pre></div> </div> <p>Update the configmap, in the file<code>templates/configmap.yaml</code>, set <code>requiresExplicitInjection</code> to true.</p> <div class=highlight><pre><span></span><code> requiresExplicitInjection: <span class=nb>true</span>
</code></pre></div> <p>Generate the end result via <code>helm template</code>.</p> <div class=highlight><pre><span></span><code>helm template cloudbees-sidecar-injector <span class=se>\</span>
 cloudbees-sidecar-injector <span class=se>\</span>
 --namespace cloudbees-sidecar-injector<span class=se>\</span>
 &gt; cloudbees-sidecar-injector.yml
</code></pre></div> <p>And apply the file.</p> <div class=highlight><pre><span></span><code>kubectl apply -f cloudbees-sidecar-injector.yml
</code></pre></div> <h2 id=configure-operations-center>Configure Operations Center<a class=headerlink href=#configure-operations-center title="Permanent link">&para;</a></h2> <p>We have to configure two things in Operations Center. First, we create the AKS endpoint, and then we configure the Master template by adding a YAML snippet.</p> <p>We go to <code>Operations Center</code> -&gt; <code>Manage Jenkins</code> -&gt; <code>Configure System</code> -&gt; <code>Kubernetes Master Provisioning</code>.</p> <h3 id=configure-endpoint>Configure Endpoint<a class=headerlink href=#configure-endpoint title="Permanent link">&para;</a></h3> <p><img alt="configure endpoint" src=../../images/multi-cluster-cjoc.png></p> <p>Every field is essential here.</p> <ul> <li><strong>API endpoint URL</strong>: the Kubernetes API server url, you should have this saved somewhere (e.g. <code>~/.kube/config</code>)</li> <li><strong>Display Name</strong>: the name by which you can refer to this endpoint</li> <li><strong>Credentials</strong>: credentials of the Service Account that can access the Kubernetes API, you should have this saved somewhere (e.g. <code>~/.kube/config</code>, <code>users.user.token</code>)</li> <li><strong>Server Certificate</strong>: the certificate of the Kubernetes API Server of the target cluster, copy paste the contents of <code>aks-kubernetes-api-server.pem</code></li> <li><strong>Namespace</strong>: the namespace we created on the AKS cluster which is configured to be used by Operations Center</li> <li><strong>Master URL Pattern</strong>: assuming that your domain name for the other cluster is different, make sure you have a pattern in here <code>http://ake.mydomain.com/*/</code> ensure all Master will have that host name and the Master name will replace the <code>*</code></li> <li><strong>Jenkins URL</strong>: the URL of this Operations Center, you can leave this blank</li> </ul> <h3 id=master-template>Master Template<a class=headerlink href=#master-template title="Permanent link">&para;</a></h3> <p>We can open up the Master template configuration by hitting the <code>Advanced</code> button in the Kubernetes Master Provisioning block.</p> <p><img alt=multi-cluster-cjoc-template src=../../images/multi-cluster-cjoc-template-1.png></p> <p>We have to add the annotation <code>com.cloudbees.sidecar-injector/inject: yes</code> to ensure the Masters will receive the certificates from the CloudBees Sidecar Injector - so they can talk to Operations Center.</p> <p>The full snippet becomes this:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class=s>&quot;apps/v1&quot;</span>
<span class=nt>kind</span><span class=p>:</span> <span class=s>&quot;StatefulSet&quot;</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>template</span><span class=p>:</span>
    <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>annotations</span><span class=p>:</span>
        <span class=nt>com.cloudbees.sidecar-injector/inject</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</code></pre></div> <p><img alt=multi-cluster-cjoc-template src=../../images/multi-cluster-cjoc-template-2.png></p> <p>And then hit the <code>Save</code> button at the bottom to persist our changes.</p> <h2 id=create-a-managed-master>Create a Managed Master<a class=headerlink href=#create-a-managed-master title="Permanent link">&para;</a></h2> <p>To create a Managed Master, we go to the home page of the Operations Center. If you're unsure, go to <code>&lt;cjocHost&gt;/cjoc/</code> or click on the top left breadcrumb <code>Jenkins</code>.</p> <p>On the top right, hit the button <code>New Master</code>.</p> <p><img alt=new-managed-master-step-1 src=../../images/multi-cluster-cjoc-create-mm1.png></p> <p>Give the Master an appropriate name and hit <code>Go</code>.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Sometimes the button is not clickable. Click next to the button with your mouse to make the text field lose focus. It should now be clickable.</p> </div> <p><img alt=new-managed-master-step-2 src=../../images/multi-cluster-cjoc-create-mm2.png></p> <p>The first thing we have to change, is the <code>Cluster endpoint</code>. This should now be a dropdown with <code>kubernetes</code> and <code>Azure</code> (or whatever you've named your endpoint). Select the one that points to your other cluster, in my case, <code>Azure</code>.</p> <p><img alt=new-managed-master-step-3 src=../../images/multi-cluster-cjoc-create-mm3.png></p> <p>We have one more change to make. We have to tell the JVM where our truststore is with the additional certificates. To ensure we can contact the Operations Center and the Kubernetes API.</p> <p>We do this by supplying the <code>javax.net.ssl.trustStore</code> and <code>javax.net.ssl.trustStorePassword</code> properties in the <code>System Properties</code> field. Each should be on its own line. If you're wondering what the location is, this is where the CloudBees Sidecar Injector will place the truststore.</p> <div class=highlight><pre><span></span><code>javax.net.ssl.trustStore<span class=o>=</span>/etc/ssl/certs/java/cacerts
javax.net.ssl.trustStorePassword<span class=o>=</span>changeit
</code></pre></div> <p>If you run into SSL or truststore issues -not trust issues, I cannot help you with those - you can enable debug logging by adding the following property.</p> <div class=highlight><pre><span></span><code>javax.net.debug<span class=o>=</span>SSL,trustmanager
</code></pre></div> <p><img alt=new-managed-master-step-4 src=../../images/multi-cluster-cjoc-create-mm4.png></p> <p>Hit the <code>Save</code> button at the bottom, and you should be good to go!</p> <hr> <div class=md-source-date> <small> Last update: 2020-02-01 11:52:48 </small> </div> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>var disqus_config=function(){this.page.url="https://joostvdg.github.io/cloudbees/multi-cluster/",this.page.identifier="/cloudbees/multi-cluster/"};!function(){var e=document,i=e.createElement("script");i.src="//joostvdg-github-io.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)}()</script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../multi-cluster-eks/ title="Multi-Cluster EKS" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Multi-Cluster EKS </div> </div> </a> <a href=../../jenkins/ title=Intro class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Intro </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Joost van der Griendt </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/joostvdg target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/joost_vdg target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/joostvdg target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.d710d30a.min.js></script> <script src=../../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../..",
          features: ["tabs", "instant"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>