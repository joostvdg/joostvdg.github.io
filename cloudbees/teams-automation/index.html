<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Use GitOps to manage Team Master in CloudBees Core on Modern"><link href=https://joostvdg.github.io/cloudbees/teams-automation/ rel=canonical><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.2"><title>Core Modern Teams Automation</title><link rel=stylesheet href=../../assets/stylesheets/main.a2408e81.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.a46bcfb3.min.css><meta name=theme-color content=#ffa726><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7CCutive+Mono&display=fallback"><style>body,input{font-family:"Lato",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Cutive Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-145385967-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=orange data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#core-modern-teams-automation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> J's Software Development Pages </span> <span class="md-header-nav__topic md-ellipsis"> Core Modern Teams Automation </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <div class=md-hero data-md-component=hero> <div class="md-hero__inner md-grid"> GitOps for Team Masters </div> </div> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../blogs/jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../sso-azure-ad/ class="md-tabs__link md-tabs__link--active"> Jenkins & CloudBees </a> </li> <li class=md-tabs__item> <a href=../../jenkinsx/build-packs/ class=md-tabs__link> Jenkins X </a> </li> <li class=md-tabs__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ class=md-tabs__link> Software Eng. </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Blogs <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Blogs data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../blogs/docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../blogs/k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../blogs/sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../blogs/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../blogs/kubernetes-sso-keycloak/ title="Kubernetes SSO Keycloak" class=md-nav__link> Kubernetes SSO Keycloak </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8> <label class=md-nav__link for=nav-2-8> Jenkins X Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ title="Database Connection And Secrets" class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ title="Previews & Integration Tests" class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ title="Promote To Production" class=md-nav__link> Promote To Production </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-9 type=checkbox id=nav-2-9> <label class=md-nav__link for=nav-2-9> Jenkins Monitoring Kubernetes <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Monitoring Kubernetes" data-md-level=2> <label class=md-nav__title for=nav-2-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/metrics/ title=Metrics class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../blogs/k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../blogs/dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3 checked> <label class=md-nav__link for=nav-3> Jenkins & CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins & CloudBees" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins & CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1 checked> <label class=md-nav__link for=nav-3-1> CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=CloudBees data-md-level=2> <label class=md-nav__title for=nav-3-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> CloudBees Automate Teams <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="CloudBees Automate Teams" class="md-nav__link md-nav__link--active"> CloudBees Automate Teams </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#goals class=md-nav__link> Goals </a> </li> <li class=md-nav__item> <a href=#before-we-start class=md-nav__link> Before We Start </a> </li> <li class=md-nav__item> <a href=#bootstrapping class=md-nav__link> Bootstrapping </a> <nav class=md-nav aria-label=Bootstrapping> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-api-token class=md-nav__link> Create API Token </a> </li> <li class=md-nav__item> <a href=#get-configure-client-jar class=md-nav__link> Get &amp; Configure Client Jar </a> </li> <li class=md-nav__item> <a href=#create-alias-test class=md-nav__link> Create Alias &amp; Test </a> </li> <li class=md-nav__item> <a href=#create-team-ops class=md-nav__link> Create Team Ops </a> </li> <li class=md-nav__item> <a href=#update-create-kubernetes-namespaces class=md-nav__link> Update &amp; Create Kubernetes Namespaces </a> <nav class=md-nav aria-label="Update & Create Kubernetes Namespaces"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-team-ops-namespace class=md-nav__link> Create Team Ops Namespace </a> </li> <li class=md-nav__item> <a href=#update-operation-center-serviceaccount class=md-nav__link> Update Operation Center ServiceAccount </a> </li> <li class=md-nav__item> <a href=#jenkins-agent-configmap class=md-nav__link> Jenkins Agent ConfigMap </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-initial-master class=md-nav__link> Create Initial Master </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-team-ops-master class=md-nav__link> Configure Team Ops Master </a> </li> <li class=md-nav__item> <a href=#create-gitops-pipeline class=md-nav__link> Create GitOps Pipeline </a> <nav class=md-nav aria-label="Create GitOps Pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-cli-image-pipeline class=md-nav__link> Create CLI Image Pipeline </a> <nav class=md-nav aria-label="Create CLI Image Pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kaniko-configuration class=md-nav__link> Kaniko Configuration </a> </li> <li class=md-nav__item> <a href=#pipeline class=md-nav__link> Pipeline </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pr-pipeline class=md-nav__link> PR Pipeline </a> <nav class=md-nav aria-label="PR Pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tools-used class=md-nav__link> Tools Used </a> </li> <li class=md-nav__item> <a href=#repository-layout class=md-nav__link> Repository Layout </a> </li> <li class=md-nav__item> <a href=#kustomize-configuration class=md-nav__link> Kustomize Configuration </a> </li> <li class=md-nav__item> <a href=#pipeline_1 class=md-nav__link> Pipeline </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#main-pipeline class=md-nav__link> Main Pipeline </a> <nav class=md-nav aria-label="Main Pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#process class=md-nav__link> Process </a> </li> <li class=md-nav__item> <a href=#notable-statements class=md-nav__link> Notable Statements </a> </li> <li class=md-nav__item> <a href=#files class=md-nav__link> Files </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> <li class=md-nav__item> <a href=../cbc-team-namespace/ title="Team Master Namespace" class=md-nav__link> Team Master Namespace </a> </li> <li class=md-nav__item> <a href=../multi-cluster-gke/ title="Multi-Cluster GKE" class=md-nav__link> Multi-Cluster GKE </a> </li> <li class=md-nav__item> <a href=../multi-cluster-eks/ title="Multi-Cluster EKS" class=md-nav__link> Multi-Cluster EKS </a> </li> <li class=md-nav__item> <a href=../multi-cluster/ title="Multi-Cluster (OLD/AKS)" class=md-nav__link> Multi-Cluster (OLD/AKS) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Jenkins <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Jenkins data-md-level=2> <label class=md-nav__title for=nav-3-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins Pipelines <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipelines" data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/kaniko-pipelines/ title="Build Docker Image Kaniko" class=md-nav__link> Build Docker Image Kaniko </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/podtemplate-dind/ title="PodTemplate With Docker-In-Docker" class=md-nav__link> PodTemplate With Docker-In-Docker </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ title="Parallel Pipelines" class=md-nav__link> Parallel Pipelines </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipeline Examples <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipeline Examples" data-md-level=2> <label class=md-nav__title for=nav-3-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Jenkins X <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/build-packs/ title="Build Packs" class=md-nav__link> Build Packs </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jx-pipelines/ title="Jenkins X Pipelines" class=md-nav__link> Jenkins X Pipelines </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-4-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ title="Database Connection And Secrets" class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ title="Previews & Integration Tests" class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ title="Promote To Production" class=md-nav__link> Promote To Production </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../jenkinsx/builder-image/ title="Create Builder Image" class=md-nav__link> Create Builder Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot/ title="JX Boot GKE" class=md-nav__link> JX Boot GKE </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot-aks/ title="JX Boot AKS" class=md-nav__link> JX Boot AKS </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/aks-boot-core/ title="JX Boot & CloudBees Core" class=md-nav__link> JX Boot & CloudBees Core </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-minimal/ title="OpenShift 3.11" class=md-nav__link> OpenShift 3.11 </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-restricted/ title="OpenShift 3.11 - Restricted" class=md-nav__link> OpenShift 3.11 - Restricted </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/lighthouse-bitbucket/ title="Lighthouse & Bitbucket" class=md-nav__link> Lighthouse & Bitbucket </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/kubernetes-days/ title="Example For Console Reel" class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Containers <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Containers data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> OpenShift <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=OpenShift data-md-level=2> <label class=md-nav__title for=nav-5-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-minimal/ title="OpenShift 3.11 GCP(minimal)" class=md-nav__link> OpenShift 3.11 GCP(minimal) </a> </li> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-medium/ title="OpenShift 3.11 GCP(medium)" class=md-nav__link> OpenShift 3.11 GCP(medium) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Kubernetes (K8S) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Kubernetes (K8S)" data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Managed Kubernetes (cloud) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Managed Kubernetes (cloud)" data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Managed Kubernetes (cloud) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/gke-terraform/ title="GKE Terraform" class=md-nav__link> GKE Terraform </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> K8S Hard Way - GCE <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="K8S Hard Way - GCE" data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Docker <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Docker data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> Linux <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Software Eng. <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Eng." data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Eng. </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Automation <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Automation data-md-level=2> <label class=md-nav__title for=nav-6-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ title=Pulumi class=md-nav__link> Pulumi </a> </li> <li class=md-nav__item> <a href=../../certificates/lets-encrypt-k8s/ title="Let's Encrypt K8S" class=md-nav__link> Let's Encrypt K8S </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Engineering" data-md-level=2> <label class=md-nav__title for=nav-6-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Productivity data-md-level=2> <label class=md-nav__title for=nav-6-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-4 type=checkbox id=nav-6-4> <label class=md-nav__link for=nav-6-4> Java <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Java data-md-level=2> <label class=md-nav__title for=nav-6-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../java/networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../java/concurrency/ title="Java Concurrency" class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#goals class=md-nav__link> Goals </a> </li> <li class=md-nav__item> <a href=#before-we-start class=md-nav__link> Before We Start </a> </li> <li class=md-nav__item> <a href=#bootstrapping class=md-nav__link> Bootstrapping </a> <nav class=md-nav aria-label=Bootstrapping> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-api-token class=md-nav__link> Create API Token </a> </li> <li class=md-nav__item> <a href=#get-configure-client-jar class=md-nav__link> Get &amp; Configure Client Jar </a> </li> <li class=md-nav__item> <a href=#create-alias-test class=md-nav__link> Create Alias &amp; Test </a> </li> <li class=md-nav__item> <a href=#create-team-ops class=md-nav__link> Create Team Ops </a> </li> <li class=md-nav__item> <a href=#update-create-kubernetes-namespaces class=md-nav__link> Update &amp; Create Kubernetes Namespaces </a> <nav class=md-nav aria-label="Update & Create Kubernetes Namespaces"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-team-ops-namespace class=md-nav__link> Create Team Ops Namespace </a> </li> <li class=md-nav__item> <a href=#update-operation-center-serviceaccount class=md-nav__link> Update Operation Center ServiceAccount </a> </li> <li class=md-nav__item> <a href=#jenkins-agent-configmap class=md-nav__link> Jenkins Agent ConfigMap </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-initial-master class=md-nav__link> Create Initial Master </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-team-ops-master class=md-nav__link> Configure Team Ops Master </a> </li> <li class=md-nav__item> <a href=#create-gitops-pipeline class=md-nav__link> Create GitOps Pipeline </a> <nav class=md-nav aria-label="Create GitOps Pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-cli-image-pipeline class=md-nav__link> Create CLI Image Pipeline </a> <nav class=md-nav aria-label="Create CLI Image Pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kaniko-configuration class=md-nav__link> Kaniko Configuration </a> </li> <li class=md-nav__item> <a href=#pipeline class=md-nav__link> Pipeline </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pr-pipeline class=md-nav__link> PR Pipeline </a> <nav class=md-nav aria-label="PR Pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tools-used class=md-nav__link> Tools Used </a> </li> <li class=md-nav__item> <a href=#repository-layout class=md-nav__link> Repository Layout </a> </li> <li class=md-nav__item> <a href=#kustomize-configuration class=md-nav__link> Kustomize Configuration </a> </li> <li class=md-nav__item> <a href=#pipeline_1 class=md-nav__link> Pipeline </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#main-pipeline class=md-nav__link> Main Pipeline </a> <nav class=md-nav aria-label="Main Pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#process class=md-nav__link> Process </a> </li> <li class=md-nav__item> <a href=#notable-statements class=md-nav__link> Notable Statements </a> </li> <li class=md-nav__item> <a href=#files class=md-nav__link> Files </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/cloudbees/teams-automation.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=core-modern-teams-automation>Core Modern Teams Automation<a class=headerlink href=#core-modern-teams-automation title="Permanent link">&para;</a></h1> <p>CloudBees Core on Modern (meaning, on Kubernetes) has two main types of Jenkins Masters, a Managed Master, and a Team Master. In this article, we're going to automate the creation and management of the Team Masters.</p> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>If you do not want to read any of the code here, or just want to take a look at the end result - pipeline wise - you can find working examples on GitHub.</p> <ul> <li><a href=https://github.com/joostvdg/cb-team-gitops-template>Template Repository</a> - creates a new team template and a PR to the GitOps repository</li> <li><a href=https://github.com/joostvdg/cb-team-gitops>GitOps Repository</a> - applies GitOps principles to manage the CloudBees Core Team Masters</li> </ul> </div> <h2 id=goals>Goals<a class=headerlink href=#goals title="Permanent link">&para;</a></h2> <p>Just automating the creation of a Team Master is relatively easy, as this can be done via the <a href>Client Jar</a>. So we're going to set some additional goals to create a decent challenge.</p> <ul> <li><strong>GitOps</strong>: I want to be able to create and delete Team Masters by managing configuration in a Git repository </li> <li><strong>Configuration-as-Code</strong>: as much of the configuration as possible should be stored in the Git repository</li> <li><strong>Namespace</strong>: one of the major reasons for Team Masters to exist is to increase (Product) Team autonomy, which in Kubernetes should correspond to a <code>namespace</code>. So I want each Team Master to be in its own Namespace!</li> <li><strong>Self-Service</strong>: the solution should cater to (semi-)autonomous teams and lower the workload of the team managing CloudBees Core. So requesting a Team Master should be doable by everyone</li> </ul> <h2 id=before-we-start>Before We Start<a class=headerlink href=#before-we-start title="Permanent link">&para;</a></h2> <p>Some assumptions need to be taken care off before we start.</p> <ul> <li>Kubernetes cluster in which you are <code>ClusterAdmin</code><ul> <li>if you don't have one yet, <a href=/kubernetes/distributions/install-gke/ >there are guides on this elsewhere on the site</a></li> </ul> </li> <li>your cluster has enough capacity (at least two nodes of 4gb memory)</li> <li>your cluster has CloudBees Core Modern installed<ul> <li>if you don't have this yet <a href=/cloudbees/cbc-gke-helm/ >look at one of the guides on this site</a></li> <li>or look at the <a href=https://go.cloudbees.com/docs/cloudbees-core/cloud-install-guide/ >guides on CloudBees.com</a></li> </ul> </li> <li>have administrator access to CloudBees Core Cloud <strong>Operations Center</strong></li> </ul> <div class="admonition tip"> <p class=admonition-title>Code Examples</p> <p>The more extensive Code Examples, such as Kubernetes Yaml files, are collapsed by default. You can open them by clicking on them. On the right, the code snippet will have a <code>[ ]</code> copy icon. Below is an example.</p> </div> <details class=example><summary>Code Snippet Example</summary><p>Here's a code snippet.</p> <div class=highlight><pre><span></span><code><span class=n>pipeline</span> <span class=o>{</span>
    <span class=n>agent</span> <span class=n>any</span>
    <span class=n>stages</span> <span class=o>{</span>
        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Hello&#39;</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>steps</span> <span class=o>{</span>
                <span class=n>echo</span> <span class=s1>&#39;Hello World!&#39;</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div> </details> <h2 id=bootstrapping>Bootstrapping<a class=headerlink href=#bootstrapping title="Permanent link">&para;</a></h2> <p>All right, so we want to use GitOps and to process the changes we need a Pipeline that can be triggered by a Webhook. I believe in <strong><em>everything as code</em></strong> - except Secrets and such - which includes the Pipeline.</p> <p>Unfortunately, <strong>Operations Center</strong> cannot run such pipelines. To get over this hurdle, we will create a special <code>Ops</code> Team Master. This Master will be configured to be able to Manage the other Team Masters for us.</p> <p>Log into your Operations Center with a user that has administrative access.</p> <h3 id=create-api-token>Create API Token<a class=headerlink href=#create-api-token title="Permanent link">&para;</a></h3> <p>Create a new API Token for your administrator user by clicking on the user's name - top right corner. Select the <code>Configuration</code> menu on the left and then you should see a section where you can <code>Create a API Token</code>. This Token will disappear, so write it down.</p> <h3 id=get-configure-client-jar>Get &amp; Configure Client Jar<a class=headerlink href=#get-configure-client-jar title="Permanent link">&para;</a></h3> <p>Replace the values marked by <code>&lt; ... &gt;</code>. The Operations Center URL should look like this: <code>http://cbcore.mydomain.com/cjoc</code>.</p> <p>Setup the connection variables.</p> <div class=highlight><pre><span></span><code><span class=nv>OC_URL</span><span class=o>=</span>&lt;your operations center url&gt;
</code></pre></div> <div class=highlight><pre><span></span><code><span class=nv>USR</span><span class=o>=</span>&lt;your username&gt;
<span class=nv>TKN</span><span class=o>=</span>&lt;api token&gt;
</code></pre></div> <p>Download the Client Jar.</p> <div class=highlight><pre><span></span><code>curl <span class=si>${</span><span class=nv>OC_URL</span><span class=si>}</span>/jnlpJars/jenkins-cli.jar -o jenkins-cli.jar
</code></pre></div> <h3 id=create-alias-test>Create Alias &amp; Test<a class=headerlink href=#create-alias-test title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=nb>alias</span> <span class=nv>cboc</span><span class=o>=</span><span class=s2>&quot;java -jar jenkins-cli.jar -noKeyAuth -auth </span><span class=si>${</span><span class=nv>USR</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nv>TKN</span><span class=si>}</span><span class=s2> -s </span><span class=si>${</span><span class=nv>OC_URL</span><span class=si>}</span><span class=s2>&quot;</span>
</code></pre></div> <div class=highlight><pre><span></span><code>cboc version
</code></pre></div> <h3 id=create-team-ops>Create Team Ops<a class=headerlink href=#create-team-ops title="Permanent link">&para;</a></h3> <p>As the tasks of the Team Masters for managing Operations are quite specific and demand special rights, I'd recommend putting this in its own <code>namespace</code>. To do so properly, we need to configure a few things.</p> <ul> <li>allows Operations Center access to this namespace (so it can create the Team Master)</li> <li>give the <code>ServiceAccount</code> the permissions to create <code>namespace</code>'s for the other Team Masters</li> <li>add config map for the Jenkins Agents</li> <li>temporarily change Operations Center's operating Namespace (where it will spawn resources in)</li> <li>use the CLI to create the <code>team-ops</code> Team Master</li> <li>reset Operations Center's operating Namespace</li> </ul> <h3 id=update-create-kubernetes-namespaces>Update &amp; Create Kubernetes Namespaces<a class=headerlink href=#update-create-kubernetes-namespaces title="Permanent link">&para;</a></h3> <h4 id=create-team-ops-namespace>Create Team Ops Namespace<a class=headerlink href=#create-team-ops-namespace title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>kubectl apply -f team-ops-namespace.yaml
</code></pre></div> <details class=example><summary>team-ops-namespace.yaml</summary><p>This creates the <code>team-ops</code> namespace including all the resources required such as <code>ResourceQuota</code>, <code>ServiceAccount</code> and so on.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Namespace</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">team-ops</span>

<span class=nn>---</span>

<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ResourceQuota</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">resource-quota</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">team-ops</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>hard</span><span class=p>:</span>
    <span class=nt>pods</span><span class=p>:</span> <span class=s>&quot;20&quot;</span>
    <span class=nt>requests.cpu</span><span class=p>:</span> <span class=s>&quot;4&quot;</span>
    <span class=nt>requests.memory</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">6Gi</span>
    <span class=nt>limits.cpu</span><span class=p>:</span> <span class=s>&quot;5&quot;</span>
    <span class=nt>limits.memory</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">10Gi</span>
    <span class=nt>services.loadbalancers</span><span class=p>:</span> <span class=s>&quot;0&quot;</span>
    <span class=nt>services.nodeports</span><span class=p>:</span> <span class=s>&quot;0&quot;</span>
    <span class=nt>persistentvolumeclaims</span><span class=p>:</span> <span class=s>&quot;10&quot;</span>

<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">team-ops</span>

<span class=nn>---</span>

<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">pods-all</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">team-ops</span>
<span class=nt>rules</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;pods&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;pods/exec&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;pods/log&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>

<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">team-ops</span>
<span class=nt>roleRef</span><span class=p>:</span>
  <span class=nt>apiGroup</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">pods-all</span>
<span class=nt>subjects</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">team-ops</span>

<span class=nn>---</span>

<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cjoc</span>
<span class=nt>roleRef</span><span class=p>:</span>
  <span class=nt>apiGroup</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">master-management</span>
<span class=nt>subjects</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">team-ops</span>

<span class=nn>---</span>

<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">create-namespaces</span>
<span class=nt>rules</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;*&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;serviceaccounts&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;rolebindings&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;roles&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;resourcequotas&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;namespaces&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;configmaps&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;rolebindings&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;roles&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;resourcequotas&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;namespaces&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;events&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;persistentvolumeclaims&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;pods&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;pods/exec&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;services&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;statefulsets&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;ingresses&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;extensions&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;pods/log&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;secrets&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;apps&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;statefulsets&quot;</span><span class="p p-Indicator">]</span> 
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;extensions&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;ingresses&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span> <span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>

<span class=nn>---</span>

<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ops-namespace</span>
<span class=nt>roleRef</span><span class=p>:</span>
  <span class=nt>apiGroup</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">create-namespaces</span>
<span class=nt>subjects</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">team-ops</span>
</code></pre></div> </details> <h4 id=update-operation-center-serviceaccount>Update Operation Center ServiceAccount<a class=headerlink href=#update-operation-center-serviceaccount title="Permanent link">&para;</a></h4> <p>The <code>ServiceAccount</code> under which Operation Center runs, only has rights in it's own <code>namespace</code>. Which means it cannot create our Team Ops Master. Below is the <code>.yaml</code> file for Kubernetes and the command to apply it.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>I assume you're using the default <code>cloudbees-core</code> as per Cloudbees' documentation. If this is not the case, change the last line, <code>namespace: cloudbees-core</code> with the namespace your Operation Center runs in.</p> </div> <div class=highlight><pre><span></span><code>kubectl apply -f patch-oc-serviceaccount.yaml -n team-ops
</code></pre></div> <details class=example><summary>patch-oc-serviceaccount.yaml</summary><p>This patches the existing Operation Center's ServiceAccount to also have the correct rights in the <code>team-ops</code> namespace.</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">master-management</span>
<span class=nt>rules</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;pods&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;pods/exec&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;pods/log&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;apps&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;statefulsets&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;services&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;persistentvolumeclaims&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;extensions&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;ingresses&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;create&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;delete&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;patch&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;update&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;secrets&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class=nt>apiGroups</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>resources</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;events&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>verbs</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;get&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;list&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;watch&quot;</span><span class="p p-Indicator">]</span>

<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cjoc</span>
<span class=nt>roleRef</span><span class=p>:</span>
  <span class=nt>apiGroup</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">master-management</span>
<span class=nt>subjects</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cjoc</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudbees-core</span>
</code></pre></div> </details> <h4 id=jenkins-agent-configmap>Jenkins Agent ConfigMap<a class=headerlink href=#jenkins-agent-configmap title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>kubectl apply -f jenkins-agent-config-map.yaml -n team-ops
</code></pre></div> <details class=example><summary>jenkins-agent-config-map.yaml</summary><p>Creates the Jenkins Agent ConfigMap, which contains the information the Jenkins Agent - within a PodTemplate - uses to connect to the Jenkins Master.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins-agent</span>
<span class=nt>data</span><span class=p>:</span>
  <span class=nt>jenkins-agent</span><span class=p>:</span> <span class="p p-Indicator">|</span>
    <span class=no>#!/usr/bin/env sh</span>
    <span class=no># The MIT License</span>
    <span class=no>#</span>
    <span class=no>#  Copyright (c) 2015, CloudBees, Inc.</span>
    <span class=no>#</span>
    <span class=no>#  Permission is hereby granted, free of charge, to any person obtaining a copy</span>
    <span class=no>#  of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
    <span class=no>#  in the Software without restriction, including without limitation the rights</span>
    <span class=no>#  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
    <span class=no>#  copies of the Software, and to permit persons to whom the Software is</span>
    <span class=no>#  furnished to do so, subject to the following conditions:</span>
    <span class=no>#</span>
    <span class=no>#  The above copyright notice and this permission notice shall be included in</span>
    <span class=no>#  all copies or substantial portions of the Software.</span>
    <span class=no>#</span>
    <span class=no>#  THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
    <span class=no>#  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
    <span class=no>#  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
    <span class=no>#  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
    <span class=no>#  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
    <span class=no>#  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
    <span class=no>#  THE SOFTWARE.</span>
    <span class=no># Usage jenkins-slave.sh [options] -url http://jenkins [SECRET] [AGENT_NAME]</span>
    <span class=no># Optional environment variables :</span>
    <span class=no># * JENKINS_TUNNEL : HOST:PORT for a tunnel to route TCP traffic to jenkins host, when jenkins can&#39;t be directly accessed over network</span>
    <span class=no># * JENKINS_URL : alternate jenkins URL</span>
    <span class=no># * JENKINS_SECRET : agent secret, if not set as an argument</span>
    <span class=no># * JENKINS_AGENT_NAME : agent name, if not set as an argument</span>
    <span class=no>if [ $# -eq 1 ]; then</span>
        <span class=no># if `docker run` only has one arguments, we assume user is running alternate command like `bash` to inspect the image</span>
        <span class=no>exec &quot;$@&quot;</span>
    <span class=no>else</span>
        <span class=no># if -tunnel is not provided try env vars</span>
        <span class=no>case &quot;$@&quot; in</span>
            <span class=no>*&quot;-tunnel &quot;*) ;;</span>
            <span class=no>*)</span>
            <span class=no>if [ ! -z &quot;$JENKINS_TUNNEL&quot; ]; then</span>
                <span class=no>TUNNEL=&quot;-tunnel $JENKINS_TUNNEL&quot;</span>
            <span class=no>fi ;;</span>
        <span class=no>esac</span>
        <span class=no>if [ -n &quot;$JENKINS_URL&quot; ]; then</span>
            <span class=no>URL=&quot;-url $JENKINS_URL&quot;</span>
        <span class=no>fi</span>
        <span class=no>if [ -n &quot;$JENKINS_NAME&quot; ]; then</span>
            <span class=no>JENKINS_AGENT_NAME=&quot;$JENKINS_NAME&quot;</span>
        <span class=no>fi  </span>
        <span class=no>if [ -z &quot;$JNLP_PROTOCOL_OPTS&quot; ]; then</span>
            <span class=no>echo &quot;Warning: JnlpProtocol3 is disabled by default, use JNLP_PROTOCOL_OPTS to alter the behavior&quot;</span>
            <span class=no>JNLP_PROTOCOL_OPTS=&quot;-Dorg.jenkinsci.remoting.engine.JnlpProtocol3.disabled=true&quot;</span>
        <span class=no>fi</span>
        <span class=no># If both required options are defined, do not pass the parameters</span>
        <span class=no>OPT_JENKINS_SECRET=&quot;&quot;</span>
        <span class=no>if [ -n &quot;$JENKINS_SECRET&quot; ]; then</span>
            <span class=no>case &quot;$@&quot; in</span>
                <span class=no>*&quot;${JENKINS_SECRET}&quot;*) echo &quot;Warning: SECRET is defined twice in command-line arguments and the environment variable&quot; ;;</span>
                <span class=no>*)</span>
                <span class=no>OPT_JENKINS_SECRET=&quot;${JENKINS_SECRET}&quot; ;;</span>
            <span class=no>esac</span>
        <span class=no>fi</span>

        <span class=no>OPT_JENKINS_AGENT_NAME=&quot;&quot;</span>
        <span class=no>if [ -n &quot;$JENKINS_AGENT_NAME&quot; ]; then</span>
            <span class=no>case &quot;$@&quot; in</span>
                <span class=no>*&quot;${JENKINS_AGENT_NAME}&quot;*) echo &quot;Warning: AGENT_NAME is defined twice in command-line arguments and the environment variable&quot; ;;</span>
                <span class=no>*)</span>
                <span class=no>OPT_JENKINS_AGENT_NAME=&quot;${JENKINS_AGENT_NAME}&quot; ;;</span>
            <span class=no>esac</span>
        <span class=no>fi</span>
        <span class=no>SLAVE_JAR=/usr/share/jenkins/slave.jar</span>
        <span class=no>if [ ! -f &quot;$SLAVE_JAR&quot; ]; then</span>
            <span class=no>tmpfile=$(mktemp)</span>
            <span class=no>if hash wget &gt; /dev/null 2&gt;&amp;1; then</span>
                <span class=no>wget -O &quot;$tmpfile&quot; &quot;$JENKINS_URL/jnlpJars/slave.jar&quot;</span>
            <span class=no>elif hash curl &gt; /dev/null 2&gt;&amp;1; then</span>
                <span class=no>curl -o &quot;$tmpfile&quot; &quot;$JENKINS_URL/jnlpJars/slave.jar&quot;</span>
            <span class=no>else</span>
                <span class=no>echo &quot;Image does not include $SLAVE_JAR and could not find wget or curl to download it&quot;</span>
                <span class=no>return 1</span>
            <span class=no>fi</span>
            <span class=no>SLAVE_JAR=$tmpfile</span>
        <span class=no>fi</span>
        <span class=no>#TODO: Handle the case when the command-line and Environment variable contain different values.</span>
        <span class=no>#It is fine it blows up for now since it should lead to an error anyway.</span>
        <span class=no>exec java $JAVA_OPTS $JNLP_PROTOCOL_OPTS -cp $SLAVE_JAR hudson.remoting.jnlp.Main -headless $TUNNEL $URL $OPT_JENKINS_SECRET $OPT_JENKINS_AGENT_NAME &quot;$@&quot;</span>
    <span class=no>fi</span>
</code></pre></div> </details> <h3 id=create-initial-master>Create Initial Master<a class=headerlink href=#create-initial-master title="Permanent link">&para;</a></h3> <p>To make it easier to change the <code>namespace</code> if needed, its extracted out from the command.</p> <div class=highlight><pre><span></span><code><span class=nv>OriginalNamespace</span><span class=o>=</span>cloudbees-core
</code></pre></div> <p>This script changes the Operations Center's operating <code>namespace</code>, creates a Team Master with the name <code>ops</code>, and then resets the namespace.</p> <div class=highlight><pre><span></span><code>cboc <span class=nv>groovy</span> <span class=o>=</span> &lt; configure-oc-namespace.groovy team-ops
cboc teams ops --put &lt; team-ops.json
cboc <span class=nv>groovy</span> <span class=o>=</span> &lt; configure-oc-namespace.groovy <span class=nv>$OriginalNamespace</span>
</code></pre></div> <details class=example><summary>team-ops.json</summary><p>This <code>json</code> file that describes a team. By default there are three roles defined on a team, <code>TEAM_ADMIN</code>, <code>TEAM_MEMBER</code>, and <code>TEAM_GUEST</code>. Don't forget to change the <code>id</code>'s to Group ID's from your Single-Sign-On solution.</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">{</span>
    <span class=s>&quot;version&quot;</span><span class=nt> </span><span class=p>:</span> <span class=s>&quot;1&quot;</span><span class="p p-Indicator">,</span>
    <span class=s>&quot;data&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
        <span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span> <span class=s>&quot;ops&quot;</span><span class="p p-Indicator">,</span>
        <span class=s>&quot;displayName&quot;</span><span class="p p-Indicator">:</span> <span class=s>&quot;Operations&quot;</span><span class="p p-Indicator">,</span>
        <span class=s>&quot;provisioningRecipe&quot;</span><span class="p p-Indicator">:</span> <span class=s>&quot;basic&quot;</span><span class="p p-Indicator">,</span>
        <span class=s>&quot;members&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[{</span>
            <span class=s>&quot;id&quot;</span><span class="p p-Indicator">:</span> <span class=s>&quot;Catmins&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;roles&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class=s>&quot;TEAM_ADMIN&quot;</span><span class="p p-Indicator">]</span>
        <span class="p p-Indicator">},</span>
        <span class="p p-Indicator">{</span>
            <span class=s>&quot;id&quot;</span><span class="p p-Indicator">:</span> <span class=s>&quot;Pirates&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;roles&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class=s>&quot;TEAM_MEMBER&quot;</span><span class="p p-Indicator">]</span>
        <span class="p p-Indicator">},</span>
        <span class="p p-Indicator">{</span>
            <span class=s>&quot;id&quot;</span><span class="p p-Indicator">:</span> <span class=s>&quot;Continental&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;roles&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class=s>&quot;TEAM_GUEST&quot;</span><span class="p p-Indicator">]</span>
        <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">],</span>
        <span class=s>&quot;icon&quot;</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span>
            <span class=s>&quot;name&quot;</span><span class="p p-Indicator">:</span> <span class=s>&quot;hexagons&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;color&quot;</span><span class="p p-Indicator">:</span> <span class=s>&quot;#8d7ec1&quot;</span>
        <span class="p p-Indicator">}</span>
    <span class="p p-Indicator">}</span>
<span class="p p-Indicator">}</span>
</code></pre></div> </details> <details class=example><summary>configure-oc-namespace.groovy</summary><p>This is a Jenkins Configuration or System Groovy script. It will change the <code>namespace</code> Operation Center uses to create resources. You can change this in the UI by going to <code>Operations Center</code> -&gt; <code>Manage Jenkins</code> -&gt; <code>System Configuration</code> -&gt; <code>Master Provisioning</code> -&gt; <code>Namespace</code>.</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>hudson.*</span>
<span class=kn>import</span> <span class=nn>hudson.util.Secret</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>hudson.util.Scrambler</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>hudson.util.FormValidation</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>jenkins.*</span>
<span class=kn>import</span> <span class=nn>jenkins.model.*</span>
<span class=kn>import</span> <span class=nn>hudson.security.*</span>

<span class=kn>import</span> <span class=nn>com.cloudbees.masterprovisioning.kubernetes.KubernetesMasterProvisioning</span>
<span class=kn>import</span> <span class=nn>com.cloudbees.masterprovisioning.kubernetes.KubernetesClusterEndpoint</span>

<span class=n>println</span> <span class=s2>&quot;=== KubernetesMasterProvisioning Configuration - start&quot;</span>

<span class=n>println</span> <span class=s2>&quot;== Retrieving main configuration&quot;</span>
<span class=kt>def</span> <span class=n>descriptor</span> <span class=o>=</span> <span class=n>Jenkins</span><span class=o>.</span><span class=na>getInstance</span><span class=o>().</span><span class=na>getInjector</span><span class=o>().</span><span class=na>getInstance</span><span class=o>(</span><span class=n>KubernetesMasterProvisioning</span><span class=o>.</span><span class=na>DescriptorImpl</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
<span class=kt>def</span> <span class=n>namespace</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span>

<span class=kt>def</span> <span class=n>currentKubernetesClusterEndpoint</span> <span class=o>=</span>  <span class=n>descriptor</span><span class=o>.</span><span class=na>getClusterEndpoints</span><span class=o>().</span><span class=na>get</span><span class=o>(</span><span class=mi>0</span><span class=o>)</span>
<span class=n>println</span> <span class=s2>&quot;= Found current endpoint&quot;</span>
<span class=n>println</span> <span class=s2>&quot;= &quot;</span> <span class=o>+</span> <span class=n>currentKubernetesClusterEndpoint</span><span class=o>.</span><span class=na>toString</span><span class=o>()</span>
<span class=kt>def</span> <span class=n>id</span> <span class=o>=</span> <span class=n>currentKubernetesClusterEndpoint</span><span class=o>.</span><span class=na>getId</span><span class=o>()</span>
<span class=kt>def</span> <span class=n>name</span> <span class=o>=</span> <span class=n>currentKubernetesClusterEndpoint</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span>
<span class=kt>def</span> <span class=n>url</span> <span class=o>=</span> <span class=n>currentKubernetesClusterEndpoint</span><span class=o>.</span><span class=na>getUrl</span><span class=o>()</span>
<span class=kt>def</span> <span class=n>credentialsId</span> <span class=o>=</span> <span class=n>currentKubernetesClusterEndpoint</span><span class=o>.</span><span class=na>getCredentialsId</span><span class=o>()</span>

<span class=n>println</span> <span class=s2>&quot;== Setting Namspace to &quot;</span> <span class=o>+</span> <span class=n>namespace</span>
<span class=kt>def</span> <span class=n>updatedKubernetesClusterEndpoint</span> <span class=o>=</span> <span class=k>new</span> <span class=n>KubernetesClusterEndpoint</span><span class=o>(</span><span class=n>id</span><span class=o>,</span> <span class=n>name</span><span class=o>,</span> <span class=n>url</span><span class=o>,</span> <span class=n>credentialsId</span><span class=o>,</span> <span class=n>namespace</span><span class=o>)</span>
<span class=kt>def</span> <span class=n>clusterEndpoints</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>KubernetesClusterEndpoint</span><span class=o>&gt;()</span>
<span class=n>clusterEndpoints</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>updatedKubernetesClusterEndpoint</span><span class=o>)</span>
<span class=n>descriptor</span><span class=o>.</span><span class=na>setClusterEndpoints</span><span class=o>(</span><span class=n>clusterEndpoints</span><span class=o>)</span>

<span class=n>println</span> <span class=s2>&quot;== Saving Jenkins configuration&quot;</span>
<span class=n>descriptor</span><span class=o>.</span><span class=na>save</span><span class=o>()</span>

<span class=n>println</span> <span class=s2>&quot;=== KubernetesMasterProvisioning Configuration - finish&quot;</span>
</code></pre></div> </details> <h2 id=configure-team-ops-master>Configure Team Ops Master<a class=headerlink href=#configure-team-ops-master title="Permanent link">&para;</a></h2> <p>Now that we've created the Operations Team Master (Team Ops), we can configure it. </p> <p>The Pipelines we need will require credentials, we describe them below. </p> <ul> <li><strong>githubtoken_token</strong>: GitHub API Token only, credentials type <code>Secret Text</code> (for the PR pipeline)</li> <li><strong>githubtoken</strong>: GitHub username and API Token</li> <li><strong>jenkins-api</strong>: Username and API Token for Operations Center. Just like the one we used for Client Jar.</li> </ul> <p>We also need to have a Global Pipeline Library defined by the name <code>github.com/joostvdg/jpl-core</code>. This, as the name suggests, should point to <code>https://github.com/joostvdg/jpl-core.git</code>.</p> <h2 id=create-gitops-pipeline>Create GitOps Pipeline<a class=headerlink href=#create-gitops-pipeline title="Permanent link">&para;</a></h2> <p>In total, we need two repositories and two or three Pipelines. You can either use my CLI Docker Image or roll your own. I will proceed as if you will create your own.</p> <ul> <li><strong>CLI Image Pipeline</strong>: this will create a CLI Docker Image that is used to talk to Operations Center via the Client Jar (CLI)</li> <li><strong>PR Pipeline</strong>: I like the idea of Self-Service, but in order to keep things in check, you might want to provide that via a PullRequest (PR) rather than a direct write to the Master branch. This is also Repository One, as I prefer having each pipeline in their own Repository, but you don't need to.</li> <li><strong>Main Pipeline</strong>: will trigger on a commit to the Master branch and create the new team. I'll even throw in a free <strong><em>manage your Team Recipes</em></strong> for free as well.</li> </ul> <h3 id=create-cli-image-pipeline>Create CLI Image Pipeline<a class=headerlink href=#create-cli-image-pipeline title="Permanent link">&para;</a></h3> <p>In a Kubernetes cluster, you should not build with Docker directly, use an in-cluster builder such as <a href=https://github.com/GoogleContainerTools/kaniko>Kaniko</a> or <a href=https://buildah.io/ >Buildah</a>. </p> <p>You can read more about the why and how <a href=/blogs/jenkins-pipeline-docker-alternatives/ >elsewhere on this site</a>.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>If you do not want to create your own, you can re-use my images.</p> <p>There should be one available for every recent version of CloudBees Core that will work with your Operations Center. The images are available in DockerHub at <a href=https://cloud.docker.com/u/caladreas/repository/docker/caladreas/cbcore-cli>caladreas/cbcore-cli</a></p> </div> <h4 id=kaniko-configuration>Kaniko Configuration<a class=headerlink href=#kaniko-configuration title="Permanent link">&para;</a></h4> <p>Kaniko uses a Docker Image to build your Docker Image in cluster. It does however need to directly communicate to your Docker Registry. This requires a Kubernetes <code>Secret</code> of type <code>docker-registry</code>.</p> <p>How you can do this and more, you <a href=https://go.cloudbees.com/docs/cloudbees-core/cloud-install-guide/kubernetes-using-kaniko/ >can read on the CloudBees Core Docs</a>.</p> <h4 id=pipeline>Pipeline<a class=headerlink href=#pipeline title="Permanent link">&para;</a></h4> <p>Now that you have Kaniko configured, you can use this Pipeline to create your own CLI Images.</p> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>Make sure you replace the environment variables with values that make sense to you.</p> <ul> <li><em>CJOC_URL</em> internal url in Kubernets, usually <code>http://cjoc.&lt;namespace&gt;/cjoc</code></li> <li><em>REGISTRY</em> : index.docker.io = DockerHub</li> <li><em>REPO</em>: docker repository name</li> <li><em>IMAGE</em>: docker image name</li> </ul> </div> <details class=example><summary>Jenkinsfile</summary><p>Jenkins Declarative Pipeline for the CLI Image geberation.</p> <div class=highlight><pre><span></span><code><span class=n>pipeline</span> <span class=o>{</span>
    <span class=n>agent</span> <span class=o>{</span>
        <span class=n>kubernetes</span> <span class=o>{</span>
        <span class=c1>//cloud &#39;kubernetes&#39;</span>
        <span class=n>label</span> <span class=s1>&#39;test&#39;</span>
        <span class=n>yaml</span> <span class=s2>&quot;&quot;&quot;</span>
<span class=s2>kind: Pod</span>
<span class=s2>metadata:</span>
<span class=s2>  name: test</span>
<span class=s2>spec:</span>
<span class=s2>  containers:</span>
<span class=s2>  - name: curl</span>
<span class=s2>    image: byrnedo/alpine-curl</span>
<span class=s2>    command:</span>
<span class=s2>    - cat</span>
<span class=s2>    tty: true</span>
<span class=s2>    resources:</span>
<span class=s2>      requests:</span>
<span class=s2>        memory: &quot;50Mi&quot;</span>
<span class=s2>        cpu: &quot;100m&quot;</span>
<span class=s2>      limits:</span>
<span class=s2>        memory: &quot;50Mi&quot;</span>
<span class=s2>        cpu: &quot;100m&quot;</span>
<span class=s2>  - name: kaniko</span>
<span class=s2>    image: gcr.io/kaniko-project/executor:debug</span>
<span class=s2>    imagePullPolicy: Always</span>
<span class=s2>    command:</span>
<span class=s2>    - /busybox/cat</span>
<span class=s2>    tty: true</span>
<span class=s2>    resources:</span>
<span class=s2>      requests:</span>
<span class=s2>        memory: &quot;50Mi&quot;</span>
<span class=s2>        cpu: &quot;100m&quot;</span>
<span class=s2>      limits:</span>
<span class=s2>        memory: &quot;50Mi&quot;</span>
<span class=s2>        cpu: &quot;100m&quot;</span>
<span class=s2>    volumeMounts:</span>
<span class=s2>      - name: jenkins-docker-cfg</span>
<span class=s2>        mountPath: /root</span>
<span class=s2>  volumes:</span>
<span class=s2>  - name: jenkins-docker-cfg</span>
<span class=s2>    projected:</span>
<span class=s2>      sources:</span>
<span class=s2>      - secret:</span>
<span class=s2>          name: docker-credentials</span>
<span class=s2>          items:</span>
<span class=s2>            - key: .dockerconfigjson</span>
<span class=s2>              path: .docker/config.json</span>
<span class=s2>&quot;&quot;&quot;</span>
        <span class=o>}</span>
    <span class=o>}</span>
    <span class=n>environment</span> <span class=o>{</span>
        <span class=n>CJOC_URL</span>    <span class=o>=</span> <span class=s1>&#39;http://cjoc.cloudbees-core/cjoc&#39;</span>
        <span class=n>CLI_VERSION</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
        <span class=n>REGISTRY</span>    <span class=o>=</span> <span class=s1>&#39;index.docker.io&#39;</span>
        <span class=n>REPO</span>        <span class=o>=</span> <span class=s1>&#39;caladreas&#39;</span>
        <span class=n>IMAGE</span>       <span class=o>=</span> <span class=s1>&#39;cbcore-cli&#39;</span>
    <span class=o>}</span>
    <span class=n>stages</span> <span class=o>{</span>
        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Download CLI&#39;</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>steps</span> <span class=o>{</span>
                <span class=n>container</span><span class=o>(</span><span class=s1>&#39;curl&#39;</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>sh</span> <span class=s1>&#39;curl --version&#39;</span>
                    <span class=n>sh</span> <span class=s1>&#39;echo ${CJOC_URL}/jnlpJars/jenkins-cli.jar&#39;</span>
                    <span class=n>sh</span> <span class=s1>&#39;curl ${CJOC_URL}/jnlpJars/jenkins-cli.jar --output jenkins-cli.jar&#39;</span>
                    <span class=n>sh</span> <span class=s1>&#39;ls -lath&#39;</span>
                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>}</span>
        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Prepare&#39;</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>parallel</span> <span class=o>{</span>
                <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Verify CLI&#39;</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>environment</span> <span class=o>{</span>
                        <span class=n>CREDS</span>   <span class=o>=</span> <span class=n>credentials</span><span class=o>(</span><span class=s1>&#39;jenkins-api&#39;</span><span class=o>)</span>
                        <span class=n>CLI</span>     <span class=o>=</span> <span class=s2>&quot;java -jar jenkins-cli.jar -noKeyAuth -s ${CJOC_URL} -auth&quot;</span>
                    <span class=o>}</span>
                    <span class=n>steps</span> <span class=o>{</span>
                        <span class=n>sh</span> <span class=s1>&#39;echo ${CLI}&#39;</span>
                        <span class=n>script</span> <span class=o>{</span>
                            <span class=n>CLI_VERSION</span> <span class=o>=</span> <span class=n>sh</span> <span class=nl>returnStdout:</span> <span class=kc>true</span><span class=o>,</span> <span class=nl>script:</span> <span class=s1>&#39;${CLI} ${CREDS} version&#39;</span>
                        <span class=o>}</span>
                        <span class=n>sh</span> <span class=s1>&#39;echo ${CLI_VERSION}&#39;</span>
                    <span class=o>}</span>
                <span class=o>}</span>
                <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Prepare Dockerfile&#39;</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>steps</span> <span class=o>{</span>
                        <span class=n>writeFile</span> <span class=nl>encoding:</span> <span class=s1>&#39;UTF-8&#39;</span><span class=o>,</span> <span class=nl>file:</span> <span class=s1>&#39;Dockerfile&#39;</span><span class=o>,</span> <span class=nl>text:</span> <span class=s2>&quot;&quot;&quot;FROM mcr.microsoft.com/java/jre-headless:8u192-zulu-alpine</span>
<span class=s2>WORKDIR /usr/bin</span>
<span class=s2>ADD jenkins-cli.jar .</span>
<span class=s2>RUN pwd</span>
<span class=s2>RUN ls -lath</span>
<span class=s2>&quot;&quot;&quot;</span>
                    <span class=o>}</span>
                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>}</span>
        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Build with Kaniko&#39;</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>environment</span> <span class=o>{</span> 
                <span class=n>PATH</span> <span class=o>=</span> <span class=s2>&quot;/busybox:/kaniko:$PATH&quot;</span>
                <span class=n>TAG</span>  <span class=o>=</span> <span class=s2>&quot;${CLI_VERSION}&quot;</span>
            <span class=o>}</span>
            <span class=n>steps</span> <span class=o>{</span>
                <span class=n>sh</span> <span class=s1>&#39;echo image fqn=${REGISTRY}/${REPO}/${IMAGE}:${TAG}&#39;</span>
                <span class=n>container</span><span class=o>(</span><span class=nl>name:</span> <span class=s1>&#39;kaniko&#39;</span><span class=o>,</span> <span class=nl>shell:</span> <span class=s1>&#39;/busybox/sh&#39;</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>sh</span> <span class=s1>&#39;&#39;&#39;#!/busybox/sh</span>
<span class=s1>                    /kaniko/executor -f `pwd`/Dockerfile -c `pwd` --cleanup --cache=true --destination=${REGISTRY}/${REPO}/${IMAGE}:${TAG}</span>
<span class=s1>                    /kaniko/executor -f `pwd`/Dockerfile -c `pwd` --cleanup --cache=true --destination=${REGISTRY}/${REPO}/${IMAGE}:latest</span>
<span class=s1>                    &#39;&#39;&#39;</span>
                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div> </details> <h3 id=pr-pipeline>PR Pipeline<a class=headerlink href=#pr-pipeline title="Permanent link">&para;</a></h3> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>The PR Pipeline example builds upon the GitHub API, if you're not using GItHub, you will have to figure out another way to make the PR.</p> </div> <h4 id=tools-used>Tools Used<a class=headerlink href=#tools-used title="Permanent link">&para;</a></h4> <ul> <li><a href=https://github.com/mikefarah/yq>yq</a>: commandline tool for processing Yaml files</li> <li><a href=https://stedolan.github.io/jq/ >jq</a> commandline tool for pressing Json files </li> <li><a href=https://kustomize.io>Kustomize</a> templating tool for Kubernetes Yaml, as of Kubernetes <code>1.13</code>, this is part of the Client (note, your server can be older, don't worry!)</li> <li><a href=https://github.com/github/hub>Hub</a> commandline client for GitHub</li> </ul> <h4 id=repository-layout>Repository Layout<a class=headerlink href=#repository-layout title="Permanent link">&para;</a></h4> <ul> <li>folder: <code>team-master-template</code><ul> <li>with file <code>simple.json</code></li> </ul> </li> <li>folder: <code>namespace-creation</code><ul> <li>with folder: <code>kustomize</code> this contains the <a href=https://kustomize.io/ >Kustomize</a> configuration</li> </ul> </li> </ul> <details class=example><summary>Simple.json</summary><p>This is a template for the team JSON definition.</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=nt>&quot;version&quot;</span> <span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>,</span>
    <span class=nt>&quot;data&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;NAME&quot;</span><span class=p>,</span>
        <span class=nt>&quot;displayName&quot;</span><span class=p>:</span> <span class=s2>&quot;DISPLAY_NAME&quot;</span><span class=p>,</span>
        <span class=nt>&quot;provisioningRecipe&quot;</span><span class=p>:</span> <span class=s2>&quot;RECIPE&quot;</span><span class=p>,</span>
        <span class=nt>&quot;members&quot;</span><span class=p>:</span> <span class=p>[</span>
            <span class=p>{</span>
                <span class=nt>&quot;id&quot;</span><span class=p>:</span> <span class=s2>&quot;ADMINS&quot;</span><span class=p>,</span>
                <span class=nt>&quot;roles&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;TEAM_ADMIN&quot;</span><span class=p>]</span>
            <span class=p>},</span>
            <span class=p>{</span>
                <span class=nt>&quot;id&quot;</span><span class=p>:</span> <span class=s2>&quot;MEMBERS&quot;</span><span class=p>,</span>
                <span class=nt>&quot;roles&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;TEAM_MEMBER&quot;</span><span class=p>]</span>
            <span class=p>},</span>
            <span class=p>{</span>
                <span class=nt>&quot;id&quot;</span><span class=p>:</span> <span class=s2>&quot;GUESTS&quot;</span><span class=p>,</span>
                <span class=nt>&quot;roles&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;TEAM_GUEST&quot;</span><span class=p>]</span>
            <span class=p>}</span>
        <span class=p>],</span>
        <span class=nt>&quot;icon&quot;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;ICON&quot;</span><span class=p>,</span>
            <span class=nt>&quot;color&quot;</span><span class=p>:</span> <span class=s2>&quot;HEX_COLOR&quot;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> </details> <h4 id=kustomize-configuration>Kustomize Configuration<a class=headerlink href=#kustomize-configuration title="Permanent link">&para;</a></h4> <p>Kustomize is a tool for template Kubernetes YAML definitions, which is what we need here. However, only for the <code>namespace</code> creation &amp; configuration. So if you don't want to do that, you can skip this.</p> <p>The Kustomize configuration has two parts, a folder called <code>team-example</code> with a <code>kustomization.yaml</code>. This will be what we configure to generate a new yaml definition. The main template is in the folder <code>base</code>, where the entrypoint will be again <code>kustomization.yaml</code>. This time, the <code>kustomization.yaml</code> will link to all the template files we need.</p> <p>As posting all these yaml files again is a bit much, I'll link to my example repo. Feel free to fork it instead: <a href=https://github.com/joostvdg/cb-team-gitops-template>cb-team-gitops-template</a></p> <ul> <li><a href=https://github.com/joostvdg/cb-team-gitops-template/blob/master/namespace-creation/kustomize/base/configmap.yaml>configmap.yaml</a>: the Jenkins Agent ConfigMap</li> <li><a href=https://github.com/joostvdg/cb-team-gitops-template/blob/master/namespace-creation/kustomize/base/namespace.yaml>namespace.yaml</a>: the new namespace</li> <li><a href=https://github.com/joostvdg/cb-team-gitops-template/blob/master/namespace-creation/kustomize/base/resource-quota.yaml>resource-quota.yaml</a>: resource quota's for the namespace</li> <li><a href=https://github.com/joostvdg/cb-team-gitops-template/blob/master/namespace-creation/kustomize/base/role-binding-cjoc.yaml>role-binding-cjoc.yaml</a>: a role binding for the CJOC ServiceAccount, so it create create the new Master in the new <code>namespace</code></li> <li><a href=https://github.com/joostvdg/cb-team-gitops-template/blob/master/namespace-creation/kustomize/base/role-binding.yaml>role-binding.yaml</a>: the role binding for the <code>jenkins</code> ServiceAccount, which allows the new Master to create and manage Pods (for PodTemplates)</li> <li><a href=https://github.com/joostvdg/cb-team-gitops-template/blob/master/namespace-creation/kustomize/base/role-cjoc.yaml>role-cjoc.yaml</a>: the role for CJOC for the ability to create a Master in the new Namspace</li> <li><a href=https://github.com/joostvdg/cb-team-gitops-template/blob/master/namespace-creation/kustomize/base/role.yaml>role.yaml</a>: the role for the <code>jenkins</code> ServiceAccount for the new Master</li> <li><a href=https://github.com/joostvdg/cb-team-gitops-template/blob/master/namespace-creation/kustomize/base/service-account.yaml>service-account.yaml</a>: the ServiceAccount, <code>jenkins</code>, used by the new Master</li> </ul> <h4 id=pipeline_1>Pipeline<a class=headerlink href=#pipeline_1 title="Permanent link">&para;</a></h4> <p>The Pipeline will do the following:</p> <ul> <li>capture input parameters to be used to customize the Team Master</li> <li>update the Kustomize template to make sure every resource is correct for the new namespace (<code>teams-&lt;name of team&gt;</code>)</li> <li>execute Kustomize to generate a single <code>yaml</code> file that defines the configuration for the new Team Masters' namespace</li> <li>process the <code>simple.json</code> to generate a <code>team.json</code> file for the new Team Master for use with the Jenkins CLI</li> <li>checkout your GIT_REPO that contains your team definitions</li> <li>create a new PR to your GIT_REPO for the new team</li> </ul> <details class=example><summary>Jenkinsfile</summary><p>Variables to update:</p> <ul> <li><strong>GIT_REPO</strong>: the GitHub repository in which the Team Definitions are stored</li> <li><strong>RESET_NAMESPACE</strong>: the namespace Operations Center should use as default</li> </ul> <div class=highlight><pre><span></span><code>  <span class=n>pipeline</span> <span class=o>{</span>
      <span class=n>agent</span> <span class=o>{</span>
          <span class=n>kubernetes</span> <span class=o>{</span>
          <span class=n>label</span> <span class=s1>&#39;team-automation&#39;</span>
          <span class=n>yaml</span> <span class=s2>&quot;&quot;&quot;</span>
<span class=s2>  kind: Pod</span>
<span class=s2>  spec:</span>
<span class=s2>    containers:</span>
<span class=s2>    - name: hub</span>
<span class=s2>      image:  caladreas/hub</span>
<span class=s2>      command: [&quot;cat&quot;]</span>
<span class=s2>      tty: true</span>
<span class=s2>      resources:</span>
<span class=s2>        requests:</span>
<span class=s2>          memory: &quot;50Mi&quot;</span>
<span class=s2>          cpu: &quot;150m&quot;</span>
<span class=s2>        limits:</span>
<span class=s2>          memory: &quot;50Mi&quot;</span>
<span class=s2>          cpu: &quot;150m&quot;</span>
<span class=s2>    - name: kubectl</span>
<span class=s2>      image: bitnami/kubectl:latest</span>
<span class=s2>      command: [&quot;cat&quot;]</span>
<span class=s2>      tty: true</span>
<span class=s2>      securityContext:</span>
<span class=s2>        runAsUser: 1000</span>
<span class=s2>        fsGroup: 1000</span>
<span class=s2>      resources:</span>
<span class=s2>        requests:</span>
<span class=s2>          memory: &quot;50Mi&quot;</span>
<span class=s2>          cpu: &quot;100m&quot;</span>
<span class=s2>        limits:</span>
<span class=s2>          memory: &quot;150Mi&quot;</span>
<span class=s2>          cpu: &quot;200m&quot;</span>
<span class=s2>    - name: yq</span>
<span class=s2>      image: mikefarah/yq</span>
<span class=s2>      command: [&#39;cat&#39;]</span>
<span class=s2>      tty: true</span>
<span class=s2>      resources:</span>
<span class=s2>        requests:</span>
<span class=s2>          memory: &quot;50Mi&quot;</span>
<span class=s2>          cpu: &quot;100m&quot;</span>
<span class=s2>        limits:</span>
<span class=s2>          memory: &quot;50Mi&quot;</span>
<span class=s2>          cpu: &quot;100m&quot;</span>
<span class=s2>    - name: jq</span>
<span class=s2>      image: colstrom/jq</span>
<span class=s2>      command: [&#39;cat&#39;]</span>
<span class=s2>      tty: true</span>
<span class=s2>      resources:</span>
<span class=s2>        requests:</span>
<span class=s2>          memory: &quot;50Mi&quot;</span>
<span class=s2>          cpu: &quot;100m&quot;</span>
<span class=s2>        limits:</span>
<span class=s2>          memory: &quot;50Mi&quot;</span>
<span class=s2>          cpu: &quot;100m&quot;</span>

<span class=s2>  &quot;&quot;&quot;</span>
          <span class=o>}</span>
      <span class=o>}</span>
      <span class=n>libraries</span> <span class=o>{</span>
          <span class=n>lib</span><span class=o>(</span><span class=s1>&#39;github.com/joostvdg/jpl-core&#39;</span><span class=o>)</span>
      <span class=o>}</span>
      <span class=n>options</span> <span class=o>{</span>
          <span class=n>disableConcurrentBuilds</span><span class=o>()</span> <span class=c1>// we don&#39;t want more than one at a time</span>
          <span class=n>checkoutToSubdirectory</span> <span class=s1>&#39;templates&#39;</span> <span class=c1>// we need to do two checkouts</span>
          <span class=n>buildDiscarder</span> <span class=nf>logRotator</span><span class=o>(</span><span class=nl>artifactDaysToKeepStr:</span> <span class=s1>&#39;&#39;</span><span class=o>,</span> <span class=nl>artifactNumToKeepStr:</span> <span class=s1>&#39;&#39;</span><span class=o>,</span> <span class=nl>daysToKeepStr:</span> <span class=s1>&#39;5&#39;</span><span class=o>,</span> <span class=nl>numToKeepStr:</span> <span class=s1>&#39;5&#39;</span><span class=o>)</span> <span class=c1>// always clean up</span>
      <span class=o>}</span>
      <span class=n>environment</span> <span class=o>{</span>
          <span class=n>envGitInfo</span>          <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>RESET_NAMESPACE</span>     <span class=o>=</span> <span class=s1>&#39;jx-production&#39;</span>
          <span class=n>TEAM_BASE_NAME</span>      <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>NAMESPACE_TO_CREATE</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>DISPLAY_NAME</span>        <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>TEAM_RECIPE</span>         <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>ICON</span>                <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>ICON_COLOR_CODE</span>     <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>ADMINS_ROLE</span>         <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>MEMBERS_ROLE</span>        <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>GUESTS_ROLE</span>         <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>RECORD_LOC</span>          <span class=o>=</span> <span class=s1>&#39;&#39;</span>
          <span class=n>GIT_REPO</span>                 <span class=o>=</span> <span class=s1>&#39;&#39;</span>
      <span class=o>}</span>
      <span class=n>stages</span> <span class=o>{</span>
          <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Team Details&#39;</span><span class=o>)</span> <span class=o>{</span>
              <span class=n>input</span> <span class=o>{</span>
                  <span class=n>message</span> <span class=s2>&quot;Please enter the team details.&quot;</span>
                  <span class=n>ok</span> <span class=s2>&quot;Looks good, proceed&quot;</span>
                  <span class=n>parameters</span> <span class=o>{</span>
                      <span class=n>string</span><span class=o>(</span><span class=nl>name:</span> <span class=s1>&#39;Name&#39;</span><span class=o>,</span> <span class=nl>defaultValue:</span> <span class=s1>&#39;hex&#39;</span><span class=o>,</span> <span class=nl>description:</span> <span class=s1>&#39;Please specify a team name&#39;</span><span class=o>)</span>
                      <span class=n>string</span><span class=o>(</span><span class=nl>name:</span> <span class=s1>&#39;DisplayName&#39;</span><span class=o>,</span> <span class=nl>defaultValue:</span> <span class=s1>&#39;Hex&#39;</span><span class=o>,</span> <span class=nl>description:</span> <span class=s1>&#39;Please specify a team display name&#39;</span><span class=o>)</span>
                      <span class=n>choice</span> <span class=nl>choices:</span> <span class=o>[</span><span class=s1>&#39;joostvdg&#39;</span><span class=o>,</span> <span class=s1>&#39;basic&#39;</span><span class=o>,</span> <span class=s1>&#39;java-web&#39;</span><span class=o>],</span> <span class=nl>description:</span> <span class=s1>&#39;Please select a Team Recipe&#39;</span><span class=o>,</span> <span class=nl>name:</span> <span class=s1>&#39;TeamRecipe&#39;</span>
                      <span class=n>choice</span> <span class=nl>choices:</span> <span class=o>[</span><span class=s1>&#39;anchor&#39;</span><span class=o>,</span> <span class=s1>&#39;bear&#39;</span><span class=o>,</span> <span class=s1>&#39;bowler-hat&#39;</span><span class=o>,</span> <span class=s1>&#39;briefcase&#39;</span><span class=o>,</span> <span class=s1>&#39;bug&#39;</span><span class=o>,</span> <span class=s1>&#39;calculator&#39;</span><span class=o>,</span> <span class=s1>&#39;calculatorcart&#39;</span><span class=o>,</span> <span class=s1>&#39;clock&#39;</span><span class=o>,</span> <span class=s1>&#39;cloud&#39;</span><span class=o>,</span> <span class=s1>&#39;cloudbees&#39;</span><span class=o>,</span> <span class=s1>&#39;connect&#39;</span><span class=o>,</span> <span class=s1>&#39;dollar-bill&#39;</span><span class=o>,</span> <span class=s1>&#39;dollar-symbol&#39;</span><span class=o>,</span> <span class=s1>&#39;file&#39;</span><span class=o>,</span> <span class=s1>&#39;flag&#39;</span><span class=o>,</span> <span class=s1>&#39;flower-carnation&#39;</span><span class=o>,</span> <span class=s1>&#39;flower-daisy&#39;</span><span class=o>,</span> <span class=s1>&#39;help&#39;</span><span class=o>,</span> <span class=s1>&#39;hexagon&#39;</span><span class=o>,</span> <span class=s1>&#39;high-heels&#39;</span><span class=o>,</span> <span class=s1>&#39;jenkins&#39;</span><span class=o>,</span> <span class=s1>&#39;key&#39;</span><span class=o>,</span> <span class=s1>&#39;marker&#39;</span><span class=o>,</span> <span class=s1>&#39;monocle&#39;</span><span class=o>,</span> <span class=s1>&#39;mustache&#39;</span><span class=o>,</span> <span class=s1>&#39;office&#39;</span><span class=o>,</span> <span class=s1>&#39;panther&#39;</span><span class=o>,</span> <span class=s1>&#39;paw-print&#39;</span><span class=o>,</span> <span class=s1>&#39;teacup&#39;</span><span class=o>,</span> <span class=s1>&#39;tiger&#39;</span><span class=o>,</span> <span class=s1>&#39;truck&#39;</span><span class=o>],</span> <span class=nl>description:</span> <span class=s1>&#39;Please select an Icon&#39;</span><span class=o>,</span> <span class=nl>name:</span> <span class=s1>&#39;Icon&#39;</span>
                      <span class=n>string</span><span class=o>(</span><span class=nl>name:</span> <span class=s1>&#39;IconColorCode&#39;</span><span class=o>,</span> <span class=nl>defaultValue:</span> <span class=s1>&#39;#CCCCCC&#39;</span><span class=o>,</span> <span class=nl>description:</span> <span class=s1>&#39;Please specify a valid html hexcode for the color (https://htmlcolorcodes.com/)&#39;</span><span class=o>)</span>
                      <span class=n>string</span><span class=o>(</span><span class=nl>name:</span> <span class=s1>&#39;Admins&#39;</span><span class=o>,</span> <span class=nl>defaultValue:</span> <span class=s1>&#39;Catmins&#39;</span><span class=o>,</span> <span class=nl>description:</span> <span class=s1>&#39;Please specify a groupid or userid for the TEAM_ADMIN role&#39;</span><span class=o>)</span>
                      <span class=n>string</span><span class=o>(</span><span class=nl>name:</span> <span class=s1>&#39;Members&#39;</span><span class=o>,</span> <span class=nl>defaultValue:</span> <span class=s1>&#39;Pirates&#39;</span><span class=o>,</span> <span class=nl>description:</span> <span class=s1>&#39;Please specify a groupid or userid for the TEAM_MEMBER role&#39;</span><span class=o>)</span>
                      <span class=n>string</span><span class=o>(</span><span class=nl>name:</span> <span class=s1>&#39;Guests&#39;</span><span class=o>,</span> <span class=nl>defaultValue:</span> <span class=s1>&#39;Continental&#39;</span><span class=o>,</span> <span class=nl>description:</span> <span class=s1>&#39;Please specify a groupid or userid for the TEAM_GUEST role&#39;</span><span class=o>)</span>
                  <span class=o>}</span>
              <span class=o>}</span>
              <span class=n>steps</span> <span class=o>{</span>
                  <span class=n>println</span> <span class=s2>&quot;Name=${Name}&quot;</span>
                  <span class=n>println</span> <span class=s2>&quot;DisplayName=${DisplayName}&quot;</span>
                  <span class=n>println</span> <span class=s2>&quot;TeamRecipe=${TeamRecipe}&quot;</span>
                  <span class=n>println</span> <span class=s2>&quot;Icon=${Icon}&quot;</span>
                  <span class=n>println</span> <span class=s2>&quot;IconColorCode=${IconColorCode}&quot;</span>
                  <span class=n>println</span> <span class=s2>&quot;Admins=${Admins}&quot;</span>
                  <span class=n>println</span> <span class=s2>&quot;Members=${Members}&quot;</span>
                  <span class=n>println</span> <span class=s2>&quot;Guests=${Guests}&quot;</span>
                  <span class=n>script</span> <span class=o>{</span>
                      <span class=n>TEAM_BASE_NAME</span>      <span class=o>=</span> <span class=s2>&quot;${Name}&quot;</span>
                      <span class=n>NAMESPACE_TO_CREATE</span> <span class=o>=</span> <span class=s2>&quot;cb-teams-${Name}&quot;</span>
                      <span class=n>DISPLAY_NAME</span>        <span class=o>=</span> <span class=s2>&quot;${DisplayName}&quot;</span>
                      <span class=n>TEAM_RECIPE</span>         <span class=o>=</span> <span class=s2>&quot;${TeamRecipe}&quot;</span>
                      <span class=n>ICON</span>                <span class=o>=</span> <span class=s2>&quot;${Icon}&quot;</span>
                      <span class=n>ICON_COLOR_CODE</span>     <span class=o>=</span> <span class=s2>&quot;${IconColorCode}&quot;</span>
                      <span class=n>ADMINS_ROLE</span>         <span class=o>=</span> <span class=s2>&quot;${Admins}&quot;</span>
                      <span class=n>MEMBERS_ROLE</span>        <span class=o>=</span> <span class=s2>&quot;${Members}&quot;</span>
                      <span class=n>GUESTS_ROLE</span>         <span class=o>=</span> <span class=s2>&quot;${Guests}&quot;</span>
                      <span class=n>RECORD_LOC</span>          <span class=o>=</span> <span class=s2>&quot;templates/teams/${Name}&quot;</span>
                      <span class=n>sh</span> <span class=s2>&quot;mkdir -p ${RECORD_LOC}&quot;</span>
                  <span class=o>}</span>
              <span class=o>}</span>
          <span class=o>}</span>
          <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Create Team Config&#39;</span><span class=o>)</span> <span class=o>{</span>
              <span class=n>environment</span> <span class=o>{</span>
                  <span class=n>BASE</span>        <span class=o>=</span> <span class=s1>&#39;templates/namespace-creation/kustomize&#39;</span>
                  <span class=n>NAMESPACE</span>   <span class=o>=</span> <span class=s2>&quot;${NAMESPACE_TO_CREATE}&quot;</span>
                  <span class=n>RECORD_LOC</span>  <span class=o>=</span> <span class=s2>&quot;templates/teams/${TEAM_BASE_NAME}&quot;</span>
              <span class=o>}</span>
              <span class=n>parallel</span> <span class=o>{</span>
                  <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Namespace&#39;</span><span class=o>)</span> <span class=o>{</span>
                      <span class=n>steps</span> <span class=o>{</span>
                          <span class=n>container</span><span class=o>(</span><span class=s1>&#39;yq&#39;</span><span class=o>)</span> <span class=o>{</span>
                              <span class=n>sh</span> <span class=s1>&#39;yq w -i ${BASE}/base/role-binding.yaml subjects[0].namespace ${NAMESPACE}&#39;</span>
                              <span class=n>sh</span> <span class=s1>&#39;yq w -i ${BASE}/base/namespace.yaml metadata.name ${NAMESPACE}&#39;</span>
                              <span class=n>sh</span> <span class=s1>&#39;yq w -i ${BASE}/team-example/kustomization.yaml namespace ${NAMESPACE}&#39;</span>
                          <span class=o>}</span>
                          <span class=n>container</span><span class=o>(</span><span class=s1>&#39;kubectl&#39;</span><span class=o>)</span> <span class=o>{</span>
                              <span class=n>sh</span> <span class=s1>&#39;&#39;&#39;</span>
<span class=s1>                                  kubectl kustomize ${BASE}/team-example &gt; ${RECORD_LOC}/team.yaml</span>
<span class=s1>                                  cat ${RECORD_LOC}/team.yaml</span>
<span class=s1>                              &#39;&#39;&#39;</span>
                          <span class=o>}</span>
                      <span class=o>}</span>
                  <span class=o>}</span>
                  <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Team Master JSON&#39;</span><span class=o>)</span> <span class=o>{</span>
                      <span class=n>steps</span> <span class=o>{</span>
                          <span class=n>container</span><span class=o>(</span><span class=s1>&#39;jq&#39;</span><span class=o>)</span> <span class=o>{</span>
                              <span class=n>sh</span> <span class=s2>&quot;&quot;&quot;jq \</span>
<span class=s2>                              &#39;.data.name = &quot;${TEAM_BASE_NAME}&quot; |\</span>
<span class=s2>                              .data.displayName = &quot;${DISPLAY_NAME}&quot; |\</span>
<span class=s2>                              .data.provisioningRecipe = &quot;${TEAM_RECIPE}&quot; |\</span>
<span class=s2>                              .data.icon.name = &quot;${ICON}&quot; |\</span>
<span class=s2>                              .data.icon.color = &quot;${ICON_COLOR_CODE}&quot; |\</span>
<span class=s2>                              .data.members[0].id = &quot;${ADMINS_ROLE}&quot; |\</span>
<span class=s2>                              .data.members[1].id = &quot;${MEMBERS_ROLE}&quot; |\</span>
<span class=s2>                              .data.members[2].id = &quot;${GUESTS_ROLE}&quot;&#39;\</span>
<span class=s2>                              templates/team-master-template/simple.json &gt; ${RECORD_LOC}/team.json</span>
<span class=s2>                              &quot;&quot;&quot;</span>
                          <span class=o>}</span>
                          <span class=n>sh</span> <span class=s1>&#39;cat ${RECORD_LOC}/team.json&#39;</span>
                      <span class=o>}</span>
                  <span class=o>}</span>
              <span class=o>}</span>
          <span class=o>}</span>
          <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Create PR&#39;</span><span class=o>)</span> <span class=o>{</span>
              <span class=n>when</span> <span class=o>{</span> <span class=n>branch</span> <span class=s1>&#39;master&#39;</span><span class=o>}</span>
              <span class=n>environment</span> <span class=o>{</span>
                  <span class=n>RECORD_OLD_LOC</span>  <span class=o>=</span> <span class=s2>&quot;templates/teams/${TEAM_BASE_NAME}&quot;</span>
                  <span class=n>RECORD_LOC</span>      <span class=o>=</span> <span class=s2>&quot;teams/${TEAM_BASE_NAME}&quot;</span>
                  <span class=n>PR_CHANGE_NAME</span>  <span class=o>=</span> <span class=s2>&quot;add_team_${TEAM_BASE_NAME}&quot;</span>
              <span class=o>}</span>
              <span class=n>steps</span> <span class=o>{</span>
                  <span class=n>container</span><span class=o>(</span><span class=s1>&#39;hub&#39;</span><span class=o>)</span> <span class=o>{</span>
                      <span class=n>dir</span><span class=o>(</span><span class=s1>&#39;cb-team-gitops&#39;</span><span class=o>)</span> <span class=o>{</span>
                          <span class=n>script</span> <span class=o>{</span>
                              <span class=n>envGitInfo</span> <span class=o>=</span> <span class=n>git</span> <span class=s2>&quot;${GIT_REPO}&quot;</span>
                          <span class=o>}</span>
                          <span class=n>sh</span> <span class=s1>&#39;git checkout -b ${PR_CHANGE_NAME}&#39;</span>
                          <span class=n>sh</span> <span class=s1>&#39;ls -lath ../${RECORD_OLD_LOC}&#39;</span>
                          <span class=n>sh</span> <span class=s1>&#39;cp -R ../${RECORD_OLD_LOC} ./teams&#39;</span>
                          <span class=n>sh</span> <span class=s1>&#39;ls -lath&#39;</span>
                          <span class=n>sh</span> <span class=s1>&#39;ls -lath teams/&#39;</span>

                          <span class=n>gitRemoteConfigByUrl</span><span class=o>(</span><span class=n>envGitInfo</span><span class=o>.</span><span class=na>GIT_URL</span><span class=o>,</span> <span class=s1>&#39;githubtoken_token&#39;</span><span class=o>)</span> <span class=c1>// must be a API Token ONLY -&gt; secret text</span>
                          <span class=n>sh</span> <span class=s1>&#39;&#39;&#39;</span>
<span class=s1>                          git config --global user.email &quot;jenkins@jenkins.io&quot;</span>
<span class=s1>                          git config --global user.name &quot;Jenkins&quot;</span>
<span class=s1>                          git add ${RECORD_LOC}</span>
<span class=s1>                          git status</span>
<span class=s1>                          git commit -m &quot;add team ${TEAM_BASE_NAME}&quot;</span>
<span class=s1>                          git push origin ${PR_CHANGE_NAME}</span>
<span class=s1>                          &#39;&#39;&#39;</span>


                          <span class=c1>// has to be indented like that, else the indents will be in the pr description</span>
                          <span class=n>writeFile</span> <span class=nl>encoding:</span> <span class=s1>&#39;UTF-8&#39;</span><span class=o>,</span> <span class=nl>file:</span> <span class=s1>&#39;pr-info.md&#39;</span><span class=o>,</span> <span class=nl>text:</span> <span class=s2>&quot;&quot;&quot;Add ${TEAM_BASE_NAME}</span>
<span class=s2>  \n</span>
<span class=s2>  This pr is automatically generated via CloudBees.\\n</span>
<span class=s2>  \n</span>
<span class=s2>  The job: ${env.JOB_URL}</span>
<span class=s2>                      &quot;&quot;&quot;</span>

                          <span class=c1>// TODO: unfortunately, environment {}&#39;s credentials have fixed environment variable names</span>
                          <span class=c1>// TODO: in this case, they need to be EXACTLY GITHUB_PASSWORD and GITHUB_USER</span>
                          <span class=n>script</span> <span class=o>{</span>
                              <span class=n>withCredentials</span><span class=o>([</span><span class=n>usernamePassword</span><span class=o>(</span><span class=nl>credentialsId:</span> <span class=s1>&#39;githubtoken&#39;</span><span class=o>,</span> <span class=nl>passwordVariable:</span> <span class=s1>&#39;GITHUB_PASSWORD&#39;</span><span class=o>,</span> <span class=nl>usernameVariable:</span> <span class=s1>&#39;GITHUB_USER&#39;</span><span class=o>)])</span> <span class=o>{</span>
                                  <span class=n>sh</span> <span class=s2>&quot;&quot;&quot;</span>
<span class=s2>                                  set +x</span>
<span class=s2>                                  hub pull-request --force -F pr-info.md -l &#39;${TEAM_BASE_NAME}&#39; --no-edit</span>
<span class=s2>                                  &quot;&quot;&quot;</span>
                              <span class=o>}</span>
                          <span class=o>}</span>
                      <span class=o>}</span>
                  <span class=o>}</span>
              <span class=o>}</span>
          <span class=o>}</span>
      <span class=o>}</span>
  <span class=o>}</span>
</code></pre></div> </details> <h3 id=main-pipeline>Main Pipeline<a class=headerlink href=#main-pipeline title="Permanent link">&para;</a></h3> <p>The main Pipeline should be part of a repository. The Repository should look like this:</p> <ul> <li><code>recipes</code> (folder)<ul> <li><code>recipes.json</code> -&gt; current complete list of CloudBees Core Team Recipes definition</li> </ul> </li> <li><code>teams</code> (folder)<ul> <li>folder per team<ul> <li><code>team.json</code> -&gt; CloudBees Core Team definition</li> <li><code>team.yaml</code> -&gt; Kubernetes YAML definition of the <code>namespace</code> and all its resources</li> </ul> </li> </ul> </li> </ul> <h4 id=process>Process<a class=headerlink href=#process title="Permanent link">&para;</a></h4> <p>The pipeline can be a bit hard to grasp, so let me break it down into individual steps.</p> <p>We have the following stages:</p> <ul> <li><code>Create Team</code> - which is broken into sub-stages via the <a href=https://jenkins.io/blog/2018/07/02/whats-new-declarative-piepline-13x-sequential-stages/ >sequential stages feature</a>. * <code>Parse Changelog</code> * <code>Create Namespace</code> * <code>Change OC Namespace</code> * <code>Create Team Master</code></li> <li><code>Test CLI Connection</code></li> <li><code>Update Team Recipes</code></li> </ul> <h4 id=notable-statements>Notable Statements<a class=headerlink href=#notable-statements title="Permanent link">&para;</a></h4> <details class=example><summary>disableConcurrentBuilds</summary><p>We change the <code>namespace</code> of Operation Center to a different value only for the duration of creating this master. This is something that should probably be part of the Team Master creation, but as it is a single configuration option for all that Operation Center does, we need to be careful. By ensuring we only run one build concurrently, we reduce the risk of this blowing up in our face.</p> <div class=highlight><pre><span></span><code><span class=n>options</span> <span class=o>{</span>
    <span class=n>disableConcurrentBuilds</span><span class=o>()</span>
<span class=o>}</span>
</code></pre></div> </details> <details class=example><summary>when { }</summary><p>The <a href=https://jenkins.io/doc/book/pipeline/syntax/#when>When Directive</a> allows us to creating effective conditions for when a stage should be executed.</p> <p>The snippet below shows the use of a combination of both the <code>branch</code> and <code>changeset</code> built-in filters. <code>changeset</code> looks at the commit being build and validates that there was a change in that file path.</p> <div class=highlight><pre><span></span><code>    <span class=n>when</span> <span class=o>{</span> <span class=n>allOf</span> <span class=o>{</span> <span class=n>branch</span> <span class=s1>&#39;master&#39;</span><span class=o>;</span> <span class=n>changeset</span> <span class=s2>&quot;teams/**/team.*&quot;</span> <span class=o>}</span> <span class=o>}</span>
</code></pre></div> </details> <details class=example><summary>post { always { } }</summary><p>The <a href=https://jenkins.io/doc/book/pipeline/syntax/#post>Post Directive</a> allows us to run certain commands after the main pipeline has run depending on the outcome (compared or not to the previous outcome). In this case, we want to make sure we reset the <code>namespace</code> used by Operations Center to the original value.</p> <p>By using <code>post { always {} }</code>, it will ALWAYS run, regardless of the status of the pipeline. So we should be safe.</p> <div class=highlight><pre><span></span><code><span class=n>post</span> <span class=o>{</span>
    <span class=n>always</span> <span class=o>{</span>
        <span class=n>container</span><span class=o>(</span><span class=s1>&#39;cli&#39;</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>sh</span> <span class=s1>&#39;${CLI} ${CREDS} groovy = &lt; resources/bootstrap/configure-oc-namespace.groovy ${RESET_NAMESPACE}&#39;</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div> </details> <details class=example><summary>stages { stage { parallel { stage() { stages { stage { </summary><p>Oke, you might've noticed this massive indenting depth and probably have some questions. </p> <p>By combining <a href=https://jenkins.io/blog/2018/07/02/whats-new-declarative-piepline-13x-sequential-stages/ >sequential stages</a> with <a href=https://jenkins.io/blog/2017/09/25/declarative-1/ >parallel stages</a> we can create a set of stages that will be executed in sequence but can be controlled by a single <code>when {}</code> statement whether or not they get executed. </p> <p>This prevents mistakes being made in the condition and accidentally running one or other but not all the required steps.</p> <div class=highlight><pre><span></span><code>    <span class=n>stages</span> <span class=o>{</span>
        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Create Team&#39;</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>parallel</span> <span class=o>{</span>
                <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Main&#39;</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>stages</span> <span class=o>{</span>
                        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Parse Changelog&#39;</span><span class=o>)</span> <span class=o>{</span>
</code></pre></div> </details> <details class=example><summary>changetSetData &amp; container('jpb') {}</summary><p>Alright, so even if we know a team was added in <code>/teams/&lt;team-name&gt;</code>, we still don't know the following two things: 1) what is the name of this team, 2) was this team changed or deleted?</p> <p>So we have to process the changelog to be able to answer these questions as well. There are different ways of getting the changelog and parsing it. I've written one you can do on ANY machine, regardless of Jenkins by leveraging <code>Git</code> and my own custom binary (<code>jpb</code> -&gt; Jenkins Pipeline Binary). The code for my binary is at GitHub: <a href=https://github.com/joostvdg/jpb>github.com/joostvdg/jpb</a>.</p> <p>An alternative approach is described by <a href=https://support.cloudbees.com/hc/en-us/articles/217630098-How-to-access-Changelogs-in-a-Pipeline-Job->CloudBees Support here</a>, which leverages Jenkins groovy powers.</p> <div class=highlight><pre><span></span><code><span class=n>COMMIT_INFO</span> <span class=o>=</span> <span class=s2>&quot;${scmVars.GIT_COMMIT} ${scmVars.GIT_PREVIOUS_COMMIT}&quot;</span>
<span class=kt>def</span> <span class=n>changeSetData</span> <span class=o>=</span> <span class=n>sh</span> <span class=nl>returnStdout:</span> <span class=kc>true</span><span class=o>,</span> <span class=nl>script:</span> <span class=s2>&quot;git diff-tree --no-commit-id --name-only -r ${COMMIT_INFO}&quot;</span>
<span class=n>changeSetData</span> <span class=o>=</span> <span class=n>changeSetData</span><span class=o>.</span><span class=na>replace</span><span class=o>(</span><span class=s2>&quot;\n&quot;</span><span class=o>,</span> <span class=s2>&quot;\\n&quot;</span><span class=o>)</span>
<span class=n>container</span><span class=o>(</span><span class=s1>&#39;jpb&#39;</span><span class=o>)</span> <span class=o>{</span>
    <span class=n>changeSetFolders</span> <span class=o>=</span> <span class=n>sh</span> <span class=nl>returnStdout:</span> <span class=kc>true</span><span class=o>,</span> <span class=nl>script:</span> <span class=s2>&quot;/usr/bin/jpb/bin/jpb GitChangeListToFolder &#39;${changeSetData}&#39; &#39;teams/&#39;&quot;</span>
    <span class=n>changeSetFolders</span> <span class=o>=</span> <span class=n>changeSetFolders</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s1>&#39;,&#39;</span><span class=o>)</span>
<span class=o>}</span>
</code></pre></div> </details> <h4 id=files>Files<a class=headerlink href=#files title="Permanent link">&para;</a></h4> <details class=example><summary>recipes.json</summary><p>The default Team Recipes that ships with CloudBees Core Modern.</p> <div class=highlight><pre><span></span><code>    <span class=p>{</span>
        <span class=nt>&quot;version&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>,</span>
        <span class=nt>&quot;data&quot;</span><span class=p>:</span> <span class=p>[{</span>
            <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;basic&quot;</span><span class=p>,</span>
            <span class=nt>&quot;displayName&quot;</span><span class=p>:</span> <span class=s2>&quot;Basic&quot;</span><span class=p>,</span>
            <span class=nt>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;The minimalistic setup.&quot;</span><span class=p>,</span>
            <span class=nt>&quot;plugins&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;bluesteel-master&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-folders-plus&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-jsync-archiver&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-monitoring&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-nodes-plus&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-ssh-slaves&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-support&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-workflow-template&quot;</span><span class=p>,</span> <span class=s2>&quot;credentials-binding&quot;</span><span class=p>,</span> <span class=s2>&quot;email-ext&quot;</span><span class=p>,</span> <span class=s2>&quot;git&quot;</span><span class=p>,</span> <span class=s2>&quot;git-client&quot;</span><span class=p>,</span> <span class=s2>&quot;github-branch-source&quot;</span><span class=p>,</span> <span class=s2>&quot;github-organization-folder&quot;</span><span class=p>,</span> <span class=s2>&quot;infradna-backup&quot;</span><span class=p>,</span> <span class=s2>&quot;ldap&quot;</span><span class=p>,</span> <span class=s2>&quot;mailer&quot;</span><span class=p>,</span> <span class=s2>&quot;operations-center-analytics-reporter&quot;</span><span class=p>,</span> <span class=s2>&quot;operations-center-cloud&quot;</span><span class=p>,</span> <span class=s2>&quot;pipeline-model-definition&quot;</span><span class=p>,</span> <span class=s2>&quot;ssh-credentials&quot;</span><span class=p>,</span> <span class=s2>&quot;wikitext&quot;</span><span class=p>,</span> <span class=s2>&quot;workflow-aggregator&quot;</span><span class=p>,</span> <span class=s2>&quot;workflow-cps-checkpoint&quot;</span><span class=p>],</span>
            <span class=nt>&quot;default&quot;</span><span class=p>:</span> <span class=kc>true</span>
        <span class=p>},</span> <span class=p>{</span>
            <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;java-web&quot;</span><span class=p>,</span>
            <span class=nt>&quot;displayName&quot;</span><span class=p>:</span> <span class=s2>&quot;Java &amp; Web Development&quot;</span><span class=p>,</span>
            <span class=nt>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;The essential tools to build, release and deploy Java Web applications including integration with Maven, Gradle and Node JS.&quot;</span><span class=p>,</span>
            <span class=nt>&quot;plugins&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;bluesteel-master&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-folders-plus&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-jsync-archiver&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-monitoring&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-nodes-plus&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-ssh-slaves&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-support&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-workflow-template&quot;</span><span class=p>,</span> <span class=s2>&quot;credentials-binding&quot;</span><span class=p>,</span> <span class=s2>&quot;email-ext&quot;</span><span class=p>,</span> <span class=s2>&quot;git&quot;</span><span class=p>,</span> <span class=s2>&quot;git-client&quot;</span><span class=p>,</span> <span class=s2>&quot;github-branch-source&quot;</span><span class=p>,</span> <span class=s2>&quot;github-organization-folder&quot;</span><span class=p>,</span> <span class=s2>&quot;infradna-backup&quot;</span><span class=p>,</span> <span class=s2>&quot;ldap&quot;</span><span class=p>,</span> <span class=s2>&quot;mailer&quot;</span><span class=p>,</span> <span class=s2>&quot;operations-center-analytics-reporter&quot;</span><span class=p>,</span> <span class=s2>&quot;operations-center-cloud&quot;</span><span class=p>,</span> <span class=s2>&quot;pipeline-model-definition&quot;</span><span class=p>,</span> <span class=s2>&quot;ssh-credentials&quot;</span><span class=p>,</span> <span class=s2>&quot;wikitext&quot;</span><span class=p>,</span> <span class=s2>&quot;workflow-aggregator&quot;</span><span class=p>,</span> <span class=s2>&quot;workflow-cps-checkpoint&quot;</span><span class=p>,</span> <span class=s2>&quot;config-file-provider&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-aws-cli&quot;</span><span class=p>,</span> <span class=s2>&quot;cloudbees-cloudfoundry-cli&quot;</span><span class=p>,</span> <span class=s2>&quot;findbugs&quot;</span><span class=p>,</span> <span class=s2>&quot;gradle&quot;</span><span class=p>,</span> <span class=s2>&quot;jira&quot;</span><span class=p>,</span> <span class=s2>&quot;junit&quot;</span><span class=p>,</span> <span class=s2>&quot;nodejs&quot;</span><span class=p>,</span> <span class=s2>&quot;openshift-cli&quot;</span><span class=p>,</span> <span class=s2>&quot;pipeline-maven&quot;</span><span class=p>,</span> <span class=s2>&quot;tasks&quot;</span><span class=p>,</span> <span class=s2>&quot;warnings&quot;</span><span class=p>],</span>
            <span class=nt>&quot;default&quot;</span><span class=p>:</span> <span class=kc>false</span>
        <span class=p>}]</span>
    <span class=p>}</span>
</code></pre></div> </details> <details class=example><summary>Jenkinsfile</summary><p>This is the pipeline that will process the commit to the repository and, if it detects a new team is created will apply the changes.</p> <p>Variables to overwrite:</p> <ul> <li><strong>GIT_REPO</strong>: the https url to the Git Repository your GitOps code/configuration is stored</li> <li><strong>RESET_NAMESPACE</strong>: the <code>namespace</code> your Operation Center normally operates in</li> <li><strong>CLI</strong>: this command depends on the namespace Operation Center is in (<code>http://&lt;service name&gt;.&lt;namespace&gt;/cjoc</code>)</li> </ul> <div class=highlight><pre><span></span><code><span class=n>pipeline</span> <span class=o>{</span>
    <span class=n>agent</span> <span class=o>{</span>
        <span class=n>kubernetes</span> <span class=o>{</span>
            <span class=n>label</span> <span class=s1>&#39;jenkins-agent&#39;</span>
            <span class=n>yaml</span> <span class=s1>&#39;&#39;&#39;</span>
<span class=s1>apiVersion: v1</span>
<span class=s1>kind: Pod</span>
<span class=s1>spec:</span>
<span class=s1>  serviceAccountName: jenkins</span>
<span class=s1>  containers:</span>
<span class=s1>  - name: cli</span>
<span class=s1>    image: caladreas/cbcore-cli:2.176.2.3</span>
<span class=s1>    imagePullPolicy: Always</span>
<span class=s1>    command:</span>
<span class=s1>    - cat</span>
<span class=s1>    tty: true</span>
<span class=s1>    resources:</span>
<span class=s1>      requests:</span>
<span class=s1>        memory: &quot;50Mi&quot;</span>
<span class=s1>        cpu: &quot;150m&quot;</span>
<span class=s1>      limits:</span>
<span class=s1>        memory: &quot;50Mi&quot;</span>
<span class=s1>        cpu: &quot;150m&quot;</span>
<span class=s1>  - name: kubectl</span>
<span class=s1>    image: bitnami/kubectl:latest</span>
<span class=s1>    command: [&quot;cat&quot;]</span>
<span class=s1>    tty: true</span>
<span class=s1>    resources:</span>
<span class=s1>      requests:</span>
<span class=s1>        memory: &quot;50Mi&quot;</span>
<span class=s1>        cpu: &quot;100m&quot;</span>
<span class=s1>      limits:</span>
<span class=s1>        memory: &quot;150Mi&quot;</span>
<span class=s1>        cpu: &quot;200m&quot;</span>
<span class=s1>  - name: yq</span>
<span class=s1>    image: mikefarah/yq</span>
<span class=s1>    command: [&#39;cat&#39;]</span>
<span class=s1>    tty: true</span>
<span class=s1>    resources:</span>
<span class=s1>      requests:</span>
<span class=s1>        memory: &quot;50Mi&quot;</span>
<span class=s1>        cpu: &quot;100m&quot;</span>
<span class=s1>      limits:</span>
<span class=s1>        memory: &quot;50Mi&quot;</span>
<span class=s1>        cpu: &quot;100m&quot;</span>
<span class=s1>  - name: jpb</span>
<span class=s1>    image: caladreas/jpb</span>
<span class=s1>    command:</span>
<span class=s1>    - cat</span>
<span class=s1>    tty: true</span>
<span class=s1>    resources:</span>
<span class=s1>      requests:</span>
<span class=s1>        memory: &quot;50Mi&quot;</span>
<span class=s1>        cpu: &quot;100m&quot;</span>
<span class=s1>      limits:</span>
<span class=s1>        memory: &quot;50Mi&quot;</span>
<span class=s1>        cpu: &quot;100m&quot;</span>
<span class=s1>  securityContext:</span>
<span class=s1>    runAsUser: 1000</span>
<span class=s1>    fsGroup: 1000</span>
<span class=s1>&#39;&#39;&#39;</span>
        <span class=o>}</span>
    <span class=o>}</span>
    <span class=n>options</span> <span class=o>{</span>
        <span class=n>disableConcurrentBuilds</span><span class=o>()</span>
        <span class=n>buildDiscarder</span> <span class=nf>logRotator</span><span class=o>(</span><span class=nl>artifactDaysToKeepStr:</span> <span class=s1>&#39;&#39;</span><span class=o>,</span> <span class=nl>artifactNumToKeepStr:</span> <span class=s1>&#39;&#39;</span><span class=o>,</span> <span class=nl>daysToKeepStr:</span> <span class=s1>&#39;5&#39;</span><span class=o>,</span> <span class=nl>numToKeepStr:</span> <span class=s1>&#39;5&#39;</span><span class=o>)</span>
    <span class=o>}</span>
    <span class=n>environment</span> <span class=o>{</span>
        <span class=n>RESET_NAMESPACE</span>     <span class=o>=</span> <span class=s1>&#39;cloudbees-core&#39;</span>
        <span class=n>CREDS</span>               <span class=o>=</span> <span class=n>credentials</span><span class=o>(</span><span class=s1>&#39;jenkins-api&#39;</span><span class=o>)</span>
        <span class=n>CLI</span>                 <span class=o>=</span> <span class=s2>&quot;java -jar /usr/bin/jenkins-cli.jar -noKeyAuth -s http://cjoc.cloudbees-core/cjoc -auth&quot;</span>
        <span class=n>COMMIT_INFO</span>         <span class=o>=</span> <span class=s1>&#39;&#39;</span>
        <span class=n>TEAM</span>                <span class=o>=</span> <span class=s1>&#39;&#39;</span>
        <span class=n>GIT_REPO</span>            <span class=o>=</span> <span class=s1>&#39;&#39;</span>
    <span class=o>}</span>
    <span class=n>stages</span> <span class=o>{</span>
        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Create Team&#39;</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>when</span> <span class=o>{</span> <span class=n>allOf</span> <span class=o>{</span> <span class=n>branch</span> <span class=s1>&#39;master&#39;</span><span class=o>;</span> <span class=n>changeset</span> <span class=s2>&quot;teams/**/team.*&quot;</span> <span class=o>}</span> <span class=o>}</span>
            <span class=n>parallel</span> <span class=o>{</span>
                <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Main&#39;</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>stages</span> <span class=o>{</span>
                        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Parse Changelog&#39;</span><span class=o>)</span> <span class=o>{</span>
                            <span class=n>steps</span> <span class=o>{</span>
                                <span class=c1>// Alternative approach: https://support.cloudbees.com/hc/en-us/articles/217630098-How-to-access-Changelogs-in-a-Pipeline-Job-</span>
                                <span class=c1>// However, that runs on the master, JPB runs in an agent!</span>
                                <span class=n>script</span> <span class=o>{</span>
                                    <span class=n>scmVars</span> <span class=o>=</span> <span class=n>git</span> <span class=s2>&quot;${GIT_REPO}&quot;</span>
                                    <span class=n>COMMIT_INFO</span> <span class=o>=</span> <span class=s2>&quot;${scmVars.GIT_COMMIT} ${scmVars.GIT_PREVIOUS_COMMIT}&quot;</span>
                                    <span class=kt>def</span> <span class=n>changeSetData</span> <span class=o>=</span> <span class=n>sh</span> <span class=nl>returnStdout:</span> <span class=kc>true</span><span class=o>,</span> <span class=nl>script:</span> <span class=s2>&quot;git diff-tree --no-commit-id --name-only -r ${COMMIT_INFO}&quot;</span>
                                    <span class=n>changeSetData</span> <span class=o>=</span> <span class=n>changeSetData</span><span class=o>.</span><span class=na>replace</span><span class=o>(</span><span class=s2>&quot;\n&quot;</span><span class=o>,</span> <span class=s2>&quot;\\n&quot;</span><span class=o>)</span>
                                    <span class=n>container</span><span class=o>(</span><span class=s1>&#39;jpb&#39;</span><span class=o>)</span> <span class=o>{</span>
                                        <span class=n>changeSetFolders</span> <span class=o>=</span> <span class=n>sh</span> <span class=nl>returnStdout:</span> <span class=kc>true</span><span class=o>,</span> <span class=nl>script:</span> <span class=s2>&quot;/usr/bin/jpb/bin/jpb GitChangeListToFolder &#39;${changeSetData}&#39; &#39;teams/&#39;&quot;</span>
                                        <span class=n>changeSetFolders</span> <span class=o>=</span> <span class=n>changeSetFolders</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s1>&#39;,&#39;</span><span class=o>)</span>
                                    <span class=o>}</span>
                                    <span class=k>if</span> <span class=o>(</span><span class=n>changeSetFolders</span><span class=o>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
                                        <span class=n>TEAM</span> <span class=o>=</span> <span class=n>changeSetFolders</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span>
                                        <span class=n>TEAM</span> <span class=o>=</span> <span class=n>TEAM</span><span class=o>.</span><span class=na>trim</span><span class=o>()</span>
                                        <span class=c1>// to protect against a team being removed</span>
                                        <span class=kt>def</span> <span class=n>exists</span> <span class=o>=</span> <span class=n>fileExists</span> <span class=s2>&quot;teams/${TEAM}/team.yaml&quot;</span>
                                        <span class=k>if</span> <span class=o>(!</span><span class=n>exists</span><span class=o>)</span> <span class=o>{</span>
                                            <span class=n>TEAM</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
                                        <span class=o>}</span>
                                    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
                                        <span class=n>TEAM</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
                                    <span class=o>}</span>
                                    <span class=n>echo</span> <span class=s2>&quot;Team that changed: |${TEAM}|&quot;</span>
                                <span class=o>}</span>
                            <span class=o>}</span>
                        <span class=o>}</span>
                        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Create Namespace&#39;</span><span class=o>)</span> <span class=o>{</span>
                            <span class=n>when</span> <span class=o>{</span> <span class=n>expression</span> <span class=o>{</span> <span class=k>return</span> <span class=o>!</span><span class=n>TEAM</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s1>&#39;&#39;</span><span class=o>)</span> <span class=o>}</span> <span class=o>}</span>
                            <span class=n>environment</span> <span class=o>{</span>
                                <span class=n>NAMESPACE</span>   <span class=o>=</span> <span class=s2>&quot;cb-teams-${TEAM}&quot;</span>
                                <span class=n>RECORD_LOC</span>  <span class=o>=</span> <span class=s2>&quot;teams/${TEAM}&quot;</span>
                            <span class=o>}</span>
                            <span class=n>steps</span> <span class=o>{</span>
                                <span class=n>container</span><span class=o>(</span><span class=s1>&#39;kubectl&#39;</span><span class=o>)</span> <span class=o>{</span>
                                    <span class=n>sh</span> <span class=s1>&#39;&#39;&#39;</span>
<span class=s1>                                        cat ${RECORD_LOC}/team.yaml</span>
<span class=s1>                                        kubectl apply -f ${RECORD_LOC}/team.yaml</span>
<span class=s1>                                    &#39;&#39;&#39;</span>
                                <span class=o>}</span>
                            <span class=o>}</span>
                        <span class=o>}</span>
                        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Change OC Namespace&#39;</span><span class=o>)</span> <span class=o>{</span>
                            <span class=n>when</span> <span class=o>{</span> <span class=n>expression</span> <span class=o>{</span> <span class=k>return</span> <span class=o>!</span><span class=n>TEAM</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s1>&#39;&#39;</span><span class=o>)</span> <span class=o>}</span> <span class=o>}</span>
                            <span class=n>environment</span> <span class=o>{</span>
                                <span class=n>NAMESPACE</span>   <span class=o>=</span> <span class=s2>&quot;cb-teams-${TEAM}&quot;</span>
                            <span class=o>}</span>
                            <span class=n>steps</span> <span class=o>{</span>
                                <span class=n>container</span><span class=o>(</span><span class=s1>&#39;cli&#39;</span><span class=o>)</span> <span class=o>{</span>
                                    <span class=n>sh</span> <span class=s1>&#39;echo ${NAMESPACE}&#39;</span>
                                    <span class=n>script</span> <span class=o>{</span>
                                        <span class=kt>def</span> <span class=n>response</span> <span class=o>=</span> <span class=n>sh</span> <span class=nl>encoding:</span> <span class=s1>&#39;UTF-8&#39;</span><span class=o>,</span> <span class=nl>label:</span> <span class=s1>&#39;create team&#39;</span><span class=o>,</span> <span class=nl>returnStatus:</span> <span class=kc>true</span><span class=o>,</span> <span class=nl>script:</span> <span class=s1>&#39;${CLI} ${CREDS} groovy = &lt; resources/bootstrap/configure-oc-namespace.groovy ${NAMESPACE}&#39;</span>
                                        <span class=n>println</span> <span class=s2>&quot;Response: ${response}&quot;</span>
                                    <span class=o>}</span>
                                <span class=o>}</span>
                            <span class=o>}</span>
                        <span class=o>}</span>
                        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Create Team Master&#39;</span><span class=o>)</span> <span class=o>{</span>
                            <span class=n>when</span> <span class=o>{</span> <span class=n>expression</span> <span class=o>{</span> <span class=k>return</span> <span class=o>!</span><span class=n>TEAM</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s1>&#39;&#39;</span><span class=o>)</span> <span class=o>}</span> <span class=o>}</span>
                            <span class=n>environment</span> <span class=o>{</span>
                                <span class=n>TEAM_NAME</span> <span class=o>=</span> <span class=s2>&quot;${TEAM}&quot;</span>
                            <span class=o>}</span>
                            <span class=n>steps</span> <span class=o>{</span>
                                <span class=n>container</span><span class=o>(</span><span class=s1>&#39;cli&#39;</span><span class=o>)</span> <span class=o>{</span>
                                    <span class=n>println</span> <span class=s2>&quot;TEAM_NAME=${TEAM_NAME}&quot;</span>
                                    <span class=n>sh</span> <span class=s1>&#39;ls -lath&#39;</span>
                                    <span class=n>sh</span> <span class=s1>&#39;ls -lath teams/&#39;</span>
                                    <span class=n>script</span> <span class=o>{</span>
                                        <span class=kt>def</span> <span class=n>response</span> <span class=o>=</span> <span class=n>sh</span> <span class=nl>encoding:</span> <span class=s1>&#39;UTF-8&#39;</span><span class=o>,</span> <span class=nl>label:</span> <span class=s1>&#39;create team&#39;</span><span class=o>,</span> <span class=nl>returnStatus:</span> <span class=kc>true</span><span class=o>,</span> <span class=nl>script:</span> <span class=s1>&#39;${CLI} ${CREDS} teams ${TEAM_NAME} --put &lt; &quot;teams/${TEAM_NAME}/team.json&quot;&#39;</span>
                                        <span class=n>println</span> <span class=s2>&quot;Response: ${response}&quot;</span>
                                    <span class=o>}</span>
                                <span class=o>}</span>
                            <span class=o>}</span>
                        <span class=o>}</span>
                    <span class=o>}</span>
                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>}</span>
        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Test CLI Connection&#39;</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>steps</span> <span class=o>{</span>
                <span class=n>container</span><span class=o>(</span><span class=s1>&#39;cli&#39;</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>script</span> <span class=o>{</span>
                        <span class=kt>def</span> <span class=n>response</span> <span class=o>=</span> <span class=n>sh</span> <span class=nl>encoding:</span> <span class=s1>&#39;UTF-8&#39;</span><span class=o>,</span> <span class=nl>label:</span> <span class=s1>&#39;retrieve version&#39;</span><span class=o>,</span> <span class=nl>returnStatus:</span> <span class=kc>true</span><span class=o>,</span> <span class=nl>script:</span> <span class=s1>&#39;${CLI} ${CREDS} version&#39;</span>
                        <span class=n>println</span> <span class=s2>&quot;Response: ${response}&quot;</span>
                    <span class=o>}</span>
                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>}</span>
        <span class=n>stage</span><span class=o>(</span><span class=s1>&#39;Update Team Recipes&#39;</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>when</span> <span class=o>{</span> <span class=n>allOf</span> <span class=o>{</span> <span class=n>branch</span> <span class=s1>&#39;master&#39;</span><span class=o>;</span> <span class=n>changeset</span> <span class=s2>&quot;recipes/recipes.json&quot;</span> <span class=o>}</span> <span class=o>}</span>
            <span class=n>steps</span> <span class=o>{</span>
                <span class=n>container</span><span class=o>(</span><span class=s1>&#39;cli&#39;</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>sh</span> <span class=s1>&#39;ls -lath&#39;</span>
                    <span class=n>sh</span> <span class=s1>&#39;ls -lath recipes/&#39;</span>
                    <span class=n>script</span> <span class=o>{</span>
                        <span class=kt>def</span> <span class=n>response</span> <span class=o>=</span> <span class=n>sh</span> <span class=nl>encoding:</span> <span class=s1>&#39;UTF-8&#39;</span><span class=o>,</span> <span class=nl>label:</span> <span class=s1>&#39;update team recipe&#39;</span><span class=o>,</span> <span class=nl>returnStatus:</span> <span class=kc>true</span><span class=o>,</span> <span class=nl>script:</span> <span class=s1>&#39;${CLI} ${CREDS} team-creation-recipes --put &lt; &quot;recipes/recipes.json&quot;&#39;</span>
                        <span class=n>println</span> <span class=s2>&quot;Response: ${response}&quot;</span>
                    <span class=o>}</span>
                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>
    <span class=n>post</span> <span class=o>{</span>
        <span class=n>always</span> <span class=o>{</span>
            <span class=n>container</span><span class=o>(</span><span class=s1>&#39;cli&#39;</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>sh</span> <span class=s1>&#39;${CLI} ${CREDS} groovy = &lt; resources/bootstrap/configure-oc-namespace.groovy ${RESET_NAMESPACE}&#39;</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>        
</code></pre></div> </details> <hr> <div class=md-source-date> <small> Last update: 2019-08-29 10:02:23 </small> </div> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>var disqus_config=function(){this.page.url="https://joostvdg.github.io/cloudbees/teams-automation/",this.page.identifier="/cloudbees/teams-automation/"};!function(){var e=document,i=e.createElement("script");i.src="//joostvdg-github-io.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)}()</script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../sso-azure-ad/ title="Single Sign On - AzureAD" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Single Sign On - AzureAD </div> </div> </a> <a href=../cbc-gke-helm/ title="CloudBees Core on GKE" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> CloudBees Core on GKE </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Joost van der Griendt </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/joostvdg target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/joost_vdg target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/joostvdg target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.d710d30a.min.js></script> <script src=../../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../..",
          features: ["tabs", "instant"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>