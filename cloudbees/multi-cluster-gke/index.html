<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Multi Cluster setup with CloudBees CI on GKE"><link href=https://joostvdg.github.io/cloudbees/multi-cluster-gke/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.2"><title>CloudBees CI - Multi Cluster GKE - J's Software Development Pages</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=orange data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#cloudbees-ci-multi-cluster-gke class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="J's Software Development Pages" class="md-header__button md-logo" aria-label="J's Software Development Pages" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> J's Software Development Pages </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> CloudBees CI - Multi Cluster GKE </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=orange data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=deep-orange data-md-color-accent=teal aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/joostvdg/joostvdg.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../blogs/jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../../jenkins/jenkins-on-kubernetes/ class="md-tabs__link md-tabs__link--active"> Jenkins & CloudBees </a> </li> <li class=md-tabs__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-tabs__link> Kubernetes & Docker </a> </li> <li class=md-tabs__item> <a href=../../tanzu/ class=md-tabs__link> VMware Tanzu </a> </li> <li class=md-tabs__item> <a href=../../jenkinsx/build-packs/ class=md-tabs__link> Jenkins X </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ class=md-tabs__link> Software Eng. </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="J's Software Development Pages" class="md-nav__button md-logo" aria-label="J's Software Development Pages" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.35 10.03A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.03A6.004 6.004 0 0 0 0 14a6 6 0 0 0 6 6h13a5 5 0 0 0 5-5c0-2.64-2.05-4.78-4.65-4.97Z"/></svg> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../other/vim/ class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../other/shell/ class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Blogs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Blogs data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/jenkins-pipeline-support-tool/ class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/graceful-shutdown/ class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../blogs/docker-alternatives/ class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../blogs/k8s-lets-encrypt/ class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../blogs/sso-azure-ad/ class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../blogs/teams-automation/ class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../blogs/kubernetes-sso-keycloak/ class=md-nav__link> Kubernetes SSO Keycloak </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_8 type=checkbox id=__nav_2_8> <label class=md-nav__link for=__nav_2_8> Jenkins X Java Native Image Prod <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Jenkins X Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> Jenkins X Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ class=md-nav__link> Production Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ class=md-nav__link> Promote To Production </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_9 type=checkbox id=__nav_2_9> <label class=md-nav__link for=__nav_2_9> Jenkins Monitoring Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Jenkins Monitoring Kubernetes" data-md-level=2> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/introduction/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/prepare/ class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/install/ class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/metrics/ class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/alerts/ class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/pipeline/ class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/dashboard/ class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/cloudbees/ class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../blogs/k8s-crd/ class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../blogs/dockercon-eu-2018/ class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Jenkins & CloudBees <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Jenkins & CloudBees" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Jenkins & CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/jenkins-on-kubernetes/ class=md-nav__link> Jenkins On Kubernetes </a> </li> <li class=md-nav__item> <a href=../../tanzu/jenkins-tap/ class=md-nav__link> TAP & Jenkins </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3> CloudBees <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CloudBees data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cbci-casc/ class=md-nav__link> CloudBees CasC </a> </li> <li class=md-nav__item> <a href=../sso-azure-ad/ class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../teams-automation/ class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../cbc-gke-helm/ class=md-nav__link> CloudBees CI on GKE </a> </li> <li class=md-nav__item> <a href=../cbc-eks/ class=md-nav__link> CloudBees CI on EKS </a> </li> <li class=md-nav__item> <a href=../cbc-team-namespace/ class=md-nav__link> Team Master Namespace </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Multi-Cluster GKE <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Multi-Cluster GKE </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#steps-to-do class=md-nav__link> Steps to do </a> </li> <li class=md-nav__item> <a href=#create-and-configure-cluster-one class=md-nav__link> Create and Configure Cluster One </a> <nav class=md-nav aria-label="Create and Configure Cluster One"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-create-cluster-with-terraform class=md-nav__link> 1. Create Cluster With Terraform </a> <nav class=md-nav aria-label="1. Create Cluster With Terraform"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#main class=md-nav__link> Main </a> </li> <li class=md-nav__item> <a href=#variables class=md-nav__link> Variables </a> </li> <li class=md-nav__item> <a href=#cluster class=md-nav__link> Cluster </a> </li> <li class=md-nav__item> <a href=#nodepools class=md-nav__link> Nodepools </a> </li> <li class=md-nav__item> <a href=#execute-terraform-steps class=md-nav__link> Execute Terraform Steps </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-create-cloud-dns-zone class=md-nav__link> 2. Create Cloud DNS Zone </a> <nav class=md-nav aria-label="2. Create Cloud DNS Zone"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gcloud class=md-nav__link> Gcloud </a> </li> <li class=md-nav__item> <a href=#terraform class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=#create-gcp-service-account-for-accessing-cloud-dns class=md-nav__link> Create GCP Service Account for accessing Cloud DNS </a> <nav class=md-nav aria-label="Create GCP Service Account for accessing Cloud DNS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#gcloud_1 class=md-nav__link> Gcloud </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-credentials-in-cluster class=md-nav__link> Configure Credentials In Cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-install-bootstrapping class=md-nav__link> 3. Install Bootstrapping </a> <nav class=md-nav aria-label="3. Install Bootstrapping"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nginx-ingress class=md-nav__link> Nginx Ingress </a> </li> <li class=md-nav__item> <a href=#certmanager class=md-nav__link> Certmanager </a> </li> <li class=md-nav__item> <a href=#external-dns-controller class=md-nav__link> External DNS Controller </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-install-cloudbees-ci class=md-nav__link> 4. Install CloudBees CI </a> </li> <li class=md-nav__item> <a href=#5-manually-configure-external-access class=md-nav__link> 5. Manually Configure External Access </a> <nav class=md-nav aria-label="5. Manually Configure External Access"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tcp-services-configmap class=md-nav__link> TCP Services ConfigMap </a> </li> <li class=md-nav__item> <a href=#update-nginx-deployment class=md-nav__link> Update Nginx Deployment </a> </li> <li class=md-nav__item> <a href=#update-nginx-service class=md-nav__link> Update Nginx Service </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-and-configure-clustertwo class=md-nav__link> Create and Configure ClusterTwo </a> <nav class=md-nav aria-label="Create and Configure ClusterTwo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#4-create-gcp-service-account-for-accessing-gke class=md-nav__link> 4. Create GCP service account for accessing GKE </a> <nav class=md-nav aria-label="4. Create GCP service account for accessing GKE"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_1 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#gcloud_2 class=md-nav__link> Gcloud </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-configure-receiving-namespace class=md-nav__link> 5. Configure Receiving Namespace </a> <nav class=md-nav aria-label="5. Configure Receiving Namespace"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prepare-namespace class=md-nav__link> Prepare Namespace </a> </li> <li class=md-nav__item> <a href=#give-user-admin-rights class=md-nav__link> Give User Admin Rights </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-managed-master-in-both-clusters class=md-nav__link> Create Managed Master in both clusters </a> <nav class=md-nav aria-label="Create Managed Master in both clusters"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-cloudbees-ci-credential-with-gcp-service-account class=md-nav__link> Create CloudBees CI Credential with GCP Service Account </a> </li> <li class=md-nav__item> <a href=#create-second-kubernetes-endpoint-configuration class=md-nav__link> Create second Kubernetes endpoint configuration </a> </li> <li class=md-nav__item> <a href=#create-managed-masters class=md-nav__link> Create Managed Masters </a> <nav class=md-nav aria-label="Create Managed Masters"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#update-master-provisioning class=md-nav__link> Update Master Provisioning </a> </li> <li class=md-nav__item> <a href=#creating-master class=md-nav__link> Creating Master </a> </li> <li class=md-nav__item> <a href=#give-user-permissions-in-cluster-two class=md-nav__link> Give User Permissions In Cluster Two </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../multi-cluster-eks/ class=md-nav__link> Multi-Cluster EKS </a> </li> <li class=md-nav__item> <a href=../multi-cluster/ class=md-nav__link> Multi-Cluster (OLD/AKS) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Jenkins <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Jenkins data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5> Jenkins Pipelines <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Jenkins Pipelines" data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/kaniko-pipelines/ class=md-nav__link> Build Docker Image Kaniko </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/podtemplate-dind/ class=md-nav__link> PodTemplate With Docker-In-Docker </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ class=md-nav__link> Parallel Pipelines </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_6 type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6> Jenkins Pipeline Examples <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Jenkins Pipeline Examples" data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Kubernetes & Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kubernetes & Docker" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Kubernetes & Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1 type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1> OpenShift <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=OpenShift data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-nav__link> OpenShift 3.11 GCP(minimal) </a> </li> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-medium/ class=md-nav__link> OpenShift 3.11 GCP(medium) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Kubernetes (K8S) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kubernetes (K8S)" data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Managed Kubernetes (cloud) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Managed Kubernetes (cloud)" data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Managed Kubernetes (cloud) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/gke-terraform/ class=md-nav__link> GKE Terraform </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4> K8S Hard Way - GCE <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="K8S Hard Way - GCE" data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_5 type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=2> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_6 type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6> Linux <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> VMware Tanzu <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="VMware Tanzu" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> VMware Tanzu </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tanzu/ class=md-nav__link> Tanzu </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-on-tkgs/ class=md-nav__link> TAP on TKGs </a> </li> <li class=md-nav__item> <a href=../../tanzu/tap-on-tkgm-on-aws/ class=md-nav__link> TAP on TKGm on AWS </a> </li> <li class=md-nav__item> <a href=../../tanzu/jenkins-tap/ class=md-nav__link> TAP Jenkins </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Jenkins X <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Jenkins X" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/build-packs/ class=md-nav__link> Build Packs </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jx-pipelines/ class=md-nav__link> Jenkins X Pipelines </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_3 type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3> Java Native Image Prod <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/01-intro/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/02-cloud-sql/ class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/03-quarkus/ class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/04-jx-import/ class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/05-jx-secrets/ class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/06-native-image/ class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/07-pipeline-improvements/ class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/08-preview-int-test/ class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/09-production-improvements/ class=md-nav__link> Production Improvements </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/java-native-prod/10-promote-prod/ class=md-nav__link> Promote To Production </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../jenkinsx/builder-image/ class=md-nav__link> Create Builder Image </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot/ class=md-nav__link> JX Boot GKE </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/jxboot-aks/ class=md-nav__link> JX Boot AKS </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/aks-boot-core/ class=md-nav__link> JX Boot & CloudBees Core </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-minimal/ class=md-nav__link> OpenShift 3.11 </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/rhos-311-restricted/ class=md-nav__link> OpenShift 3.11 - Restricted </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/lighthouse-bitbucket/ class=md-nav__link> Lighthouse & Bitbucket </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hello-world/ class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/maven/ class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/hybrid/ class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../../jenkinsx/kubernetes-days/ class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Software Eng. <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Software Eng." data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Software Eng. </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_1 type=checkbox id=__nav_7_1> <label class=md-nav__link for=__nav_7_1> Automation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Automation data-md-level=2> <label class=md-nav__title for=__nav_7_1> <span class="md-nav__icon md-icon"></span> Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ class=md-nav__link> Pulumi </a> </li> <li class=md-nav__item> <a href=../../certificates/lets-encrypt-k8s/ class=md-nav__link> Let's Encrypt K8S </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_2 type=checkbox id=__nav_7_2> <label class=md-nav__link for=__nav_7_2> Software Engineering <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Software Engineering" data-md-level=2> <label class=md-nav__title for=__nav_7_2> <span class="md-nav__icon md-icon"></span> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_3 type=checkbox id=__nav_7_3> <label class=md-nav__link for=__nav_7_3> Productivity <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Productivity data-md-level=2> <label class=md-nav__title for=__nav_7_3> <span class="md-nav__icon md-icon"></span> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4 type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4> Java <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Java data-md-level=2> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/ class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../java/networking/ class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../java/concurrency/ class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#steps-to-do class=md-nav__link> Steps to do </a> </li> <li class=md-nav__item> <a href=#create-and-configure-cluster-one class=md-nav__link> Create and Configure Cluster One </a> <nav class=md-nav aria-label="Create and Configure Cluster One"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-create-cluster-with-terraform class=md-nav__link> 1. Create Cluster With Terraform </a> <nav class=md-nav aria-label="1. Create Cluster With Terraform"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#main class=md-nav__link> Main </a> </li> <li class=md-nav__item> <a href=#variables class=md-nav__link> Variables </a> </li> <li class=md-nav__item> <a href=#cluster class=md-nav__link> Cluster </a> </li> <li class=md-nav__item> <a href=#nodepools class=md-nav__link> Nodepools </a> </li> <li class=md-nav__item> <a href=#execute-terraform-steps class=md-nav__link> Execute Terraform Steps </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-create-cloud-dns-zone class=md-nav__link> 2. Create Cloud DNS Zone </a> <nav class=md-nav aria-label="2. Create Cloud DNS Zone"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gcloud class=md-nav__link> Gcloud </a> </li> <li class=md-nav__item> <a href=#terraform class=md-nav__link> Terraform </a> </li> <li class=md-nav__item> <a href=#create-gcp-service-account-for-accessing-cloud-dns class=md-nav__link> Create GCP Service Account for accessing Cloud DNS </a> <nav class=md-nav aria-label="Create GCP Service Account for accessing Cloud DNS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#gcloud_1 class=md-nav__link> Gcloud </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-credentials-in-cluster class=md-nav__link> Configure Credentials In Cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-install-bootstrapping class=md-nav__link> 3. Install Bootstrapping </a> <nav class=md-nav aria-label="3. Install Bootstrapping"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nginx-ingress class=md-nav__link> Nginx Ingress </a> </li> <li class=md-nav__item> <a href=#certmanager class=md-nav__link> Certmanager </a> </li> <li class=md-nav__item> <a href=#external-dns-controller class=md-nav__link> External DNS Controller </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-install-cloudbees-ci class=md-nav__link> 4. Install CloudBees CI </a> </li> <li class=md-nav__item> <a href=#5-manually-configure-external-access class=md-nav__link> 5. Manually Configure External Access </a> <nav class=md-nav aria-label="5. Manually Configure External Access"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tcp-services-configmap class=md-nav__link> TCP Services ConfigMap </a> </li> <li class=md-nav__item> <a href=#update-nginx-deployment class=md-nav__link> Update Nginx Deployment </a> </li> <li class=md-nav__item> <a href=#update-nginx-service class=md-nav__link> Update Nginx Service </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-and-configure-clustertwo class=md-nav__link> Create and Configure ClusterTwo </a> <nav class=md-nav aria-label="Create and Configure ClusterTwo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#4-create-gcp-service-account-for-accessing-gke class=md-nav__link> 4. Create GCP service account for accessing GKE </a> <nav class=md-nav aria-label="4. Create GCP service account for accessing GKE"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ui_1 class=md-nav__link> UI </a> </li> <li class=md-nav__item> <a href=#gcloud_2 class=md-nav__link> Gcloud </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-configure-receiving-namespace class=md-nav__link> 5. Configure Receiving Namespace </a> <nav class=md-nav aria-label="5. Configure Receiving Namespace"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prepare-namespace class=md-nav__link> Prepare Namespace </a> </li> <li class=md-nav__item> <a href=#give-user-admin-rights class=md-nav__link> Give User Admin Rights </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#create-managed-master-in-both-clusters class=md-nav__link> Create Managed Master in both clusters </a> <nav class=md-nav aria-label="Create Managed Master in both clusters"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-cloudbees-ci-credential-with-gcp-service-account class=md-nav__link> Create CloudBees CI Credential with GCP Service Account </a> </li> <li class=md-nav__item> <a href=#create-second-kubernetes-endpoint-configuration class=md-nav__link> Create second Kubernetes endpoint configuration </a> </li> <li class=md-nav__item> <a href=#create-managed-masters class=md-nav__link> Create Managed Masters </a> <nav class=md-nav aria-label="Create Managed Masters"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#update-master-provisioning class=md-nav__link> Update Master Provisioning </a> </li> <li class=md-nav__item> <a href=#creating-master class=md-nav__link> Creating Master </a> </li> <li class=md-nav__item> <a href=#give-user-permissions-in-cluster-two class=md-nav__link> Give User Permissions In Cluster Two </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/cloudbees/multi-cluster-gke.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=cloudbees-ci-multi-cluster-gke>CloudBees CI - Multi Cluster GKE<a class=headerlink href=#cloudbees-ci-multi-cluster-gke title="Permanent link">&para;</a></h1> <p>Imagine you have a whole range of departments and development teams. Preferably you want to serve them with a standardized SDA(Software Delivery Automation) platform, but at the same time, make sure they pay for their usage.</p> <p>I don't think this is too far fetched or something terrible. I think it makes sense. In this light, CloudBees Core now <a href=https://docs.cloudbees.com/docs/cloudbees-core/latest/cloud-admin-guide/multiple-clusters>supports running on multiple Kubernetes clusters</a>.</p> <p>In this guide, we're going to explore how to run CloudBees Core on two GKE cluster at the same time. And how to deal with the details of getting the namespace configured, certificates, Kubernetes API tokens and so on and so forth.</p> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <ul> <li>The ability to create two GKE clusters</li> <li>CloudDNS enabled</li> <li>valid domain name</li> </ul> <h2 id=steps-to-do>Steps to do<a class=headerlink href=#steps-to-do title="Permanent link">&para;</a></h2> <p>High over, we have to do the following steps:</p> <ul> <li>create and configure GKE cluster One<ul> <li>create GCP service account for accessing CloudDNS<ul> <li>this is per GCP Project, if cluster two is in another project, repeat this</li> </ul> </li> <li>install Operations Center</li> </ul> </li> <li>create and configure GKE cluster Two<ul> <li>create GCP service account for accessing GKE</li> </ul> </li> <li>create a Managed Master in both clusters<ul> <li>configure Operations Center</li> <li>create managed masters</li> </ul> </li> </ul> <h2 id=create-and-configure-cluster-one>Create and Configure Cluster One<a class=headerlink href=#create-and-configure-cluster-one title="Permanent link">&para;</a></h2> <p>The easiest way to create <em>and</em> manage a cluster is with Terraform.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>I will use <code>GCP_PROJECT_ONE</code> and <code>one.domain.com</code> as placeholders for the Google Project ID and domain name respectively. You will need to change these to reflect your configuration.</p> <p>The assumption in this guide is that the clusters are in two different projects. This doesn't have to be so be, so feel free to use the same project id and domain name for both clusters.</p> </div> <p>To create and configure cluster one, we execute the following steps:</p> <ol> <li>Create Cluster With Terraform</li> <li>Create Cloud DNS Zone</li> <li>Install Bootstrapping services (certmanager, ingress controller, external dns)</li> <li>Install CloudBees CI</li> <li>Configure External Access</li> </ol> <h3 id=1-create-cluster-with-terraform>1. Create Cluster With Terraform<a class=headerlink href=#1-create-cluster-with-terraform title="Permanent link">&para;</a></h3> <p>We create four files:</p> <ul> <li><code>main.tf</code> containing the provider information</li> <li><code>variables.tf</code> containg the variables (and their defaults)</li> <li><code>cluster.tf</code> cluster definition</li> <li><code>nodepool.tf</code>houses our node pool definition, currently one, but should be easy to add more if desired</li> </ul> <h4 id=main>Main<a class=headerlink href=#main title="Permanent link">&para;</a></h4> <div class="admonition example"> <p class=admonition-title>main.tf</p> <div class=highlight><pre><span></span><code><span class=nb>terraform</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>required_version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;~&gt; 0.12&quot;</span><span class=w></span>
<span class=p>}</span><span class=c1></span>

<span class=c1># https://www.terraform.io/docs/providers/google/index.html</span>
<span class=kr>provider</span><span class=w> </span><span class=nv>&quot;google&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>version</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;~&gt; 2.18.1&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>project</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>var.project</span><span class=w></span>
<span class=w>  </span><span class=na>region</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <h4 id=variables>Variables<a class=headerlink href=#variables title="Permanent link">&para;</a></h4> <div class="admonition example"> <p class=admonition-title>variables.tf</p> <div class=highlight><pre><span></span><code><span class=kr>variable</span><span class=w> </span><span class=nv>&quot;project&quot;</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>}</span><span class=w></span>

<span class=kr>variable</span><span class=w> </span><span class=nv>&quot;name&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;The name of the cluster (required)&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>default</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;jvandergriendt_cluster_one&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kr>variable</span><span class=w> </span><span class=nv>&quot;description&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;The description of the cluster&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>default</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;CloudBees CI environment for jvandergriendt&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kr>variable</span><span class=w> </span><span class=nv>&quot;location&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;The location to host the cluster&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>default</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;europe-west4&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kr>variable</span><span class=w> </span><span class=nv>&quot;cluster_master_version&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;The minimum kubernetes version for the master nodes&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>default</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;1.15.9-gke.8&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kr>variable</span><span class=w> </span><span class=nv>&quot;np1count&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;The initial Node Count for NodePool 2&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>default</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=m>1</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=kr>variable</span><span class=w> </span><span class=nv>&quot;np1machinetype&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;GCP Machine Type for Nodepool 1&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>default</span><span class=w>     </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;e2-standard-2&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <h4 id=cluster>Cluster<a class=headerlink href=#cluster title="Permanent link">&para;</a></h4> <div class="admonition example"> <p class=admonition-title>cluster.tf</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_container_cluster&quot;</span><span class=w> </span><span class=nv>&quot;primary&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=nv>var.name</span><span class=w></span>
<span class=w>  </span><span class=na>location</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span><span class=c1></span>

<span class=c1>  # We can&#39;t create a cluster with no node pool defined, but we want to only use</span>
<span class=c1>  # separately managed node pools. So we create the smallest possible default</span>
<span class=c1>  # node pool and immediately delete it.</span>
<span class=w>  </span><span class=na>remove_default_node_pool</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=no>true</span><span class=w></span>
<span class=w>  </span><span class=na>initial_node_count</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=m>1</span><span class=w></span>
<span class=w>  </span><span class=nb>resource_labels</span><span class=w>           </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=na>environment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;development&quot;</span><span class=w></span>
<span class=w>    </span><span class=na>created-by</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;terraform&quot;</span><span class=w></span>
<span class=w>    </span><span class=na>cb-owner</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;professional-services&quot;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=c1></span>

<span class=c1>  # Configuration options for the NetworkPolicy feature.</span>
<span class=w>  </span><span class=nb>network_policy</span><span class=w> </span><span class=p>{</span><span class=c1></span>
<span class=c1>    # Whether network policy is enabled on the cluster. Defaults to false.</span>
<span class=c1>    # In GKE this also enables the ip masquerade agent</span>
<span class=c1>    # https://cloud.google.com/kubernetes-engine/docs/how-to/ip-masquerade-agent</span>
<span class=w>    </span><span class=na>enabled</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span><span class=c1></span>

<span class=c1>    # The selected network policy provider. Defaults to PROVIDER_UNSPECIFIED.</span>
<span class=w>    </span><span class=na>provider</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;CALICO&quot;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <h4 id=nodepools>Nodepools<a class=headerlink href=#nodepools title="Permanent link">&para;</a></h4> <div class="admonition example"> <p class=admonition-title>nodepool.tf</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_container_node_pool&quot;</span><span class=w> </span><span class=nv>&quot;nodepool1&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>name</span><span class=w>       </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;pool1&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>location</span><span class=w>   </span><span class=o>=</span><span class=w> </span><span class=nv>var.location</span><span class=w></span>
<span class=w>  </span><span class=na>cluster</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=nv>google_container_cluster.primary.name</span><span class=w></span>
<span class=w>  </span><span class=na>node_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.np1count</span><span class=w></span>

<span class=w>  </span><span class=nb>management</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=na>auto_repair</span><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=no>true</span><span class=w></span>
<span class=w>    </span><span class=na>auto_upgrade</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=no>true</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nb>autoscaling</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=na>min_node_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>2</span><span class=w></span>
<span class=w>    </span><span class=na>max_node_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>5</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>

<span class=w>  </span><span class=nb>node_config</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=na>machine_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nv>var.np1machinetype</span><span class=w></span>
<span class=w>    </span><span class=na>oauth_scopes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=w></span>
<span class=w>      </span><span class=s2>&quot;https://www.googleapis.com/auth/compute&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>      </span><span class=s2>&quot;https://www.googleapis.com/auth/devstorage.read_only&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>      </span><span class=s2>&quot;https://www.googleapis.com/auth/logging.write&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>      </span><span class=s2>&quot;https://www.googleapis.com/auth/monitoring&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>      </span><span class=s2>&quot;https://www.googleapis.com/auth/ndev.clouddns.readwrite&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>      </span><span class=s2>&quot;https://www.googleapis.com/auth/cloud-platform&quot;</span><span class=w></span>
<span class=w>    </span><span class=p>]</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <h4 id=execute-terraform-steps>Execute Terraform Steps<a class=headerlink href=#execute-terraform-steps title="Permanent link">&para;</a></h4> <div class="tabbed-set tabbed-alternate" data-tabs=1:3><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Terraform init</label><label for=__tabbed_1_2>Terraform plan</label><label for=__tabbed_1_3>Terraform apply</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>terraform init
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>terraform plan -out plan.out
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>terraform apply <span class=s2>&quot;plan.out&quot;</span>
</code></pre></div> </div> </div> </div> <h3 id=2-create-cloud-dns-zone>2. Create Cloud DNS Zone<a class=headerlink href=#2-create-cloud-dns-zone title="Permanent link">&para;</a></h3> <h4 id=gcloud>Gcloud<a class=headerlink href=#gcloud title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>gcloud dns managed-zones create one-domain-com --dns-name one.domain.com. <span class=se>\</span>
      --description <span class=s2>&quot;Example DNS zone&quot;</span>
</code></pre></div> <h4 id=terraform>Terraform<a class=headerlink href=#terraform title="Permanent link">&para;</a></h4> <div class="admonition example"> <p class=admonition-title>main.tf</p> <div class=highlight><pre><span></span><code><span class=kr>resource</span><span class=w> </span><span class=nc>&quot;google_dns_managed_zone&quot;</span><span class=w> </span><span class=nv>&quot;one-domain-com&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=na>name</span><span class=w>        </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;one-domain-com&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>dns_name</span><span class=w>    </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;one.domain.com.&quot;</span><span class=w></span>
<span class=w>  </span><span class=na>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Example DNS zone&quot;</span><span class=w></span>
<span class=w>  </span><span class=nb>labels</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=na>foo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;bar&quot;</span><span class=w></span>
<span class=w>  </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> </div> <h4 id=create-gcp-service-account-for-accessing-cloud-dns>Create GCP Service Account for accessing Cloud DNS<a class=headerlink href=#create-gcp-service-account-for-accessing-cloud-dns title="Permanent link">&para;</a></h4> <h5 id=ui>UI<a class=headerlink href=#ui title="Permanent link">&para;</a></h5> <p>In GCP's IAM/service Account screen, create a new Service Account.</p> <p>Give the service account two roles:</p> <ul> <li>Project Viewer</li> <li>DNS Admin</li> </ul> <p>Once done, create a JSON key and download this. Rename the file to <code>credentials.json</code>.</p> <h5 id=gcloud_1>Gcloud<a class=headerlink href=#gcloud_1 title="Permanent link">&para;</a></h5> <div class="tabbed-set tabbed-alternate" data-tabs=2:4><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><input id=__tabbed_2_3 name=__tabbed_2 type=radio><input id=__tabbed_2_4 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Create SA</label><label for=__tabbed_2_2>Give SA Project Permission</label><label for=__tabbed_2_3>Give CloudDNS Permission</label><label for=__tabbed_2_4>Generate JSON Key</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>gcloud iam service-accounts create sa-name <span class=se>\</span>
    --description<span class=o>=</span><span class=s2>&quot;sa-description&quot;</span> <span class=se>\</span>
    --display-name<span class=o>=</span><span class=s2>&quot;sa-display-name&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>gcloud projects add-iam-policy-binding my-project-123 <span class=se>\</span>
    --member serviceAccount:my-sa-123@my-project-123.iam.gserviceaccount.com <span class=se>\</span>
    --role roles/viewer
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>gcloud projects add-iam-policy-binding my-project-123 <span class=se>\</span>
    --member serviceAccount:my-sa-123@my-project-123.iam.gserviceaccount.com <span class=se>\</span>
    --role roles/dns.admin
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>gcloud iam service-accounts keys create ~key.json <span class=se>\</span>
  --iam-account &lt;YOUR-SA-NAME&gt;&gt;@project-id.iam.gserviceaccount.com
</code></pre></div> </div> </div> </div> <h4 id=configure-credentials-in-cluster>Configure Credentials In Cluster<a class=headerlink href=#configure-credentials-in-cluster title="Permanent link">&para;</a></h4> <p>Create the Kubernetes namespace <code>bootstrap</code> and add the credentials to the namespace.</p> <div class=highlight><pre><span></span><code>kubectl create namespace bootstrap
</code></pre></div> <div class=highlight><pre><span></span><code>kubectl create secret generic external-dns-gcp-sa --from-file<span class=o>=</span>credentials.json -n bootstrap
</code></pre></div> <h3 id=3-install-bootstrapping>3. Install Bootstrapping<a class=headerlink href=#3-install-bootstrapping title="Permanent link">&para;</a></h3> <h4 id=nginx-ingress>Nginx Ingress<a class=headerlink href=#nginx-ingress title="Permanent link">&para;</a></h4> <div class="admonition important"> <p class=admonition-title>Important</p> <p>We assume Cluster One will be the cluster hosting Operations Center.</p> <p>This means Cluster One needs to expose the port <code>50000</code> via the LoadBalancer. Nginx can do this automatically, if we add a <code>tcp</code> configuration in the <code>values.yaml</code>.</p> <p>Cluster Two should <em>not</em> get this configuration as it will throw errors and polute your Nginx Ingress Controller logs. So be mindful that there are two different files and two different commands.</p> </div> <div class="tabbed-set tabbed-alternate" data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Add Helm Repo</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
</code></pre></div> </div> </div> </div> <p>=== "Update Helm repositories <div class=highlight><pre><span></span><code>helm repo update
</code></pre></div></p> <div class="tabbed-set tabbed-alternate" data-tabs=4:2><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><input id=__tabbed_4_2 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>Helm Install Cluster One</label><label for=__tabbed_4_2>Helm Install Cluster Two</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm install ingress ingress-nginx/ingress-nginx -f ingress-values-c1.yaml
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm install ingress ingress-nginx/ingress-nginx -f ingress-values-c2.yaml
</code></pre></div> </div> </div> </div> <div class="admonition example"> <p class=admonition-title>ingress-values-c1.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>service</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>omitClusterIP</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=nt>controller</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>tcp</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>configMapNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class=w></span>
<span class=w>  </span><span class=nt>autoscaling</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>    </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<span class=w>    </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class=w></span>
<span class=w>  </span><span class=nt>publishService</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=nt>tcp</span><span class=p>:</span><span class=w> </span>
<span class=w>  </span><span class=nt>50000</span><span class=p>:</span><span class=w> </span><span class=s>&quot;cloudbees-ci/cjoc:50000&quot;</span><span class=w></span>
</code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>ingress-values-c2.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>service</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>omitClusterIP</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=nt>controller</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>tcp</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>configMapNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class=w></span>
<span class=w>  </span><span class=nt>autoscaling</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>    </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<span class=w>    </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class=w></span>
<span class=w>  </span><span class=nt>publishService</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>  </span><span class=nt>metrics</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
</code></pre></div> </div> <h4 id=certmanager>Certmanager<a class=headerlink href=#certmanager title="Permanent link">&para;</a></h4> <div class="tabbed-set tabbed-alternate" data-tabs=5:3><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><input id=__tabbed_5_2 name=__tabbed_5 type=radio><input id=__tabbed_5_3 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1>Install Repository</label><label for=__tabbed_5_2>Update Helm Repositories</label><label for=__tabbed_5_3>Install Certmanager chart</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm repo add jetstack https://charts.jetstack.io
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm repo update
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm install certmanager jetstack/cert-manager <span class=se>\</span>
  -f certmanager-values.yaml <span class=se>\</span>
  -n bootstrap <span class=se>\</span>
   --version v0.15.1 <span class=se>\</span>
   --set <span class=nv>installCRDs</span><span class=o>=</span><span class=nb>true</span>
</code></pre></div> </div> </div> </div> <div class="admonition example"> <p class=admonition-title>certmanager-values.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>prometheus</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=nt>ingressShim</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>defaultIssuerName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span><span class=w></span>
<span class=w>  </span><span class=nt>defaultIssuerKind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span><span class=w></span>
</code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>cluster-issuer.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1alpha2</span><span class=w></span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span><span class=w></span>
<span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span><span class=w></span>
<span class=nt>spec</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>acme</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>email</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">joostvdg@gmail.com</span><span class=w></span>
<span class=w>    </span><span class=nt>privateKeySecretRef</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span><span class=w></span>
<span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://acme-v02.api.letsencrypt.org/directory</span><span class=w></span>
<span class=w>    </span><span class=nt>solvers</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>dns01</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>clouddns</span><span class=p>:</span><span class=w></span>
<span class=w>          </span><span class=nt>project</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GCP_PROJECT_ONE</span><span class=w></span>
<span class=w>          </span><span class=nt>serviceAccountSecretRef</span><span class=p>:</span><span class=w></span>
<span class=w>            </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">credentials.json</span><span class=w></span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">external-dns-gcp-sa</span><span class=w></span>
</code></pre></div> </div> <div class=highlight><pre><span></span><code>kubectl apply -f cluster-issuer.yaml
</code></pre></div> <h4 id=external-dns-controller>External DNS Controller<a class=headerlink href=#external-dns-controller title="Permanent link">&para;</a></h4> <div class="admonition example"> <p class=admonition-title>extdns-values.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">google</span><span class=w></span>
<span class=nt>domainFilters</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;one.domain.com&quot;</span><span class=w></span>
<span class=nt>metrics</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=nt>google</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>project</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GCP_PROJECT_ONE</span><span class=w></span>
<span class=w>  </span><span class=nt>serviceAccountSecret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">external-dns-gcp-sa</span><span class=w></span>
</code></pre></div> </div> <h3 id=4-install-cloudbees-ci>4. Install CloudBees CI<a class=headerlink href=#4-install-cloudbees-ci title="Permanent link">&para;</a></h3> <div class="admonition example"> <p class=admonition-title>cloudbees-ci-values.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>OperationsCenter</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>HostName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ci.one.domain.com</span><span class=w></span>
<span class=w>  </span><span class=nt>Ingress</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>tls</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>Enable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>      </span><span class=nt>Host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ci.dev.jxgke.kearos.net</span><span class=w></span>
<span class=w>      </span><span class=nt>SecretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tls-dev-jxgke-kearos-net-p</span><span class=w></span>
<span class=w>  </span><span class=nt>ServiceType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span><span class=w></span>
</code></pre></div> </div> <div class="tabbed-set tabbed-alternate" data-tabs=6:4><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><input id=__tabbed_6_2 name=__tabbed_6 type=radio><input id=__tabbed_6_3 name=__tabbed_6 type=radio><input id=__tabbed_6_4 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1>Add Helm Repo</label><label for=__tabbed_6_2>Update Helm Repos</label><label for=__tabbed_6_3>Create Namespace</label><label for=__tabbed_6_4>Helm Install</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm repo add cloudbees https://charts.cloudbees.com/public/cloudbees
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm repo update
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>kubectl create namespace cloudbees-ci
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm install cloudbees-ci cloudbees/cloudbees-core <span class=se>\</span>
  -f cloudbees-ci-values.yaml <span class=se>\</span>
  --namespace cloudbees-ci <span class=se>\</span>
  --version <span class=m>3</span>.14.0+ebfb4625ad50
</code></pre></div> </div> </div> </div> <h3 id=5-manually-configure-external-access>5. Manually Configure External Access<a class=headerlink href=#5-manually-configure-external-access title="Permanent link">&para;</a></h3> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>This configuration is only required if you do not use the Nginx Ingress Helm Chart.</p> <p>If you do, this is already configured for you <a href=/cloudbees/multi-cluster-gke/#nginx-ingress>in the Nginx Ingress paragraph earlier</a>.</p> <p>If you're curious how to configure this <em>manually</em>, read on!</p> </div> <p>To allow Master to connect back to Operations Center from another cluster, two ports must be open, <code>443</code> (or <code>80</code> if no TLS) and <code>50000</code> (if you've kept the default).</p> <p>For this we enable <code>tcp-services</code> and configure the <code>50000</code> port on the <em>deployment</em> and <em>service</em> (Kubernetes resources) of our Nginx Ingress.</p> <p>How to change the Nginx Ingress configuration depends on how you've installed it. For sake of brevity, I will simply edit the resources via a <code>kubectl edit</code> (hint: don't do this in production).</p> <h4 id=tcp-services-configmap>TCP Services ConfigMap<a class=headerlink href=#tcp-services-configmap title="Permanent link">&para;</a></h4> <p>To enable the TCP services, we need to take three steps:</p> <ul> <li>create a config map with the configuration</li> <li>enable tcp services in the deployment and point to the configmap</li> <li>update the service to listen to port <code>50000</code></li> </ul> <div class="admonition example"> <p class=admonition-title>nginx-config-map.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span><span class=w></span>
<span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tcp-services</span><span class=w></span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span><span class=w></span>
<span class=nt>data</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>50000</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cloudbees-ci/cjoc:50000&quot;</span><span class=w></span>
</code></pre></div> </div> <div class="admonition info"> <p class=admonition-title>Info</p> <p><code>cloudbees-ci</code> is the namespace my CJOC runs in.</p> <p>Change this if your CJOC runs elsewhere.</p> </div> <div class=highlight><pre><span></span><code>kubectl apply -f nginx-config-map.yaml
</code></pre></div> <h4 id=update-nginx-deployment>Update Nginx Deployment<a class=headerlink href=#update-nginx-deployment title="Permanent link">&para;</a></h4> <p>Once this is done, we can edit the controller's deployment.</p> <p>We have to make two changes:</p> <ul> <li>add the tcp-services coniguration</li> <li>add the port <code>50000</code> configuration</li> </ul> <div class=highlight><pre><span></span><code>kubectl -n <span class=si>${</span><span class=nv>NAMESPACE</span><span class=si>}</span> edit deployment nginx-ingress-controller
</code></pre></div> <p>Among the container args, we add <code>--tcp-services-configmap</code>.</p> <div class=highlight><pre><span></span><code><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>args</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/nginx-ingress-controller</span><span class=w></span>
<span class=w>        </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class=w></span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">--tcp-services-configmap=kube-system/tcp-services</span><span class=w></span>
</code></pre></div> <p>Next, we edit the same deployment, and add the tcp port.</p> <p>We will add the 50000 to the container ports.</p> <div class=highlight><pre><span></span><code><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">50000</span><span class=w></span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jnlp</span><span class=w></span>
<span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
</code></pre></div> <p>It will then look something like this.</p> <div class=highlight><pre><span></span><code><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class=w></span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class=w></span>
<span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">443</span><span class=w></span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class=w></span>
<span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">50000</span><span class=w></span>
<span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jnlp</span><span class=w></span>
<span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
</code></pre></div> <h4 id=update-nginx-service>Update Nginx Service<a class=headerlink href=#update-nginx-service title="Permanent link">&para;</a></h4> <p>Last but not least, we also have to update the Nginx Ingress <em>service</em> resource.</p> <div class=highlight><pre><span></span><code>kubectl -n <span class=nv>$NAMESPACE</span> edit svc nginx-ingress-controller
</code></pre></div> <p>We add a similar port definition.</p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jnlp</span><span class=w></span>
<span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">31559</span><span class=w></span>
<span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">50000</span><span class=w></span>
<span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
<span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jnlp</span><span class=w></span>
</code></pre></div> <p>Which will then look something like this (clusterIp and nodePort's will be different).</p> <div class=highlight><pre><span></span><code><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.....</span><span class=w></span>
<span class=w>  </span><span class=nt>externalTrafficPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span><span class=w></span>
<span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class=w></span>
<span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">31406</span><span class=w></span>
<span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class=w></span>
<span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
<span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class=w></span>
<span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30391</span><span class=w></span>
<span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">443</span><span class=w></span>
<span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
<span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jnlp</span><span class=w></span>
<span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">31559</span><span class=w></span>
<span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">50000</span><span class=w></span>
<span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
<span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">jnlp</span><span class=w></span>
</code></pre></div> <h2 id=create-and-configure-clustertwo>Create and Configure ClusterTwo<a class=headerlink href=#create-and-configure-clustertwo title="Permanent link">&para;</a></h2> <p>Creating Cluster Two is similar to the creation of Cluster One. We re-use some steps of the Creation Cluster One segment, and below are the new steps. Do ensure to replace the placeholders for the cluster name, project id, and domain with the appropriate values for Cluster Two.</p> <p>To create and configure Cluster Two, we execute the following steps:</p> <ol> <li>Create Cluster With Terraform <a href=#1-create-cluster-with-terraform>see step 1</a></li> <li>Create Cloud DNS Zone <a href=#2-create-cloud-dns-zone>see step 2</a></li> <li>Install Bootstrapping services <a href=#3-install-bootstrapping>see step 3</a></li> <li>Create GCP service account for accessing GKE</li> <li>Configure Receiving Namespace</li> </ol> <h3 id=4-create-gcp-service-account-for-accessing-gke>4. Create GCP service account for accessing GKE<a class=headerlink href=#4-create-gcp-service-account-for-accessing-gke title="Permanent link">&para;</a></h3> <h4 id=ui_1>UI<a class=headerlink href=#ui_1 title="Permanent link">&para;</a></h4> <p>Open the <em>Hamburger Menu</em> on the top left, and select <code>IAM &amp; Admin</code> &rarr; <code>Service Accounts</code> -&gt; <code>CREATE SERVICE ACCOUNT</code> (top middle).</p> <p>Give it a descriptive name and two roles:</p> <ul> <li><code>Project / Viewer</code></li> <li><code>Kubernetes Engine Cluster Admin</code> (or, <code>Kubernetes Engine Developer</code>)</li> </ul> <p><img alt="Configure GCP SA" src=../../images/cloudbees-multicluster-gke-sa.png></p> <p>Then hit the <code>+ CREATE KEY</code> button, and select (and download) the JSON key.</p> <p><img alt="Configure Second Kubernetes Endpoint" src=../../images/cloudbees-multicluster-gke-sa-key.png></p> <h4 id=gcloud_2>Gcloud<a class=headerlink href=#gcloud_2 title="Permanent link">&para;</a></h4> <p>If you prefer to create the SA via <a href=https://cloud.google.com/sdk/ >Gcloud</a> CLI:</p> <div class="tabbed-set tabbed-alternate" data-tabs=7:4><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><input id=__tabbed_7_2 name=__tabbed_7 type=radio><input id=__tabbed_7_3 name=__tabbed_7 type=radio><input id=__tabbed_7_4 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1>Create SA</label><label for=__tabbed_7_2>Give SA Project Permission</label><label for=__tabbed_7_3>Give GKE Permission</label><label for=__tabbed_7_4>Generate JSON Key</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>gcloud iam service-accounts create sa-name <span class=se>\</span>
    --description<span class=o>=</span><span class=s2>&quot;sa-description&quot;</span> <span class=se>\</span>
    --display-name<span class=o>=</span><span class=s2>&quot;sa-display-name&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>gcloud projects add-iam-policy-binding my-project-123 <span class=se>\</span>
    --member serviceAccount:my-sa-123@my-project-123.iam.gserviceaccount.com <span class=se>\</span>
    --role roles/viewer
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>gcloud projects add-iam-policy-binding my-project-123 <span class=se>\</span>
    --member serviceAccount:my-sa-123@my-project-123.iam.gserviceaccount.com <span class=se>\</span>
    --role roles/container.clusterAdmin <span class=c1># or roles/container.developer</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>gcloud iam service-accounts keys create ~key.json <span class=se>\</span>
  --iam-account &lt;YOUR-SA-NAME&gt;&gt;@project-id.iam.gserviceaccount.com
</code></pre></div> </div> </div> </div> <p>Read <a href=https://cloud.google.com/iam/docs/understanding-roles#predefined_roles>Google Cloud's</a> documentation on Roles for further information.</p> <h3 id=5-configure-receiving-namespace>5. Configure Receiving Namespace<a class=headerlink href=#5-configure-receiving-namespace title="Permanent link">&para;</a></h3> <h4 id=prepare-namespace>Prepare Namespace<a class=headerlink href=#prepare-namespace title="Permanent link">&para;</a></h4> <div class="tabbed-set tabbed-alternate" data-tabs=8:4><input checked=checked id=__tabbed_8_1 name=__tabbed_8 type=radio><input id=__tabbed_8_2 name=__tabbed_8 type=radio><input id=__tabbed_8_3 name=__tabbed_8 type=radio><input id=__tabbed_8_4 name=__tabbed_8 type=radio><div class=tabbed-labels><label for=__tabbed_8_1>Create Namespace</label><label for=__tabbed_8_2>Fetch Helm Chart</label><label for=__tabbed_8_3>Generate Namespace Manifests</label><label for=__tabbed_8_4>Apply Namespace Manifests</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>kubectl create namespace masters
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm fetch cloudbees/cloudbees-core --untar
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>helm template cloudbees-core-masters-masters cloudbees-core <span class=se>\</span>
   --namespace masters <span class=se>\</span>
   -f namespace-masters-values.yaml <span class=se>\</span>
   &gt; namespace-masters.yaml
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>kubectl apply -f namespace-masters.yaml <span class=se>\</span>
  --namespace masters
</code></pre></div> </div> </div> </div> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>Make sure you are executing the steps on Cluster Two!</p> </div> <div class="admonition example"> <p class=admonition-title>namespace-masters-values.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>OperationsCenter</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>Enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w></span>
<span class=nt>Master</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>Enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<span class=w>    </span><span class=nt>OperationsCenterNamespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">masters</span><span class=w></span>
<span class=nt>Agents</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>Enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
</code></pre></div> </div> <h4 id=give-user-admin-rights>Give User Admin Rights<a class=headerlink href=#give-user-admin-rights title="Permanent link">&para;</a></h4> <p>I'm not sure if you can figure out the user id upfront. When you create a Master in this cluster, you'll likely see an error that <code>user 98389745879 has no permission</code> to create certain resources, such as the StatefulSet.</p> <p>Run the command below to give this user permission to create these Kubernetes resources.</p> <div class=highlight><pre><span></span><code>kubectl create clusterrolebinding clusterrolebinding-name <span class=se>\</span>
--clusterrole cluster-admin <span class=se>\</span>
--user <span class=nv>$USER_ID</span>
</code></pre></div> <p>If you don't know the user id of your GCP Service Account, go ahead with the next chapter. We refer back to this paragraph.</p> <h2 id=create-managed-master-in-both-clusters>Create Managed Master in both clusters<a class=headerlink href=#create-managed-master-in-both-clusters title="Permanent link">&para;</a></h2> <ol> <li>Create CloudBees CI Credential with GCP Service Account</li> <li>Create second Kubernetes endpoint configuration</li> <li>Create Managed Master in Cluster One</li> <li>Create Managed Master in Cluster Two</li> </ol> <h3 id=create-cloudbees-ci-credential-with-gcp-service-account>Create CloudBees CI Credential with GCP Service Account<a class=headerlink href=#create-cloudbees-ci-credential-with-gcp-service-account title="Permanent link">&para;</a></h3> <p>This requires that you've created the GCP Service Account with access to GKE and generated the JSON Key.</p> <p>You can then upload this JSON Key as a credential to CloudBees CI via the Credentials kind <code>Google Service Account from private key</code>.</p> <p><img alt="Configure Second Kubernetes Endpoint" src=../../images/cloudbees-multicluster-gke-cred.png></p> <h3 id=create-second-kubernetes-endpoint-configuration>Create second Kubernetes endpoint configuration<a class=headerlink href=#create-second-kubernetes-endpoint-configuration title="Permanent link">&para;</a></h3> <p>Now we create a second Kubernetes Endpoint in the cluster.</p> <p>The fields to fill in:</p> <ol> <li><strong>API endpoint URL</strong>: the cluster endpoint of Cluster Two</li> <li><strong>Display Name</strong>: display name so you know which cluster you create a Master in</li> <li><strong>Credentials</strong>: the credentials we create in <a href="#Create CloudBees CI Credential with GCP Service Account">#Create CloudBees CI Credential with GCP Service Account</a></li> <li><strong>Server Certificate</strong>: the server certificate of Cluster Two</li> <li><strong>Namespace</strong>: the namespace you have prepared, in our case <code>masters</code></li> <li><strong>Master URL Pattern</strong>: the DNS pattern for Cluster Two, in our case <code>https://*.two.domain.com</code></li> <li><strong>Ingress Class</strong>: unless you used a different Ingress than in this guide, set to <code>nginx</code></li> <li><strong>Jenkins URL</strong>: the external URL of the Operations Center</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If you don't know the API Endpoint or the Server Certificate, you can retrieve this from your <code>~/.kube/config</code> file. Assuming you have access to Cluster Two, you will the details of the cluster there.</p> <p>For the Server Certificate, you have to Base64 decode this. You can do so on mac/linux by echo + pipe into <code>base64</code>.</p> <p>For example, on a mac:</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=s2>&quot;kjhKJSDH13123&quot;</span> <span class=p>|</span> base64 -D
</code></pre></div> </div> <p><img alt="Configure Second Kubernetes Endpoint" src=../../images/cloudbees-multicluster-gke.png></p> <h3 id=create-managed-masters>Create Managed Masters<a class=headerlink href=#create-managed-masters title="Permanent link">&para;</a></h3> <p>To enable automatic TLS for the Masters in the clusters, you can either edit the Ingress when creating the Mater, or update the Kubernetes Master Provisioning before hand.</p> <h4 id=update-master-provisioning>Update Master Provisioning<a class=headerlink href=#update-master-provisioning title="Permanent link">&para;</a></h4> <ul> <li><code>Manage Jenkins</code> -&gt; <code>Configure System</code> -&gt; <code>Kubernetes Master Provisioning</code> -&gt; <code>Advanced</code> -&gt; <code>YAML</code></li> </ul> <div class="admonition example"> <p class=admonition-title>YAML field</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=s>&quot;extensions/v1beta1&quot;</span><span class=w></span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Ingress&quot;</span><span class=w></span>
<span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>cert-manager.io/cluster-issuer</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span><span class=w></span>
<span class=nt>spec</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>tls</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${host}</span><span class=w></span>
<span class=w>    </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${secretName}</span><span class=w></span>
</code></pre></div> </div> <h4 id=creating-master>Creating Master<a class=headerlink href=#creating-master title="Permanent link">&para;</a></h4> <p>In the top right corner, there's a button "New Master", push it and give your master a name.</p> <p>In the field <code>Cluster Endpoint</code>, select the one for Cluster Two. Confirm the URL has the correct domain and hit save.</p> <p><img alt="Create New Master" src=../../images/cloudbees-multicluster-gke-newmm.png></p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The process for creating a Master in Cluster One and Cluster Two are the same. The only difference is the Kubenernetes endpoint used.</p> </div> <h4 id=give-user-permissions-in-cluster-two>Give User Permissions In Cluster Two<a class=headerlink href=#give-user-permissions-in-cluster-two title="Permanent link">&para;</a></h4> <p>As discussed in the Create Cluster Two chapter, the paragraph <a href=/cloudbees/multi-cluster-gke/#give-user-admin-rights>#Give User Admin Rights</a> explains how to do so.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2020-06-05 09:09:12</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../cbc-team-namespace/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Team Master Namespace" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Team Master Namespace </div> </div> </a> <a href=../multi-cluster-eks/ class="md-footer__link md-footer__link--next" aria-label="Next: Multi-Cluster EKS" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Multi-Cluster EKS </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 Joost van der Griendt </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/joostvdg target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/joost_vdg target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/joostvdg target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tabs.sticky", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>