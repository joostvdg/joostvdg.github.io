<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Installing Jenkins X using Bitbucket and Lighthouse for environment repositories"><link href=https://joostvdg.github.io/jenkinsx/lighthouse-bitbucket/ rel=canonical><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.2"><title>Jenkins X - Lighthouse & Bitbucket</title><link rel=stylesheet href=../../assets/stylesheets/application.30686662.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#fb8c00><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-145385967-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=orange data-md-color-accent=red> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#jenkins-x-lighthouse-bitbucket tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo"> <i class=md-icon>public</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> J's Software Development Pages </span> <span class=md-header-nav__topic> Jenkins X - Lighthouse & Bitbucket </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../blogs/jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../../cloudbees/sso-azure-ad/ class=md-tabs__link> Jenkins & CloudBees </a> </li> <li class=md-tabs__item> <a href=../build-packs/ class="md-tabs__link md-tabs__link--active"> Jenkins X </a> </li> <li class=md-tabs__item> <a href=../../openshift/rhos311-gcp-minimal/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ class=md-tabs__link> Software Eng. </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo"> <i class=md-icon>public</i> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Blogs </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../blogs/docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../blogs/k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../blogs/sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../blogs/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../blogs/kubernetes-sso-keycloak/ title="Kubernetes SSO Keycloak" class=md-nav__link> Kubernetes SSO Keycloak </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8> <label class=md-nav__link for=nav-2-8> Jenkins Monitoring Kubernetes </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-8> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/metrics/ title=Metrics class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../blogs/k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../blogs/dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Jenkins & CloudBees </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Jenkins & CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> CloudBees </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-1> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloudbees/sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../../cloudbees/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-team-namespace/ title="Team Master Namespace" class=md-nav__link> Team Master Namespace </a> </li> <li class=md-nav__item> <a href=../../cloudbees/multi-cluster/ title=Multi-Cluster class=md-nav__link> Multi-Cluster </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Jenkins </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins Pipelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-3> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/kaniko-pipelines/ title="Build Docker Image Kaniko" class=md-nav__link> Build Docker Image Kaniko </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/podtemplate-dind/ title="PodTemplate With Docker-In-Docker" class=md-nav__link> PodTemplate With Docker-In-Docker </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ title="Parallel Pipelines" class=md-nav__link> Parallel Pipelines </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipeline Examples </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-4> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Jenkins X </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../build-packs/ title="Build Packs" class=md-nav__link> Build Packs </a> </li> <li class=md-nav__item> <a href=../jx-pipelines/ title="Jenkins X Pipelines" class=md-nav__link> Jenkins X Pipelines </a> </li> <li class=md-nav__item> <a href=../jxboot/ title="JX Boot GKE" class=md-nav__link> JX Boot GKE </a> </li> <li class=md-nav__item> <a href=../jxboot-aks/ title="JX Boot AKS" class=md-nav__link> JX Boot AKS </a> </li> <li class=md-nav__item> <a href=../aks-boot-core/ title="JX Boot & CloudBees Core" class=md-nav__link> JX Boot & CloudBees Core </a> </li> <li class=md-nav__item> <a href=../rhos-311-minimal/ title="JX On OpenShift 3.11" class=md-nav__link> JX On OpenShift 3.11 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Lighthouse & Bitbucket </label> <a href=./ title="Lighthouse & Bitbucket" class="md-nav__link md-nav__link--active"> Lighthouse & Bitbucket </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#run-bitbucket-on-kubernetes class=md-nav__link> Run Bitbucket on Kubernetes </a> </li> <li class=md-nav__item> <a href=#jx-boot-configuration class=md-nav__link> JX Boot Configuration </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bitbucket-api-token class=md-nav__link> Bitbucket API Token </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-requisites </a> </li> <li class=md-nav__item> <a href=#issue-with-controllerbuild class=md-nav__link> Issue with controllerbuild </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#errata class=md-nav__link> Errata </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#import-quickstarts-source-repositories-always-https class=md-nav__link> Import &amp; Quickstarts Source Repositories Always HTTPS </a> </li> <li class=md-nav__item> <a href=#pullrequest-updates class=md-nav__link> PullRequest Updates </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../kubernetes-days/ title="Example For Console Reel" class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Containers </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> OpenShift </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-minimal/ title="OpenShift 3.11 GCP(minimal)" class=md-nav__link> OpenShift 3.11 GCP(minimal) </a> </li> <li class=md-nav__item> <a href=../../openshift/rhos311-gcp-medium/ title="OpenShift 3.11 GCP(medium)" class=md-nav__link> OpenShift 3.11 GCP(medium) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Kubernetes (K8S) </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Managed Kubernetes (cloud) </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> Managed Kubernetes (cloud) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/gke-terraform/ title="GKE Terraform" class=md-nav__link> GKE Terraform </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> K8S Hard Way - GCE </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Docker </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-6> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Software Eng. </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> Software Eng. </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Automation </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-1> Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ title=Pulumi class=md-nav__link> Pulumi </a> </li> <li class=md-nav__item> <a href=../../certificates/lets-encrypt-k8s/ title="Let's Encrypt K8S" class=md-nav__link> Let's Encrypt K8S </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-3> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-4 type=checkbox id=nav-6-4> <label class=md-nav__link for=nav-6-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../java/networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../java/concurrency/ title="Java Concurrency" class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#run-bitbucket-on-kubernetes class=md-nav__link> Run Bitbucket on Kubernetes </a> </li> <li class=md-nav__item> <a href=#jx-boot-configuration class=md-nav__link> JX Boot Configuration </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bitbucket-api-token class=md-nav__link> Bitbucket API Token </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pre-requisites class=md-nav__link> Pre-requisites </a> </li> <li class=md-nav__item> <a href=#issue-with-controllerbuild class=md-nav__link> Issue with controllerbuild </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#errata class=md-nav__link> Errata </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#import-quickstarts-source-repositories-always-https class=md-nav__link> Import &amp; Quickstarts Source Repositories Always HTTPS </a> </li> <li class=md-nav__item> <a href=#pullrequest-updates class=md-nav__link> PullRequest Updates </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> References </a> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/jenkinsx/lighthouse-bitbucket.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=jenkins-x-lighthouse-bitbucket>Jenkins X - Lighthouse &amp; Bitbucket<a class=headerlink href=#jenkins-x-lighthouse-bitbucket title="Permanent link">&para;</a></h1> <p>This guide is about using Jenkins X with Lighthouse<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup> as webhook manager and Bitbucket for the environment repositories<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup>.</p> <h2 id=run-bitbucket-on-kubernetes>Run Bitbucket on Kubernetes<a class=headerlink href=#run-bitbucket-on-kubernetes title="Permanent link">&para;</a></h2> <p>Unfortunately, Atlassian doesn't have an officially supported Bitbucket for Kubernetes.</p> <p>So I've taken the courtesy of creating my own basic configuration - read, <strong><em>not</em></strong> production ready.</p> <div class="admonition example"> <p class=admonition-title>service.yaml</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nt>labels</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket</span>
<span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket</span>
<span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=nt>ports</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="l l-Scalar l-Scalar-Plain">protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
    <span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
<span class=nt>selector</span><span class=p>:</span>
    <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket</span>
<span class=nt>sessionAffinity</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">None</span>
<span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
</pre></div> </td></tr></table> </div> <div class="admonition example"> <p class=admonition-title>ingress.yaml</p> <p>I've taken the assumption that your cluster supports Ingress resources (even if its an OpenShift cluster).</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>rules</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>host</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket.openshift.example.com</span>
    <span class=nt>http</span><span class=p>:</span>
      <span class=nt>paths</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>backend</span><span class=p>:</span>
          <span class=nt>serviceName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket</span>
          <span class=nt>servicePort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</pre></div> </td></tr></table> </div> <div class="admonition example"> <p class=admonition-title>stateful-set.yaml</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>serviceName</span><span class=p>:</span> <span class=s>&quot;bitbucket&quot;</span>
  <span class=nt>replicas</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>matchLabels</span><span class=p>:</span>
      <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket</span>
  <span class=nt>template</span><span class=p>:</span>
    <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>app</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucket</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">atlassian/bitbucket-server:7.0.0</span>
        <span class=nt>ports</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">7990</span>
          <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">7999</span>
          <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">web</span>
        <span class=nt>volumeMounts</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">data</span>
          <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/var/atlassian/application-data/bitbucket</span>
  <span class=nt>volumeClaimTemplates</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">data</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>accessModes</span><span class=p>:</span> <span class="p p-Indicator">[</span> <span class=s>&quot;ReadWriteOnce&quot;</span> <span class="p p-Indicator">]</span>
      <span class=nt>resources</span><span class=p>:</span>
        <span class=nt>requests</span><span class=p>:</span>
          <span class=nt>storage</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">5Gi</span>
</pre></div> </td></tr></table> </div> <h2 id=jx-boot-configuration>JX Boot Configuration<a class=headerlink href=#jx-boot-configuration title="Permanent link">&para;</a></h2> <p>We use <code class=codehilite><span class=n>jx</span> <span class=n>boot</span></code><sup id=fnref:3><a class=footnote-ref href=#fn:3>3</a></sup> to install Jenkins X. If we want to use Bitbucket for the environment repositories, we have to use Lighthouse<sup id=fnref2:1><a class=footnote-ref href=#fn:1>1</a></sup><sup id=fnref:4><a class=footnote-ref href=#fn:4>4</a></sup>.</p> <p>In order to jx to install correctly, we have configure several parameters in the <code class=codehilite><span class=n>jx</span><span class=o>-</span><span class=n>requirements</span><span class=p>.</span><span class=n>yml</span></code> with specific values. See the docs for all the possible values<sup id=fnref:5><a class=footnote-ref href=#fn:5>5</a></sup>.</p> <ul> <li><strong>webhook: lighthouse</strong>: we have to set the webhook manager to <code class=codehilite><span class=n>lighthouse</span></code>, as Prow only works with GitHub</li> <li><strong>environmentGitOwner: jx</strong>: the project in Bitbucket where the repositories need to be created</li> <li><strong>gitKind: bitbucketserver</strong>: the <code class=codehilite><span class=n>kind</span></code> of git server, in this case <code class=codehilite><span class=n>bitbucketserver</span></code>, because <code class=codehilite><span class=n>bitbucket</span></code> refers to <a href=https://bitbucket.org/ >Bitbucket Cloud</a></li> <li><strong>gitName: bs</strong>: the name for our gitserver configuration</li> <li><strong>gitServer: <a href=http://bitbucket.openshift.example.com>http://bitbucket.openshift.example.com</a></strong>: the url to our Bitbucket Server</li> <li><strong>registry: docker.io</strong>: when not using a Public Cloud provider, you have to specify the docker registry URL, in this case, Dockerhub (which is <code class=codehilite><span class=n>docker</span><span class=p>.</span><span class=n>io</span></code>)</li> <li><strong>dockerRegistryOrg: caladreas</strong>: when the docker registry owner - in my case, <code class=codehilite><span class=n>caladreas</span></code>- is different from the git repository owner, you have to specify this via <code class=codehilite><span class=n>dockerRegistryOrg</span></code></li> </ul> <p>We also have to set the storage for at least the logs. If we do not configure the storage for our logs, they will be assumed to be written to github pages of our application. That is, regardless of where our application resides. So, if you use anything other than GitHub (cloud), you <em>have</em> to configure the logs storage.</p> <p>The easiest solution, is to create a seperate repository for the build logs in your Bitbucket Server project.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4</pre></div></td><td class=code><div class=codehilite><pre><span></span>    <span class=nt>storage</span><span class=p>:</span>
      <span class=nt>logs</span><span class=p>:</span>
        <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class=nt>url</span><span class=p>:</span> <span class=s>&quot;http://bitbucket.openshift.example.com/scm/jx/build-logs.git&quot;</span>
</pre></div> </td></tr></table> <p>If you have forgotten to set the storage before the installation, you can rectify this afterwards via the <code class=codehilite><span class=n>jx</span> <span class=n>edit</span> <span class=k>storage</span></code> command.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>jx edit storage -c logs --git-url http://bitbucket.openshift.kearos.net/scm/jx/build-logs.git  --git-branch master
</pre></div> </td></tr></table> <details class=example><summary>jx-requirements.yml</summary><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>bootConfigURL</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://github.com/jenkins-x/jenkins-x-boot-config.git</span>
<span class=nt>cluster</span><span class=p>:</span>
  <span class=nt>clusterName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">rhos11</span>
  <span class=nt>devEnvApprovers</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">jvandergriendt</span>
  <span class=nt>environmentGitOwner</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jx</span>
  <span class=nt>gitKind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bitbucketserver</span>
  <span class=nt>gitName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">bs</span>
  <span class=nt>gitServer</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http://bitbucket.openshift.example.com</span>
  <span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jx</span>
  <span class=nt>provider</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes</span>
  <span class=nt>registry</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">docker.io</span>
  <span class=nt>dockerRegistryOrg</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">caladreas</span>
<span class=nt>environments</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>ingress</span><span class=p>:</span>
    <span class=nt>domain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">openshift.example.com</span>
    <span class=nt>namespaceSubDomain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">-jx.</span>
  <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">dev</span>
  <span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">environment-rhos11-dev</span>
<span class="p p-Indicator">-</span> <span class=nt>ingress</span><span class=p>:</span>
    <span class=nt>domain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">staging.openshift.example.com</span>
    <span class=nt>namespaceSubDomain</span><span class=p>:</span> <span class=s>&quot;&quot;</span>
  <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">staging</span>
  <span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">env-rhos311-staging</span>
<span class="p p-Indicator">-</span> <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">production</span>
  <span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">env-rhos311-prod</span>
<span class=nt>gitops</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>ingress</span><span class=p>:</span>
  <span class=nt>domain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">openshift.example.com</span>
  <span class=nt>namespaceSubDomain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">-jx.</span>
<span class=nt>kaniko</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nexus</span>
<span class=nt>secretStorage</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
<span class=nt>storage</span><span class=p>:</span>
  <span class=nt>logs</span><span class=p>:</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>url</span><span class=p>:</span> <span class=s>&quot;http://bitbucket.openshift.example.com/scm/jx/build-logs.git&quot;</span>
<span class=nt>versionStream</span><span class=p>:</span>
  <span class=nt>ref</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1.0.361</span>
  <span class=nt>url</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://github.com/jenkins-x/jenkins-x-versions.git</span>
<span class=nt>webhook</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">lighthouse</span>
</pre></div> </td></tr></table> </details> <h3 id=bitbucket-api-token>Bitbucket API Token<a class=headerlink href=#bitbucket-api-token title="Permanent link">&para;</a></h3> <p>To authenticate with Bitbucket server, Jenkins X needs a API token of a user that has admin permissions.</p> <p>First, create this user API token in Bitbucket. You can do so, via <code class=codehilite><span class=n>Manage</span> <span class=n>Account</span></code>(top right menu) -&gt; <code class=codehilite><span class=n>Personal</span> <span class=k>access</span> <span class=n>tokens</span></code> -&gt; <code class=codehilite><span class=k>Create</span> <span class=n>a</span> <span class=n>token</span></code> (top right).</p> <p>Then use the <code class=codehilite><span class=n>jx</span> <span class=k>create</span> <span class=n>token</span> <span class=n>addon</span></code><sup id=fnref:6><a class=footnote-ref href=#fn:6>6</a></sup> command to create the API token for Bitbucket server. Make sure to use the same <code class=codehilite><span class=c1>--name &lt;NAME&gt;</span></code>, as the <code class=codehilite><span class=n>gitName</span></code> in your <code class=codehilite><span class=n>jx</span><span class=o>-</span><span class=n>requirements</span><span class=p>.</span><span class=n>yml</span></code> file.</p> <blockquote> <p>Creates a new User Token for an Addon service</p> </blockquote> <p>For example, lets create the token for my configuration:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>jx create token addon --name bs --url http://bitbucket.openshift.example.com  --api-token &lt;API_TOKEN&gt; &lt;USER&gt;
</pre></div> </td></tr></table> <p>This should give the following response.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>Created user &lt;USER&gt; API Token <span class=k>for</span> addon server bs at http://bitbucket.openshift.example.com
</pre></div> </td></tr></table> <h2 id=installation>Installation<a class=headerlink href=#installation title="Permanent link">&para;</a></h2> <p>Before running the Jenkins X installation with <code class=codehilite><span class=n>jx</span> <span class=n>boot</span></code>, make sure you meet the pre-requisites.</p> <h3 id=pre-requisites>Pre-requisites<a class=headerlink href=#pre-requisites title="Permanent link">&para;</a></h3> <ul> <li>Kubernetes cluster</li> <li>cluster admin access to Kubernetes cluster</li> <li>Bitbucket server</li> <li>Project in Bitbucket server</li> <li>API token in Bitbucket server</li> <li>API token for Jenkins X in the Kubernetes cluster</li> </ul> <p>Once these are met, we can install Jenkins X via <code class=codehilite><span class=n>jx</span> <span class=n>boot</span></code><sup id=fnref2:3><a class=footnote-ref href=#fn:3>3</a></sup>.</p> <h3 id=issue-with-controllerbuild>Issue with controllerbuild<a class=headerlink href=#issue-with-controllerbuild title="Permanent link">&para;</a></h3> <p>A potential issue you can run into, is that the deployment <code class=codehilite><span class=n>jenkins</span><span class=o>-</span><span class=n>x</span><span class=o>-</span><span class=n>controllerbuild</span></code> fails to come up.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>could not lock config file //.gitconfig: Permission denied: failed to run <span class=s1>&#39;git config --global --add user.name jenkins-x-bot&#39;</span> <span class=nb>command</span> in directory <span class=s1>&#39;&#39;</span>,
</pre></div> </td></tr></table> <p>The issue here, seems to be some missing configuration, as the the two <code class=codehilite><span class=o>/</span></code>'s in <code class=codehilite><span class=o>//</span><span class=p>.</span><span class=n>gitconfig</span></code>, give the idea there's supposed to be some folder defined.</p> <p>A way to solve this, is to ensure we have a home folder git can write into, and tell git where this home folder is.</p> <p>The image seems to set its working directory to <code class=codehilite><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>jenkins</span></code>, so lets use that. In order to tell git where to write its configuration to, we can set the <code class=codehilite><span class=n>HOME</span></code> environment variable.</p> <p>So in the <code class=codehilite><span class=n>jenkins</span><span class=o>-</span><span class=n>x</span><span class=o>-</span><span class=n>controllerbuild</span></code> deployment, set the HOME environment variable to <code class=codehilite><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>jenkins</span></code>.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">HOME</span>
  <span class=nt>value</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/home/jenkins</span>
</pre></div> </td></tr></table> <p>Add folder for <code class=codehilite><span class=n>home</span><span class=o>/</span><span class=n>jenkins</span></code> via volume and volumeMount.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span>    <span class=nt>volumeMounts</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/home/jenkins</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jenkinshome</span>
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span>  <span class=nt>volumes</span><span class=p>:</span>
  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jenkinshome</span>
    <span class=nt>emptyDir</span><span class=p>:</span> <span class="p p-Indicator">{}</span>
</pre></div> </td></tr></table> <h2 id=errata>Errata<a class=headerlink href=#errata title="Permanent link">&para;</a></h2> <h3 id=import-quickstarts-source-repositories-always-https>Import &amp; Quickstarts Source Repositories Always HTTPS<a class=headerlink href=#import-quickstarts-source-repositories-always-https title="Permanent link">&para;</a></h3> <p>When you add applications to Jenkins X, either via the <code class=codehilite><span class=n>jx</span> <span class=n>import</span></code> or <code class=codehilite><span class=n>jx</span> <span class=k>create</span> <span class=n>quickstart</span></code> processes, a <code class=codehilite><span class=n>SourceRepository</span></code> CRD gets created.</p> <p>This resource will contain the the value <code class=codehilite><span class=n>spec</span><span class=p>.</span><span class=n>httpCloneURL</span></code>. This is used in the Tekton pipelines for cloning the repository. This <code class=codehilite><span class=n>httpCloneURL</span></code> is always set to <code class=codehilite><span class=n>https</span><span class=p>:</span><span class=o>//</span></code>, even if the repository <code class=codehilite><span class=n>url</span></code> is <code class=codehilite><span class=n>http</span><span class=p>:</span><span class=o>//</span></code>.</p> <p>To retrieve the existing source repositories, you can do the following:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>kubectl get sourcerepository
</pre></div> </td></tr></table> <p>You can edit a specific source repository via:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>kubectl edit sourcerepository jx-jx-go
</pre></div> </td></tr></table> <p>And if required, change the <code class=codehilite><span class=n>https</span><span class=p>:</span><span class=o>//</span></code> into a <code class=codehilite><span class=n>http</span><span class=p>:</span><span class=o>//</span></code>.</p> <h3 id=pullrequest-updates>PullRequest Updates<a class=headerlink href=#pullrequest-updates title="Permanent link">&para;</a></h3> <p>Bitbucket Server does not send a specific webhook when there's an update to a branch participating in a PullRequest. It only sends a generic <code class=codehilite><span class=n>Push</span></code> event, which does not give Jenkins X the information required to trigger a new build for the specific PullRequest.</p> <p>Atlassian has recently add this feature in Bitbucket Server <code class=codehilite><span class=mi>7</span><span class=p>.</span><span class=mi>0</span><span class=p>.</span><span class=mi>0</span></code>, confirmed by the <a href=https://jira.atlassian.com/browse/BSERV-10279>March 5<sup>th</sup> update in this Jira ticket</a>.</p> <p>As of March 2020, this is not yet supported by Jenkins X, nor is it expected at this point in time to find its way into earlier releases (such as 6.x) of Bitbucket server.</p> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">&para;</a></h2> <div class=footnote> <hr> <ol> <li id=fn:1> <p><a href=https://jenkins-x.io/docs/reference/components/lighthouse/ >https://jenkins-x.io/docs/reference/components/lighthouse/</a>&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:2> <p><a href=https://jenkins-x.io/docs/reference/components/lighthouse/#bitbucket-server>https://jenkins-x.io/docs/reference/components/lighthouse/#bitbucket-server</a>&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> <li id=fn:3> <p><a href=https://jenkins-x.io/docs/getting-started/setup/boot/how-it-works/ >https://jenkins-x.io/docs/getting-started/setup/boot/how-it-works/</a>&#160;<a class=footnote-backref href=#fnref:3 title="Jump back to footnote 3 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:3 title="Jump back to footnote 3 in the text">&#8617;</a></p> </li> <li id=fn:4> <p><a href=https://jenkins-x.io/docs/getting-started/setup/boot/#bitbucket-server>https://jenkins-x.io/docs/getting-started/setup/boot/#bitbucket-server</a>&#160;<a class=footnote-backref href=#fnref:4 title="Jump back to footnote 4 in the text">&#8617;</a></p> </li> <li id=fn:5> <p><a href=https://jenkins-x.io/docs/reference/config/config/#config.jenkins.io/v1.ClusterConfig>https://jenkins-x.io/docs/reference/config/config/#config.jenkins.io/v1.ClusterConfig</a>&#160;<a class=footnote-backref href=#fnref:5 title="Jump back to footnote 5 in the text">&#8617;</a></p> </li> <li id=fn:6> <p><a href=https://jenkins-x.io/commands/jx_create_token_addon/ >https://jenkins-x.io/commands/jx_create_token_addon/</a>&#160;<a class=footnote-backref href=#fnref:6 title="Jump back to footnote 6 in the text">&#8617;</a></p> </li> </ol> </div> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://joostvdg.github.io/jenkinsx/lighthouse-bitbucket/";
      this.page.identifier =
        "/jenkinsx/lighthouse-bitbucket/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//joostvdg-github-io.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../rhos-311-minimal/ title="JX On OpenShift 3.11" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> JX On OpenShift 3.11 </span> </div> </a> <a href=../hello-world/ title=HelloWorld class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> HelloWorld </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Joost van der Griendt </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/joostvdg class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/joost_vdg class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/joostvdg class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c648116f.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> </body> </html>