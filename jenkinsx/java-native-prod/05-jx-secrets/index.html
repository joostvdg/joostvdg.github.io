<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Creating a Java Native Image application and run it as Production with Jenkins X -Database Connection And Secrets - 5/10"><link href=https://joostvdg.github.io/jenkinsx/java-native-prod/05-jx-secrets/ rel=canonical><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.2"><title>Jenkins X - Java Native Image Prod</title><link rel=stylesheet href=../../../assets/stylesheets/main.a2408e81.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.a46bcfb3.min.css><meta name=theme-color content=#ffa726><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7CCutive+Mono&display=fallback"><style>body,input{font-family:"Lato",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Cutive Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-145385967-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=orange data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#database-connection-and-secrets class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> J's Software Development Pages </span> <span class="md-header-nav__topic md-ellipsis"> Jenkins X - Java Native Image Prod </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <div class=md-hero data-md-component=hero> <div class="md-hero__inner md-grid"> Database Connection And Secrets - 5/10 </div> </div> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../blogs/jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../../../cloudbees/sso-azure-ad/ class=md-tabs__link> Jenkins & CloudBees </a> </li> <li class=md-tabs__item> <a href=../../build-packs/ class="md-tabs__link md-tabs__link--active"> Jenkins X </a> </li> <li class=md-tabs__item> <a href=../../../openshift/rhos311-gcp-minimal/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../../cloud/automation-pulumi/ class=md-tabs__link> Software Eng. </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Blogs <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Blogs data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../blogs/jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../../../blogs/graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../../blogs/docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../../blogs/k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../../blogs/sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../../blogs/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../../blogs/kubernetes-sso-keycloak/ title="Kubernetes SSO Keycloak" class=md-nav__link> Kubernetes SSO Keycloak </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8> <label class=md-nav__link for=nav-2-8> Jenkins X Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Database Connection And Secrets <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Database Connection And Secrets" class="md-nav__link md-nav__link--active"> Database Connection And Secrets </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#manage-database-via-flyway class=md-nav__link> Manage Database Via Flyway </a> <nav class=md-nav aria-label="Manage Database Via Flyway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quarkus-integration class=md-nav__link> Quarkus Integration </a> <nav class=md-nav aria-label="Quarkus Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-definitions class=md-nav__link> Schema definitions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#unit-test-configuration class=md-nav__link> Unit Test Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cloudsql-proxy-container class=md-nav__link> CloudSQL Proxy Container </a> </li> <li class=md-nav__item> <a href=#jenkins-x-and-secrets class=md-nav__link> Jenkins X and Secrets </a> </li> <li class=md-nav__item> <a href=#create-secrets class=md-nav__link> Create Secrets </a> <nav class=md-nav aria-label="Create Secrets"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-valuesyaml class=md-nav__link> Configure Values.yaml </a> </li> <li class=md-nav__item> <a href=#google-cloudsql-connection-url class=md-nav__link> Google CloudSQL Connection URL </a> </li> <li class=md-nav__item> <a href=#google-cloudsql-service-account-key class=md-nav__link> Google CloudSQL Service Account Key </a> <nav class=md-nav aria-label="Google CloudSQL Service Account Key"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-secret-manifest class=md-nav__link> Create Secret Manifest </a> </li> <li class=md-nav__item> <a href=#update-deployment class=md-nav__link> Update Deployment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#google-cloudsql-password class=md-nav__link> Google CloudSQL Password </a> <nav class=md-nav aria-label="Google CloudSQL Password"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-secret-manifest_1 class=md-nav__link> Create Secret Manifest </a> </li> <li class=md-nav__item> <a href=#update-deployment_1 class=md-nav__link> Update Deployment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#google-cloudsql-username class=md-nav__link> Google CloudSQL Username </a> </li> <li class=md-nav__item> <a href=#configure-jenkins-x-environments class=md-nav__link> Configure Jenkins X Environments </a> <nav class=md-nav aria-label="Configure Jenkins X Environments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#update-staging-environment class=md-nav__link> Update Staging Environment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary-of-changes-made-to-application class=md-nav__link> Summary of Changes Made To Application </a> </li> <li class=md-nav__item> <a href=#summary-of-changes-made-to-staging-environment class=md-nav__link> Summary of Changes Made To Staging Environment </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../08-preview-int-test/ title="Previews & Integration Tests" class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> <li class=md-nav__item> <a href=../10-promote-prod/ title="Promote To Production" class=md-nav__link> Promote To Production </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-9 type=checkbox id=nav-2-9> <label class=md-nav__link for=nav-2-9> Jenkins Monitoring Kubernetes <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Monitoring Kubernetes" data-md-level=2> <label class=md-nav__title for=nav-2-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/metrics/ title=Metrics class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../blogs/k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../../blogs/dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Jenkins & CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins & CloudBees" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins & CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=CloudBees data-md-level=2> <label class=md-nav__title for=nav-3-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloudbees/sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/cbc-team-namespace/ title="Team Master Namespace" class=md-nav__link> Team Master Namespace </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/multi-cluster-gke/ title="Multi-Cluster GKE" class=md-nav__link> Multi-Cluster GKE </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/multi-cluster-eks/ title="Multi-Cluster EKS" class=md-nav__link> Multi-Cluster EKS </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/multi-cluster/ title="Multi-Cluster (OLD/AKS)" class=md-nav__link> Multi-Cluster (OLD/AKS) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Jenkins <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Jenkins data-md-level=2> <label class=md-nav__title for=nav-3-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins Pipelines <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipelines" data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/kaniko-pipelines/ title="Build Docker Image Kaniko" class=md-nav__link> Build Docker Image Kaniko </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/podtemplate-dind/ title="PodTemplate With Docker-In-Docker" class=md-nav__link> PodTemplate With Docker-In-Docker </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/jenkins-parallel-pipeline/ title="Parallel Pipelines" class=md-nav__link> Parallel Pipelines </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipeline Examples <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipeline Examples" data-md-level=2> <label class=md-nav__title for=nav-3-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Jenkins X <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../build-packs/ title="Build Packs" class=md-nav__link> Build Packs </a> </li> <li class=md-nav__item> <a href=../../jx-pipelines/ title="Jenkins X Pipelines" class=md-nav__link> Jenkins X Pipelines </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3 checked> <label class=md-nav__link for=nav-4-3> Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-4-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Database Connection And Secrets <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Database Connection And Secrets" class="md-nav__link md-nav__link--active"> Database Connection And Secrets </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#manage-database-via-flyway class=md-nav__link> Manage Database Via Flyway </a> <nav class=md-nav aria-label="Manage Database Via Flyway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quarkus-integration class=md-nav__link> Quarkus Integration </a> <nav class=md-nav aria-label="Quarkus Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-definitions class=md-nav__link> Schema definitions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#unit-test-configuration class=md-nav__link> Unit Test Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cloudsql-proxy-container class=md-nav__link> CloudSQL Proxy Container </a> </li> <li class=md-nav__item> <a href=#jenkins-x-and-secrets class=md-nav__link> Jenkins X and Secrets </a> </li> <li class=md-nav__item> <a href=#create-secrets class=md-nav__link> Create Secrets </a> <nav class=md-nav aria-label="Create Secrets"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-valuesyaml class=md-nav__link> Configure Values.yaml </a> </li> <li class=md-nav__item> <a href=#google-cloudsql-connection-url class=md-nav__link> Google CloudSQL Connection URL </a> </li> <li class=md-nav__item> <a href=#google-cloudsql-service-account-key class=md-nav__link> Google CloudSQL Service Account Key </a> <nav class=md-nav aria-label="Google CloudSQL Service Account Key"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-secret-manifest class=md-nav__link> Create Secret Manifest </a> </li> <li class=md-nav__item> <a href=#update-deployment class=md-nav__link> Update Deployment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#google-cloudsql-password class=md-nav__link> Google CloudSQL Password </a> <nav class=md-nav aria-label="Google CloudSQL Password"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-secret-manifest_1 class=md-nav__link> Create Secret Manifest </a> </li> <li class=md-nav__item> <a href=#update-deployment_1 class=md-nav__link> Update Deployment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#google-cloudsql-username class=md-nav__link> Google CloudSQL Username </a> </li> <li class=md-nav__item> <a href=#configure-jenkins-x-environments class=md-nav__link> Configure Jenkins X Environments </a> <nav class=md-nav aria-label="Configure Jenkins X Environments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#update-staging-environment class=md-nav__link> Update Staging Environment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary-of-changes-made-to-application class=md-nav__link> Summary of Changes Made To Application </a> </li> <li class=md-nav__item> <a href=#summary-of-changes-made-to-staging-environment class=md-nav__link> Summary of Changes Made To Staging Environment </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <a href=../08-preview-int-test/ title="Previews & Integration Tests" class=md-nav__link> Previews & Integration Tests </a> </li> <li class=md-nav__item> <a href=../09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> <li class=md-nav__item> <a href=../10-promote-prod/ title="Promote To Production" class=md-nav__link> Promote To Production </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../builder-image/ title="Create Builder Image" class=md-nav__link> Create Builder Image </a> </li> <li class=md-nav__item> <a href=../../jxboot/ title="JX Boot GKE" class=md-nav__link> JX Boot GKE </a> </li> <li class=md-nav__item> <a href=../../jxboot-aks/ title="JX Boot AKS" class=md-nav__link> JX Boot AKS </a> </li> <li class=md-nav__item> <a href=../../aks-boot-core/ title="JX Boot & CloudBees Core" class=md-nav__link> JX Boot & CloudBees Core </a> </li> <li class=md-nav__item> <a href=../../rhos-311-minimal/ title="OpenShift 3.11" class=md-nav__link> OpenShift 3.11 </a> </li> <li class=md-nav__item> <a href=../../rhos-311-restricted/ title="OpenShift 3.11 - Restricted" class=md-nav__link> OpenShift 3.11 - Restricted </a> </li> <li class=md-nav__item> <a href=../../lighthouse-bitbucket/ title="Lighthouse & Bitbucket" class=md-nav__link> Lighthouse & Bitbucket </a> </li> <li class=md-nav__item> <a href=../../hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../../maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../../hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../../kubernetes-days/ title="Example For Console Reel" class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Containers <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Containers data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> OpenShift <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=OpenShift data-md-level=2> <label class=md-nav__title for=nav-5-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../openshift/rhos311-gcp-minimal/ title="OpenShift 3.11 GCP(minimal)" class=md-nav__link> OpenShift 3.11 GCP(minimal) </a> </li> <li class=md-nav__item> <a href=../../../openshift/rhos311-gcp-medium/ title="OpenShift 3.11 GCP(medium)" class=md-nav__link> OpenShift 3.11 GCP(medium) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Kubernetes (K8S) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Kubernetes (K8S)" data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Managed Kubernetes (cloud) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Managed Kubernetes (cloud)" data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Managed Kubernetes (cloud) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/gke-terraform/ title="GKE Terraform" class=md-nav__link> GKE Terraform </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> K8S Hard Way - GCE <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="K8S Hard Way - GCE" data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Docker <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Docker data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> Linux <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Software Eng. <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Eng." data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Eng. </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Automation <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Automation data-md-level=2> <label class=md-nav__title for=nav-6-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud/automation-pulumi/ title=Pulumi class=md-nav__link> Pulumi </a> </li> <li class=md-nav__item> <a href=../../../certificates/lets-encrypt-k8s/ title="Let's Encrypt K8S" class=md-nav__link> Let's Encrypt K8S </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Engineering" data-md-level=2> <label class=md-nav__title for=nav-6-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Productivity data-md-level=2> <label class=md-nav__title for=nav-6-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-4 type=checkbox id=nav-6-4> <label class=md-nav__link for=nav-6-4> Java <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Java data-md-level=2> <label class=md-nav__title for=nav-6-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../../java/networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../../java/concurrency/ title="Java Concurrency" class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#manage-database-via-flyway class=md-nav__link> Manage Database Via Flyway </a> <nav class=md-nav aria-label="Manage Database Via Flyway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quarkus-integration class=md-nav__link> Quarkus Integration </a> <nav class=md-nav aria-label="Quarkus Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-definitions class=md-nav__link> Schema definitions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#unit-test-configuration class=md-nav__link> Unit Test Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cloudsql-proxy-container class=md-nav__link> CloudSQL Proxy Container </a> </li> <li class=md-nav__item> <a href=#jenkins-x-and-secrets class=md-nav__link> Jenkins X and Secrets </a> </li> <li class=md-nav__item> <a href=#create-secrets class=md-nav__link> Create Secrets </a> <nav class=md-nav aria-label="Create Secrets"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-valuesyaml class=md-nav__link> Configure Values.yaml </a> </li> <li class=md-nav__item> <a href=#google-cloudsql-connection-url class=md-nav__link> Google CloudSQL Connection URL </a> </li> <li class=md-nav__item> <a href=#google-cloudsql-service-account-key class=md-nav__link> Google CloudSQL Service Account Key </a> <nav class=md-nav aria-label="Google CloudSQL Service Account Key"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-secret-manifest class=md-nav__link> Create Secret Manifest </a> </li> <li class=md-nav__item> <a href=#update-deployment class=md-nav__link> Update Deployment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#google-cloudsql-password class=md-nav__link> Google CloudSQL Password </a> <nav class=md-nav aria-label="Google CloudSQL Password"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-secret-manifest_1 class=md-nav__link> Create Secret Manifest </a> </li> <li class=md-nav__item> <a href=#update-deployment_1 class=md-nav__link> Update Deployment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#google-cloudsql-username class=md-nav__link> Google CloudSQL Username </a> </li> <li class=md-nav__item> <a href=#configure-jenkins-x-environments class=md-nav__link> Configure Jenkins X Environments </a> <nav class=md-nav aria-label="Configure Jenkins X Environments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#update-staging-environment class=md-nav__link> Update Staging Environment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary-of-changes-made-to-application class=md-nav__link> Summary of Changes Made To Application </a> </li> <li class=md-nav__item> <a href=#summary-of-changes-made-to-staging-environment class=md-nav__link> Summary of Changes Made To Staging Environment </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/jenkinsx/java-native-prod/05-jx-secrets.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=database-connection-and-secrets>Database Connection And Secrets<a class=headerlink href=#database-connection-and-secrets title="Permanent link">&para;</a></h1> <p>In most cases, connecting to a database from your application requires three pieces of information.</p> <ol> <li>Database URL</li> <li>Username</li> <li>Password</li> </ol> <p>Now, you can argue if the fourth would be the schema, or if that is included in #1. </p> <p>Eitherway, our application is currently missing this information. If you remember, we've set our URL to <code>jdbc:mysql://127.0.0.1:3306/fruit</code>, and our username and password to <code>${GOOGLE_SQL_USER}</code> and <code>${GOOGLE_SQL_PASS}</code> respectively.</p> <p>Before we configure these secrets, lets manage our database and it schema in a way that fits Jenkins X.</p> <h2 id=manage-database-via-flyway>Manage Database Via Flyway<a class=headerlink href=#manage-database-via-flyway title="Permanent link">&para;</a></h2> <p>One part of CI/CD that is often forgotten, is managing your Database (schema) updates. There are several options available, such as <a href=https://www.liquibase.org/ >Liquibase</a> and <a href=https://flywaydb.org/ >Flyway</a>.</p> <p>As I've used Flyway in the past with good results, we use Flyway for this guide, but I'm certain you can achieve the same results wichever route you take. You can also choose to ignore database schema management, and leave it to Hibernate or Spring Data to update the schema based on your classes.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>If you do use Flyway or Liquibase to manage the Database schema, you have to re-create the database.</p> <p>The moment to do this, is when the updated application lands in the Staging environment.</p> </div> <h3 id=quarkus-integration>Quarkus Integration<a class=headerlink href=#quarkus-integration title="Permanent link">&para;</a></h3> <p>Quarkus has excellent support for Flyway, and the <a href=https://quarkus.io/guides/flyway>Quarkus Flyway guide</a> explains all the details . To use Flyway with our Quarkus application, we take the following steps:</p> <ol> <li>add the <code>quarkus-flyway</code> dependency to the <code>pom.xml</code></li> <li>update the <code>application.properties</code> file in <code>src/main/resources</code></li> <li>update our Fruit entity, <code>src/main/java/.../Fruit.java</code></li> <li>create initial schema definition</li> <li>ensure find all call return a sorted list</li> </ol> <div class="admonition example"> <p class=admonition-title>pom.xml</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dependency&gt;</span>
    <span class=nt>&lt;groupId&gt;</span>io.quarkus<span class=nt>&lt;/groupId&gt;</span>
    <span class=nt>&lt;artifactId&gt;</span>quarkus-flyway<span class=nt>&lt;/artifactId&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
</code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>src/main/resources/application.properties</p> <p>The highlighted lines are the changes.</p> <div class=highlight><pre><span></span><code><span class=na>quarkus.datasource.db-kind</span><span class=o>=</span><span class=s>mysql</span>
<span class=na>quarkus.datasource.jdbc.url</span><span class=o>=</span><span class=s>jdbc:mysql://127.0.0.1:3306/fruits</span>
<span class=na>quarkus.datasource.jdbc.max-size</span><span class=o>=</span><span class=s>8</span>
<span class=na>quarkus.datasource.jdbc.min-size</span><span class=o>=</span><span class=s>2</span>

<span class=na>quarkus.datasource.username</span><span class=o>=</span><span class=s>${GOOGLE_SQL_USER}</span>
<span class=na>quarkus.datasource.password</span><span class=o>=</span><span class=s>${GOOGLE_SQL_PASS}</span>

<span class=hll><span class=na>quarkus.flyway.migrate-at-start</span><span class=o>=</span><span class=s>true</span>
</span><span class=hll><span class=na>quarkus.flyway.baseline-on-migrate</span><span class=o>=</span><span class=s>true</span>
</span>
<span class=hll><span class=na>quarkus.hibernate-orm.database.generation</span><span class=o>=</span><span class=s>none</span>
</span><span class=hll><span class=na>quarkus.log.level</span><span class=o>=</span><span class=s>INFO</span>
</span><span class=hll><span class=na>quarkus.log.category.&quot;org.hibernate&quot;.level</span><span class=o>=</span><span class=s>INFO</span>
</span></code></pre></div> </div> <p>To ensure we don't run into any troubles with MySQL locally or within Google Cloud, it is best to explicitly set the Table name to exclusively lower case.</p> <p>Secondly, instead of letting Hibernate take care of the id of our entities, we can rely on MySQL doing this for us. So we set the generation strategy to <code>IDENTITY</code>.</p> <div class="admonition example"> <p class=admonition-title>src/main/java/.../Fruit.java</p> <div class=highlight><pre><span></span><code><span class=hll><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&quot;fruit&quot;</span><span class=p>)</span>
</span><span class=nd>@Entity</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Fruit</span> <span class=p>{</span>

<span class=nd>@Id</span>
<span class=hll><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>GenerationType</span><span class=p>.</span><span class=na>IDENTITY</span><span class=p>)</span>
</span><span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=p>;</span>
</code></pre></div> </div> <h4 id=schema-definitions>Schema definitions<a class=headerlink href=#schema-definitions title="Permanent link">&para;</a></h4> <p>Flyway uses SQL files for managing the schema - and data - of your database. By default, it looks in the <code>src/main/resources/db/migration</code> folder.</p> <p>Flyway runs the files in order and uses the filename for determining the schema version and update title. We create two files:</p> <ol> <li><code>V1.0.0__initial.sql</code>: houses our Fruit table</li> <li><code>V1.0.1__test_data.sql</code>: has our initial data entries, which we can then also use for our Integration Tests!</li> </ol> <div class="admonition example"> <p class=admonition-title>V1.0.0__initial.sql</p> <p>The comments were generated by CloudSQL's export, if you use CloudSQL I recommend leaving them intact. If you use something else, probably best to remove them.</p> <div class=highlight><pre><span></span><code><span class=cm>/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class=p>;</span>
<span class=cm>/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class=p>;</span>
<span class=cm>/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class=p>;</span>
<span class=cm>/*!40101 SET NAMES utf8 */</span><span class=p>;</span>
<span class=cm>/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span><span class=p>;</span>
<span class=cm>/*!40103 SET TIME_ZONE=&#39;+00:00&#39; */</span><span class=p>;</span>
<span class=cm>/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span><span class=p>;</span>
<span class=cm>/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class=p>;</span>
<span class=cm>/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#39;NO_AUTO_VALUE_ON_ZERO&#39; */</span><span class=p>;</span>
<span class=cm>/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class=p>;</span>

<span class=c1>--</span>
<span class=c1>-- Current Database: `fruits`</span>
<span class=c1>--</span>
<span class=c1>--</span>
<span class=c1>-- CREATE DATABASE /*!32312 IF NOT EXISTS*/ `fruits` /*!40100 DEFAULT CHARACTER SET utf8 */;</span>
<span class=c1>--</span>
<span class=c1>-- USE `fruits`;</span>

<span class=c1>--</span>
<span class=c1>-- Table structure for table `Fruit`</span>
<span class=c1>--</span>

<span class=k>DROP</span> <span class=k>TABLE</span> <span class=k>IF</span> <span class=k>EXISTS</span> <span class=o>`</span><span class=n>fruit</span><span class=o>`</span><span class=p>;</span>
<span class=cm>/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class=p>;</span>
<span class=cm>/*!40101 SET character_set_client = utf8 */</span><span class=p>;</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=o>`</span><span class=n>fruit</span><span class=o>`</span> <span class=p>(</span>
  <span class=o>`</span><span class=n>id</span><span class=o>`</span> <span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span> <span class=n>AUTO_INCREMENT</span><span class=p>,</span>
  <span class=o>`</span><span class=n>color</span><span class=o>`</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>name</span><span class=o>`</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span>
<span class=p>)</span> <span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span> <span class=k>DEFAULT</span> <span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span>
<span class=cm>/*!40101 SET character_set_client = @saved_cs_client */</span><span class=p>;</span>

<span class=k>CREATE</span> <span class=k>UNIQUE</span> <span class=k>INDEX</span> <span class=o>`</span><span class=n>fruit_name_color</span><span class=o>`</span> <span class=k>ON</span> <span class=o>`</span><span class=n>fruit</span><span class=o>`</span> <span class=p>(</span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span> <span class=o>`</span><span class=n>color</span><span class=o>`</span><span class=p>);</span>
</code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>V1.0.1__test_data.sql</p> <div class=highlight><pre><span></span><code><span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Cherry&#39;</span><span class=p>,</span> <span class=s1>&#39;Red&#39;</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Apple&#39;</span><span class=p>,</span> <span class=s1>&#39;Red&#39;</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Banana&#39;</span><span class=p>,</span> <span class=s1>&#39;Yellow&#39;</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Avocado&#39;</span><span class=p>,</span> <span class=s1>&#39;Green&#39;</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Strawberry&#39;</span><span class=p>,</span> <span class=s1>&#39;Red&#39;</span><span class=p>);</span>
</code></pre></div> </div> <h3 id=unit-test-configuration>Unit Test Configuration<a class=headerlink href=#unit-test-configuration title="Permanent link">&para;</a></h3> <p>To ensure our unit tests also keep working, we have to make some changes to our Tests' <code>application.properties</code> file.</p> <p>The mandatory lines are highlighted, the lat three are for debug logging - should be obvious. This gives you more information on what Flyway is doing, which is almost mandatory when you run into issues. These can be safely ignored, but I thought it best to show you how to set that type of logging, just in case.</p> <div class="admonition example"> <p class=admonition-title>src/test/resources/application.properties</p> <div class=highlight><pre><span></span><code><span class=na>quarkus.datasource.url</span><span class=o>=</span><span class=s>jdbc:h2:tcp://localhost/mem:fruits;MODE=MySQL;DB_CLOSE_ON_EXIT=FALSE;DB_CLOSE_DELAY=-1;DATABASE_TO_UPPER=false;</span>
<span class=na>quarkus.datasource.driver</span><span class=o>=</span><span class=s>org.h2.Driver</span>

<span class=na>quarkus.hibernate-orm.log.sql</span><span class=o>=</span><span class=s>true</span>
<span class=hll><span class=na>quarkus.hibernate-orm.database.default-schema</span><span class=o>=</span><span class=s>FRUITS</span>
</span><span class=hll><span class=na>quarkus.flyway.migrate-at-start</span><span class=o>=</span><span class=s>true</span>
</span><span class=hll><span class=na>quarkus.flyway.schemas</span><span class=o>=</span><span class=s>FRUITS</span>
</span>
<span class=na>quarkus.log.console.level</span><span class=o>=</span><span class=s>DEBUG</span>
<span class=na>quarkus.log.category.&quot;org.flywaydb.core&quot;.level</span><span class=o>=</span><span class=s>DEBUG</span>
<span class=na>quarkus.log.category.&quot;io.quarkus.flyway&quot;.level</span><span class=o>=</span><span class=s>DEBUG</span>
</code></pre></div> </div> <h2 id=cloudsql-proxy-container>CloudSQL Proxy Container<a class=headerlink href=#cloudsql-proxy-container title="Permanent link">&para;</a></h2> <p>But first, we have to do one more configuration for our CloudSQL Database. If you do <em>not</em> use the CloudSQL database, you can skip this step, but make sure to replace the JDBC URL appropriately.</p> <p>Google takes its security serious, and thus doesn't allow you to access its CloudSQL databases from <em>everywhere</em>. Our Kubernetes cluster cannot directly access CloudSQL, but it can use a Proxy, provided we connect with a <strong>Google Cloud Service Account</strong> - not to be confused with a Kubernetes Service Account.</p> <p>We deal with the secrets later, we first have to add this Proxy container configuration. To add the container, we update the <code>deployment.yaml</code> in our <code>charts/Name-Of-Your-Application/templates</code> folder. Containers is a list, so we add the <code>cloudsql-proxy</code> container as an additional list item.</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-proxy</span>
  <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/cloudsql-docker/gce-proxy:1.16</span>
  <span class=nt>command</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;/cloud_sql_proxy&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;-instances={{.Values.secrets.sql_connection}}=tcp:3306&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;-credential_file=/secrets/cloudsql/credentials.json&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div> <p>If you look carefully, you can see we already reference a secret: <code>{{.Values.secrets.sql_connection}}</code>. We come back to this later. For further clarification on how the containers section of our <code>deployment.yaml</code> should look like, expand the example below.</p> <details class=example><summary>charts/Your-Application-Name/templates/deployment.yaml snippet</summary><div class=highlight><pre><span></span><code><span class=nt>spec</span><span class=p>:</span>
  <span class=nt>containers</span><span class=p>:</span>
<span class=hll>  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-proxy</span>
</span><span class=hll>    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/cloudsql-docker/gce-proxy:1.16</span>
</span><span class=hll>    <span class=nt>command</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;/cloud_sql_proxy&quot;</span><span class="p p-Indicator">,</span>
</span><span class=hll>              <span class=s>&quot;-instances={{.Values.secrets.sql_connection}}=tcp:3306&quot;</span><span class="p p-Indicator">,</span>
</span><span class=hll>              <span class=s>&quot;-credential_file=/secrets/cloudsql/credentials.json&quot;</span><span class="p p-Indicator">]</span>
</span>  <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Chart.Name</span> <span class="p p-Indicator">}}</span>
    <span class=nt>envFrom</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>secretRef</span><span class=p>:</span>
          <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-sql-secret</span>
      <span class="p p-Indicator">-</span> <span class=nt>secretRef</span><span class=p>:</span>
          <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-sentry-dsn</span>
    <span class=nt>image</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Values.image.repository</span><span class=nv> </span><span class=s>}}:{{</span><span class=nv> </span><span class=s>.Values.image.tag</span><span class=nv> </span><span class=s>}}&quot;</span>
    <span class=nt>imagePullPolicy</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.image.pullPolicy</span> <span class="p p-Indicator">}}</span>
</code></pre></div> </details> <h2 id=jenkins-x-and-secrets>Jenkins X and Secrets<a class=headerlink href=#jenkins-x-and-secrets title="Permanent link">&para;</a></h2> <p>If you have followed the pre-requisites, you have a Jenkins X installation with Hashicorp Vault. Where Jenkins X is configured to manage its secrets in Vault.</p> <p>This allows Jenkins X to retrieve secrets from Vault for you, and inject them where you need them. We will explore the different ways you can do so, in order to give our application enough information to connect to the MySQL database.</p> <p>Jenkins X can deal with secrets in several ways, and we will use most of them going forward.</p> <ol> <li>configure a Kubernetes secret in the Chart templates, not really Jenkins X, but remember you have this option as well</li> <li>inject a secret as environment variable into the container from Vault, this is a <em>global secret</em>, in the sense that the Vault URI is always the same, for every environment</li> <li>inject a secret via a <code>values.yaml</code> variable, you can - and should - change this depending on the environment, this is a <em>environment secret</em> as our Jenkins X environment will do the replacement from Vault URI to value</li> <li>use a container in our pipeline that has bot the Jenkins X binary (<code>jx</code>) and the Vault CLI, through which we can then interact with Vault's API</li> </ol> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>When injecting variables directly as environment variable, they will show up in Kubernetes manifests.</p> <p>This might leak the secrets further than you intent. You can use this a shortcut to centralized configuration management - forgoing something such as Consul or Spring Cloud Config Server.</p> </div> <p>When using the option to read the secret into a <code>values.yaml</code> variable, you can use this variable in a template. This means you can create a Kubernetes Secret manifest in your templates folder, and have Jenkins X populate its value from Vault.</p> <h2 id=create-secrets>Create Secrets<a class=headerlink href=#create-secrets title="Permanent link">&para;</a></h2> <p>Lets configure the secrets in our application. we start by setting up variables and placeholders in the <code>values.yaml</code> of our Chart. After which we configure the secret in our Helm templates and enter them in Vault.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>To access Vault, you can use the <a href=https://www.vaultproject.io/docs/commands>Vault CLI</a>, see how to <a href=https://www.vaultproject.io/docs/install>install here</a>, or via its UI.</p> <p>Either way, to get the Vault configuration of your Jenkins X cluster, use the <a href=https://jenkins-x.io/commands/jx_get_vault-config/ >get vault-config</a> command:</p> <div class=highlight><pre><span></span><code>jx get vault-config
</code></pre></div> <p>It prints out the URL and the connection token.</p> <p>Every secret we create, is assumed to be in the <code>/secrets</code> KV vault. Jenkins X makes the same assumption, and omits this in the Vault secret URI.</p> </div> <h3 id=configure-valuesyaml>Configure Values.yaml<a class=headerlink href=#configure-valuesyaml title="Permanent link">&para;</a></h3> <p>Depending on the secret, we either want it to be the same everywhere or unique per environment. That partly depends on your, do you have a different database for every environment that isn't Production? </p> <p>In my case, the user of my database is always the same, so I enject it as a environment variable. We do this, by adding <code>key: value</code> pairs to the <code>env:</code> property.</p> <p>The other information pieces are both more sensitive and environment specific. So we create a new property called <code>secrets</code>, and fill in empty (placeholder) values:</p> <ul> <li><strong>sql_password</strong>: the password for our database</li> <li><strong>sql_connection</strong>: the connection information the CloudSQL Proxy container will use</li> <li><strong>sqlsa</strong>: the Google Cloud Service Account (JSON) key for validating the database connection request</li> </ul> <div class="admonition example"> <p class=admonition-title>values.yaml</p> <div class=highlight><pre><span></span><code><span class=c1># Secrets that get loaded via the (jx) environment from Vault</span>
<span class=nt>secrets</span><span class=p>:</span>
  <span class=nt>sql_password</span><span class=p>:</span> <span class=s>&quot;&quot;</span>
  <span class=nt>sql_connection</span><span class=p>:</span> <span class=s>&quot;&quot;</span>
  <span class=nt>sqlsa</span><span class=p>:</span> <span class=s>&quot;&quot;</span>

<span class=c1># define environment variables here as a map of key: value</span>
<span class=nt>env</span><span class=p>:</span>
</code></pre></div> </div> <h3 id=google-cloudsql-connection-url>Google CloudSQL Connection URL<a class=headerlink href=#google-cloudsql-connection-url title="Permanent link">&para;</a></h3> <p>Access Vault and create a new Secret under <code>secrets/Name-Of-Your-Application</code>. In these examples, we use <code>quarkus-fruits</code> as our application name.</p> <p>Each secret in Vault is a set of Key/Value pairs.</p> <p>For the CloudSQL Connection URL, we use <code>INSTANCE_CONNECTION_NAME</code>, as this is how CloudSQL names this information.</p> <h3 id=google-cloudsql-service-account-key>Google CloudSQL Service Account Key<a class=headerlink href=#google-cloudsql-service-account-key title="Permanent link">&para;</a></h3> <p>If everything is allright, you have created this service account earlier. If not, please revisit <a href=/jenkinsx/java-native-prod/02-cloud-sql/#how-to-connect-to-the-database>How To Connect To The Database paragraph from the CloudSQL page</a>.</p> <p>Due to the secret being a JSON file, it is best to Base64 encode the contents before adding it as a secret value in Vault.</p> <p>In Linux of MacOS, this should be sufficient:</p> <div class=highlight><pre><span></span><code>cat credentials.json <span class=p>|</span> base64
</code></pre></div> <p>As key, we use <code>SA</code>.</p> <h4 id=create-secret-manifest>Create Secret Manifest<a class=headerlink href=#create-secret-manifest title="Permanent link">&para;</a></h4> <p>This is very sensitive information, so we follow the best practice of moutning the secret. To do so, we have to create it as a secret in Kubernetes. We create a new Kubernetes Secert manifest in the <code>charts/Your-Application-Name/templates</code> folder with the name <code>sql-sa-secret.yaml</code> so that Jenkins X will create this for us.</p> <div class="admonition example"> <p class=admonition-title>templates/sql-sa-secret.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-sql-sa</span>
<span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class=nt>data</span><span class=p>:</span>
  <span class=nt>credentials.json</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.secrets.sql_sa</span> <span class="p p-Indicator">}}</span>
</code></pre></div> </div> <h4 id=update-deployment>Update Deployment<a class=headerlink href=#update-deployment title="Permanent link">&para;</a></h4> <p>We have to make two changes. We have to create a <em>volume</em> and a <em>volumeMount</em> to ensure the <code>cloudsql-proxy</code> has access to the Service Account Key.</p> <div class="admonition example"> <p class=admonition-title>templates/deployment.yaml</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-proxy</span>
  <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/cloudsql-docker/gce-proxy:1.16</span>
  <span class=nt>command</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;/cloud_sql_proxy&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;-instances={{.Values.secrets.sql_connection}}=tcp:3306&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;-credential_file=/secrets/cloudsql/credentials.json&quot;</span><span class="p p-Indicator">]</span>
<span class=hll>  <span class=nt>volumeMounts</span><span class=p>:</span>
</span><span class=hll>    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-instance-credentials</span>
</span><span class=hll>      <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/secrets/cloudsql</span>
</span><span class=hll>      <span class=nt>readOnly</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div> <div class=highlight><pre><span></span><code><span class="p p-Indicator">{{</span> <span class=nv>toYaml .Values.resources | indent 12</span> <span class="p p-Indicator">}}</span>
      <span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.terminationGracePeriodSeconds</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- end</span> <span class="p p-Indicator">}}</span>
<span class=hll>      <span class=nt>volumes</span><span class=p>:</span>
</span><span class=hll>        <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-instance-credentials</span>
</span><span class=hll>          <span class=nt>secret</span><span class=p>:</span>
</span><span class=hll>            <span class=nt>secretName</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-sql-sa</span>
</span></code></pre></div> </div> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>Kubernetes' YAML manifest files can be difficult to get right, especially the indenting.</p> <p>If you have <code>Helm</code> installed locally, you can use its linting feature to see if everything is allright.</p> <div class=highlight><pre><span></span><code>helm lint charts/quarkus-fruits
</code></pre></div> </div> <h3 id=google-cloudsql-password>Google CloudSQL Password<a class=headerlink href=#google-cloudsql-password title="Permanent link">&para;</a></h3> <p>Add the CloudSQL password to your secret in Vault (in my case, <code>secrets/quarkus-fruits</code>) and use the Key <code>GOOGLE_SQL_PASS</code>.</p> <h4 id=create-secret-manifest_1>Create Secret Manifest<a class=headerlink href=#create-secret-manifest_1 title="Permanent link">&para;</a></h4> <p>We again make a Kubernetes Secret Manifest, this time by the name of <code>sql-secret.yaml</code>. Please not, that as we did not Base64 encode our password, we have to do this in our manifest. But no worries, Helm templating can do this for us, via <code>| b64enc</code>.</p> <div class="admonition example"> <p class=admonition-title>templates/sql-secret.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-sql-secret</span>
<span class=nt>data</span><span class=p>:</span>
  <span class=nt>GOOGLE_SQL_PASS</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.secrets.sql_password | b64enc</span> <span class="p p-Indicator">}}</span>
</code></pre></div> </div> <h4 id=update-deployment_1>Update Deployment<a class=headerlink href=#update-deployment_1 title="Permanent link">&para;</a></h4> <p>Instead of mounting the secret, we inject it as a environment variable. Unlike the the username, which was added as a environment variable directly, we let Kubernetes take care of the injection via <code>envFrom</code>. This ensures the secret does not show up in the manifest (when you do a <code>kubectl get pod -o yaml</code> for example), and saves us the hassle of reading the property from a file.</p> <p>When using <code>envFrom</code>, there are several options of where it comes from. In our case, it comes from a secret, so we use <code>-secretRef</code> with the name of our <code>sql-secret</code> secret manifest.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>The <code>deployment.yaml</code> is set up in such a way, that it expect us to declare <code>envFrom</code> in the <code>values.yaml</code>. Unfortunately, in our case, that doesn't work because we don't know the name of the secret up front. It is derived from the name of our Helm chart's installation, and it is best to keep this templated.</p> <p>To solve this, we have to remove the line <code>{{ toYaml .Values.envFrom | indent 10 }}</code></p> </div> <div class="admonition example"> <p class=admonition-title>templates/deployment.yaml</p> <div class=highlight><pre><span></span><code>      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Chart.Name</span> <span class="p p-Indicator">}}</span>
        <span class=nt>image</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Values.image.repository</span><span class=nv> </span><span class=s>}}:{{</span><span class=nv> </span><span class=s>.Values.image.tag</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>imagePullPolicy</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.image.pullPolicy</span> <span class="p p-Indicator">}}</span>
        <span class=nt>env</span><span class=p>:</span>
<span class="p p-Indicator">{{</span><span class=nv>- range $pkey</span><span class="p p-Indicator">,</span> <span class=nv>$pval</span> <span class="p p-Indicator">:</span><span class=nv>= .Values.env</span> <span class="p p-Indicator">}}</span>
        <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>$pkey</span> <span class="p p-Indicator">}}</span>
          <span class=nt>value</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>quote $pval</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- end</span> <span class="p p-Indicator">}}</span>
<span class=hll>        <span class=nt>envFrom</span><span class=p>:</span>
</span><span class=hll>        <span class="p p-Indicator">-</span> <span class=nt>secretRef</span><span class=p>:</span>
</span><span class=hll>            <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-sql-secret</span>
</span><span class="p p-Indicator">{{</span> <span class=nv>toYaml .Values.envFrom | indent 10</span> <span class="p p-Indicator">}}</span> <span class=c1>## LINE TO REMOVE</span>
</code></pre></div> </div> <h3 id=google-cloudsql-username>Google CloudSQL Username<a class=headerlink href=#google-cloudsql-username title="Permanent link">&para;</a></h3> <p>Add the CloudSQL username to your secret in Vault (in my case, <code>secrets/quarkus-fruits</code>) and use the Key <code>GOOGLE_SQL_USER</code>.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If you haven't created a separate user - which is probably best - the user would be <code>root</code>.</p> <p>If you create a new user, ensure the password set in <code>GOOGLE_SQL_PASS</code> matches the user in <code>GOOGLE_SQL_USER</code>.</p> </div> <p>For the username, this is all we have to do, as we directly inject this variable as an environment variable.</p> <div class="admonition example"> <p class=admonition-title>values.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>env</span><span class=p>:</span>
  <span class=nt>GOOGLE_SQL_USER</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault:quarkus-fruits:GOOGLE_SQL_USER</span>
</code></pre></div> </div> <h3 id=configure-jenkins-x-environments>Configure Jenkins X Environments<a class=headerlink href=#configure-jenkins-x-environments title="Permanent link">&para;</a></h3> <p>For each Jenkins X environment that your application is going to land in, such as <code>jx-staging</code> and <code>jx-production</code>, we have to enable Vault support.</p> <p>We do this by making a change in the Environment's <code>jx-requirements.yml</code> file in the root of the repository of the environment. This file might not exist, if so, create it.</p> <p>If you're not sure where the repository of your environment is, you can retrieve this information via the <code>jx</code> CLI.</p> <div class=highlight><pre><span></span><code>jx get environments
</code></pre></div> <p>To enable support for Vault, we add <code>secretStorage: vault</code> to the file. The file will look like this:</p> <div class="admonition example"> <p class=admonition-title>jx-requirements.yml</p> <div class=highlight><pre><span></span><code><span class=nt>secretStorage</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault</span>
</code></pre></div> </div> <h4 id=update-staging-environment>Update Staging Environment<a class=headerlink href=#update-staging-environment title="Permanent link">&para;</a></h4> <p>Once you create the secret and the <code>INSTANCE_CONNECTION_NAME</code> key with its secret value - which should be the instance connection name from your CloudSQL database - we can add this information to our Jenkins X environment(s), such as Staging. Again, here we assume the application's name is <code>quarkus-fruits</code>.</p> <div class="admonition example"> <p class=admonition-title>env/values.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>quarkus-fruits</span><span class=p>:</span>
  <span class=nt>secrets</span><span class=p>:</span>
    <span class=nt>sql_connection</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault:quarkus-fruits:INSTANCE_CONNECTION_NAME</span>
    <span class=nt>sql_sa</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault:quarkus-fruits:SA</span>
    <span class=nt>sql_password</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault:quarkus-fruits:GOOGLE_SQL_PASS</span>
</code></pre></div> </div> <p>For this secret, this is all we need to do. As our CloudSQL Proxy Container directly uses this value in the <code>deployment.yaml</code>.</p> <h3 id=summary-of-changes-made-to-application>Summary of Changes Made To Application<a class=headerlink href=#summary-of-changes-made-to-application title="Permanent link">&para;</a></h3> <ul> <li>created two new templates in the folder <code>charts/Name-Of-Your-Application/templates</code><ul> <li><code>sql-secret.yaml</code></li> <li><code>sql-sa-secret.yaml</code></li> </ul> </li> <li>updated the <code>charts/Name-Of-Your-Application/templates/deployment.yaml</code><ul> <li>add second container, for the CloudSQL Proxy</li> <li>add volume and volumeMount to CloudSQL Proxy container</li> <li>add environment injection from secret for password</li> </ul> </li> <li>updated <code>charts/Name-Of-Your-Application/values.yaml</code> with placeholders for the secrets</li> </ul> <details class=example><summary>templates/deployment.yaml</summary><p>Your deployment should now look like this:</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">{{</span><span class=nv>- if .Values.knativeDeploy</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- else</span> <span class="p p-Indicator">}}</span>
<span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span>
  <span class=nt>labels</span><span class=p>:</span>
    <span class=nt>draft</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>default &quot;draft-app&quot; .Values.draft</span> <span class="p p-Indicator">}}</span>
    <span class=nt>chart</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Chart.Name</span><span class=nv> </span><span class=s>}}-{{</span><span class=nv> </span><span class=s>.Chart.Version</span><span class=nv> </span><span class=s>|</span><span class=nv> </span><span class=s>replace</span><span class=nv> </span><span class=s>&quot;</span><span class="l l-Scalar l-Scalar-Plain">+&quot; &quot;_&quot; }}&quot;</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>selector</span><span class=p>:</span>
    <span class=nt>matchLabels</span><span class=p>:</span>
      <span class=nt>app</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- if .Values.hpa.enabled</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- else</span> <span class="p p-Indicator">}}</span>
  <span class=nt>replicas</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.replicaCount</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- end</span> <span class="p p-Indicator">}}</span>
  <span class=nt>template</span><span class=p>:</span>
    <span class=nt>metadata</span><span class=p>:</span>
      <span class=nt>labels</span><span class=p>:</span>
        <span class=nt>draft</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>default &quot;draft-app&quot; .Values.draft</span> <span class="p p-Indicator">}}</span>
        <span class=nt>app</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- if .Values.podAnnotations</span> <span class="p p-Indicator">}}</span>
      <span class=nt>annotations</span><span class=p>:</span>
<span class="p p-Indicator">{{</span> <span class=nv>toYaml .Values.podAnnotations | indent 8</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- end</span> <span class="p p-Indicator">}}</span>
    <span class=nt>spec</span><span class=p>:</span>
      <span class=nt>containers</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-proxy</span>
        <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/cloudsql-docker/gce-proxy:1.16</span>
        <span class=nt>command</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;/cloud_sql_proxy&quot;</span><span class="p p-Indicator">,</span>
                  <span class=s>&quot;-instances={{.Values.secrets.sql_connection}}=tcp:3306&quot;</span><span class="p p-Indicator">,</span>
                  <span class=s>&quot;-credential_file=/secrets/cloudsql/credentials.json&quot;</span><span class="p p-Indicator">]</span>
        <span class=nt>volumeMounts</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-instance-credentials</span>
            <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/secrets/cloudsql</span>
            <span class=nt>readOnly</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Chart.Name</span> <span class="p p-Indicator">}}</span>
        <span class=nt>image</span><span class=p>:</span> <span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Values.image.repository</span><span class=nv> </span><span class=s>}}:{{</span><span class=nv> </span><span class=s>.Values.image.tag</span><span class=nv> </span><span class=s>}}&quot;</span>
        <span class=nt>imagePullPolicy</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.image.pullPolicy</span> <span class="p p-Indicator">}}</span>
        <span class=nt>env</span><span class=p>:</span>
<span class="p p-Indicator">{{</span><span class=nv>- range $pkey</span><span class="p p-Indicator">,</span> <span class=nv>$pval</span> <span class="p p-Indicator">:</span><span class=nv>= .Values.env</span> <span class="p p-Indicator">}}</span>
        <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>$pkey</span> <span class="p p-Indicator">}}</span>
          <span class=nt>value</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>quote $pval</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- end</span> <span class="p p-Indicator">}}</span>
        <span class=nt>envFrom</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>secretRef</span><span class=p>:</span>
            <span class=nt>name</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-sql-secret</span>
        <span class=nt>ports</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>containerPort</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.service.internalPort</span> <span class="p p-Indicator">}}</span>
        <span class=nt>livenessProbe</span><span class=p>:</span>
          <span class=nt>httpGet</span><span class=p>:</span>
            <span class=nt>path</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.livenessProbePath</span> <span class="p p-Indicator">}}</span>
            <span class=nt>port</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.service.internalPort</span> <span class="p p-Indicator">}}</span>
          <span class=nt>initialDelaySeconds</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.livenessProbe.initialDelaySeconds</span> <span class="p p-Indicator">}}</span>
          <span class=nt>periodSeconds</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.livenessProbe.periodSeconds</span> <span class="p p-Indicator">}}</span>
          <span class=nt>successThreshold</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.livenessProbe.successThreshold</span> <span class="p p-Indicator">}}</span>
          <span class=nt>timeoutSeconds</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.livenessProbe.timeoutSeconds</span> <span class="p p-Indicator">}}</span>
        <span class=nt>readinessProbe</span><span class=p>:</span>
          <span class=nt>httpGet</span><span class=p>:</span>
            <span class=nt>path</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.readinessProbePath</span> <span class="p p-Indicator">}}</span>
            <span class=nt>port</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.service.internalPort</span> <span class="p p-Indicator">}}</span>
          <span class=nt>periodSeconds</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.readinessProbe.periodSeconds</span> <span class="p p-Indicator">}}</span>
          <span class=nt>successThreshold</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.readinessProbe.successThreshold</span> <span class="p p-Indicator">}}</span>
          <span class=nt>timeoutSeconds</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.readinessProbe.timeoutSeconds</span> <span class="p p-Indicator">}}</span>
        <span class=nt>resources</span><span class=p>:</span>
<span class="p p-Indicator">{{</span> <span class=nv>toYaml .Values.resources | indent 12</span> <span class="p p-Indicator">}}</span>
      <span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>.Values.terminationGracePeriodSeconds</span> <span class="p p-Indicator">}}</span>
<span class="p p-Indicator">{{</span><span class=nv>- end</span> <span class="p p-Indicator">}}</span>
      <span class=nt>volumes</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-instance-credentials</span>
          <span class=nt>secret</span><span class=p>:</span>
            <span class=nt>secretName</span><span class=p>:</span> <span class="p p-Indicator">{{</span> <span class=nv>template &quot;fullname&quot; .</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">-sql-sa</span>
</code></pre></div> </details> <h3 id=summary-of-changes-made-to-staging-environment>Summary of Changes Made To Staging Environment<a class=headerlink href=#summary-of-changes-made-to-staging-environment title="Permanent link">&para;</a></h3> <ul> <li>created a new file, called <code>jx-requirements.yml</code> at the root</li> <li>updated the <code>env/values.yaml</code> with values for our application</li> </ul> <details class=example><summary>jx-requirements.yml</summary><div class=highlight><pre><span></span><code><span class=nt>secretStorage</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault</span>
</code></pre></div> </details> <details class=example><summary>env/values.yaml</summary><div class=highlight><pre><span></span><code><span class=nt>quarkus-fruits</span><span class=p>:</span>
<span class=nt>secrets</span><span class=p>:</span>
  <span class=nt>sql_connection</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault:quarkus-fruits:INSTANCE_CONNECTION_NAME</span>
  <span class=nt>sql_sa</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault:quarkus-fruits:SA</span>
  <span class=nt>sql_password</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault:quarkus-fruits:GOOGLE_SQL_PASS</span>
</code></pre></div> </details> <hr> <div class=md-source-date> <small> Last update: 2020-06-02 22:22:42 </small> </div> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>var disqus_config=function(){this.page.url="https://joostvdg.github.io/jenkinsx/java-native-prod/05-jx-secrets/",this.page.identifier="/jenkinsx/java-native-prod/05-jx-secrets/"};!function(){var e=document,i=e.createElement("script");i.src="//joostvdg-github-io.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)}()</script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../04-jx-import/ title="Import Into Jenkins X" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Import Into Jenkins X </div> </div> </a> <a href=../06-native-image/ title="Native Image" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Native Image </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Joost van der Griendt </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/joostvdg target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/joost_vdg target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/joostvdg target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/vendor.d710d30a.min.js></script> <script src=../../../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../../..",
          features: ["tabs", "instant"],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>