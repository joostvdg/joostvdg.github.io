<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Creating a Java Native Image application and run it as Production with Jenkins X - Previews & Integration Tests - 8/9"><link href=https://joostvdg.github.io/jenkinsx/java-native-prod/08-preview-int-test/ rel=canonical><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.2"><title>Jenkins X - Java Native Image Prod</title><link rel=stylesheet href=../../../assets/stylesheets/main.a2408e81.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.a46bcfb3.min.css><meta name=theme-color content=#ffa726><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7CCutive+Mono&display=fallback"><style>body,input{font-family:"Lato",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Cutive Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel="preconnect dns-prefetch" href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-145385967-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=orange data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#previews-integration-tests class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> J's Software Development Pages </span> <span class="md-header-nav__topic md-ellipsis"> Jenkins X - Java Native Image Prod </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <div class=md-hero data-md-component=hero> <div class="md-hero__inner md-grid"> Previews & Integration Tests - 8/9 </div> </div> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../blogs/jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../../../cloudbees/sso-azure-ad/ class=md-tabs__link> Jenkins & CloudBees </a> </li> <li class=md-tabs__item> <a href=../../build-packs/ class="md-tabs__link md-tabs__link--active"> Jenkins X </a> </li> <li class=md-tabs__item> <a href=../../../openshift/rhos311-gcp-minimal/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../../cloud/automation-pulumi/ class=md-tabs__link> Software Eng. </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo" aria-label="J's Software Development Pages"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Blogs <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Blogs data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../blogs/jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../../../blogs/graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../../blogs/docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../../blogs/k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../../blogs/sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../../blogs/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../../blogs/kubernetes-sso-keycloak/ title="Kubernetes SSO Keycloak" class=md-nav__link> Kubernetes SSO Keycloak </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8> <label class=md-nav__link for=nav-2-8> Jenkins X Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../05-jx-secrets/ title="Database Connection And Secrets" class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class=md-nav__item> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Previews & Integration Tests <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Previews & Integration Tests" class="md-nav__link md-nav__link--active"> Previews & Integration Tests </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#manage-database-via-flyway class=md-nav__link> Manage Database Via Flyway </a> <nav class=md-nav aria-label="Manage Database Via Flyway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quarkus-integration class=md-nav__link> Quarkus Integration </a> <nav class=md-nav aria-label="Quarkus Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-definitions class=md-nav__link> Schema definitions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#unit-test-configuration class=md-nav__link> Unit Test Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#postman-test-suit class=md-nav__link> PostMan Test Suit </a> <nav class=md-nav aria-label="PostMan Test Suit"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#postman-test-suite-json class=md-nav__link> PostMan Test Suite JSON </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#preview-environments class=md-nav__link> Preview Environments </a> <nav class=md-nav aria-label="Preview Environments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-preview-environment class=md-nav__link> Create Preview Environment </a> </li> <li class=md-nav__item> <a href=#update-preview-pipeline class=md-nav__link> Update Preview Pipeline </a> </li> <li class=md-nav__item> <a href=#mysql-database-as-preview-dependency class=md-nav__link> MySQL Database as Preview Dependency </a> </li> <li class=md-nav__item> <a href=#update-properties class=md-nav__link> Update Properties </a> </li> <li class=md-nav__item> <a href=#update-helm-chart class=md-nav__link> Update Helm Chart </a> <nav class=md-nav aria-label="Update Helm Chart"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deployment class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=#chart-values class=md-nav__link> Chart Values </a> </li> <li class=md-nav__item> <a href=#preview-chart-values class=md-nav__link> Preview Chart Values </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ensure-sorted-list-is-returned class=md-nav__link> Ensure Sorted List Is Returned </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> Next Steps </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-9 type=checkbox id=nav-2-9> <label class=md-nav__link for=nav-2-9> Jenkins Monitoring Kubernetes <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Monitoring Kubernetes" data-md-level=2> <label class=md-nav__title for=nav-2-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/metrics/ title=Metrics class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../../blogs/monitor-jenkins-on-k8s/cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../blogs/k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../../blogs/dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Jenkins & CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins & CloudBees" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins & CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> CloudBees <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=CloudBees data-md-level=2> <label class=md-nav__title for=nav-3-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloudbees/sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/cbc-team-namespace/ title="Team Master Namespace" class=md-nav__link> Team Master Namespace </a> </li> <li class=md-nav__item> <a href=../../../cloudbees/multi-cluster/ title=Multi-Cluster class=md-nav__link> Multi-Cluster </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2> <label class=md-nav__link for=nav-3-2> Jenkins <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Jenkins data-md-level=2> <label class=md-nav__title for=nav-3-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins Pipelines <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipelines" data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/kaniko-pipelines/ title="Build Docker Image Kaniko" class=md-nav__link> Build Docker Image Kaniko </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/podtemplate-dind/ title="PodTemplate With Docker-In-Docker" class=md-nav__link> PodTemplate With Docker-In-Docker </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/jenkins-parallel-pipeline/ title="Parallel Pipelines" class=md-nav__link> Parallel Pipelines </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipeline Examples <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins Pipeline Examples" data-md-level=2> <label class=md-nav__title for=nav-3-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Jenkins X <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Jenkins X" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../build-packs/ title="Build Packs" class=md-nav__link> Build Packs </a> </li> <li class=md-nav__item> <a href=../../jx-pipelines/ title="Jenkins X Pipelines" class=md-nav__link> Jenkins X Pipelines </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3 checked> <label class=md-nav__link for=nav-4-3> Java Native Image Prod <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Java Native Image Prod" data-md-level=2> <label class=md-nav__title for=nav-4-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java Native Image Prod </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-intro/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../02-cloud-sql/ title="Cloud SQL" class=md-nav__link> Cloud SQL </a> </li> <li class=md-nav__item> <a href=../03-quarkus/ title=Quarkus class=md-nav__link> Quarkus </a> </li> <li class=md-nav__item> <a href=../04-jx-import/ title="Import Into Jenkins X" class=md-nav__link> Import Into Jenkins X </a> </li> <li class=md-nav__item> <a href=../05-jx-secrets/ title="Database Connection And Secrets" class=md-nav__link> Database Connection And Secrets </a> </li> <li class=md-nav__item> <a href=../06-native-image/ title="Native Image" class=md-nav__link> Native Image </a> </li> <li class=md-nav__item> <a href=../07-pipeline-improvements/ title="Pipeline Improvements" class=md-nav__link> Pipeline Improvements </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Previews & Integration Tests <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Previews & Integration Tests" class="md-nav__link md-nav__link--active"> Previews & Integration Tests </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#manage-database-via-flyway class=md-nav__link> Manage Database Via Flyway </a> <nav class=md-nav aria-label="Manage Database Via Flyway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quarkus-integration class=md-nav__link> Quarkus Integration </a> <nav class=md-nav aria-label="Quarkus Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-definitions class=md-nav__link> Schema definitions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#unit-test-configuration class=md-nav__link> Unit Test Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#postman-test-suit class=md-nav__link> PostMan Test Suit </a> <nav class=md-nav aria-label="PostMan Test Suit"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#postman-test-suite-json class=md-nav__link> PostMan Test Suite JSON </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#preview-environments class=md-nav__link> Preview Environments </a> <nav class=md-nav aria-label="Preview Environments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-preview-environment class=md-nav__link> Create Preview Environment </a> </li> <li class=md-nav__item> <a href=#update-preview-pipeline class=md-nav__link> Update Preview Pipeline </a> </li> <li class=md-nav__item> <a href=#mysql-database-as-preview-dependency class=md-nav__link> MySQL Database as Preview Dependency </a> </li> <li class=md-nav__item> <a href=#update-properties class=md-nav__link> Update Properties </a> </li> <li class=md-nav__item> <a href=#update-helm-chart class=md-nav__link> Update Helm Chart </a> <nav class=md-nav aria-label="Update Helm Chart"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deployment class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=#chart-values class=md-nav__link> Chart Values </a> </li> <li class=md-nav__item> <a href=#preview-chart-values class=md-nav__link> Preview Chart Values </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ensure-sorted-list-is-returned class=md-nav__link> Ensure Sorted List Is Returned </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> Next Steps </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../09-production-improvements/ title="Production Improvements" class=md-nav__link> Production Improvements </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../builder-image/ title="Create Builder Image" class=md-nav__link> Create Builder Image </a> </li> <li class=md-nav__item> <a href=../../jxboot/ title="JX Boot GKE" class=md-nav__link> JX Boot GKE </a> </li> <li class=md-nav__item> <a href=../../jxboot-aks/ title="JX Boot AKS" class=md-nav__link> JX Boot AKS </a> </li> <li class=md-nav__item> <a href=../../aks-boot-core/ title="JX Boot & CloudBees Core" class=md-nav__link> JX Boot & CloudBees Core </a> </li> <li class=md-nav__item> <a href=../../rhos-311-minimal/ title="OpenShift 3.11" class=md-nav__link> OpenShift 3.11 </a> </li> <li class=md-nav__item> <a href=../../rhos-311-restricted/ title="OpenShift 3.11 - Restricted" class=md-nav__link> OpenShift 3.11 - Restricted </a> </li> <li class=md-nav__item> <a href=../../lighthouse-bitbucket/ title="Lighthouse & Bitbucket" class=md-nav__link> Lighthouse & Bitbucket </a> </li> <li class=md-nav__item> <a href=../../hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../../maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../../hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../../kubernetes-days/ title="Example For Console Reel" class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Containers <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Containers data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> OpenShift <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=OpenShift data-md-level=2> <label class=md-nav__title for=nav-5-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> OpenShift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../openshift/rhos311-gcp-minimal/ title="OpenShift 3.11 GCP(minimal)" class=md-nav__link> OpenShift 3.11 GCP(minimal) </a> </li> <li class=md-nav__item> <a href=../../../openshift/rhos311-gcp-medium/ title="OpenShift 3.11 GCP(medium)" class=md-nav__link> OpenShift 3.11 GCP(medium) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Kubernetes (K8S) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Kubernetes (K8S)" data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Managed Kubernetes (cloud) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Managed Kubernetes (cloud)" data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Managed Kubernetes (cloud) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/gke-terraform/ title="GKE Terraform" class=md-nav__link> GKE Terraform </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> K8S Hard Way - GCE <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="K8S Hard Way - GCE" data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Docker <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Docker data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> Linux <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Linux data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Software Eng. <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Eng." data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Eng. </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Automation <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Automation data-md-level=2> <label class=md-nav__title for=nav-6-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Automation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../cloud/automation-pulumi/ title=Pulumi class=md-nav__link> Pulumi </a> </li> <li class=md-nav__item> <a href=../../../certificates/lets-encrypt-k8s/ title="Let's Encrypt K8S" class=md-nav__link> Let's Encrypt K8S </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Software Engineering" data-md-level=2> <label class=md-nav__title for=nav-6-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Productivity data-md-level=2> <label class=md-nav__title for=nav-6-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-4 type=checkbox id=nav-6-4> <label class=md-nav__link for=nav-6-4> Java <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Java data-md-level=2> <label class=md-nav__title for=nav-6-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../../java/networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../../java/concurrency/ title="Java Concurrency" class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#manage-database-via-flyway class=md-nav__link> Manage Database Via Flyway </a> <nav class=md-nav aria-label="Manage Database Via Flyway"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quarkus-integration class=md-nav__link> Quarkus Integration </a> <nav class=md-nav aria-label="Quarkus Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schema-definitions class=md-nav__link> Schema definitions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#unit-test-configuration class=md-nav__link> Unit Test Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#postman-test-suit class=md-nav__link> PostMan Test Suit </a> <nav class=md-nav aria-label="PostMan Test Suit"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#postman-test-suite-json class=md-nav__link> PostMan Test Suite JSON </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#preview-environments class=md-nav__link> Preview Environments </a> <nav class=md-nav aria-label="Preview Environments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-preview-environment class=md-nav__link> Create Preview Environment </a> </li> <li class=md-nav__item> <a href=#update-preview-pipeline class=md-nav__link> Update Preview Pipeline </a> </li> <li class=md-nav__item> <a href=#mysql-database-as-preview-dependency class=md-nav__link> MySQL Database as Preview Dependency </a> </li> <li class=md-nav__item> <a href=#update-properties class=md-nav__link> Update Properties </a> </li> <li class=md-nav__item> <a href=#update-helm-chart class=md-nav__link> Update Helm Chart </a> <nav class=md-nav aria-label="Update Helm Chart"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deployment class=md-nav__link> Deployment </a> </li> <li class=md-nav__item> <a href=#chart-values class=md-nav__link> Chart Values </a> </li> <li class=md-nav__item> <a href=#preview-chart-values class=md-nav__link> Preview Chart Values </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ensure-sorted-list-is-returned class=md-nav__link> Ensure Sorted List Is Returned </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> Next Steps </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/jenkinsx/java-native-prod/08-preview-int-test.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=previews-integration-tests>Previews &amp; Integration Tests<a class=headerlink href=#previews-integration-tests title="Permanent link">&para;</a></h1> <p>As mentioned in <a href=/jenkinsx/java-native-prod/07-pipeline-improvements/ >Pipeline Improvements</a> (previous page), here we will dive into - amongst other things - running integration tests with PostMan.</p> <p>The first part of the title is <strong><em>Previews</em></strong>. The name comes from the Jenkins X feature called <em>Preview Environments</em>. We will explore how we can leverage Preview Environments for running Integration Tests.</p> <blockquote> <p>Jenkins X allows users to test and validate changes to code in a specialized fourth tier called a <strong>preview environment</strong>, which is a temporary tier where quick testing, feedback and limited availability demos for a wider user base can be done before changes are merged to master for production deployment. This gives developers the ability to receive faster feedback for their changes. - <a href=https://docs.cloudbees.com/docs/cloudbees-jenkins-x-distribution/latest/developer-guide/preview-environments>CloudBees Jenkins X Distribution Guide</a></p> </blockquote> <p>The plan for this part of the guide, is to run a PostMan test suite everytime we create or update a PullRequest (PR) on its related Preview Environment.</p> <h2 id=manage-database-via-flyway>Manage Database Via Flyway<a class=headerlink href=#manage-database-via-flyway title="Permanent link">&para;</a></h2> <p>One part of CI/CD that is often forgotten, is managing your Database (schema) updates. There are several options available, such as <a href=https://www.liquibase.org/ >Liquibase</a> and <a href=https://flywaydb.org/ >Flyway</a>.</p> <p>As I've used Flyway in the past with good results, we use Flyway for this guide, but I'm certain you can achieve the same results wichever route you take. You can also choose to ignore database schema management, and leave it to Hibernate or Spring Data to update the schema based on your classes.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>If you do use Flyway or Liquibase to manage the Database schema, you have to re-create the database.</p> <p>The moment to do this, is when the updated application lands in the Staging environment.</p> </div> <h3 id=quarkus-integration>Quarkus Integration<a class=headerlink href=#quarkus-integration title="Permanent link">&para;</a></h3> <p>Quarkus has excellent support for Flyway, and the <a href=https://quarkus.io/guides/flyway>Quarkus Flyway guide</a> explains all the details . To use Flyway with our Quarkus application, we take the following steps:</p> <ol> <li>add the <code>quarkus-flyway</code> dependency to the <code>pom.xml</code></li> <li>update the <code>application.properties</code> file in <code>src/main/resources</code></li> <li>update our Fruit entity, <code>src/main/java/.../Fruit.java</code></li> <li>create initial schema definition</li> <li>ensure find all call return a sorted list</li> </ol> <div class="admonition example"> <p class=admonition-title>pom.xml</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dependency&gt;</span>
    <span class=nt>&lt;groupId&gt;</span>io.quarkus<span class=nt>&lt;/groupId&gt;</span>
    <span class=nt>&lt;artifactId&gt;</span>quarkus-flyway<span class=nt>&lt;/artifactId&gt;</span>
<span class=nt>&lt;/dependency&gt;</span>
</code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>src/main/resources/application.properties</p> <p>The highlighted lines are the changes.</p> <div class=highlight><pre><span></span><code><span class=na>quarkus.datasource.db-kind</span><span class=o>=</span><span class=s>mysql</span>
<span class=na>quarkus.datasource.jdbc.url</span><span class=o>=</span><span class=s>jdbc:mysql://127.0.0.1:3306/fruits</span>
<span class=na>quarkus.datasource.jdbc.max-size</span><span class=o>=</span><span class=s>8</span>
<span class=na>quarkus.datasource.jdbc.min-size</span><span class=o>=</span><span class=s>2</span>

<span class=na>quarkus.datasource.username</span><span class=o>=</span><span class=s>${GOOGLE_SQL_USER}</span>
<span class=na>quarkus.datasource.password</span><span class=o>=</span><span class=s>${GOOGLE_SQL_PASS}</span>

<span class=hll><span class=na>quarkus.flyway.migrate-at-start</span><span class=o>=</span><span class=s>true</span>
</span><span class=hll><span class=na>quarkus.flyway.baseline-on-migrate</span><span class=o>=</span><span class=s>true</span>
</span>
<span class=hll><span class=na>quarkus.hibernate-orm.database.generation</span><span class=o>=</span><span class=s>none</span>
</span><span class=hll><span class=na>quarkus.log.level</span><span class=o>=</span><span class=s>INFO</span>
</span><span class=hll><span class=na>quarkus.log.category.&quot;org.hibernate&quot;.level</span><span class=o>=</span><span class=s>INFO</span>
</span></code></pre></div> </div> <p>To ensure we don't run into any troubles with MySQL locally or within Google Cloud, it is best to explicitly set the Table name to exclusively lower case.</p> <p>Secondly, instead of letting Hibernate take care of the id of our entities, we can rely on MySQL doing this for us. So we set the generation strategy to <code>IDENTITY</code>.</p> <div class="admonition example"> <p class=admonition-title>src/main/java/.../Fruit.java</p> <div class=highlight><pre><span></span><code><span class=hll><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&quot;fruit&quot;</span><span class=p>)</span>
</span><span class=nd>@Entity</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Fruit</span> <span class=p>{</span>

<span class=nd>@Id</span>
<span class=hll><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span> <span class=o>=</span> <span class=n>GenerationType</span><span class=p>.</span><span class=na>IDENTITY</span><span class=p>)</span>
</span><span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=p>;</span>
</code></pre></div> </div> <h4 id=schema-definitions>Schema definitions<a class=headerlink href=#schema-definitions title="Permanent link">&para;</a></h4> <p>Flyway uses SQL files for managing the schema - and data - of your database. By default, it looks in the <code>src/main/resources/db/migration</code> folder.</p> <p>Flyway runs the files in order and uses the filename for determining the schema version and update title. We create two files:</p> <ol> <li><code>V1.0.0__initial.sql</code>: houses our Fruit table</li> <li><code>V1.0.1__test_data.sql</code>: has our initial data entries, which we can then also use for our Integration Tests!</li> </ol> <div class="admonition example"> <p class=admonition-title>V1.0.0__initial.sql</p> <p>The comments were generated by CloudSQL's export, if you use CloudSQL I recommend leaving them intact. If you use something else, probably best to remove them.</p> <div class=highlight><pre><span></span><code><span class=cm>/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class=p>;</span>
<span class=cm>/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class=p>;</span>
<span class=cm>/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class=p>;</span>
<span class=cm>/*!40101 SET NAMES utf8 */</span><span class=p>;</span>
<span class=cm>/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */</span><span class=p>;</span>
<span class=cm>/*!40103 SET TIME_ZONE=&#39;+00:00&#39; */</span><span class=p>;</span>
<span class=cm>/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */</span><span class=p>;</span>
<span class=cm>/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class=p>;</span>
<span class=cm>/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE=&#39;NO_AUTO_VALUE_ON_ZERO&#39; */</span><span class=p>;</span>
<span class=cm>/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class=p>;</span>

<span class=c1>--</span>
<span class=c1>-- Current Database: `fruits`</span>
<span class=c1>--</span>
<span class=c1>--</span>
<span class=c1>-- CREATE DATABASE /*!32312 IF NOT EXISTS*/ `fruits` /*!40100 DEFAULT CHARACTER SET utf8 */;</span>
<span class=c1>--</span>
<span class=c1>-- USE `fruits`;</span>

<span class=c1>--</span>
<span class=c1>-- Table structure for table `Fruit`</span>
<span class=c1>--</span>

<span class=k>DROP</span> <span class=k>TABLE</span> <span class=k>IF</span> <span class=k>EXISTS</span> <span class=o>`</span><span class=n>fruit</span><span class=o>`</span><span class=p>;</span>
<span class=cm>/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class=p>;</span>
<span class=cm>/*!40101 SET character_set_client = utf8 */</span><span class=p>;</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=o>`</span><span class=n>fruit</span><span class=o>`</span> <span class=p>(</span>
  <span class=o>`</span><span class=n>id</span><span class=o>`</span> <span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span> <span class=k>NOT</span> <span class=k>NULL</span> <span class=n>AUTO_INCREMENT</span><span class=p>,</span>
  <span class=o>`</span><span class=n>color</span><span class=o>`</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=o>`</span><span class=n>name</span><span class=o>`</span> <span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span> <span class=k>DEFAULT</span> <span class=k>NULL</span><span class=p>,</span>
  <span class=k>PRIMARY</span> <span class=k>KEY</span> <span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span>
<span class=p>)</span> <span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span> <span class=k>DEFAULT</span> <span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span>
<span class=cm>/*!40101 SET character_set_client = @saved_cs_client */</span><span class=p>;</span>

<span class=k>CREATE</span> <span class=k>UNIQUE</span> <span class=k>INDEX</span> <span class=o>`</span><span class=n>fruit_name_color</span><span class=o>`</span> <span class=k>ON</span> <span class=o>`</span><span class=n>fruit</span><span class=o>`</span> <span class=p>(</span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span> <span class=o>`</span><span class=n>color</span><span class=o>`</span><span class=p>);</span>
</code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>V1.0.1__test_data.sql</p> <div class=highlight><pre><span></span><code><span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Cherry&#39;</span><span class=p>,</span> <span class=s1>&#39;Red&#39;</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Apple&#39;</span><span class=p>,</span> <span class=s1>&#39;Red&#39;</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Banana&#39;</span><span class=p>,</span> <span class=s1>&#39;Yellow&#39;</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Avocado&#39;</span><span class=p>,</span> <span class=s1>&#39;Green&#39;</span><span class=p>);</span>
<span class=k>INSERT</span> <span class=k>INTO</span> <span class=n>fruit</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>color</span><span class=p>)</span> <span class=k>VALUES</span> <span class=p>(</span><span class=s1>&#39;Strawberry&#39;</span><span class=p>,</span> <span class=s1>&#39;Red&#39;</span><span class=p>);</span>
</code></pre></div> </div> <h3 id=unit-test-configuration>Unit Test Configuration<a class=headerlink href=#unit-test-configuration title="Permanent link">&para;</a></h3> <p>To ensure our unit tests also keep working, we have to make some changes to our Tests' <code>application.properties</code> file.</p> <p>The mandatory lines are highlighted, the lat three are for debug logging - should be obvious. This gives you more information on what Flyway is doing, which is almost mandatory when you run into issues. These can be safely ignored, but I thought it best to show you how to set that type of logging, just in case.</p> <div class="admonition example"> <p class=admonition-title>src/test/resources/application.properties</p> <div class=highlight><pre><span></span><code><span class=na>quarkus.datasource.url</span><span class=o>=</span><span class=s>jdbc:h2:tcp://localhost/mem:fruits;MODE=MYSQL;DB_CLOSE_DELAY=-1</span>
<span class=na>quarkus.datasource.driver</span><span class=o>=</span><span class=s>org.h2.Driver</span>

<span class=na>quarkus.hibernate-orm.log.sql</span><span class=o>=</span><span class=s>true</span>
<span class=hll><span class=na>quarkus.hibernate-orm.database.default-schema</span><span class=o>=</span><span class=s>FRUITS</span>
</span><span class=hll><span class=na>quarkus.flyway.migrate-at-start</span><span class=o>=</span><span class=s>true</span>
</span><span class=hll><span class=na>quarkus.flyway.schemas</span><span class=o>=</span><span class=s>FRUITS</span>
</span>
<span class=na>quarkus.log.console.level</span><span class=o>=</span><span class=s>DEBUG</span>
<span class=na>quarkus.log.category.&quot;org.flywaydb.core&quot;.level</span><span class=o>=</span><span class=s>DEBUG</span>
<span class=na>quarkus.log.category.&quot;io.quarkus.flyway&quot;.level</span><span class=o>=</span><span class=s>DEBUG</span>
</code></pre></div> </div> <h2 id=postman-test-suit>PostMan Test Suit<a class=headerlink href=#postman-test-suit title="Permanent link">&para;</a></h2> <p><a href=https://learning.postman.com/docs/postman/launching-postman/introduction/ >Postman</a> is a good and commonly used [rest] API testing tool. It has a CLI alternative, which also ships as a <a href=https://hub.docker.com/r/postman/newman>Docker image</a>, called <a href=https://github.com/postmanlabs/newman>Newman</a>.</p> <p>We can use this to test our running Preview application.</p> <p>First, we create a <a href=https://learning.postman.com/docs/postman/collections/intro-to-collections/ >collection</a> of <a href=https://learning.postman.com/docs/postman/scripts/test-scripts/ >tests</a> with Postman, which we can then <a href=https://learning.postman.com/docs/postman/collections/importing-and-exporting-data/#exporting-postman-data>export</a> as a json file.</p> <h3 id=postman-test-suite-json>PostMan Test Suite JSON<a class=headerlink href=#postman-test-suite-json title="Permanent link">&para;</a></h3> <details class=example><summary>postman-suite-01.json</summary><p>We specify to variables in this script, <code>baseUrl</code>, which we set in the Jenkins X Pipeline Step, and <code>MANDARIN_ID</code>. <code>MANDARIN_ID</code> is set in one of the tests, when we add a new entry to the database.</p> <p>This way, we can ensure we also cleanup the database, so that an update to the PR has the original data set to work with.</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
  <span class=nt>&quot;variables&quot;</span><span class=p>:</span> <span class=p>[],</span>
  <span class=nt>&quot;info&quot;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;postman-suite-01&quot;</span><span class=p>,</span>
    <span class=nt>&quot;_postman_id&quot;</span><span class=p>:</span> <span class=s2>&quot;2c62b599-f952-d49c-3b36-5fb1b7a77472&quot;</span><span class=p>,</span>
    <span class=nt>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span><span class=p>,</span>
    <span class=nt>&quot;schema&quot;</span><span class=p>:</span> <span class=s2>&quot;https://schema.getpostman.com/json/collection/v2.0.0/collection.json&quot;</span>
  <span class=p>},</span>
  <span class=nt>&quot;item&quot;</span><span class=p>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;find-all-fruits&quot;</span><span class=p>,</span>
      <span class=nt>&quot;event&quot;</span><span class=p>:</span> <span class=p>[</span>
        <span class=p>{</span>
          <span class=nt>&quot;listen&quot;</span><span class=p>:</span> <span class=s2>&quot;test&quot;</span><span class=p>,</span>
          <span class=nt>&quot;script&quot;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;text/javascript&quot;</span><span class=p>,</span>
            <span class=nt>&quot;exec&quot;</span><span class=p>:</span> <span class=p>[</span>
              <span class=s2>&quot;tests[\&quot;Successful GET request\&quot;] = responseCode.code === 200;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;tests[\&quot;Response time is less than 400ms\&quot;] = responseTime &lt; 400;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;var jsonData = JSON.parse(responseBody);&quot;</span><span class=p>,</span>
              <span class=s2>&quot;tests[\&quot;JSON Data Test-1\&quot;] = jsonData[0].name === \&quot;Cherry\&quot;;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;tests[\&quot;JSON Data Test-2\&quot;] = jsonData[1].name === \&quot;Apple\&quot;;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;tests[\&quot;JSON Data Test-3\&quot;] = jsonData[2].name === \&quot;Banana\&quot;;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;tests[\&quot;JSON Data Test-4\&quot;] = jsonData[3].color === \&quot;Green\&quot;;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;tests[\&quot;JSON Data Test-5\&quot;] = jsonData[4].color === \&quot;Red\&quot;;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;&quot;</span>
            <span class=p>]</span>
          <span class=p>}</span>
        <span class=p>}</span>
      <span class=p>],</span>
      <span class=nt>&quot;request&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&quot;url&quot;</span><span class=p>:</span> <span class=s2>&quot;{{baseUrl}}/fruits&quot;</span><span class=p>,</span>
        <span class=nt>&quot;method&quot;</span><span class=p>:</span> <span class=s2>&quot;GET&quot;</span><span class=p>,</span>
        <span class=nt>&quot;header&quot;</span><span class=p>:</span> <span class=p>[],</span>
        <span class=nt>&quot;body&quot;</span><span class=p>:</span> <span class=p>{},</span>
        <span class=nt>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;Test fina all fruits&quot;</span>
      <span class=p>},</span>
      <span class=nt>&quot;response&quot;</span><span class=p>:</span> <span class=p>[]</span>
    <span class=p>},</span>
    <span class=p>{</span>
      <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;post-new-fruit&quot;</span><span class=p>,</span>
      <span class=nt>&quot;event&quot;</span><span class=p>:</span> <span class=p>[</span>
        <span class=p>{</span>
          <span class=nt>&quot;listen&quot;</span><span class=p>:</span> <span class=s2>&quot;test&quot;</span><span class=p>,</span>
          <span class=nt>&quot;script&quot;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;text/javascript&quot;</span><span class=p>,</span>
            <span class=nt>&quot;exec&quot;</span><span class=p>:</span> <span class=p>[</span>
              <span class=s2>&quot;tests[\&quot;Successful GET request\&quot;] = responseCode.code === 200;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;tests[\&quot;Response time is less than 400ms\&quot;] = responseTime &lt; 400;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;var jsonData = JSON.parse(responseBody);&quot;</span><span class=p>,</span>
              <span class=s2>&quot;postman.setGlobalVariable(\&quot;MANDARIN_ID\&quot;, jsonData.id);&quot;</span>
            <span class=p>]</span>
          <span class=p>}</span>
        <span class=p>}</span>
      <span class=p>],</span>
      <span class=nt>&quot;request&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&quot;url&quot;</span><span class=p>:</span> <span class=s2>&quot;{{baseUrl}}/fruits/name/Mandarin/color/Orange&quot;</span><span class=p>,</span>
        <span class=nt>&quot;method&quot;</span><span class=p>:</span> <span class=s2>&quot;POST&quot;</span><span class=p>,</span>
        <span class=nt>&quot;header&quot;</span><span class=p>:</span> <span class=p>[],</span>
        <span class=nt>&quot;body&quot;</span><span class=p>:</span> <span class=p>{},</span>
        <span class=nt>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span>
      <span class=p>},</span>
      <span class=nt>&quot;response&quot;</span><span class=p>:</span> <span class=p>[]</span>
    <span class=p>},</span>
    <span class=p>{</span>
      <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;post-new-fruit-again&quot;</span><span class=p>,</span>
      <span class=nt>&quot;event&quot;</span><span class=p>:</span> <span class=p>[</span>
        <span class=p>{</span>
          <span class=nt>&quot;listen&quot;</span><span class=p>:</span> <span class=s2>&quot;test&quot;</span><span class=p>,</span>
          <span class=nt>&quot;script&quot;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;text/javascript&quot;</span><span class=p>,</span>
            <span class=nt>&quot;exec&quot;</span><span class=p>:</span> <span class=p>[</span>
              <span class=s2>&quot;tests[\&quot;Successful GET request\&quot;] = responseCode.code === 500;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;tests[\&quot;Response time is less than 400ms\&quot;] = responseTime &lt; 400;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;&quot;</span>
            <span class=p>]</span>
          <span class=p>}</span>
        <span class=p>}</span>
      <span class=p>],</span>
      <span class=nt>&quot;request&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&quot;url&quot;</span><span class=p>:</span> <span class=s2>&quot;{{baseUrl}}/fruits/name/Mandarin/color/Orange&quot;</span><span class=p>,</span>
        <span class=nt>&quot;method&quot;</span><span class=p>:</span> <span class=s2>&quot;POST&quot;</span><span class=p>,</span>
        <span class=nt>&quot;header&quot;</span><span class=p>:</span> <span class=p>[],</span>
        <span class=nt>&quot;body&quot;</span><span class=p>:</span> <span class=p>{},</span>
        <span class=nt>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span>
      <span class=p>},</span>
      <span class=nt>&quot;response&quot;</span><span class=p>:</span> <span class=p>[]</span>
    <span class=p>},</span>
    <span class=p>{</span>
      <span class=nt>&quot;name&quot;</span><span class=p>:</span> <span class=s2>&quot;{{baseUrl}}/fruits/{{MANDARIN_ID}}&quot;</span><span class=p>,</span>
      <span class=nt>&quot;event&quot;</span><span class=p>:</span> <span class=p>[</span>
        <span class=p>{</span>
          <span class=nt>&quot;listen&quot;</span><span class=p>:</span> <span class=s2>&quot;test&quot;</span><span class=p>,</span>
          <span class=nt>&quot;script&quot;</span><span class=p>:</span> <span class=p>{</span>
            <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;text/javascript&quot;</span><span class=p>,</span>
            <span class=nt>&quot;exec&quot;</span><span class=p>:</span> <span class=p>[</span>
              <span class=s2>&quot;tests[\&quot;Successful GET request\&quot;] = responseCode.code === 204;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;&quot;</span><span class=p>,</span>
              <span class=s2>&quot;tests[\&quot;Response time is less than 400ms\&quot;] = responseTime &lt; 400;&quot;</span>
            <span class=p>]</span>
          <span class=p>}</span>
        <span class=p>}</span>
      <span class=p>],</span>
      <span class=nt>&quot;request&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=nt>&quot;url&quot;</span><span class=p>:</span> <span class=s2>&quot;{{baseUrl}}/fruits/{{MANDARIN_ID}}&quot;</span><span class=p>,</span>
        <span class=nt>&quot;method&quot;</span><span class=p>:</span> <span class=s2>&quot;DELETE&quot;</span><span class=p>,</span>
        <span class=nt>&quot;header&quot;</span><span class=p>:</span> <span class=p>[],</span>
        <span class=nt>&quot;body&quot;</span><span class=p>:</span> <span class=p>{},</span>
        <span class=nt>&quot;description&quot;</span><span class=p>:</span> <span class=s2>&quot;&quot;</span>
      <span class=p>},</span>
      <span class=nt>&quot;response&quot;</span><span class=p>:</span> <span class=p>[]</span>
    <span class=p>}</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div> </details> <h2 id=preview-environments>Preview Environments<a class=headerlink href=#preview-environments title="Permanent link">&para;</a></h2> <blockquote> <p>When a preview environment is up and running Jenkins X will submit a comment to a Pull Request with a link to a temporary build of the project so that development members or invited end users can demo the preview. Using preview environments any pull request can have a preview version built and deployed, including libraries that feed into a downstream deployable application. This means development team members can perform code reviews, run unit or cross-functional behavior-driven development (BDD) tests, and grow consensus as to when a new feature can be deployed to production. - <a href=https://docs.cloudbees.com/docs/cloudbees-jenkins-x-distribution/latest/developer-guide/preview-environments>CloudBees Jenkins X Distribution Guide</a></p> </blockquote> <p>For more information on Preview Environments, you can read the Jenkins X <a href=https://jenkins-x.io/docs/build-test-preview/preview/ >Guide on Preview Environments</a>, or the <a href=https://jenkins-x.io/docs/build-test-preview/promotion/ >Guide on the Promotion mechanism</a> within Jenkins X.</p> <ul> <li>create preview environment</li> <li>update preview pipeline</li> <li>add mysql database as preview dependency - so we test in a throwaway database</li> <li>update application.properties file</li> <li>tweak Helm Chart configuration</li> </ul> <h3 id=create-preview-environment>Create Preview Environment<a class=headerlink href=#create-preview-environment title="Permanent link">&para;</a></h3> <p>I included this paragraph for completeness. The only thing you have to do to create a Preview Environment, is to let Jenkins X create one for you. You do this by creating a <strong><em>Pull Request</em></strong>, on an application that is managed by Jenkins X. </p> <p>If you're not sure how to create a Pull Request, <a href=https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request>GitHub has a nice guide on this</a>.</p> <h3 id=update-preview-pipeline>Update Preview Pipeline<a class=headerlink href=#update-preview-pipeline title="Permanent link">&para;</a></h3> <p>We can then call this JSON file an a new Jenkins X Pipeline step. We want to run that step against a running application, so we run it <em>after</em> preview-promote step, which will finish with confirming the preview is live.</p> <p>Which will something like this:</p> <div class="admonition example"> <p class=admonition-title>jenkins-x.yml</p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jx-preview</span>
  <span class=nt>stage</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">promote</span>
  <span class=nt>pipeline</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">pullRequest</span>
  <span class=nt>step</span><span class=p>:</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">postman-tests</span>
    <span class=nt>dir</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/workspace/source</span>
    <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">postman/newman</span>
    <span class=nt>command</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">newman</span>
    <span class=nt>args</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">run</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">postman-suite-01.json</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--global-var</span>
<span class=hll>      <span class="p p-Indicator">-</span> <span class=s>&quot;baseUrl=http://quarkus-fruits.jx-joostvdg-quarkus-fruits-pr-${PULL_NUMBER}.example.com&quot;</span>
</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--verbose</span>
  <span class=nt>type</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">after</span>
</code></pre></div> </div> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Make sure you replace the URL with the actual URL of your application.</p> <p>The baseURL highlighted in the above example, <code>http://quarkus-fruits.jx-joostvdg-quarkus-fruits-pr-${PULL_NUMBER}.example.com</code>, depends on your domain, application name and repository owner.</p> <p>Adjust the configuration accordingly!</p> </div> <p>As each PR will have a unique URL based on the PR number, we set the global variable - from Newman perspective - <code>baseUrl</code> to <code>$PULL_NUMBER</code>. Which is a <a href=https://jenkins-x.io/docs/guides/using-jx/pipelines/envvars/ >Pipeline environment variable</a> provided by the Jenkins X Pipeline.</p> <h3 id=mysql-database-as-preview-dependency>MySQL Database as Preview Dependency<a class=headerlink href=#mysql-database-as-preview-dependency title="Permanent link">&para;</a></h3> <p>You might have wondered until now, why there are two Helm Charts in the <code>charts/</code> folder. One of the Charts, which we haven't used until now, is called <code>preview</code>. </p> <p>Guess what, it is used to generate the preview environment installation. It has a <code>requirements.yaml</code> file with its dependencies. As you can see, it always includes your main application via the <code>file://../</code> directive. This <em>must</em> be the last entry.</p> <p>We use a different database for our tests, and it should be a throw-away database. The easiest way to do so, is to add <code>mysql</code> as a dependency to our Preview Chart.</p> <p>This way, every preview environment has its own database, so our tests do not pollute other PR's or our permanent databases.</p> <div class="admonition example"> <p class=admonition-title>charts/preview/requirements.yaml</p> <div class=highlight><pre><span></span><code><span class=hll><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span class=hll>  <span class=nt>version</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">1.6.3</span>
</span><span class=hll>  <span class=nt>repository</span><span class=p>:</span>  <span class="l l-Scalar l-Scalar-Plain">https://kubernetes-charts.storage.googleapis.com</span>
</span>
  <span class=c1># !! &quot;alias: preview&quot; must be last entry in dependencies array !!</span>
  <span class=c1># !! Place custom dependencies above !!</span>
<span class="p p-Indicator">-</span> <span class=nt>alias</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">preview</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">quarkus-fruits</span>
  <span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">file://../quarkus-fruits</span>
</code></pre></div> </div> <h3 id=update-properties>Update Properties<a class=headerlink href=#update-properties title="Permanent link">&para;</a></h3> <p>We make sure <code>quarkus.datasource.jdbc.url</code> is now a variable, so we can set a different value in the Preview Environment.</p> <div class="admonition example"> <p class=admonition-title>src/main/resources/application.properties</p> <p>The highlighted lines are the changes. </p> <div class=highlight><pre><span></span><code><span class=na>quarkus.datasource.db-kind</span><span class=o>=</span><span class=s>mysql</span>
<span class=na>quarkus.datasource.jdbc.url</span><span class=o>=</span><span class=s>jdbc:mysql://127.0.0.1:3306/fruits</span>
<span class=na>quarkus.datasource.jdbc.max-size</span><span class=o>=</span><span class=s>8</span>
<span class=na>quarkus.datasource.jdbc.min-size</span><span class=o>=</span><span class=s>2</span>

<span class=na>quarkus.datasource.username</span><span class=o>=</span><span class=s>${GOOGLE_SQL_USER}</span>
<span class=na>quarkus.datasource.password</span><span class=o>=</span><span class=s>${GOOGLE_SQL_PASS}</span>
<span class=hll><span class=na>quarkus.datasource.jdbc.url</span><span class=o>=</span><span class=s>${GOOGLE_SQL_CONN}</span>
</span>
<span class=na>quarkus.flyway.migrate-at-start</span><span class=o>=</span><span class=s>true</span>
<span class=na>quarkus.flyway.baseline-on-migrate</span><span class=o>=</span><span class=s>true</span>

<span class=na>quarkus.hibernate-orm.database.generation</span><span class=o>=</span><span class=s>none</span>
<span class=na>quarkus.log.level</span><span class=o>=</span><span class=s>INFO</span>
<span class=na>quarkus.log.category.&quot;org.hibernate&quot;.level</span><span class=o>=</span><span class=s>INFO</span>
</code></pre></div> </div> <h3 id=update-helm-chart>Update Helm Chart<a class=headerlink href=#update-helm-chart title="Permanent link">&para;</a></h3> <p>We have to make a few related changes.</p> <ol> <li><strong>Deployment</strong>: so we only include the CloudSQL proxy container if we will talk to a CloudSQL Database</li> <li><strong>Chart Values</strong>: to set defaults for the CloudSQL proxy container configuration</li> <li><strong>Preview Chart Values</strong>: to configure the MySQL dependency</li> </ol> <h4 id=deployment>Deployment<a class=headerlink href=#deployment title="Permanent link">&para;</a></h4> <div class="admonition example"> <p class=admonition-title>templates/deployment.yaml</p> <div class=highlight><pre><span></span><code><span class=hll><span class="p p-Indicator">{{</span> <span class=nv>if eq .Values.cloudsql.enabled &quot;true&quot;</span> <span class="p p-Indicator">}}</span>
</span><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-proxy</span>
  <span class=nt>image</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/cloudsql-docker/gce-proxy:1.16</span>
  <span class=nt>command</span><span class=p>:</span> <span class="p p-Indicator">[</span><span class=s>&quot;/cloud_sql_proxy&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;-instances={{.Values.secrets.sql_connection}}=tcp:3306&quot;</span><span class="p p-Indicator">,</span>
            <span class=s>&quot;-credential_file=/secrets/cloudsql/credentials.json&quot;</span><span class="p p-Indicator">]</span>
  <span class=nt>volumeMounts</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudsql-instance-credentials</span>
      <span class=nt>mountPath</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">/secrets/cloudsql</span>
      <span class=nt>readOnly</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=hll><span class="p p-Indicator">{{</span> <span class=nv>end</span> <span class="p p-Indicator">}}</span>
</span></code></pre></div> </div> <h4 id=chart-values>Chart Values<a class=headerlink href=#chart-values title="Permanent link">&para;</a></h4> <p>In <code>charts/Name-of-Your-Application/values.yaml</code> we set default values for the CloudSQL configuration. Namely the <code>GOOGLE_SQL_CONN</code> to connect to the CloudSQL proxy container, and <code>cloudsql.enabled=true</code> to ensure we run the CloudSQL proxy container.</p> <div class="admonition example"> <p class=admonition-title>values.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>cloudsql</span><span class=p>:</span>
  <span class=nt>enabled</span><span class=p>:</span> <span class=s>&quot;true&quot;</span>

<span class=c1># define environment variables here as a map of key: value</span>
<span class=nt>env</span><span class=p>:</span>
  <span class=nt>GOOGLE_SQL_USER</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">vault:quarkus-petclinic:GOOGLE_SQL_USER</span>
  <span class=nt>GOOGLE_SQL_CONN</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jdbc:mysql://127.0.0.1:3306/fruits</span>
</code></pre></div> </div> <h4 id=preview-chart-values>Preview Chart Values<a class=headerlink href=#preview-chart-values title="Permanent link">&para;</a></h4> <p>We add some basic configuration for our MySQL dependency. Such as the passwords, storage, and database name.</p> <p>Via the <code>preview</code> property, we configures our application's Helm Chart. We ensure our Helm Chart is configured so our application will connect to the Preview Environment's MySQL database, and not to run a CloudSQL proxy container.</p> <div class="admonition example"> <p class=admonition-title>charts/preview/values.yaml</p> <div class=highlight><pre><span></span><code><span class=nt>mysql</span><span class=p>:</span>
  <span class=nt>mysqlUser</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">fruitsadmin</span>
  <span class=nt>mysqlPassword</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">JFjec3c7MgFH6cZyKaVNaC2F</span>
  <span class=nt>mysqlRootPassword</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">4dDDPE5nj3dVPxDYsPgCzu9B</span>
  <span class=nt>mysqlDatabase</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">fruits</span>
  <span class=nt>persistence</span><span class=p>:</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>size</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">50Gi</span>

<span class=nt>preview</span><span class=p>:</span>
  <span class=nt>cloudsql</span><span class=p>:</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class=s>&quot;false&quot;</span>
  <span class=nt>secrets</span><span class=p>:</span>
    <span class=nt>sql_password</span><span class=p>:</span> <span class=s>&quot;4dDDPE5nj3dVPxDYsPgCzu9B&quot;</span>
  <span class=nt>env</span><span class=p>:</span>
    <span class=nt>GOOGLE_SQL_USER</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class=nt>GOOGLE_SQL_CONN</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jdbc:mysql://mysql:3306/fruits</span>
</code></pre></div> </div> <h3 id=ensure-sorted-list-is-returned>Ensure Sorted List Is Returned<a class=headerlink href=#ensure-sorted-list-is-returned title="Permanent link">&para;</a></h3> <p>The test I've written with PostMan is a bit silly. It evaluates each element of the returned list, expecting a fixed order.</p> <p>As our code returns a List, we can sort it via a comparator. With Java's Lambda support, this becomes a quite readable single line.</p> <div class="admonition example"> <p class=admonition-title>FruitResource.java</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Fruit</span><span class=o>&gt;</span> <span class=nf>findAll</span><span class=p>()</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=n>it</span> <span class=o>=</span> <span class=n>fruitRepository</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>Fruit</span><span class=o>&gt;</span> <span class=n>fruits</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Fruit</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=n>it</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>fruits</span><span class=p>::</span><span class=n>add</span><span class=p>);</span>
<span class=hll>    <span class=n>fruits</span><span class=p>.</span><span class=na>sort</span><span class=p>(</span><span class=n>Comparator</span><span class=p>.</span><span class=na>comparing</span><span class=p>(</span><span class=n>Fruit</span><span class=p>::</span><span class=n>getId</span><span class=p>));</span>
</span>    <span class=k>return</span> <span class=n>fruits</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> </div> <h2 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2> <p>Now that we have more tests and validations in our application, we focus our attention on how the application is running. Things like logging, metrics, and tracing.</p> <hr> <div class=md-source-date> <small> Last update: 2020-05-25 19:52:48 </small> </div> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>var disqus_config=function(){this.page.url="https://joostvdg.github.io/jenkinsx/java-native-prod/08-preview-int-test/",this.page.identifier="/jenkinsx/java-native-prod/08-preview-int-test/"};!function(){var e=document,i=e.createElement("script");i.src="//joostvdg-github-io.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(i)}()</script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../07-pipeline-improvements/ title="Pipeline Improvements" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Pipeline Improvements </div> </div> </a> <a href=../09-production-improvements/ title="Production Improvements" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Production Improvements </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Joost van der Griendt </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/joostvdg target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/joost_vdg target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/joostvdg target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/vendor.d710d30a.min.js></script> <script src=../../../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../../..",
          features: ["tabs", "instant"],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>