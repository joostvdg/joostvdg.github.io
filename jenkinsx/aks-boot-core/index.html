<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Installing Jenkins X on AKS with jx boot + CloudDNS + TLS"><link href=https://joostvdg.github.io/jenkinsx/aks-boot-core/ rel=canonical><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.2"><title>Jenkins X: jx boot + AKS</title><link rel=stylesheet href=../../assets/stylesheets/application.30686662.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#fb8c00><script src=../../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-145385967-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=orange data-md-color-accent=red> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#jenkins-x-on-aks-with-jx-boot-cloudbees-core tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-header-nav__button md-logo"> <i class=md-icon>public</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> J's Software Development Pages </span> <span class=md-header-nav__topic> Jenkins X: jx boot + AKS </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../blogs/jenkins-pipeline-support-tool/ class=md-tabs__link> Blogs </a> </li> <li class=md-tabs__item> <a href=../../cloudbees/sso-azure-ad/ class=md-tabs__link> CICD </a> </li> <li class=md-tabs__item> <a href=../../kubernetes/ class=md-tabs__link> Containers </a> </li> <li class=md-tabs__item> <a href=../../cloud/automation-pulumi/ class=md-tabs__link> Cloud </a> </li> <li class=md-tabs__item> <a href=../../certificates/lets-encrypt-k8s/ class=md-tabs__link> SWE </a> </li> <li class=md-tabs__item> <a href=../../java/ class=md-tabs__link> Java </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://joostvdg.github.io title="J's Software Development Pages" class="md-nav__button md-logo"> <i class=md-icon>public</i> </a> J's Software Development Pages </label> <div class=md-nav__source> <a href=https://github.com/joostvdg/joostvdg.github.io/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> joostvdg/joostvdg.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Me class=md-nav__link> Me </a> </li> <li class=md-nav__item> <a href=../../other/mkdocs/ title="MKDocs (This Static Website)" class=md-nav__link> MKDocs (This Static Website) </a> </li> <li class=md-nav__item> <a href=../../other/vim/ title=VIM class=md-nav__link> VIM </a> </li> <li class=md-nav__item> <a href=../../other/shell/ title=Shell class=md-nav__link> Shell </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Blogs </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/jenkins-pipeline-support-tool/ title="Jenkins Pipeline Support Tools" class=md-nav__link> Jenkins Pipeline Support Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/graceful-shutdown/ title="Docker Graceful Shutdown" class=md-nav__link> Docker Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../blogs/docker-alternatives/ title="Pipelines with Docker Alternatives" class=md-nav__link> Pipelines with Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../blogs/k8s-lets-encrypt/ title="Let's Encrypt for Kubernetes Apps" class=md-nav__link> Let's Encrypt for Kubernetes Apps </a> </li> <li class=md-nav__item> <a href=../../blogs/sso-azure-ad/ title="CloudBees SSO Azure AD" class=md-nav__link> CloudBees SSO Azure AD </a> </li> <li class=md-nav__item> <a href=../../blogs/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../blogs/kubernetes-sso-keycloak/ title="Kubernetes SSO Keycloak" class=md-nav__link> Kubernetes SSO Keycloak </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8> <label class=md-nav__link for=nav-2-8> Jenkins Monitoring Kubernetes </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-8> Jenkins Monitoring Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/introduction/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/prepare/ title="Prepare Environment" class=md-nav__link> Prepare Environment </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/install/ title="Install Tools" class=md-nav__link> Install Tools </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/metrics/ title=Metrics class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/alerts/ title=Alerts class=md-nav__link> Alerts </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/pipeline/ title=Pipeline class=md-nav__link> Pipeline </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/dashboard/ title=Dashboard class=md-nav__link> Dashboard </a> </li> <li class=md-nav__item> <a href=../../blogs/monitor-jenkins-on-k8s/cloudbees/ title=CloudBees class=md-nav__link> CloudBees </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../blogs/k8s-crd/ title="Create your own k8s resource" class=md-nav__link> Create your own k8s resource </a> </li> <li class=md-nav__item> <a href=../../blogs/dockercon-eu-2018/ title="DockerCon EU 2018" class=md-nav__link> DockerCon EU 2018 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3 checked> <label class=md-nav__link for=nav-3> CICD </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> CICD </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-1 type=checkbox id=nav-3-1> <label class=md-nav__link for=nav-3-1> CloudBees </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-1> CloudBees </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloudbees/sso-azure-ad/ title="Single Sign On - AzureAD" class=md-nav__link> Single Sign On - AzureAD </a> </li> <li class=md-nav__item> <a href=../../cloudbees/teams-automation/ title="CloudBees Automate Teams" class=md-nav__link> CloudBees Automate Teams </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-gke-helm/ title="CloudBees Core on GKE" class=md-nav__link> CloudBees Core on GKE </a> </li> <li class=md-nav__item> <a href=../../cloudbees/cbc-eks/ title="CloudBees Core on EKS" class=md-nav__link> CloudBees Core on EKS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-2 type=checkbox id=nav-3-2 checked> <label class=md-nav__link for=nav-3-2> Jenkins X </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-2> Jenkins X </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> JX Boot & CloudBees Core </label> <a href=./ title="JX Boot & CloudBees Core" class="md-nav__link md-nav__link--active"> JX Boot & CloudBees Core </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#create-aks-cluster class=md-nav__link> Create AKS Cluster </a> </li> <li class=md-nav__item> <a href=#install-jenkins-x class=md-nav__link> Install Jenkins X </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#boot-config class=md-nav__link> Boot Config </a> </li> <li class=md-nav__item> <a href=#external-dns class=md-nav__link> External DNS </a> </li> <li class=md-nav__item> <a href=#tls-config class=md-nav__link> TLS Config </a> </li> <li class=md-nav__item> <a href=#docker-registry-config class=md-nav__link> Docker Registry Config </a> </li> <li class=md-nav__item> <a href=#tls-for-application-in-environment class=md-nav__link> TLS For Application In Environment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#install-cloudbees-core class=md-nav__link> Install CloudBees Core </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#requirementsyaml class=md-nav__link> requirements.yaml </a> </li> <li class=md-nav__item> <a href=#valuesyaml class=md-nav__link> values.yaml </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../hello-world/ title=HelloWorld class=md-nav__link> HelloWorld </a> </li> <li class=md-nav__item> <a href=../buildpack/ title=BuildPack class=md-nav__link> BuildPack </a> </li> <li class=md-nav__item> <a href=../maven/ title=Maven class=md-nav__link> Maven </a> </li> <li class=md-nav__item> <a href=../hybrid/ title=Hybrid class=md-nav__link> Hybrid </a> </li> <li class=md-nav__item> <a href=../kubernetes-days/ title="Example For Console Reel" class=md-nav__link> Example For Console Reel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Jenkins </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-3> Jenkins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jobdsl/ title=JobDSL class=md-nav__link> JobDSL </a> </li> <li class=md-nav__item> <a href=../../jenkins-jobs/jenkins-jobs-builder/ title=JenkinsJobsBuilder class=md-nav__link> JenkinsJobsBuilder </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-4 type=checkbox id=nav-3-4> <label class=md-nav__link for=nav-3-4> Jenkins Pipelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-4> Jenkins Pipelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline/job-types/ title="Job Types" class=md-nav__link> Job Types </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/kaniko-pipelines/ title="Build Docker Image Kaniko" class=md-nav__link> Build Docker Image Kaniko </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/podtemplate-dind/ title="PodTemplate With Docker-In-Docker" class=md-nav__link> PodTemplate With Docker-In-Docker </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/jenkins-parallel-pipeline/ title="Parallel Pipelines" class=md-nav__link> Parallel Pipelines </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/core-concepts/ title="Core Concepts" class=md-nav__link> Core Concepts </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/artifactory-integration/ title="Artifactory Integration" class=md-nav__link> Artifactory Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/declarative-pipeline/ title="Pipeline (declarative)" class=md-nav__link> Pipeline (declarative) </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/groovy-pipeline/ title="Groovy DSL Pipeline" class=md-nav__link> Groovy DSL Pipeline </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/global-shared-library/ title="Pipeline Libraries" class=md-nav__link> Pipeline Libraries </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/ide-integration-pipeline-dsl/ title="DSL IDE Integration" class=md-nav__link> DSL IDE Integration </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline/input/ title=Input class=md-nav__link> Input </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-5 type=checkbox id=nav-3-5> <label class=md-nav__link for=nav-3-5> Jenkins Pipeline Examples </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-5> Jenkins Pipeline Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/ title=Index class=md-nav__link> Index </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-alternatives/ title="Docker Alternatives" class=md-nav__link> Docker Alternatives </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/maven-declarative/ title="Maven Declarative" class=md-nav__link> Maven Declarative </a> </li> <li class=md-nav__item> <a href=../../jenkins-pipeline-examples/docker-declarative/ title="Docker Declarative" class=md-nav__link> Docker Declarative </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Containers </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Containers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1> <label class=md-nav__link for=nav-4-1> Kubernetes (K8S) </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> Kubernetes (K8S) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../kubernetes/cka-exam-prep/ title="CKA Exam prep" class=md-nav__link> CKA Exam prep </a> </li> <li class=md-nav__item> <a href=../../kubernetes/tools/ title=Tools class=md-nav__link> Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> K8S Public Services </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-2> K8S Public Services </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/distributions/install-gke/ title=GKE class=md-nav__link> GKE </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/eks-eksctl/ title="AWS EKS" class=md-nav__link> AWS EKS </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-cli/ title="AKS CLI" class=md-nav__link> AKS CLI </a> </li> <li class=md-nav__item> <a href=../../kubernetes/distributions/aks-terraform/ title="AKS Terraform" class=md-nav__link> AKS Terraform </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> K8S Hard Way - GCE </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-3> K8S Hard Way - GCE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/ title="Installer Preparation" class=md-nav__link> Installer Preparation </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/terraform-compute/ title="Create GCE resources" class=md-nav__link> Create GCE resources </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/certificates/ title="Prepare Certificates" class=md-nav__link> Prepare Certificates </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/kubeconfigs/ title="Prepare Kubeconfigs" class=md-nav__link> Prepare Kubeconfigs </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/encryption/ title="Encryption configuration" class=md-nav__link> Encryption configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/etcd/ title="ETCD configuration" class=md-nav__link> ETCD configuration </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/controller/ title="Controller Config" class=md-nav__link> Controller Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/worker/ title="Worker Config" class=md-nav__link> Worker Config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/remote-access/ title="Remote access" class=md-nav__link> Remote access </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/network/ title="Network config" class=md-nav__link> Network config </a> </li> <li class=md-nav__item> <a href=../../kubernetes/khw-gce/debug/ title=Debug class=md-nav__link> Debug </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4> <label class=md-nav__link for=nav-4-4> Docker </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-4> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docker/graceful-shutdown/ title="Graceful Shutdown" class=md-nav__link> Graceful Shutdown </a> </li> <li class=md-nav__item> <a href=../../docker/build-kit/ title=BuildKit class=md-nav__link> BuildKit </a> </li> <li class=md-nav__item> <a href=../../docker/multi-stage-builds/ title="Multi-Stage Builds(TBD)" class=md-nav__link> Multi-Stage Builds(TBD) </a> </li> <li class=md-nav__item> <a href=../../docker/swarm/ title="Swarm (mode) (TBD)" class=md-nav__link> Swarm (mode) (TBD) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-5> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../linux/systemd/ title=SystemD class=md-nav__link> SystemD </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Cloud </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Cloud </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cloud/automation-pulumi/ title="Automation - Pulumi" class=md-nav__link> Automation - Pulumi </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> SWE </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> SWE </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../certificates/lets-encrypt-k8s/ title="Let's Encrypt K8S" class=md-nav__link> Let's Encrypt K8S </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Software Engineering </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Software Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../swe/important-concepts/ title="Important Concepts" class=md-nav__link> Important Concepts </a> </li> <li class=md-nav__item> <a href=../../swe/naming/ title=Naming class=md-nav__link> Naming </a> </li> <li class=md-nav__item> <a href=../../swe/distributed/ title="Distributed Computing" class=md-nav__link> Distributed Computing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> Productivity </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-3> Productivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../productivity/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../productivity/incidents/ title=Incidents class=md-nav__link> Incidents </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../java/ title=General class=md-nav__link> General </a> </li> <li class=md-nav__item> <a href=../../keep-watching/ title="Spring Boot App" class=md-nav__link> Spring Boot App </a> </li> <li class=md-nav__item> <a href=../../java/networking/ title="Java Networking" class=md-nav__link> Java Networking </a> </li> <li class=md-nav__item> <a href=../../java/concurrency/ title="Java Concurrency" class=md-nav__link> Java Concurrency </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#create-aks-cluster class=md-nav__link> Create AKS Cluster </a> </li> <li class=md-nav__item> <a href=#install-jenkins-x class=md-nav__link> Install Jenkins X </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#boot-config class=md-nav__link> Boot Config </a> </li> <li class=md-nav__item> <a href=#external-dns class=md-nav__link> External DNS </a> </li> <li class=md-nav__item> <a href=#tls-config class=md-nav__link> TLS Config </a> </li> <li class=md-nav__item> <a href=#docker-registry-config class=md-nav__link> Docker Registry Config </a> </li> <li class=md-nav__item> <a href=#tls-for-application-in-environment class=md-nav__link> TLS For Application In Environment </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#install-cloudbees-core class=md-nav__link> Install CloudBees Core </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#requirementsyaml class=md-nav__link> requirements.yaml </a> </li> <li class=md-nav__item> <a href=#valuesyaml class=md-nav__link> values.yaml </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> </li> <li class=md-nav__item> <a href=#__comments title=Comments class="md-nav__link md-nav__link--active"> Comments </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/joostvdg/joostvdg.github.io/edit/master/docs/jenkinsx/aks-boot-core.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=jenkins-x-on-aks-with-jx-boot-cloudbees-core>Jenkins X On AKS With JX Boot &amp; CloudBees Core<a class=headerlink href=#jenkins-x-on-aks-with-jx-boot-cloudbees-core title="Permanent link">&para;</a></h1> <p>The goal of the guide is the following:</p> <blockquote> <p>manage CloudBees Core on Modern via Jenkins X in its own environment/namespace.</p> </blockquote> <p>To make it more interesting, we add more variables in the mix in the form of "requirements".</p> <ul> <li>cluster must NOT run on GKE, Jenkins X works pretty well there and doesn't teach us much</li> <li>every exposed service MUST use TLS, no excuses</li> <li>we do not want to create a certificate for every service that uses TLS</li> <li>as much as possible must be <strong>Configuration-as-Code</strong></li> </ul> <p>In conclusion:</p> <ul> <li>We use <a href=/kubernetes/distributions/aks-terraform.md>Terraform</a> to manage the Kubernetes Cluster on <strong>AKS</strong></li> <li><a href=https://jenkins-x.io/docs/reference/boot/ >JX Boot</a> to manage Jenkins X</li> <li>We use Google CloudDNS to manage the DNS<ul> <li>this enables us to validate an entire subdomain via Let's Encrypt in one go</li> </ul> </li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Unfortunately, these are already quite a lot of requirements. The Vault integration on anywhere but GKE is not stable. So we cheat and use <code class=codehilite><span class=k>local</span></code> storage for credentials, meaning we need to use <code class=codehilite><span class=n>jx</span> <span class=n>boot</span></code> every time to upgrade the cluster.</p> <p>We will come back to this!</p> </div> <h2 id=create-aks-cluster>Create AKS Cluster<a class=headerlink href=#create-aks-cluster title="Permanent link">&para;</a></h2> <p>Either create a cluster via <a href=/kubernetes/distributions/aks-terraform.md>AKS Terraform</a> (recommended) or via <a href=/kubernetes/distributions/aks-cli.md>AKS CLI</a>.</p> <h2 id=install-jenkins-x>Install Jenkins X<a class=headerlink href=#install-jenkins-x title="Permanent link">&para;</a></h2> <h3 id=boot-config>Boot Config<a class=headerlink href=#boot-config title="Permanent link">&para;</a></h3> <p>Make a fork of the <a href=https://github.com/jenkins-x/jenkins-x-boot-config.git>jenkins-x-boot-config</a> repository and clone it.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nv>GH_USER</span><span class=o>=</span>
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span>git clone https://github.com/<span class=si>${</span><span class=nv>GH_USER</span><span class=si>}</span>/jenkins-x-boot-config.git
<span class=nb>cd</span> jenkins-x-boot-config
</pre></div> </td></tr></table> <p>Changes to make:</p> <ul> <li>provider from <code class=codehilite><span class=n>gke</span></code> to <code class=codehilite><span class=n>aks</span></code></li> <li>set domain</li> <li>set clustername</li> <li>set external dns (see below)</li> <li>set repository value for each environments (not dev) as below</li> </ul> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class="p p-Indicator">-</span> <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">staging</span>
  <span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">environment-jx-aks-staging</span>
</pre></div> </td></tr></table> <h3 id=external-dns>External DNS<a class=headerlink href=#external-dns title="Permanent link">&para;</a></h3> <p>Using Google CloudDNS:</p> <ul> <li>login to the GCP account you want to use</li> <li>enable CloudDNS API by going to it</li> <li>create a CloudDNS zone for your subdomain<ul> <li>if the main domain is <code class=codehilite><span class=n>example</span><span class=p>.</span><span class=n>com</span></code> -&gt; <code class=codehilite><span class=n>aks</span><span class=p>.</span><span class=n>example</span><span class=p>.</span><span class=n>com</span></code></li> <li>once created, you get <code class=codehilite><span class=n>NS</span></code> entries, copy these (usualy in the form <code class=codehilite><span class=n>ns</span><span class=o>-</span><span class=n>cloud</span><span class=o>-</span><span class=n>X</span><span class=err>{</span><span class=mi>1</span><span class=o>-</span><span class=mi>4</span><span class=err>}</span><span class=p>.</span><span class=n>googledomains</span><span class=p>.</span><span class=n>com</span></code></li> </ul> </li> <li>in your Domain's DNS configuration, map your subdomain to these <code class=codehilite><span class=n>NS</span></code> entries</li> <li>create a service account that can use CloudDNS API</li> <li>add the Google Project to which the Service Account belongs to: <code class=codehilite><span class=n>jx</span><span class=o>-</span><span class=n>requirements</span><span class=p>.</span><span class=n>yaml</span></code> and <code class=codehilite><span class=k>values</span><span class=p>.</span><span class=n>yaml</span></code></li> <li>export the <code class=codehilite><span class=n>json</span></code> configuration file<ul> <li>rename the file to <code class=codehilite><span class=n>credentials</span><span class=p>.</span><span class=n>json</span></code></li> </ul> </li> <li>create secret a secret in Kubernetes<ul> <li><code class=codehilite><span class=n>kubectl</span> <span class=k>create</span> <span class=n>secret</span> <span class=n>generic</span> <span class=k>external</span><span class=o>-</span><span class=n>dns</span><span class=o>-</span><span class=n>gcp</span><span class=o>-</span><span class=n>sa</span> <span class=c1>--from-file=credentials.json</span></code></li> </ul> </li> <li>fix external dns values template -&gt; <code class=codehilite><span class=n>systems</span><span class=o>/</span><span class=k>external</span><span class=o>-</span><span class=n>dns</span><span class=o>/</span><span class=k>values</span><span class=p>.</span><span class=n>tmpl</span><span class=p>.</span><span class=n>yaml</span></code><ul> <li>add <code class=codehilite><span class=x>project: &quot;</span><span class=cp>{{</span> <span class=nv>.Requirements.cluster.project</span> <span class=cp>}}</span><span class=x>&quot;</span></code> to <code class=codehilite><span class=k>external</span><span class=o>-</span><span class=n>dns</span></code>.<code class=codehilite><span class=n>google</span></code></li> </ul> </li> </ul> <div class="admonition important"> <p class=admonition-title>Important</p> <p>You have to create the secret <code class=codehilite><span class=k>external</span><span class=o>-</span><span class=n>dns</span><span class=o>-</span><span class=n>gcp</span><span class=o>-</span><span class=n>sa</span></code> in every namespace you set up TLS via the <code class=codehilite><span class=n>dns01</span></code> challenge.</p> </div> <details class=example><summary>jx-requirements.yaml</summary><p>We're omitting the default values as much as possible, such as the <code class=codehilite><span class=n>dev</span></code> and <code class=codehilite><span class=n>production</span></code> environments.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>cluster</span><span class=p>:</span>
<span class=nt>environmentGitOwner</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;YOUR GITHUB ACCOUNT&gt;</span>
<span class=nt>gitKind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">github</span>
<span class=nt>gitName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">github</span>
<span class=nt>gitServer</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://github.com</span>
<span class=nt>namespace</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">jx</span>
<span class=nt>project</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">your-google-project</span>
<span class=nt>provider</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">aks</span>
<span class=nt>environments</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>ingress</span><span class=p>:</span>
    <span class=nt>domain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">staging.aks.example.com</span>
    <span class=nt>externalDNS</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>namespaceSubDomain</span><span class=p>:</span> <span class=s>&quot;&quot;</span>
    <span class=nt>tls</span><span class=p>:</span>
    <span class=nt>email</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;YOUR EMAIL ADDRESS&gt;</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>production</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">environment-jx-aks-staging</span>
<span class=nt>gitops</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>ingress</span><span class=p>:</span>
<span class=nt>domain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">aks.example.com</span>
<span class=nt>externalDNS</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>namespaceSubDomain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">-jx.</span>
<span class=nt>tls</span><span class=p>:</span>
    <span class=nt>email</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;YOUR EMAIL ADDRESS&gt;</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>production</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>kaniko</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=nt>secretStorage</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>
</pre></div> </td></tr></table> </details> <details class=example><summary>values.yaml</summary><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>cluster</span><span class=p>:</span>
    <span class=nt>projectID</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">your-google-project</span>
</pre></div> </td></tr></table> </details> <h3 id=tls-config>TLS Config<a class=headerlink href=#tls-config title="Permanent link">&para;</a></h3> <p>Update the <code class=codehilite><span class=n>jx</span><span class=o>-</span><span class=n>requirements</span><span class=p>.</span><span class=n>yaml</span></code>, make sure <code class=codehilite><span class=n>ingress</span></code> configuration is correct:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>ingress</span><span class=p>:</span>
  <span class=nt>domain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">aks.example.com</span>
  <span class=nt>externalDNS</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class=nt>namespaceSubDomain</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">-jx.</span>
  <span class=nt>tls</span><span class=p>:</span>
    <span class=nt>email</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">admin@example.com</span>
    <span class=nt>enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>production</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div> </td></tr></table> <p>If all is done correctly with the CloudDNS configuration, the external dns will contain all the entries of the <code class=codehilite><span class=n>jx</span></code> services (such as hook, chartmuseum) and certmanager will be able to verify the domain with Let's Encrypt.</p> <h3 id=docker-registry-config>Docker Registry Config<a class=headerlink href=#docker-registry-config title="Permanent link">&para;</a></h3> <div class="admonition example"> <p class=admonition-title>values.yaml</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>jenkins-x-platform</span><span class=p>:</span>
    <span class=nt>dockerRegistry</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myacr.azurecr.io</span>
</pre></div> </td></tr></table> <p>This was not enough, added it to the values template: <code class=codehilite><span class=n>env</span><span class=o>/</span><span class=n>jenkins</span><span class=o>-</span><span class=n>x</span><span class=o>-</span><span class=n>platform</span><span class=o>/</span><span class=k>values</span><span class=p>.</span><span class=n>tmpl</span><span class=p>.</span><span class=n>yaml</span></code></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>dockerRegistry</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">myacr.azurecr.io</span>
</pre></div> </td></tr></table> </div> <h3 id=tls-for-application-in-environment>TLS For Application In Environment<a class=headerlink href=#tls-for-application-in-environment title="Permanent link">&para;</a></h3> <ul> <li>create issuer</li> <li>create certificate</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This implies you need to run <code class=codehilite><span class=n>jx</span> <span class=n>boot</span></code> at least once before working on your environment configuration!</p> </div> <p>Easiest way I found, was to copy the yaml from the issuer and certificate in the <code class=codehilite><span class=n>jx</span></code> namespace. You then remove the unnecesary elements, those generated by Kubernetes itself (such as creation date, status, etc).</p> <p>You have to change the domain name and hosts values, as they should now point to the subdomain corresponding to this environment (unless its production). Once the files are good, you add them to your environment. You do so, by adding them to the templates folder -&gt; <code class=codehilite><span class=n>env</span><span class=o>/</span><span class=n>templates</span></code>.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span>.
├── Jenkinsfile
├── LICENSE
├── Makefile
├── README.md
├── env
│   ├── Chart.yaml
│   ├── requirements.yaml
│   ├── templates
<span class=hll>│   │   ├── certificate.yaml
</span><span class=hll>│   │   └── issuer.yaml
</span>│   └── values.yaml
└── jenkins-x.yml
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>kubectl -n jx get issuer letsencrypt-prod -o yaml
</pre></div> </td></tr></table> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>kubectl -n jx get certificate tls-&lt;unique to your cluster&gt;-p -o yaml
</pre></div> </td></tr></table> <details class=example><summary>issuer.yaml</summary><p>The end result should look like this:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">certmanager.k8s.io/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Issuer</span>
<span class=nt>metadata</span><span class=p>:</span>
  <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
<span class=nt>spec</span><span class=p>:</span>
  <span class=nt>acme</span><span class=p>:</span>
    <span class=nt>email</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">admin@example.com</span>
    <span class=nt>privateKeySecretRef</span><span class=p>:</span>
      <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
    <span class=nt>server</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://acme-v02.api.letsencrypt.org/directory</span>
    <span class=nt>solvers</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=nt>dns01</span><span class=p>:</span>
        <span class=nt>clouddns</span><span class=p>:</span>
          <span class=nt>project</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">your-google-project</span>
          <span class=nt>serviceAccountSecretRef</span><span class=p>:</span>
            <span class=nt>key</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">credentials.json</span>
            <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">external-dns-gcp-sa</span>
      <span class=nt>selector</span><span class=p>:</span>
        <span class=nt>dnsNames</span><span class=p>:</span>
        <span class="p p-Indicator">-</span> <span class=s>&#39;*.staging.aks.example.com&#39;</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">staging.aks.example.com</span>
</pre></div> </td></tr></table> </details> <details class=example><summary>certificate.yaml</summary><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>apiVersion</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">certmanager.k8s.io/v1alpha1</span>
<span class=nt>kind</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Certificate</span>
<span class=nt>metadata</span><span class=p>:</span>
    <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">tls-staging-aks-example-com-p</span>
<span class=nt>spec</span><span class=p>:</span>
    <span class=nt>commonName</span><span class=p>:</span> <span class=s>&#39;*.staging.aks.example.com&#39;</span>
    <span class=nt>dnsNames</span><span class=p>:</span>
    <span class="p p-Indicator">-</span> <span class=s>&#39;*.staging.aks.example.com&#39;</span>
    <span class=nt>issuerRef</span><span class=p>:</span>
        <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
    <span class=nt>secretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">tls-staging-aks-example-com-p</span>
</pre></div> </td></tr></table> </details> <h2 id=install-cloudbees-core>Install CloudBees Core<a class=headerlink href=#install-cloudbees-core title="Permanent link">&para;</a></h2> <p>In order to install CloudBees Core with TLS, we need the following:</p> <ul> <li>TLS configuration for the environment Core is landing in (see above on how)</li> <li>add CloudBees Core as a requirement to the <code class=codehilite><span class=n>env</span><span class=o>/</span><span class=n>requirements</span><span class=p>.</span><span class=n>yaml</span></code></li> <li>add configuration for CloudBees Core to the <code class=codehilite><span class=n>env</span><span class=o>/</span><span class=k>values</span><span class=p>.</span><span class=n>yaml</span></code></li> </ul> <h3 id=requirementsyaml>requirements.yaml<a class=headerlink href=#requirementsyaml title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>dependencies</span><span class=p>:</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">exposecontroller</span>
  <span class=nt>version</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">2.3.89</span>
  <span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http://chartmuseum.jenkins-x.io</span>
  <span class=nt>alias</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">expose</span>
<span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">exposecontroller</span>
  <span class=nt>version</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">2.3.89</span>
  <span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">http://chartmuseum.jenkins-x.io</span>
  <span class=nt>alias</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cleanup</span>
<span class=hll><span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cloudbees-core</span>
</span><span class=hll>  <span class=nt>version</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">2.176.203</span>
</span><span class=hll>  <span class=nt>repository</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://charts.cloudbees.com/public/cloudbees</span>
</span><span class=hll>  <span class=nt>alias</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cbcore</span>
</span></pre></div> </td></tr></table> <h3 id=valuesyaml>values.yaml<a class=headerlink href=#valuesyaml title="Permanent link">&para;</a></h3> <div class="admonition important"> <p class=admonition-title>Important</p> <p>The value you've set for the <code class=codehilite><span class=k>alias</span></code> in the requirements, is your entrypoint for the configuration in the <code class=codehilite><span class=k>values</span><span class=p>.</span><span class=n>yaml</span></code>!</p> <p>Also, take care to change the following values to reflect your environment! * OperationsCenter.HostName * OperationsCenter.Ingress.tls.Host * OperationsCenter.Ingress.tls.SecretName</p> </div> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nt>cbcore</span><span class=p>:</span>
  <span class=nt>OperationsCenter</span><span class=p>:</span>
    <span class=nt>CSRF</span><span class=p>:</span>
      <span class=nt>ProxyCompatibility</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class=nt>HostName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cbcore.staging.aks.example.com</span>
    <span class=nt>Ingress</span><span class=p>:</span>
      <span class=nt>Annotations</span><span class=p>:</span>
        <span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class=nt>kubernetes.io/tls-acme</span><span class=p>:</span> <span class=s>&quot;true&quot;</span>
        <span class=nt>nginx.ingress.kubernetes.io/app-root</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">https://$best_http_host/cjoc/teams-check/</span>
        <span class=nt>nginx.ingress.kubernetes.io/proxy-body-size</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">50m</span>
        <span class=nt>nginx.ingress.kubernetes.io/proxy-request-buffering</span><span class=p>:</span> <span class=s>&quot;off&quot;</span>
        <span class=nt>nginx.ingress.kubernetes.io/ssl-redirect</span><span class=p>:</span> <span class=s>&quot;true&quot;</span>
      <span class=nt>tls</span><span class=p>:</span>
        <span class=nt>Enable</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class=nt>Host</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">cbcore.staging.aks.example.com</span>
        <span class=nt>SecretName</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">tls-staging-aks-example-com-p</span>
    <span class=nt>ServiceType</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
  <span class=nt>nginx-ingress</span><span class=p>:</span>
    <span class=nt>Enabled</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div> </td></tr></table> <h2 id=resources>Resources<a class=headerlink href=#resources title="Permanent link">&para;</a></h2> <ul> <li><a href=https://cloud.google.com/iam/docs/creating-managing-service-account-keys#iam-service-account-keys-create-console>https://cloud.google.com/iam/docs/creating-managing-service-account-keys#iam-service-account-keys-create-console</a></li> <li><a href=https://medium.com/google-cloud/kubernetes-w-lets-encrypt-cloud-dns-c888b2ff8c0e>https://medium.com/google-cloud/kubernetes-w-lets-encrypt-cloud-dns-c888b2ff8c0e</a></li> <li><a href="https://support.google.com/domains/answer/3290309?hl=en-GB&ref_topic=9018335">https://support.google.com/domains/answer/3290309?hl=en-GB&amp;ref_topic=9018335</a></li> <li><a href=https://thorsten-hans.com/how-to-use-private-azure-container-registry-with-kubernetes>https://thorsten-hans.com/how-to-use-private-azure-container-registry-with-kubernetes</a></li> <li><a href=https://cloud.google.com/dns/docs/migrating>https://cloud.google.com/dns/docs/migrating</a></li> </ul> <h2 id=__comments>Comments</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://joostvdg.github.io/jenkinsx/aks-boot-core/";
      this.page.identifier =
        "/jenkinsx/aks-boot-core/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//joostvdg-github-io.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../../cloudbees/cbc-eks/ title="CloudBees Core on EKS" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> CloudBees Core on EKS </span> </div> </a> <a href=../hello-world/ title=HelloWorld class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> HelloWorld </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 Joost van der Griendt </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/joostvdg class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/joost_vdg class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/joostvdg class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c648116f.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> </body> </html>